import{a as T}from"./CTy_bxvY.js";import{a as p,r as w}from"./H-cN399H.js";var o,u;function M(){if(u)return o;u=1,o=i;var s=T().codes,_=s.ERR_METHOD_NOT_IMPLEMENTED,l=s.ERR_MULTIPLE_CALLBACK,c=s.ERR_TRANSFORM_ALREADY_TRANSFORMING,m=s.ERR_TRANSFORM_WITH_LENGTH_0,f=p();w()(i,f);function R(r,t){var e=this._transformState;e.transforming=!1;var a=e.writecb;if(a===null)return this.emit("error",new l);e.writechunk=null,e.writecb=null,t!=null&&this.push(t),a(r);var n=this._readableState;n.reading=!1,(n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}function i(r){if(!(this instanceof i))return new i(r);f.call(this,r),this._transformState={afterTransform:R.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,r&&(typeof r.transform=="function"&&(this._transform=r.transform),typeof r.flush=="function"&&(this._flush=r.flush)),this.on("prefinish",d)}function d(){var r=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(t,e){h(r,t,e)}):h(this,null,null)}i.prototype.push=function(r,t){return this._transformState.needTransform=!1,f.prototype.push.call(this,r,t)},i.prototype._transform=function(r,t,e){e(new _("_transform()"))},i.prototype._write=function(r,t,e){var a=this._transformState;if(a.writecb=e,a.writechunk=r,a.writeencoding=t,!a.transforming){var n=this._readableState;(a.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}},i.prototype._read=function(r){var t=this._transformState;t.writechunk!==null&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},i.prototype._destroy=function(r,t){f.prototype._destroy.call(this,r,function(e){t(e)})};function h(r,t,e){if(t)return r.emit("error",t);if(e!=null&&r.push(e),r._writableState.length)throw new m;if(r._transformState.transforming)throw new c;return r.push(null)}return o}export{M as r};

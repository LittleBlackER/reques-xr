var m0=Object.defineProperty;var g0=(t,e,n)=>e in t?m0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var g=(t,e,n)=>g0(t,typeof e!="symbol"?e+"":e,n);import{b as y0,r as w0,a as b0}from"./H-cN399H.js";import"./PfVXPUeE.js";import{V as Q,Q as gn,a as ea,P as v0,C as yn,z as Si,B as x0,D as ql,E as Fr,c as xr,H as ec,d as sr,I as S0,J as E0,N as tc}from"./DSNNqjDP.js";import{P as C0,C as nc,I as cn}from"./SZZ8NaUf.js";import{S as Eo,A as sc}from"./DqSBQOHB.js";import{c as jl,b as A0,r as k0}from"./CTy_bxvY.js";import{r as P0}from"./wN59b_Al.js";import{r as _0}from"./CCNg_wXw.js";import{r as T0}from"./DgnVQLLQ.js";import{f as R0,g as M0}from"./CZq0xcQz.js";import{_ as ta,a as na,b as Wl}from"./CaAMb0zI.js";import{p as I0,a as L0,i as B0,c as Vl,b as F0,r as D0}from"./ClVnoY18.js";import"./DRK5nedI.js";import"./CVOG6I8Y.js";import"./CXnJwLpf.js";import"./DfavyPf3.js";import"./Bj40Iw6y.js";import"./DaTJh3Re.js";import"./D9FROM4Y.js";import"./l8tU0ONq.js";import"./BH2782tf.js";import"./B5PtpWph.js";import"./C7wh6v0-.js";import"./CQwZNWSf.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();var It=(t=>(t.HIGH="high",t.MEDIUM="medium",t.LOW="low",t.LOW_VR="lowVR",t))(It||{});const Kl=()=>!sa()&&!Qt()&&!Gl()&&!N0(),Gl=()=>{const t=navigator.userAgent.includes("Macintosh"),e=navigator.maxTouchPoints===5,n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return t&&e&&n},sa=()=>navigator.userAgent.includes("Quest"),N0=()=>{const t=navigator.userAgent.toLowerCase();return t.includes("pico")||t.includes("picolrowser")},Qt=()=>["iOS","Android"].includes(O0()),ra=()=>new URL(location.href).searchParams.has("nowheel"),Zl=()=>new URL(location.href).searchParams.has("nowheel"),O0=()=>{const t=window.navigator.userAgent.toLowerCase(),e=window.navigator.platform.toLowerCase();return/iphone|ipad|ipod/.test(t)?"iOS":/android/.test(t)?"Android":/mac/.test(e)?"macOS":/win/.test(e)?"Windows":/linux/.test(e)?"Linux":"Unknown"};class U0{constructor(){g(this,"HIGH_FPS_THRESHOLD",45);g(this,"MEDIUM_FPS_THRESHOLD",30);g(this,"HIGH_MEMORY_THRESHOLD",4*1024*1024*1024);g(this,"MEDIUM_MEMORY_THRESHOLD",2*1024*1024*1024);g(this,"SCORE_THRESHOLDS",{HIGH:70,MEDIUM:50,LOW:30});g(this,"VENDOR_WEIGHTS",{nvidia:1,amd:.9,apple:.8,intel:.6,qualcomm:.5,arm:.4});g(this,"HIGH_END_PATTERNS",{nvidia:[/geforce\s+(?:rtx\s*[3-4]|titan\s*(?:rtx|xp|v))|quadro\s+(?:rtx|a[0-9]+)/i,/a[1-9][0-9]+/i],amd:[/radeon\s+(?:rx\s*[6-9]|rx\s*7[0-9]+|pro\s*w[5-9])|instinct\s+mi[2-9]/i],apple:[/m[1-3]\s+(?:pro|max|ultra)?/i]});g(this,"MEDIUM_END_PATTERNS",{nvidia:[/geforce\s+(?:rtx\s*2|gtx\s*1[6-9])|quadro\s+(?:p[2-9]|t[1-9])/i],amd:[/radeon\s+(?:rx\s*[4-5]|vega\s*[5-9])|pro\s*w[2-4]/i],apple:[/a[1-9][0-9]+\s+(?:x|z)?/i]});g(this,"LOW_END_PATTERNS",{intel:[/(?:hd|uhd|iris|xe)\s*graphics\s*(?:[6-9][0-9]+|[1-9][0-9]+g)/i],qualcomm:[/adreno\s*[6-9][0-9]+/i],arm:[/mali\s*-?(?:g[7-9][0-9]|t[8-9][0-9])/i]})}getVendorScore(e){const n=e.toLowerCase();for(const[s,r]of Object.entries(this.VENDOR_WEIGHTS))if(n.includes(s))return r*100;return 50}getModelScore(e,n){const s=e.toLowerCase(),r=n.toLowerCase();for(const[i,o]of Object.entries(this.HIGH_END_PATTERNS))if(s.includes(i)&&o.some(a=>a.test(r)))return 90;for(const[i,o]of Object.entries(this.MEDIUM_END_PATTERNS))if(s.includes(i)&&o.some(a=>a.test(r)))return 70;for(const[i,o]of Object.entries(this.LOW_END_PATTERNS))if(s.includes(i)&&o.some(a=>a.test(r)))return 50;return 60}getMemoryScore(e){return e?e>=12e3?100:e>=8e3?90:e>=6e3?80:e>=4e3?70:e>=2e3?60:50:50}getDriverScore(e){if(!e)return 50;const n=e.match(/20[2-9][0-9]/);if(n){const s=parseInt(n[0]);if(s>=2023)return 100;if(s>=2022)return 80;if(s>=2021)return 60}return 50}evaluateGPU(e){const n=this.getVendorScore(e.vendor),s=this.getModelScore(e.vendor,e.renderer),r=this.getMemoryScore(e.memory),i=this.getDriverScore(e.driverVersion);return console.log("GPU:",e.vendor),console.log("GPU:",e.renderer),console.log("GPU:",e.driverVersion),console.table(e),n*.3+s*.4+r*.2+i*.1}evaluateCPU(){const e=navigator.hardwareConcurrency;return e>=8?3:e>=4?2:1}evaluateMemory(e){return typeof e=="string"?0:e.totalJSHeapSize}evaluatePerformance(e){const n=Qt(),s=Gl(),r=sa();if(s)return"medium";if(r)return"lowVR";if(n)return"low";const i=e.fps>=this.HIGH_FPS_THRESHOLD?3:e.fps>=this.MEDIUM_FPS_THRESHOLD?2:1;let o=1;typeof e.gpuInfo!="string"&&(o=this.evaluateGPU(e.gpuInfo));const a=this.evaluateCPU(),d=this.evaluateMemory(e.memoryInfo)>=this.HIGH_MEMORY_THRESHOLD?3:this.evaluateMemory(e.memoryInfo)>=this.MEDIUM_MEMORY_THRESHOLD?2:1,c=i+o+a+d;return console.log("GPU:",i,o,a,d),c>=this.SCORE_THRESHOLDS.HIGH?"high":c>=this.SCORE_THRESHOLDS.MEDIUM?"medium":"low"}getModelQualitySettings(e){return{high:{textureQuality:"high"},medium:{textureQuality:"medium"},low:{textureQuality:"low"},lowVR:{textureQuality:"lowVR"}}[e]}}class Xl{constructor(){g(this,"_clearIdList",[]);this._clearIdList=[]}addListenerFn(e,n,s){e.addEventListener(n,s),this._clearIdList.push({fn:s,eventName:n,el:e})}destroy(){this._clearIdList.forEach(e=>{const{fn:n,eventName:s,el:r}=e;r.removeEventListener(s,n)}),this._clearIdList=[]}}class Q0 extends Xl{constructor(){super();g(this,"_canShow","true");g(this,"remaining")}initialize(){const n=window.localStorage.getItem("tips");this._canShow=n;const s=document.getElementById("tips"),r=document.getElementById("mobileTip"),i=document.getElementById("questTip"),o=document.getElementById("allTip"),a=sa();Qt()?r.classList.remove("hidden"):a?i.classList.remove("hidden"):o.classList.remove("hidden");const c=document.getElementById("tipsConfirm");!s||n==="false"||(s.classList.remove("hidden"),this.addListenerFn(c,"click",()=>{console.log("tipsConfirm clicked"),this._canShow="false",window.localStorage.setItem("tips",this._canShow),s.classList.add("faded-out")}))}startCount(n=5,s){this.remaining=n;const r=document.getElementById("tips"),i=setInterval(()=>{this.remaining--,this.remaining>0?console.log(`剩余时间：${this.remaining} 秒`):(s==null||s(),r.classList.add("faded-out"),console.log("倒计时结束"),clearInterval(i))},1e3)}set canShow(n){this._canShow=n}get canShow(){return this._canShow}}const Ei=new Q0;var Ci={exports:{}},rc;function $0(){return rc||(rc=1,function(t){var e=Object.prototype.hasOwnProperty,n="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(n=!1));function r(d,c,l){this.fn=d,this.context=c,this.once=l||!1}function i(d,c,l,u,h){if(typeof l!="function")throw new TypeError("The listener must be a function");var f=new r(l,u||d,h),y=n?n+c:c;return d._events[y]?d._events[y].fn?d._events[y]=[d._events[y],f]:d._events[y].push(f):(d._events[y]=f,d._eventsCount++),d}function o(d,c){--d._eventsCount===0?d._events=new s:delete d._events[c]}function a(){this._events=new s,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],l,u;if(this._eventsCount===0)return c;for(u in l=this._events)e.call(l,u)&&c.push(n?u.slice(1):u);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(l)):c},a.prototype.listeners=function(c){var l=n?n+c:c,u=this._events[l];if(!u)return[];if(u.fn)return[u.fn];for(var h=0,f=u.length,y=new Array(f);h<f;h++)y[h]=u[h].fn;return y},a.prototype.listenerCount=function(c){var l=n?n+c:c,u=this._events[l];return u?u.fn?1:u.length:0},a.prototype.emit=function(c,l,u,h,f,y){var x=n?n+c:c;if(!this._events[x])return!1;var w=this._events[x],_=arguments.length,R,S;if(w.fn){switch(w.once&&this.removeListener(c,w.fn,void 0,!0),_){case 1:return w.fn.call(w.context),!0;case 2:return w.fn.call(w.context,l),!0;case 3:return w.fn.call(w.context,l,u),!0;case 4:return w.fn.call(w.context,l,u,h),!0;case 5:return w.fn.call(w.context,l,u,h,f),!0;case 6:return w.fn.call(w.context,l,u,h,f,y),!0}for(S=1,R=new Array(_-1);S<_;S++)R[S-1]=arguments[S];w.fn.apply(w.context,R)}else{var k=w.length,M;for(S=0;S<k;S++)switch(w[S].once&&this.removeListener(c,w[S].fn,void 0,!0),_){case 1:w[S].fn.call(w[S].context);break;case 2:w[S].fn.call(w[S].context,l);break;case 3:w[S].fn.call(w[S].context,l,u);break;case 4:w[S].fn.call(w[S].context,l,u,h);break;default:if(!R)for(M=1,R=new Array(_-1);M<_;M++)R[M-1]=arguments[M];w[S].fn.apply(w[S].context,R)}}return!0},a.prototype.on=function(c,l,u){return i(this,c,l,u,!1)},a.prototype.once=function(c,l,u){return i(this,c,l,u,!0)},a.prototype.removeListener=function(c,l,u,h){var f=n?n+c:c;if(!this._events[f])return this;if(!l)return o(this,f),this;var y=this._events[f];if(y.fn)y.fn===l&&(!h||y.once)&&(!u||y.context===u)&&o(this,f);else{for(var x=0,w=[],_=y.length;x<_;x++)(y[x].fn!==l||h&&!y[x].once||u&&y[x].context!==u)&&w.push(y[x]);w.length?this._events[f]=w.length===1?w[0]:w:o(this,f)}return this},a.prototype.removeAllListeners=function(c){var l;return c?(l=n?n+c:c,this._events[l]&&o(this,l)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,t.exports=a}(Ci)),Ci.exports}var H0=$0();const z0=y0(H0);class Yl{constructor(e,n){g(this,"$em");g(this,"$eventName");g(this,"$list");this.$em=e,this.$list=new Set,this.$eventName=n}emit(e){this.$em.emit(this.$eventName,e)}on(e){this.$em.on(this.$eventName,e),this.$list.add(e)}once(e){const n=(...s)=>{typeof e=="function"&&e(...s),this.$list.delete(n),this.$em.off(this.$eventName,n)};this.on(n)}off(e){e&&this.$list.has(e)?(this.$em.off(this.$eventName,e),this.$list.delete(e)):e||(this.$list.forEach(n=>{this.$em.off(this.$eventName,n)}),this.$list.clear())}}class q0 extends Yl{constructor(n,s){super(n,s);g(this,"$latest");this.$latest=void 0;const r=i=>{this.$latest=i};this.on(r)}on(n){super.on(n),typeof this.$latest<"u"&&n(this.$latest)}}class j0 extends z0{createPublisher(e){return new Yl(this,e)}createReplayPublisher(e){return new q0(this,e)}}const Ft=new j0;var rr=(t=>(t.LISTEN_MESSAGE="listenMessage",t))(rr||{});let Co=[],Ao=[];const V=(t,e,n)=>{t&&(t.addEventListener(e,n),Co.push({fn:n,eventName:e,el:t}))},W0=t=>{Co.forEach(e=>{const{fn:n,eventName:s,el:r}=e;r.removeEventListener(s,n)}),Co=[],t==null||t(),Ao.forEach(e=>{const{fn:n,type:s,el:r}=e;r.off(s,n)}),Ao=[]},z=(t,e,n)=>{t.on(e,n),Ao.push({el:t,type:e,fn:n})},V0=t=>{if(!t.frameRate){t.frameRate=60;const n=t.keyframes.times;for(let s=0;s<n.length;s++)n[s]*=60}},K0=t=>{var e;return(e=t.animTracks)==null||e.forEach(n=>{V0(n)}),t},G0=(t,e)=>{const n=new Set(Object.keys(e));return new Proxy(e,{set(s,r,i,o){if(!n.has(r))return console.log("err"),!1;if(s[r]!==i){const a=s[r];s[r]=i,t.fire(`${r}:changed`,i,a)}return!0}})};class Z0{constructor(e,n,s,r,i){g(this,"app");g(this,"gsplat");g(this,"asset");g(this,"events");g(this,"state");g(this,"timeOption");g(this,"currentSeq");g(this,"nextSeq");g(this,"prevSeq");g(this,"loadedSeq",new Map);this.app=e,this.gsplat=e.root.findComponent("gsplat"),this.asset=n,this.events=s,this.state=r,this.timeOption=i,this.init(),e.on("update",()=>{this.updateCurrentSeq()})}init(){this.currentSeq=0,this.nextSeq=1,this.prevSeq=-1,this.loadedSeq.set(this.currentSeq,!0)}updateCurrentSeq(){if(!this.timeOption)return;const{currentTime:e}=this.state;let n=this.currentSeq,s=this.nextSeq;for(let r=0;r<this.timeOption.length;r+=2)if(r===this.timeOption.length-2&&e>=this.timeOption[r]&&e<this.timeOption[r]+this.timeOption[r+1]?(n=r/2,s=0):e>=this.timeOption[r]&&e<this.timeOption[r]+this.timeOption[r+1]&&(n=r/2,s=(r+2)/2),n!==this.currentSeq){this.prevSeq=this.currentSeq,this.currentSeq=n,this.nextSeq=s,console.log("---- updateCurrentSeq",this.currentSeq,this.nextSeq),this.loadNextSeq(),this.releaseSeq();break}}loadNextSeq(){}releaseSeq(){var e,n;this.prevSeq>=0&&((n=(e=this.gsplat)==null?void 0:e.instance)==null||n.releaseSeq(this.prevSeq),this.loadedSeq.delete(this.prevSeq))}}const Hr=(t,e,n)=>t*(1-n)+e*n,Jl=(t,e)=>1-Math.pow(t,e*1e3),Hs=(t,e)=>(t%e+e)%e,Sr=new Q,ic=new Q,ts=new Q;class bs extends gn{dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lerp(e,n,s){const r=(1-s)*(e.dot(n)<0?-1:1);return this.x=e.x*r+n.x*s,this.y=e.y*r+n.y*s,this.z=e.z*r+n.z*s,this.w=e.w*r+n.w*s,this.normalize()}fromBasis(e,n,s){const r=e.x,i=e.y,o=e.z,a=n.x,d=n.y,c=n.z,l=s.x,u=s.y,h=s.z;return h<0?r>d?this.set(1+r-d-h,i+a,l+o,c-u):this.set(i+a,1-r+d-h,c+u,l-o):r<-d?this.set(l+o,c+u,1-r-d+h,i-a):this.set(c-u,l-o,i-a,1+r+d+h),this.mulScalar(1/this.length()),this}fromLookAt(e,n){return ts.sub2(e,n).normalize(),Math.abs(ts.dot(Q.UP))>.9999?Sr.cross(Q.RIGHT,ts).normalize():Sr.cross(Q.UP,ts).normalize(),ic.cross(ts,Sr),this.fromBasis(Sr,ic,ts)}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this}toArray(e,n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e}}class X0{constructor(e,n=.05){this.dims=e.length,this.value=e,this.target=e.slice(),this.velocity=e.slice().fill(0),this.smoothTime=n}reset(e){const{dims:n,value:s,velocity:r}=this;for(let i=0;i<n;i++)s[i]=e[i],r[i]=0}update(e){const{dims:n,value:s,target:r,velocity:i,smoothTime:o}=this,a=2/o,d=a*e,c=1/(1+d+.48*d*d+.235*d*d*d);for(let l=0;l<n;l++){const u=s[l]-r[l],h=(i[l]+a*u)*e;i[l]=(i[l]-a*h)*c,s[l]=r[l]+(u+h)*c}}}class Vs{constructor(e,n){g(this,"times");g(this,"knots");g(this,"dim");this.times=e,this.knots=n,this.dim=n.length/e.length/3}evaluate(e,n){const{times:s}=this,r=s.length-1;if(e<=s[0])this.getKnot(0,n);else if(e>=s[r])this.getKnot(r,n);else{let i=0;for(;e>=s[i+1];)i++;return this.evaluateSegment(i,(e-s[i])/(s[i+1]-s[i]),n)}}getKnot(e,n){const{knots:s,dim:r}=this,i=e*3*r;for(let o=0;o<r;++o)n[o]=s[i+o*3+1]}evaluateSegment(e,n,s){const{knots:r,dim:i}=this,o=n*n,a=n+n,d=1-n,c=d*d;let l=e*i*3;for(let u=0;u<i;++u){const h=r[l+1],f=r[l+2],y=r[l+i*3],x=r[l+i*3+1];l+=3,s[u]=h*((1+a)*c)+f*(n*c)+x*(o*(3-a))+y*(o*(n-1))}}static fromPoints(e,n,s=0){const r=n.length/e.length,i=new Array(e.length*r*3);for(let o=0;o<e.length;o++){const a=e[o];for(let d=0;d<r;d++){const c=o*r+d,l=n[c];let u;o===0?u=(n[c+r]-l)/(e[o+1]-a):o===e.length-1?u=(l-n[c-r])/(a-e[o-1]):u=.5*((n[c+r]-l)/(e[o+1]-a)+(l-n[c-r])/(a-e[o-1])),u*=1-s,i[c*3]=u,i[c*3+1]=l,i[c*3+2]=u}}return new Vs(e,i)}static fromPointsLooping(e,n,s,r){if(n.length<2||n.length>60)return Vs.fromPoints(n,s,r);const i=s.length/n.length,o=n.slice(),a=s.slice();return o.push(e+n[0],e+n[1]),a.push(...s.slice(0,i*2)),o.splice(0,0,n[n.length-2]-e,n[n.length-1]-e),a.splice(0,0,...s.slice(s.length-i*2)),Vs.fromPoints(o,a,r)}}const Er=new bs;class ia{constructor(e,n,s){g(this,"spline");g(this,"frameRate");g(this,"result",[]);g(this,"position",new Q);g(this,"target",new Q);g(this,"rotateSpeed",.2);g(this,"rotation",new Q);this.spline=e,this.timeCursor=n,this.frameRate=s,this.update(0,null)}update(e,n){const{timeCursor:s,result:r,spline:i,frameRate:o,position:a,target:d,rotateSpeed:c,rotation:l}=this;i.evaluate(s.value*o,r),r.every(isFinite)&&(a.set(r[0],r[1],r[2]),d.set(r[3],r[4],r[5])),n!=null&&n.rotate&&(n.rotate.events.indexOf("up")!==-1?l.set(0,0,0):(l.x=Math.max(-90,Math.min(90,l.x-n.rotate.value[1]*c)),l.y=Math.max(-180,Math.min(180,l.y-n.rotate.value[0]*c))))}getPose(e){const{position:n,target:s,rotation:r}=this;e.fromLookAt(n,s),Er.setFromAxisAngle(Q.RIGHT,r.x),e.rotation.mul2(e.rotation,Er),Er.setFromAxisAngle(Q.UP,r.y),e.rotation.mul2(Er,e.rotation)}static fromTrack(e,n){const{keyframes:s,duration:r,frameRate:i}=e,{times:o,values:a}=s,{position:d,target:c}=a,l=[];for(let f=0;f<o.length;f++)o[f]=o[f]*i,l.push(d[f*3],d[f*3+1],d[f*3+2]),l.push(c[f*3],c[f*3+1],c[f*3+2]);const u=r===o[o.length-1]/i?1:0,h=Vs.fromPointsLooping((r+u)*i,o,l,-1);return new ia(h,n,i)}}class Y0{constructor(e,n){g(this,"events");g(this,"controllers");g(this,"activeGestures");g(this,"dragState");g(this,"twoHandState");g(this,"smoothingFactor");g(this,"minScaleRatio");g(this,"maxScaleRatio");g(this,"deadZone");g(this,"rotationDeadZone");g(this,"session");g(this,"manager");this.events=e,this.manager=n,this.controllers=new Map,this.activeGestures=new Set,this.dragState={active:!1,handedness:null,startPosition:[0,0,0],currentPosition:[0,0,0],deltaPosition:[0,0,0],timestamp:0},this.twoHandState={active:!1,leftController:null,rightController:null,initialDistance:0,currentDistance:0,scaleRatio:1,initialAngle:0,currentAngle:0,rotationAngle:0},this.smoothingFactor=.8,this.minScaleRatio=.01,this.maxScaleRatio=100,this.deadZone=.001,this.rotationDeadZone=.001}onSessionStart(e){var n,s;this.session=e,(s=(n=this.controllers)==null?void 0:n.clear)==null||s.call(n),this.resetStates()}onSessionEnd(){this.session=null,this.controllers.clear(),this.resetStates()}resetStates(){this.dragState.active=!1,this.twoHandState.active=!1,this.activeGestures.clear()}onXRFrame(e,n){if(!this.session)return;this.updateControllers(e),this.processGestures(),this.emitGestureEvents();const s=this.controllers.get("left"),r=this.controllers.get("right"),i=[s.position[0]-r.position[0]/2,s.position[1]-r.position[1]/2,s.position[2]-r.position[2]/2];this.events.fire("xrTextPlacePosition",i)}_fingersTipDistance(e,n){return e.tip._localPosition.distance(n.tip._localPosition)<=.01}updateControllers(e){for(const n of this.manager.input.inputSources){if(!n.gamepad&&!n.hand)continue;const s=n.handedness,r=n.gamepad,i=n.hand;let o=null;try{if(n._xrInputSource.gripSpace)o=e.getPose(n._xrInputSource.gripSpace,this.manager._referenceSpace);else if(i){const h=n._xrInputSource.hand.get("thumb-tip");o=e.getJointPose(h,this.manager._referenceSpace)}}catch(h){console.warn("无法获取手柄位置:",h);continue}if(!o)continue;const a=[o.transform.position.x,o.transform.position.y,o.transform.position.z],d=[o.transform.orientation.x,o.transform.orientation.y,o.transform.orientation.z,o.transform.orientation.w];let c=r.buttons[0]&&r.buttons[0].pressed;i&&(c=this._fingersTipDistance(i.fingers[0],i.fingers[1]));const l=this.controllers.get(s),u={handedness:s,position:a,orientation:d,gripPressed:c,prevPosition:l?l.position:a,prevTriggerPressed:l?l.gripPressed:!1,timestamp:Date.now()};this.controllers.set(s,u)}}processGestures(){const e=this.controllers.get("left"),n=this.controllers.get("right");(e==null?void 0:e.gripPressed)&&(n==null?void 0:n.gripPressed)?(this.dragState.active&&this.endDrag(),this.processTwoHandGesture(e,n)):(this.twoHandState.active&&this.endTwoHandGesture(),this.processSingleHandGesture(e,n))}processSingleHandGesture(e,n){let s=null;e!=null&&e.gripPressed?s=e:n!=null&&n.gripPressed&&(s=n),s?this.dragState.active?this.dragState.handedness===s.handedness&&this.updateDrag(s):this.startDrag(s):this.dragState.active&&this.endDrag()}startDrag(e){this.dragState.active=!0,this.dragState.handedness=e.handedness,this.dragState.startPosition=[...e.position],this.dragState.currentPosition=[...e.position],this.dragState.deltaPosition=[0,0,0],this.activeGestures.add("drag"),this.events.fire("startXrDrag"),console.log(`开始拖拽 - ${e.handedness}手`)}updateDrag(e){const n=this.dragState.currentPosition;this.dragState.currentPosition=[...e.position];for(let s=0;s<3;s++){const r=this.dragState.currentPosition[s]-n[s];Math.abs(r)>this.deadZone?this.dragState.deltaPosition[s]=Hr(this.dragState.deltaPosition[s],r,this.smoothingFactor):this.dragState.deltaPosition[s]=Hr(this.dragState.deltaPosition[s],0,this.smoothingFactor)}}endDrag(){this.dragState.active=!1,this.dragState.handedness=null,this.dragState.deltaPosition=[0,0,0],this.activeGestures.delete("drag"),console.log("结束拖拽")}processTwoHandGesture(e,n){this.twoHandState.active?this.updateTwoHandGesture(e,n):this.startTwoHandGesture(e,n)}startTwoHandGesture(e,n){this.twoHandState.active=!0,this.twoHandState.leftController=e,this.twoHandState.rightController=n,this.twoHandState.initialDistance=this.calculateDistance(e.position,n.position),this.twoHandState.currentDistance=this.twoHandState.initialDistance,this.twoHandState.scaleRatio=1,this.twoHandState.initialAngle=this.calculateYAxisAngle(e.position,n.position),this.twoHandState.currentAngle=this.twoHandState.initialAngle,this.twoHandState.rotationAngle=0,this.activeGestures.add("twoHand"),this.events.fire("startXrTwoHandGesture"),console.log("开始双手操作")}updateTwoHandGesture(e,n){const s=this.calculateDistance(e.position,n.position);if(this.twoHandState.initialDistance>0){const o=s/this.twoHandState.initialDistance;this.twoHandState.scaleRatio=Math.max(this.minScaleRatio,Math.min(this.maxScaleRatio,o))}this.twoHandState.currentDistance=s;const r=this.calculateYAxisAngle(e.position,n.position);let i=r-this.twoHandState.initialAngle;i>Math.PI?i-=2*Math.PI:i<-Math.PI&&(i+=2*Math.PI),Math.abs(i)>this.rotationDeadZone?this.twoHandState.rotationAngle=i:this.twoHandState.rotationAngle=0,this.twoHandState.currentAngle=r}endTwoHandGesture(){this.twoHandState.active=!1,this.twoHandState.leftController=null,this.twoHandState.rightController=null,this.twoHandState.scaleRatio=1,this.twoHandState.rotationAngle=0,this.activeGestures.delete("twoHand"),console.log("结束双手操作")}calculateDistance(e,n){const s=e[0]-n[0];return Math.sqrt(s*s)}calculateYAxisAngle(e,n){const s=n[2]-e[2];return Math.atan(s)*2}emitGestureEvents(){this.twoHandState.active?(this.events.fire("xrTwoHandGesture",{detail:{scaleRatio:this.twoHandState.scaleRatio,currentAngle:this.twoHandState.currentAngle,rotationAngle:this.twoHandState.rotationAngle,distance:this.twoHandState.currentDistance,leftPosition:[...this.twoHandState.leftController.position],rightPosition:[...this.twoHandState.rightController.position]}}),this.events.fire("xrTextCursor",{s:this.dragState,t:this.twoHandState})):this.dragState.active&&(this.events.fire("xrDrag",{detail:{handedness:this.dragState.handedness,position:[...this.dragState.currentPosition],deltaPosition:[...this.dragState.deltaPosition],startPosition:[...this.dragState.startPosition]}}),this.events.fire("xrTextCursor",{s:this.dragState,t:this.twoHandState})),this.events.fire("xrTextCursor",{s:this.dragState,t:this.twoHandState})}getDragState(){return{active:this.dragState.active,handedness:this.dragState.handedness,position:[...this.dragState.currentPosition],deltaPosition:[...this.dragState.deltaPosition],x:this.dragState.currentPosition[0],y:this.dragState.currentPosition[1],z:this.dragState.currentPosition[2],deltaX:this.dragState.deltaPosition[0],deltaY:this.dragState.deltaPosition[1],deltaZ:this.dragState.deltaPosition[2]}}getTwoHandState(){return{active:this.twoHandState.active,scaleRatio:this.twoHandState.scaleRatio,rotationAngle:this.twoHandState.rotationAngle,rotationDegrees:this.twoHandState.rotationAngle*180/Math.PI,distance:this.twoHandState.currentDistance}}getActiveGestures(){return Array.from(this.activeGestures)}isGestureActive(e){return this.activeGestures.has(e)}setSmoothingFactor(e){this.smoothingFactor=Math.max(0,Math.min(1,e))}setScaleRange(e,n){this.minScaleRatio=Math.max(.01,e),this.maxScaleRatio=Math.max(this.minScaleRatio,n)}setDeadZones(e,n){this.deadZone=Math.max(0,e),this.rotationDeadZone=Math.max(0,n)}clear(){this.resetStates()}}class J0{constructor(e,n,s){g(this,"events");g(this,"left");g(this,"right");g(this,"gripActive");g(this,"lastPosition");g(this,"lastRotation");g(this,"lastButtonPressTime");g(this,"debounceTime");g(this,"session");g(this,"inputSources");g(this,"gestureController");g(this,"manager");g(this,"checkInputSourcesInterval");g(this,"app");g(this,"onSessionStart",e=>{this.session=e,this.inputSources.clear();try{e.addEventListener("inputsourceschange",this.onInputSourcesChange)}catch(n){this.events.fire("xrTextCursor",{m:{errorAtext:"error add inputsourceschange"}}),console.error("无法添加inputsourceschange监听器:",n)}this.gestureController.onSessionStart(e)});g(this,"onSessionEnd",()=>{if(this.session){try{this.session.removeEventListener("inputsourceschange",this.onInputSourcesChange)}catch(e){console.error("无法移除inputsourceschange监听器:",e),this.events.fire("xrTextCursor",{m:{errorRtext:"error remove inputsourceschange"}})}this.session=null,this.inputSources.clear()}this.checkInputSourcesInterval&&(clearInterval(this.checkInputSourcesInterval),this.checkInputSourcesInterval=null),this.gripActive=!1,this.gestureController.onSessionEnd()});g(this,"onInputSourcesChange",e=>{var n;try{if(e.removed&&e.removed.length>0){let s={};for(const r of e.removed)this.inputSources.delete(r),this.app.root.removeChild(r.entity),(n=r.entity)==null||n.destroy();s[`R-${new Date().getTime()}`]=`removed inputsourceschange ${this.inputSources.size}`,this.events.fire("xrTextCursor",s)}if(e.added&&e.added.length>0){let s={};for(const r of e.added)this.inputSources.set(r,{gripPressed:!1,position:[0,0,0],rotation:[0,0,0],buttonStates:r.gamepad?Array(r.gamepad.buttons.length).fill(!1):[],inputSource:r});s[`A-${new Date().getTime()}`]=`add inputsourceschange ${this.inputSources.size}`,console.log("add",s),this.events.fire("xrTextCursor",s)}}catch(s){console.error("处理XR输入源变化时出错:",s)}});g(this,"onXRFrame",async({frame:e,screen3D:n})=>{if(this.session){this.gestureController.onXRFrame(e,n);try{for(let s of this.manager.input.inputSources)if(s.gamepad&&!s.hand){const r=s.gamepad;for(let i=0;i<r.buttons.length;++i){const o=r.buttons[i];if(o&&(o.pressed||o.value>.5)){const a=Date.now();if(this.lastButtonPressTime[i]&&a-this.lastButtonPressTime[i]<this.debounceTime)return;switch(this.lastButtonPressTime[i]=a,console.log(`xr button pressed===>>>xr: ${s.handedness} button index: ${i}`),i){case 0:break;case 1:break;case 2:break;case 3:break;case 4:s.handedness==="right"?this.events.fire("inputEvent","playPause",null):this.events.fire("inputEvent","decreaseXrPlaybackRate",null);break;case 5:s.handedness==="right"?(this.events.fire("inputEvent","resetXrPosition",null),this.events.fire("resetModelTransform")):this.events.fire("inputEvent","togglePointCloudMode",null);break}}}for(let i=0,o=0;i<r.axes.length;i+=2,++o)if(r.axes[i]!=0||r.axes[i+1]!=0){const d=r.axes[i]*.02,c=r.axes[i+1]*.02;s.handedness==="left"?(this.left.value[0]+=d,this.left.value[2]+=c):s.handedness==="right"&&(this.right.value[0]+=d,this.right.value[1]+=c),this.events.fire("xrJoystickMove",{handedness:s.handedness,moveX:d,moveZ:c})}}else s.hand}catch(s){console.error("XR控制器处理错误:",s)}}});this.events=e,this.left=n[1],this.right=n[0],this.gripActive=!1,this.lastPosition=[0,0,0],this.lastRotation=[0,0,0],this.lastButtonPressTime={},this.debounceTime=300,this.manager=s.xr,this.app=s,this.session=null,this.inputSources=new Map,this.gestureController=new Y0(e,this.manager)}update(e){}clear(){this.left.clear(),this.right.clear()}}class Yt{constructor(){this.value=[0,0,0],this.events=[]}add(e,n,s){this.value[0]+=e,this.value[1]+=n,this.value[2]+=s}update(e){}clear(){this.value.fill(0),this.events.splice(0)}}class zr extends Yt{constructor(...e){super(),this.inputs=e}update(e){const{inputs:n,value:s,events:r}=this;n.forEach(i=>{var o;(o=i.update)==null||o.call(i,e),s[0]+=i.value[0],s[1]+=i.value[1],s[2]+=i.value[2],r.push(...i.events)})}clear(){super.clear(),this.inputs.forEach(e=>e.clear())}}class eu extends Yt{constructor(){super(),this.stick=[0,0,0]}update(e){const{value:n,stick:s}=this;for(let r=0;r<3;++r)n[r]+=s[r]*e}}class oc extends eu{constructor(){super(),this.target=[0,0,0]}update(e){const{stick:n,target:s}=this,r=Jl(.98,e);for(let i=0;i<3;++i)n[i]=Hr(n[i],s[i],r),Math.abs(n[i])<.001&&(n[i]=0);super.update(e)}}class ko extends Yt{constructor(){super(),this.id=null,this.prev=[0,0,0]}down(e,n,s,r=0){const{prev:i}=this;this.id=e,i[0]=n,i[1]=s,i[2]=r}move(e,n,s=0){const{value:r,prev:i}=this;r[0]+=e-i[0],r[1]+=n-i[1],r[2]+=s-i[2],i[0]=e,i[1]=n,i[2]=s}up(){this.id=null}}class ef extends eu{constructor(){super(),this.id=null,this.base=[0,0,0]}down(e,n,s,r=0){const{base:i}=this;this.id=e,i[0]=n,i[1]=s,i[2]=r}move(e,n,s=0){const{base:r,stick:i}=this;i[0]=e-r[0],i[1]=n-r[1],i[2]=s-r[2]}up(){const{stick:e}=this;this.id=null,e[0]=0,e[1]=0,e[2]=0}}class tf{constructor(){const e=new ef,n=new ko,s=r=>r===e.id?e:r===n.id?n:null;this.pointerDown=(r,i)=>{const o=r.clientX<i.getBoundingClientRect().width/2,a=o?e.id===null&&e:n.id===null&&n;a&&a.down(r.pointerId,r.clientX,r.clientY),o&&i.setPointerCapture(r.pointerId)},this.pointerMove=r=>{const i=s(r.pointerId);i&&i.move(r.clientX,r.clientY)},this.pointerUp=(r,i)=>{const o=s(r.pointerId);o&&(o.up(),o===e&&i.releasePointerCapture(r.pointerId))},this.left=e,this.right=n}}class nf extends Yt{constructor(e,n){super(),this.a=e,this.b=n,this.active=!1,this.prev=[0,0,0]}update(e){const{a:n,b:s}=this;if(n.update(e),s.update(e),n.id&&s.id){const{value:r,prev:i}=this,o=n.prev,a=s.prev,d=(o[0]+a[0])*.5,c=(o[1]+a[1])*.5,l=Math.sqrt((o[0]-a[0])**2+(o[1]-a[1])**2);this.active||(this.active=!0,i[0]=d,i[1]=c,i[2]=l),r[0]=d-i[0],r[1]=c-i[1],r[2]=-(l-i[2]),i[0]=d,i[1]=c,i[2]=l,n.clear(),s.clear()}else this.active=!1}clear(){super.clear();const{a:e,b:n}=this;e.clear(),n.clear()}}class sf{constructor(){const e=new ko,n=new ko,s=new nf(e,n);this.pointerDown=(r,i)=>{e.id===null?(e.down(r.pointerId,r.clientX,r.clientY),i.setPointerCapture(r.pointerId)):n.id===null&&(n.down(r.pointerId,r.clientX,r.clientY),i.setPointerCapture(r.pointerId))},this.pointerMove=r=>{r.pointerId===e.id?e.move(r.clientX,r.clientY):r.pointerId===n.id&&n.move(r.clientX,r.clientY)},this.pointerUp=(r,i)=>{r.pointerId===e.id?(e.up(),i.releasePointerCapture(r.pointerId)):r.pointerId===n.id&&(n.up(),i.releasePointerCapture(r.pointerId))},this.pointerCancel=this.pointerUp,this.left=s,this.right=e}}class rf{constructor(){this.prev=[0,0,0],this.left=new Yt,this.middle=new Yt,this.right=new Yt}down(e,n,s=0){const{prev:r}=this;r[0]=e,r[1]=n,r[2]=s}move(e,n,s,r=0){const{prev:i}=this,o=n-i[0],a=s-i[1],d=r-i[2];i[0]=n,i[1]=s,i[2]=r,e===1?this.left.add(o,a,d):e===2?this.right.add(o,a,d):e===4&&this.middle.add(o,a,d)}up(){this.left.events.push("up")}clear(){const{left:e,right:n,middle:s}=this;e.clear(),n.clear(),s.clear()}}class of{constructor(){const e={left:!1,right:!1,forward:!1,backward:!1,up:!1,down:!1,lookleft:!1,lookright:!1,lookup:!1,lookdown:!1},n={w:"forward",a:"left",s:"backward",d:"right",q:"up",e:"down",arrowleft:"lookleft",arrowright:"lookright",arrowup:"lookup",arrowdown:"lookdown"},s=new rf,r=new oc,i=new oc,o=new zr(s.right,r),a=new zr(s.left,i);this.wheel=c=>{s.right.value[2]+=c.deltaY*.1,c.preventDefault()},this.pointerDown=(c,l)=>{s.down(c.clientX,c.clientY),l.setPointerCapture(c.pointerId)},this.pointerMove=c=>{s.move(c.buttons,c.clientX,c.clientY)},this.pointerUp=(c,l)=>{s.up(),l.releasePointerCapture(c.pointerId)},this.contextMenu=c=>c.preventDefault();const d=(c,l)=>{if(c.metaKey&&l)return;const u=c.key.toLowerCase();if(n.hasOwnProperty(u)){c.stopPropagation(),c.preventDefault(),e[n[u]]=l;const h=300;switch(n[u]){case"left":case"right":r.target[0]=(e.left?-300:0)+(e.right?h:0);break;case"forward":case"backward":r.target[1]=(e.forward?-300:0)+(e.backward?h:0);break;case"up":case"down":r.target[2]=(e.up?h:0)+(e.down?-300:0);break;case"lookleft":case"lookright":i.target[0]=(e.lookleft?-300:0)+(e.lookright?h:0);break;case"lookup":case"lookdown":i.target[1]=(e.lookup?-300:0)+(e.lookdown?h:0);break}}};this.keyDown=c=>d(c,!0),this.keyUp=c=>d(c,!1),this.left=o,this.right=a}}class af{constructor(e,n,s){this.events=e,this.app=n,this.touch=new tf,this.orbit=new sf,this.desktop=new of,this.xr=new J0(this.events,[new Yt,new Yt],n,s),this.left=new zr(this.touch.left,this.orbit.left,this.desktop.left),this.right=new zr(this.touch.right,this.orbit.right,this.desktop.right),this.update=r=>{this.left.update(r),this.right.update(r)},this.clear=()=>{this.left.clear(),this.right.clear()}}}const Ai=new Q,ki=new Q,ac=new Q,ns=new Q,ss=new bs;class cf{constructor(){g(this,"position",new Q);g(this,"rotation",new bs);g(this,"distance",1);g(this,"smoothPosition",new Q);g(this,"smoothRotation",new bs);g(this,"moveSpeed",.1);g(this,"rotateSpeed",.2)}reset(e,n=!0){this.position.copy(e.position),this.rotation.copy(e.rotation),this.distance=e.distance,n&&(this.smoothPosition.copy(e.position),this.smoothRotation.copy(e.rotation))}update(e,n){n&&this.move(n),this.smooth(e)}move(e){const{position:n,rotation:s,moveSpeed:r,rotateSpeed:i}=this;s.transformVector(Q.FORWARD,Ai),s.transformVector(Q.RIGHT,ki),s.transformVector(Q.UP,ac),ns.copy(ki).mulScalar(e.move.value[0]*r),n.add(ns),ns.copy(ac).mulScalar(e.move.value[2]*-r),n.add(ns),ns.copy(Ai).mulScalar(e.move.value[1]*-r),n.add(ns),ss.setFromAxisAngle(ki,-e.rotate.value[1]*i),s.mul2(ss,s),ss.setFromAxisAngle(Q.UP,-e.rotate.value[0]*i),s.mul2(ss,s),ss.setFromAxisAngle(Ai,-e.rotate.value[2]*i),s.mul(ss,s),s.normalize()}smooth(e){const n=Jl(.98,e);this.smoothPosition.lerp(this.smoothPosition,this.position,n),this.smoothRotation.lerp(this.smoothRotation,this.rotation,n)}getPose(e){const{smoothPosition:n,smoothRotation:s,distance:r}=this;e.position.copy(n),e.rotation.copy(s),e.distance=r}}const df=new Q,cc=new Q,dc=new Q,wt=new Q,Cr=new bs,lc=180/Math.PI;class lf{constructor(){g(this,"focus",new Q);g(this,"rotation",new Q);g(this,"distance",1);g(this,"smoothDamp",new X0([0,0,0,0,0,0,1]));g(this,"moveSpeed",.001);g(this,"rotateSpeed",.16);g(this,"distanceSpeed",.01)}reset(e,n=!0){e.rotation.transformVector(Q.FORWARD,wt),wt.normalize(),this.focus.copy(wt).mulScalar(e.distance).add(e.position),this.rotation.x=Math.asin(wt.y)*lc,this.rotation.y=Hs(Math.atan2(-wt.x,-wt.z)*lc,360),this.rotation.z=0,this.distance=e.distance,n&&(this.focus.toArray(this.smoothDamp.value,0),this.rotation.toArray(this.smoothDamp.value,3),this.smoothDamp.value[6]=e.distance)}update(e,n){n&&this.move(n),this.smooth(e)}move(e){const{focus:n,rotation:s,moveSpeed:r,distanceSpeed:i,rotateSpeed:o}=this;Cr.setFromEulerAngles(s),Cr.transformVector(Q.FORWARD,df),Cr.transformVector(Q.RIGHT,cc),Cr.transformVector(Q.UP,dc),wt.copy(cc).mulScalar(e.move.value[0]*-r*this.distance),n.add(wt),wt.copy(dc).mulScalar(e.move.value[1]*r*this.distance),n.add(wt),this.distance=Math.max(.01,this.distance*(1+e.move.value[2]*i)),s.x=Math.max(-90,Math.min(90,s.x-e.rotate.value[1]*o)),s.y=Hs(s.y-e.rotate.value[0]*o,360)}smooth(e){const{focus:n,rotation:s,smoothDamp:r}=this,{value:i,target:o}=r;n.toArray(o,0),s.toArray(o,3),o[6]=this.distance,i[3]=o[3]+Hs(i[3]-o[3]+90,180)-90,i[4]=o[4]+Hs(i[4]-o[4]+180,360)-180,r.update(e)}getPose(e){const{smoothDamp:n}=this,{value:s}=n;wt.fromArray(s,3),e.rotation.setFromEulerAngles(wt),e.rotation.transformVector(Q.FORWARD,wt),e.distance=s[6],wt.mulScalar(-e.distance),e.position.fromArray(s).add(wt)}}const tu=new Float32Array(1),uf=new Uint8Array(tu.buffer),hf=new ea(2,2,2,1),ff=new ea(1,1,1,0);class pf{constructor(e,n){this.app=e,this.camera=n,this.picker=null}async pick(e,n){const{app:s,camera:r}=this,{graphicsDevice:i}=s,{canvas:o}=i,a=o.clientWidth,d=o.clientHeight;n=d-n-1,this.picker||(this.picker=new v0(this.app,a,d));const{picker:c}=this;c.resize(a,d),c.prepare(r.camera,s.scene,[s.scene.layers.getLayerByName("World")]);const l=await c.renderTarget.colorBuffer.read(e,n,1,1,{renderTarget:c.renderTarget});for(let y=0;y<4;++y)uf[y]=l[y];const u=tu[0];if(!isFinite(u))return null;const h=new ea(e/a,n/d,u,1).mul(hf).sub(ff);r.camera.projectionMatrix.clone().invert().transformVec4(h,h),h.mulScalar(1/h.w);const f=new Q(h.x,h.y,h.z);return r.getWorldTransform().transformPoint(f,f),f}}class mf{constructor(e){this.target=null,this.clearIdList=[],this._addListenerFn(e,"wheel",n=>{var s,r;(r=(s=this.target)==null?void 0:s.wheel)==null||r.call(s,n,e)},{passive:!1}),this._addListenerFn(e,"pointerdown",n=>{var s,r;(r=(s=this.target)==null?void 0:s.pointerDown)==null||r.call(s,n,e)}),this._addListenerFn(e,"pointermove",n=>{var s,r;(r=(s=this.target)==null?void 0:s.pointerMove)==null||r.call(s,n,e)}),this._addListenerFn(e,"pointerup",n=>{var s,r;(r=(s=this.target)==null?void 0:s.pointerUp)==null||r.call(s,n,e)}),this._addListenerFn(e,"pointercancel",n=>{var s,r;(r=(s=this.target)==null?void 0:s.pointerCancel)==null||r.call(s,n,e)}),this._addListenerFn(e,"contextmenu",n=>{var s,r;(r=(s=this.target)==null?void 0:s.contextMenu)==null||r.call(s,n,e)}),this._addListenerFn(window,"keydown",n=>{var s,r;(r=(s=this.target)==null?void 0:s.keyDown)==null||r.call(s,n,window)}),this._addListenerFn(window,"keyup",n=>{var s,r;(r=(s=this.target)==null?void 0:s.keyUp)==null||r.call(s,n,window)})}_addListenerFn(e,n,s){e.addEventListener(n,s),this.clearIdList.push({fn:s,eventName:n,el:e})}destroy(){this.clearIdList.forEach(e=>{const{fn:n,eventName:s,el:r}=e;r.removeEventListener(s,n)}),this.clearIdList=[]}}const uc=new Q;class Zt{constructor(e){this.position=new Q,this.rotation=new bs,this.distance=1,e&&this.copy(e)}copy(e){return this.position.copy(e.position),this.rotation.copy(e.rotation),this.distance=e.distance,this}lerp(e,n,s){return this.position.lerp(e.position,n.position,s),this.rotation.lerp(e.rotation,n.rotation,s),this.distance=Hr(e.distance,n.distance,s),this}fromLookAt(e,n){return this.position.copy(e),this.rotation.fromLookAt(e,n),this.distance=e.distance(n),this}calcTarget(e){this.rotation.transformVector(Q.FORWARD,uc),e.copy(uc).mulScalar(this.distance).add(this.position)}}class gf{constructor(e,n){g(this,"duration",0);g(this,"loopMode","none");g(this,"cursor",0);this.reset(e,n)}update(e){if(this.cursor+=e,this.cursor>=this.duration)switch(this.loopMode){case"none":this.cursor=this.duration;break;case"repeat":this.cursor=this.cursor%this.duration;break;case"pingpong":this.cursor=this.cursor%(this.duration*2);break}}reset(e,n){this.duration=e,this.loopMode=n,this.cursor=0}get value(){return this.cursor>this.duration?this.duration-this.cursor:this.cursor}set value(e){this.cursor=Hs(e,this.duration)}}class yf{constructor(e,n,s,r){this.app=e,this.events=n,this.state=s,this.settings=r,this.gsplat=e.root.findComponent("gsplat"),this.initUI(),this.initEvents()}destroy(){this.container=document.getElementById("statsPanelContent"),this.container.innerHTML=""}initUI(){var s;this.container=document.getElementById("statsPanelContent"),this.panel=new C0({headerText:"Viewer Stats",width:280}),this.infoContainer=new nc({flex:!0,flexDirection:"column"}),this.cameraInfoContainer=new nc({flex:!0,flexDirection:"column"}),this.cameraPositionInfo=new cn({cursor:!0}),this.cameraPositionInfo.dom.addEventListener("pointerdown",()=>{navigator.clipboard.writeText(this.cameraPositionInfo.value.split(":")[1].trim())}),this.cameraLookAtInfo=new cn({cursor:!0}),this.cameraLookAtInfo.dom.addEventListener("pointerdown",()=>{navigator.clipboard.writeText(this.cameraLookAtInfo.value.split(":")[1].trim())}),this.cameraTargetInfo=new cn({cursor:!0}),this.cameraTargetInfo.dom.addEventListener("pointerdown",()=>{navigator.clipboard.writeText(this.cameraTargetInfo.value.split(":")[1].trim())}),this.cameraInfo=new cn({label:"Camera Info"}),this.renderInfo=new cn({label:"Render Info"}),this.performanceInfo=new cn({label:"Performance Info"}),this.splatInfo=new cn({label:"Splat Info"}),this.systemInfo=new cn({label:"System Info"}),this.infoContainer.append(this.performanceInfo),this.infoContainer.append(this.cameraInfoContainer),this.cameraInfoContainer.append(this.cameraInfo),this.cameraInfoContainer.append(this.cameraPositionInfo),this.cameraInfoContainer.append(this.cameraLookAtInfo),this.cameraInfoContainer.append(this.cameraTargetInfo),this.infoContainer.append(this.renderInfo),this.infoContainer.append(this.splatInfo),this.infoContainer.append(this.systemInfo),this.panel.append(this.infoContainer),this.container.appendChild(this.panel.dom),(s=document.getElementsByClassName("pcui-panel-header")[0])==null||s.addEventListener("click",r=>{document.getElementById("statsPanel").classList.add("hidden")});const e=new URL(location.href),n=Number(e.searchParams.get("cutoff"));document.getElementsByClassName("pcui-container")[1].addEventListener("click",r=>{const i=n+.01;e.searchParams.set("cutoff",i.toFixed(2)),window.location.href=e.href}),document.getElementsByClassName("pcui-infobox")[5].addEventListener("click",r=>{const i=n-.01;e.searchParams.set("cutoff",i.toFixed(2)),window.location.href=e.href})}initEvents(){this.app.on("framerender",()=>{this.state.statsVisible&&this.update()}),this.events.on("inputEvent",(e,n)=>{switch(e){case"information":this.update(),this.state.statsVisible=!this.state.statsVisible;break}})}update(){var h,f,y,x,w;const e=this.app.root.findByName("camera"),n=e.camera,s=e.getPosition(),r=new Q,i=e.forward;r.copy(i).mulScalar(3).add(s),this.cameraPositionInfo.value=`Position: ${s.x.toFixed(10)}, ${s.y.toFixed(10)}, ${s.z.toFixed(10)}`,this.cameraLookAtInfo.value=`Look At: ${i.x.toFixed(10)}, ${i.y.toFixed(10)}, ${i.z.toFixed(10)}`,this.cameraTargetInfo.value=`Target: ${r.x.toFixed(10)}, ${r.y.toFixed(10)}, ${r.z.toFixed(10)}`,this.cameraInfo.value=`Mode: ${this.state.cameraMode}
            FOV: ${n.fov}°
            Near: ${n.nearClip}
            Far: ${n.farClip}
        `;const o=this.app.graphicsDevice,a=this.app.stats.drawCalls.total;this.renderInfo.value=`Resolution: ${o.width}x${o.height}
            Pixel Ratio: ${o.maxPixelRatio.toFixed(2)}
            HQ Mode: ${this.state.hqMode?"High Quality":"Low Quality"}
            Point Cloud Mode: ${this.state.pointCloudModeEnabled?"Enabled":"Disabled"}
            Splat Scale: ${this.state.splatScale.toFixed(2)}
            Playback Speed: ${this.state.playbackSpeed.toFixed(1)}x
            Background Color: ${this.state.backgroundColor}
            Total Duration: ${this.state.duration.toFixed(1)}s
            Current Time: ${this.state.currentTime.toFixed(1)}s
        `;const d=(h=this.gsplat)==null?void 0:h.instance,c=this.app.stats.frame.fps,l=((f=d==null?void 0:d.splat)==null?void 0:f.numSplats)||"N/A";this.performanceInfo.value=`Draw Calls: ${a}
            rasterize: ${Number(window.drawReasterize).toFixed(1)}
            FPS: ${c.toFixed(1)}
            Sort Time: ${this.state.sortTime.toFixed(1)}ms  ${(this.state.sortTime*c/10).toFixed(2)}%
            Render Count: ${this.state.renderCount} splats out of ${l} (${(this.state.renderCount/l*100).toFixed(2)}%)
        `;let u="No Splat Data";if(d){const _=(y=d.meshInstance)==null?void 0:y.aabb;let R="N/A";if(_){const k=_.halfExtents;R=`${(k.x*2).toFixed(6)}, ${(k.y*2).toFixed(6)}, ${(k.z*2).toFixed(6)}`}u=`File: ${((w=(x=this.app.assets.filter(k=>k.type==="gsplat")[0])==null?void 0:x.file)==null?void 0:w.url)||"N/A"}
                Rendered Splats Count: N/A
                AABB Size: ${R}
            `}this.splatInfo.value=u,this.systemInfo.value=`Device Type: ${this.state.inputMode}
            WebGL Version: ${o.isWebGL2?"WebGL 2.0":"WebGL 1.0"}
            WebGPU Version: ${o.webgpu?"WebGPU":"None"}
            XR Support: ${this.state.hasAR?"AR ":""}${this.state.hasVR?"VR":""}${!this.state.hasAR&&!this.state.hasVR?"None":""}
            Full Screen: ${this.state.isFullscreen?"Yes":"No"}
        `}}const wf=`
precision highp float;

#ifdef PICK_PASS
vec4 packFloat(float depth) {
    uvec4 u = (uvec4(floatBitsToUint(depth)) >> uvec4(0u, 8u, 16u, 24u)) & 0xffu;
    return vec4(u) / 255.0;
}
#endif

varying mediump vec2 gaussianUV;
varying mediump vec4 gaussianColor;

void main(void) {
    mediump float A = dot(gaussianUV, gaussianUV);
    if (A > 1.0) {
        discard;
    }

    // evaluate alpha
    mediump float alpha = exp(-A * 4.0) * gaussianColor.a;

    #ifdef PICK_PASS
        if (alpha < 0.1) {
            discard;
        }
        gl_FragColor = packFloat(gl_FragCoord.z);
    #else
        if (alpha < 1.0 / 255.0) {
            discard;
        }

        #ifndef DITHER_NONE
            opacityDither(alpha, id * 0.013);
        #endif

        gl_FragColor = vec4(gaussianColor.xyz, alpha);
    #endif
}
`;class bf{constructor(e,n,s){g(this,"events");g(this,"controller");g(this,"modelTransform");g(this,"manager");this.events=e,this.controller=n,this.manager=s,this.modelTransform={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]},this.setupEventListeners()}setupEventListeners(){this.events.on("xrDrag",e=>{this.handleDrag(e.detail)}),this.events.on("xrTwoHandGesture",e=>{this.handleTwoHandGesture(e.detail)})}handleDrag(e){const{deltaPosition:n,handedness:s}=e,r=this.manager.camera.getPosition(),i=(o,a,d)=>d?o:-o;this.modelTransform.position[0]=i(n[0],r.x,!0),this.modelTransform.position[1]=i(n[1],r.y,!0),this.modelTransform.position[2]=i(n[2],r.z,!1),this.events.fire("setNewPosition",this.modelTransform.position)}handleTwoHandGesture(e){const{scaleRatio:n,rotationAngle:s}=e,r=n;this.modelTransform.scale=[r,r,r],this.modelTransform.rotation[1]=s,this.events.fire("setNewScale",this.modelTransform.scale);const i=this.modelTransform.rotation[1]*360;this.events.fire("setNewRotationY",i)}onXRSessionStart(e){this.controller.xr.onSessionStart(e),console.log("XR手势控制已启用")}onXRSessionEnd(){this.controller.xr.onSessionEnd(),console.log("XR手势控制已禁用")}onXRFrame(e,n){this.controller.xr.onXRFrame(e,n);const s=this.controller.xr.getDragState(),r=this.controller.xr.getTwoHandState();this.controller.xr.getClapState(),this.controller.xr.getActiveGestures(),s.active&&this.onDragActive(s),r.active&&this.onTwoHandActive(r)}onDragActive(e){}onTwoHandActive(e){}getModelTransform(){return{...this.modelTransform}}resetModelTransform(){this.modelTransform={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]},this.events.fire("resetModelTransform"),console.log("模型变换已重置")}configureGestureController(){const e=this.controller.xr.gestureController;e.setSmoothingFactor(.8),e.setScaleRange(.1,5),e.setDeadZones(.001,.05)}}function vf(t,e,n){const s=new bf(t,e,n);return s.configureGestureController(),s}const Rt=new Zt;class xf{constructor(e,n,s,r,i,o,a){g(this,"cameraElement");g(this,"accumulatedTime",0);g(this,"frameInterval",-1);g(this,"dynamicSorting",!0);g(this,"temporalSorting",!0);g(this,"overrideDuration",-1);const{background:d,camera:c,dynamicSorting:l,temporalSorting:u}=i,{graphicsDevice:h}=e;this.dynamicSorting=l,this.temporalSorting=u,this.overrideDuration=a,this.app=e,this.timeCursor=new gf,this.cameraEntity=n,this.events=s,this.state=r,this.settings=i,i.fps>=0&&(this.frameInterval=1/i.fps),this.params=o,this.gsplat=e.root.findComponent("gsplat"),e.autoRender=!1,n.camera.clearColor=new yn(d==null?void 0:d.color),n.camera.fov=c?c.fov:50,console.log(n.camera.shaderParams.gammaCorrection,"!!!"),this.statsPanel=new yf(e,s,r,i);const f=()=>{this.cameraEntity.camera.horizontalFov=h.width>h.height};h.on("resizecanvas",()=>{f(),this.RenderNextFrame(!0)}),f();const y=new Si,x=new Si;e.on("framerender",()=>{const w=this.cameraEntity.getWorldTransform(),_=this.cameraEntity.camera.projectionMatrix,R=(S,k,M=1e-4)=>!S.some(($,I)=>Math.abs($-k[I])>=M);this.params.ministats&&this.RenderNextFrame(!0),!e.autoRender&&!e.renderNextFrame&&(!R(w.data,x.data)||!R(_.data,y.data))&&this.RenderNextFrame(!0),e.renderNextFrame&&(x.copy(w),y.copy(_)),r.readyToRender||this.RenderNextFrame(!1)}),z(s,"hqMode:changed",w=>{h.maxPixelRatio=w?window.devicePixelRatio:1,this.RenderNextFrame(!0)}),h.maxPixelRatio=r.hqMode?window.devicePixelRatio:1,z(s,"loaded",()=>{console.log("loaded^^ can start rendering"),this.initialize()}),this.initCameraElement()}RenderNextFrame(e){this.app.renderNextFrame=e}destroy(){this.pointerDevice.destroy(),this.statsPanel.destroy()}async initCameraElement(){this.cameraElement=await document.querySelector('pc-entity[name="camera"]').ready()}updateGSMaterial(){const{instance:e}=this.gsplat;e.createMaterial({fragment:wf})}initialize(){var ot,pe,Ze,ut,Le,Re,Fe,De,at,ne,he,ct;this.gsplat=this.app.root.findComponent("gsplat");const{app:e,cameraEntity:n,events:s,state:r,settings:i,gsplat:o}=this,a=((pe=(ot=o==null?void 0:o.instance)==null?void 0:ot.meshInstance)==null?void 0:pe.aabb)??new x0;this.updateGSMaterial();const d=(U,W)=>{var yt;const{animTracks:Z,camera:le}=U;if((Z==null?void 0:Z.length)>0&&le.startAnim==="animTrack"){const Me=Z.find(Ee=>Ee.name===le.animTrack);if(Me){let Ee=Me==null?void 0:Me.duration;return this.overrideDuration>0&&Ee>0?Ee=Math.min(this.overrideDuration,Ee):this.overrideDuration>0&&Ee<=0?Ee=this.overrideDuration:Ee<=0&&(Ee=5),Me.duration=Ee,Me}}const ue=2;let X=(Z==null?void 0:Z.length)>0?((yt=Z[0])==null?void 0:yt.duration)||5:-1;this.overrideDuration>0&&X>0?X=Math.min(this.overrideDuration,X):this.overrideDuration>0&&X<=0?X=this.overrideDuration:X<=0&&(X=5);const me=new Array(ue).fill(0).map((Me,Ee)=>Ee/ue*X),xe=[],Be=[],Pe=new Q;W.calcTarget(Pe);const ge=new Si,Se=new Q,qe=new Q(W.position.x-Pe.x,W.position.y-Pe.y,W.position.z-Pe.z);for(let Me=0;Me<ue;++Me)ge.setFromEulerAngles(0,Me/ue*90,0),ge.transformPoint(qe,Se),xe.push(Pe.x+Se.x),xe.push(Pe.y+Se.y),xe.push(Pe.z+Se.z),Be.push(Pe.x),Be.push(Pe.y),Be.push(Pe.z);return{name:"rotate",duration:X,frameRate:60,target:"camera",loopMode:"repeat",interpolation:"spline",keyframes:{times:me,values:{position:xe,target:Be}}}},c=(()=>{const W=a.halfExtents.length()/Math.sin(n.camera.fov/180*Math.PI*.5);return new Zt().fromLookAt(new Q(-1,.5,-1).normalize().mulScalar(W*.5).add(a.center),a.center)})(),l=(()=>{const{position:U,target:W}=this.settings.camera??{};return new Zt().fromLookAt(new Q(U??[-1,1,-1]),new Q(W??[0,1,0]))})(),u=((Ze=i==null?void 0:i.camera)==null?void 0:Ze.position)||((ut=i==null?void 0:i.camera)==null?void 0:ut.target)||a.halfExtents.length()>100,h=new Zt(u?l:c),f=d(i,h);this.timeCursor.reset(f.duration,f.loopMode);const y=ia.fromTrack(f,this.timeCursor),x=new lf,w=new cf,_=U=>{switch(U){case"orbit":return x;case"anim":return y;case"fly":return w}};w.moveSpeed=Math.max(.05,Math.min(1,a.halfExtents.length()*1e-4)),r.hasAnimationCamera=!!y,r.duration=this.timeCursor.duration,r.cameraMode=y?"anim":"orbit";const R=new Zt;r.cameraMode==="anim"?y.getPose(R):R.copy(h),x.reset(R),w.reset(R),this.pointerDevice=new mf(e.graphicsDevice.canvas);const S=new af(s,e,this.settings.xrCamera);vf(s,S,e.xr),z(s,"xrSessionStart",U=>{S.xr.onSessionStart(U)}),z(s,"xrSessionEnd",()=>{S.xr.onSessionEnd()}),z(s,"xrFrame",U=>{S.xr.onXRFrame(U)});let k=0;const M=new Zt;let $=null,I="orbit";const j=()=>{switch(r.cameraMode){case"orbit":this.pointerDevice.target=r.inputMode==="touch"?S.orbit:S.desktop;break;case"anim":this.pointerDevice.target=null;break;case"fly":this.pointerDevice.target=r.inputMode==="touch"?S.touch:S.desktop;break}};j(),z(s,"inputMode:changed",(U,W)=>{j()});const ee=U=>{r.cameraMode==="anim"&&(r.cameraMode=I),r.cameraMode==="orbit"?x.reset(U,!1):r.cameraMode==="fly"&&w.reset(U,!1)};z(s,"inputEvent",(U,W)=>{switch(U){case"frame":ee(c);break;case"reset":ee(l);break;case"cancel":case"interrupt":r.cameraMode==="anim"&&(r.cameraMode=I);break}});let de=!1;e.on("update",U=>{if(!de&&r.currentTime.toFixed(1)==="0.7"&&(r.timePaused=!0,de=!0),U*=r.playbackSpeed,!r.timePaused)if(this.frameInterval>=0){if(this.accumulatedTime+=U,this.accumulatedTime>=this.frameInterval){let X=Math.floor(this.accumulatedTime/this.frameInterval);this.accumulatedTime-=X*this.frameInterval,this.timeCursor.update(X*this.frameInterval),this.RenderNextFrame(!0)}}else this.timeCursor.update(U),this.RenderNextFrame(!0);if(r.currentTime=this.timeCursor.value,e.xr.active)return;if(S.update(U),r.cameraMode==="orbit"){const{value:X}=S.desktop.left.inputs[1];S.left.value[0]-=X[0]*2,S.left.value[1]-=X[1]*2}else if(r.cameraMode==="fly"){const{value:X}=S.desktop.left.inputs[0];S.left.value[1]-=X[1],S.left.value[2]+=X[1]}const W=S.touch.left;W.stick.every(X=>X===0)?s.fire("touchJoystickUpdate",null):s.fire("touchJoystickUpdate",W.base,W.stick);const Z={move:S.left,rotate:S.right},le=r.cameraMode==="anim"?U*k:U,ue=_(r.cameraMode);if(ue.update(le,r.cameraMode!=="anim"&&Z),ue.getPose(Rt),S.clear(),k<1&&(k=Math.min(1,k+U),k<1&&$)){const X=k,me=1-2**-10,xe=(1-2**(-10*X))/me;Rt.lerp(M,Rt,xe)}R.copy(Rt),n.setPosition(R.position),n.setRotation(R.rotation)}),z(s,"currentTime:changed",()=>{var X,me,xe,Be;const U=f==null?void 0:f.frameRate,W=(me=(X=this.gsplat)==null?void 0:X.instance)==null?void 0:me.material,Z=this.timeCursor.value*U/60;let le=Z;const ue=f==null?void 0:f.frameTs;if(ue){const Pe=Math.floor(Z*60),ge=ue==null?void 0:ue[Pe];ge>0&&(le=ge/60)}(Be=(xe=this.gsplat)==null?void 0:xe.instance)==null||Be.updateTime(le),W&&W.setParameter("uTime",le)}),z(s,"inputEvent",(U,W)=>{var le,ue,X,me;const Z=(ue=(le=this.gsplat)==null?void 0:le.instance)==null?void 0:ue.material;switch(U){case"toggleDebugMode":r.debugModeEnabled=!r.debugModeEnabled;break;case"decreaseSplatSize":r.splatScale=Math.max(r.splatScale-.05,.01),Z==null||Z.setParameter("uSplatScale",r.splatScale),this.RenderNextFrame(!0);break;case"increaseSplatSize":r.splatScale=Math.min(r.splatScale+.05,1),Z==null||Z.setParameter("uSplatScale",r.splatScale),this.RenderNextFrame(!0);break;case"togglePointCloudMode":r.pointCloudModeEnabled=!r.pointCloudModeEnabled,Z==null||Z.setParameter("pointCloudModeEnabled",r.pointCloudModeEnabled?1:0),this.RenderNextFrame(!0);break;case"toggleBackgroundColor":r.backgroundColor==="original"?(r.backgroundColor="white",n.camera.clearColor=new yn(1,1,1)):r.backgroundColor==="white"?(r.backgroundColor="black",n.camera.clearColor=new yn(0,0,0)):(r.backgroundColor="original",n.camera.clearColor=new yn(i.background.color)),this.RenderNextFrame(!0);break;case"framePlaybackForward":r.timePaused=!0,this.timeCursor.update(.05),this.RenderNextFrame(!0);break;case"framePlaybackBackward":r.timePaused=!0,this.timeCursor.update(-.05),this.RenderNextFrame(!0);break;case"decreasePlaybackRate":r.playbackSpeed=Math.max(r.playbackSpeed-.1,.1);break;case"increasePlaybackRate":r.playbackSpeed=Math.min(r.playbackSpeed+.1,2);break;case"slowMotion":r.playbackSpeed>=1?r.playbackSpeed=.2:r.playbackSpeed=1;break;case"decreaseXrPlaybackRate":r.playbackSpeed>=1?r.playbackSpeed=.2:r.playbackSpeed=1;break;case"resetPlaybackRate":r.playbackSpeed=1;break;case"resetXrPosition":const xe=(me=(X=this.cameraElement)==null?void 0:X.parentElement)==null?void 0:me.entity;if(xe){const Be=(()=>{const{position:Pe,target:ge}=this.settings.xrCamera;return new Zt().fromLookAt(new Q(Pe??[0,0,-2]),new Q(ge??[0,0,0]))})();xe.setPosition(Be.position.x,Be.position.y,Be.position.z),xe.setRotation(Be.rotation)}break}});const fe=({position:U,target:W,fov:Z})=>{r.cameraMode="orbit";const le=new Zt().fromLookAt(new Q(U??[-1,1,-1]),new Q(W??[0,1,0]));return ee(le),Z&&(n.camera.fov=Z),{camera:_(r.cameraMode),newPose:le}};(Le=s==null?void 0:s.function)==null||Le.call(s,"getOrbitCameraActive",fe),((Re=window.super_camera_setting)==null?void 0:Re.length)>0&&(window.super_camera_setting=(De=(Fe=window.super_camera_setting)==null?void 0:Fe.map(U=>(U&&fe(U),null)))==null?void 0:De.filter(U=>!!U)),z(s,"cameraMode:changed",(U,W)=>{switch(I=W,$=_(W),$.getPose(M),U){case"orbit":case"fly":_(U).reset(Rt);break}k=0,j()}),z(s,"setCurrentTime",U=>{if(this.frameInterval>=0){let W=Math.floor(U/this.frameInterval);this.timeCursor.value=W*this.frameInterval,this.accumulatedTime=0}else this.timeCursor.value=U;this.RenderNextFrame(!0)});let re=null;z(s,"inputEvent",async(U,W)=>{var Z,le;if(r.cameraMode==="orbit"&&U==="dblclick"){this.updateGSMaterial(),re||(re=new pf(e,n));const{top:ue=0,left:X=0}=((le=(Z=W.target)==null?void 0:Z.getBoundingClientRect)==null?void 0:le.call(Z))||{},me=await re.pick(W.clientX-X,W.clientY-ue);me&&(x.getPose(Rt),Rt.fromLookAt(Rt.position,me),x.reset(Rt,!1),console.log("---- orbitCamera position",[Rt.position.x,Rt.position.y,Rt.position.z]),console.log("---- orbitCamera target",[me.x,me.y,me.z]))}}),n.setPosition(R.position),n.setRotation(R.rotation);let O=!1;(ne=(at=o==null?void 0:o.instance)==null?void 0:at.sorter)==null||ne.on("initialized",()=>{var U;this.dynamicSorting,O&&((U=o==null?void 0:o.instance)==null||U.sort(n))}),z(s,"loadAllAssetsDone",()=>{var U;O=!0,(U=o==null?void 0:o.instance)==null||U.sort(n)}),(ct=(he=o==null?void 0:o.instance)==null?void 0:he.sorter)==null||ct.on("updated",(U,W)=>{var Z,le,ue,X;if(typeof this.temporalSorting=="boolean"&&!this.temporalSorting?(le=(Z=o==null?void 0:o.instance)==null?void 0:Z.sorter)==null||le.setUseTemporalSort(!1):(X=(ue=o==null?void 0:o.instance)==null?void 0:ue.sorter)==null||X.setUseTemporalSort(!0),W>0&&(r.sortTime=W),r.renderCount=U,this.RenderNextFrame(!0),!r.readyToRender){r.readyToRender=!0;const me=e.on("frameend",()=>{var xe;me.off(),s.fire("firstFrame"),(xe=window.firstFrame)==null||xe.call(window)})}});let q=0,Te=0;z(s,"xrJoystickMove",U=>{var X,me,xe,Be,Pe;if(!e.xr.active)return;const W=(me=(X=this.cameraElement)==null?void 0:X.parentElement)==null?void 0:me.entity;if(!W)return;const Z=((Pe=(Be=(xe=o==null?void 0:o.instance)==null?void 0:xe.meshInstance)==null?void 0:Be.aabb)==null?void 0:Pe.halfExtents.length())||1,le=Math.max(.5,Math.min(2,Z*.1)),ue=40;if(U.handedness==="left"){const ge=W.getPosition().clone(),Se=W.getRotation().clone(),qe=new Q(0,0,-1),Je=new Q(1,0,0),yt=new Q,Me=new Q;Se.transformVector(qe,yt),Se.transformVector(Je,Me),qe.copy(yt),Je.copy(Me),qe.y=0,Je.y=0,qe.length()>0&&qe.normalize(),Je.length()>0&&Je.normalize();const Ee=new Q;Ee.add(Je.mulScalar(U.moveX*le)),Ee.add(qe.mulScalar(-U.moveZ*le)),W.setPosition(ge.x+Ee.x,ge.y,ge.z+Ee.z)}else if(U.handedness==="right"){let ge=U.moveX*ue,Se=U.moveZ*ue;const qe=.3;ge=ge*qe+q*(1-qe),Se=Se*qe+Te*(1-qe),q=ge,Te=Se;const Je=W.getRotation().clone(),yt=Je.getEulerAngles();(yt.x>60&&Se>0||yt.x<-60&&Se<0)&&(Se*=.2);const Me=new Q(0,1,0),Ee=new gn().setFromAxisAngle(Me,ge);let an=new gn().mul2(Ee,Je);const es=new Q(1,0,0),A=new Q;Je.transformVector(es,A);const L=new gn().setFromAxisAngle(A,Se);an=new gn().mul2(L,an),W.setRotation(an)}this.RenderNextFrame(!0)})}}class Sf{constructor(){g(this,"performance");g(this,"navigator");g(this,"metrics",null);g(this,"error",null);this.performance=window.performance,this.navigator=window.navigator}getDeviceType(){const e=this.navigator.userAgent.toLowerCase(),n=this.navigator.platform.toLowerCase();return/iphone|ipad|ipod/.test(e)?"iOS":/android/.test(e)?"Android":/mac/.test(n)?"macOS":/win/.test(n)?"Windows":/linux/.test(n)?"Linux":"Unknown"}getDeviceInfo(){return{userAgent:this.navigator.userAgent,platform:this.navigator.platform,language:this.navigator.language,deviceMemory:this.navigator.deviceMemory||"unknown",hardwareConcurrency:this.navigator.hardwareConcurrency||"unknown",maxTouchPoints:this.navigator.maxTouchPoints||"unknown",deviceType:this.getDeviceType()}}getMemoryInfo(){return this.performance.memory?{totalJSHeapSize:this.performance.memory.totalJSHeapSize,usedJSHeapSize:this.performance.memory.usedJSHeapSize,jsHeapSizeLimit:this.performance.memory.jsHeapSizeLimit}:"Memory API not available"}async getGPUInfo(){try{const e=document.createElement("canvas"),n=e.getContext("webgl")||e.getContext("experimental-webgl");if(!n)return"WebGL not supported";const s=n.getExtension("WEBGL_debug_renderer_info");return s?{vendor:n.getParameter(s.UNMASKED_VENDOR_WEBGL),renderer:n.getParameter(s.UNMASKED_RENDERER_WEBGL)}:"GPU info not available"}catch(e){return`Error getting GPU info: ${e.message}`}}measureFPS(){return new Promise(e=>{let n=0,s=performance.now();function r(){n++;const o=performance.now()-s;if(o>=1e3){const a=Math.round(n*1e3/o);e(a);return}requestAnimationFrame(r)}requestAnimationFrame(r)})}async refresh(){try{this.error=null;const e={deviceInfo:this.getDeviceInfo(),memoryInfo:this.getMemoryInfo(),gpuInfo:await this.getGPUInfo(),fps:await this.measureFPS()};this.metrics=e}catch(e){this.error=e.message}}getMetrics(){return this.metrics}getError(){return this.error}async initialize(){await this.refresh()}}const Ar=new Q,Ef=t=>{const e=Cf(t);return Number(e.horizontalFov.toFixed(2))},Cf=t=>{const e=t[0][0],n=t[1][1],s=t[0][2],r=t[1][2],i=2*s,o=2*r,d=2*Math.atan2(i/2,e)*180/Math.PI,l=2*Math.atan2(o/2,n)*180/Math.PI;return{horizontalFov:d,verticalFov:l}},Af=async t=>{var M,$;const n=await(await fetch(t)).text(),s=60,r=(M=n.trim().split(`
`))==null?void 0:M.map(I=>I.replace(/\r/g,"")),i=r[0].split(","),o=i.findIndex(I=>I.trim()==="frame"),a=i.findIndex(I=>I.trim()==="ts"),d=[i.findIndex(I=>I.trim()==="trans_0"),i.findIndex(I=>I.trim()==="trans_1"),i.findIndex(I=>I.trim()==="trans_2")],c=Array(3).fill(0).map(()=>Array(3).fill(-1));for(let I=0;I<3;I++)for(let j=0;j<3;j++)c[I][j]=i.findIndex(ee=>ee.trim()===`rots_${I}_${j}`);const l=Array(3).fill(0).map(()=>Array(3).fill(-1));for(let I=0;I<3;I++)for(let j=0;j<3;j++)l[I][j]=i.findIndex(ee=>ee.trim()===`Ks_${I}_${j}`);if(o===-1||d.some(I=>I===-1)||c.some(I=>I.some(j=>j===-1))){console.error("CSV格式不符合预期，缺少必要字段");return}const u=new Q(0,0,0),h=[];let f,y=[],x=[],w=[],_={};for(let I=1;I<r.length;I++){const j=r[I].split(","),ee=d.map(fe=>parseFloat(j[fe])),de=new Q(ee[0],ee[1],ee[2]);h.push(de),u.add(de)}h.length>0&&u.mulScalar(1/h.length);for(let I=1;I<r.length;I++){const j=r[I].split(",");parseInt(j[o],10);const ee=d.map(Re=>parseFloat(j[Re])),de=[];for(let Re=0;Re<3;Re++){const Fe=[];for(let De=0;De<3;De++)Fe.push(parseFloat(j[c[Re][De]]));de.push(Fe)}let fe=null;if(l.every(Re=>Re.every(Fe=>Fe!==-1))){fe=[];for(let Re=0;Re<3;Re++){const Fe=[];for(let De=0;De<3;De++)Fe.push(parseFloat(j[l[Re][De]]));fe.push(Fe)}}const O=new Q(ee[0],ee[1],ee[2]),q=new Q(de[0][2],de[1][2],de[2][2]);Ar.copy(q).normalize().mulScalar(2).add(O);const ot=fe?Ef(fe):50,Ze=parseInt(j[o],10)/s,ut=[O.x,O.y,O.z],Le=[Ar.x,Ar.y,Ar.z];y=y.concat([Ze]),_[parseInt(j[o],10)]=parseInt(j[a],10),x=x.concat(ut),w=w.concat(Le),f={startAnim:"animTrack",animTrack:"cameraAnim",fov:ot,position:ut,target:Le}}const R=($=r.at(-1))==null?void 0:$.split(","),S=parseInt(R[o],10)/s;let k=ls.settings;return k.animTracks=[{name:"cameraAnim",target:"camera",loopMode:"repeat",interpolation:"spline",duration:S,frameRate:s,keyframes:{times:y,values:{position:x,target:w}},frameTs:_}],k.camera=f,k},kf=async t=>{let e=null;return/(^https?:\/\/|.*\.(json|csz))/.test(t)?(t.endsWith(".csv")?e=await Af(t):e=await fetch(`${t}?t=${Date.now()}`).then(s=>s.json()),console.log("formateCameraSettings csv===>>>",e),e):null},Pf={plyPath:"/4dgs/demo/corgi_30w.ply",lowVRPlyPath:"",lowPlyPath:"",highPlyPath:"",timeOption:"0,5,5,5",previewPath:"",posterPath:"./splats/demo.png",settingPath:"/4dgs/demo/new/corgi_settings.json",paramsPath:"",audioPath:"",position:"",rotation:"",scale:"",audioPosition:""},_f={plyPath:"/4dgs/demo/corgi_50w.ply",timeOption:"0,5",settingPath:"/4dgs/demo/new/corgi_settings.json"},Tf={plyPath:"/4dgs/demo/tim_30w.ply",timeOption:"0,5",settingPath:"/4dgs/demo/new/timtalk_settings.json"},Rf={plyPath:"/4dgs/demo/tim_50w.ply",timeOption:"0,5",settingPath:"/4dgs/demo/new/timtalk_settings.json"},Mf={plyPath:"/4dgs/demo/new/corgi_l.4dv",lowVRPlyPath:"/4dgs/demo/new/corgi_l.4dv",lowPlyPath:"/4dgs/demo/new/corgi_l.4dv",posterPath:"/4dgs/demo/new/corgi.webp",previewPath:"/4dgs/demo/new/corgi.webm",settingPath:"/4dgs/demo/new/corgi_settings.json",scale:"1,1,1",showDemo:"4dv,ysjf"},If={plyPath:"/4dgs/demo/new/new_timtalk_seg_1.4dv, /4dgs/demo/new/new_timtalk_seg_2.4dv, /4dgs/demo/new/new_timtalk_seg_3.4dv",highPlyPath:"/4dgs/demo/new/timtalk_0_h.4dv",timeOption:"0,5,5,5,10,4.7",settingPath:"/4dgs/demo/new/timtalk_settings.json",posterPath:"/4dgs/demo/new/timtalk.png",previewPath:"/4dgs/demo/new/timtalk.webm",audioPath:"/4dgs/demo/new/tim-talk-0610-20s.wav",audioPosition:"0,0,0",scale:"1.13,1.13,1.13",showDemo:"ysjf,4dv"},Lf={plyPath:"/4dgs/demo/dance_white_seg_1_3.4dv, /4dgs/demo/dance_white_seg_2_3.4dv, /4dgs/demo/dance_white_seg_3_3.4dv",timeOption:"0,5,5,5,10,5",posterPath:"/4dgs/demo/new/0512_dance_white.png",settingPath:"/4dgs/demo/dance_color_settings.json",previewPath:"/4dgs/demo/dance_white.webm",scale:"1,1,1",showDemo:""},Bf={plyPath:"/4dgs/demo/new/neemo.compressed.ply",settingPath:"/4dgs/demo/new/neemo_settings.json",position:"0,0,0",rotation:"0,0,0",scale:"1.4,1.4,1.4"},Ff={plyPath:"/4dgs/demo/new/neemo_m.compressed.ply",lowVRPlyPath:"/4dgs/demo/new/neemo_l.compressed.ply",lowPlyPath:"/4dgs/demo/new/neemo_l.compressed.ply",highPlyPath:"/4dgs/demo/new/neemo_h.compressed.ply",settingPath:"/4dgs/demo/new/neemo2_1_settings.json",audioPath:"/4dgs/demo/new/neemo_1.wav",position:"0,0,0",rotation:"0,0,0",audioPosition:"0,0,0",scale:"1.25,1.25,1.25"},Df={plyPath:"/4dgs/demo/new/neemo3_m.compressed.ply",lowVRPlyPath:"/4dgs/demo/new/neemo3_l.compressed.ply",lowPlyPath:"/4dgs/demo/new/neemo3_l.compressed.ply",highPlyPath:"/4dgs/demo/new/neemo3_h.compressed.ply",settingPath:"/4dgs/demo/new/neemo3_settings.json",audioPath:"/4dgs/demo/new/neemo3.wav",position:"0,0,0",rotation:"0,0,0",audioPosition:"0,0,0",scale:"1.25,1.25,1.25"},Nf={plyPath:"/4dgs/demo/new/boss_bg.ply",settingPath:"/4dgs/demo/new/boss_bg_settings.json",scale:"1,1,1"},Of={plyPath:"/4dgs/demo/new/ysjf_lsw.compressed.ply",settingPath:"/4dgs/demo/new/ysjf_lsw_settings.json",scale:"0.6,0.6,0.6"},Uf={plyPath:"/4dgs/demo/new/boss_seg_3.compressed.ply",lowVRPlyPath:"/4dgs/demo/new/boss_seg_3_l.compressed.ply",lowPlyPath:"/4dgs/demo/new/boss_seg_3_l.compressed.ply",highPlyPath:"/4dgs/demo/new/boss_seg_3_h.compressed.ply",settingPath:"/4dgs/demo/new/boss_seg_3_settings.json",scale:"1,1,1"},Qf={plyPath:"/4dgs/demo/new/new_jazz_seg_7155-7461.4dv, /4dgs/demo/new/new_jazz_seg_7455-7761.4dv, /4dgs/demo/new/new_jazz_seg_7755-8061.4dv",timeOption:"0,5,5,5,10,5",settingPath:"/4dgs/demo/new/jazz_settings.json",posterPath:"/4dgs/demo/new/new_jazz.png",previewPath:"/4dgs/demo/new/new_jazz.webm",audioPath:"/4dgs/demo/new/jazz.wav",scale:"0.54,0.54,0.54",showDemo:"ysjf,4dv"},$f={plyPath:"/4dgs/demo/new/new_dance_seg_0.4dv",timeOption:"0,5",settingPath:"/4dgs/demo/new/dance_settings.json",posterPath:"/4dgs/demo/new/dance.png",previewPath:"/4dgs/demo/new/dance.webm",scale:"0.48,0.48,0.48",showDemo:"ysjf,4dv"},Hf={plyPath:"/4dgs/demo/new/dtwd_seg_0_l.4dv",lowVRPlyPath:"/4dgs/demo/new/dtwd_seg_0_l.4dv",lowPlyPath:"/4dgs/demo/new/dtwd_seg_0_l.4dv",highPlyPath:"/4dgs/demo/new/dtwd_seg_0_h.4dv",settingPath:"/4dgs/demo/new/dtwd_settings_1.json",posterPath:"/4dgs/demo/new/shiku_dtwd.png",previewPath:"/4dgs/demo/new/shiku_dtwd.webm",scale:"1.4,1.4,1.4",showDemo:"ysjf,4dv,yg"},zf={plyPath:"/4dgs/demo/new/no10_l.4dv",lowVRPlyPath:"/4dgs/demo/new/no10_l.4dv",lowPlyPath:"/4dgs/demo/new/no10_l.4dv",highPlyPath:"/4dgs/demo/new/no10_h.4dv",settingPath:"/4dgs/demo/new/shiku_no10_settings.json",posterPath:"/4dgs/demo/new/no10.png",previewPath:"/4dgs/demo/new/no10.webm",scale:"1,1,1",showDemo:"ysjf,4dv,yg"},qf={plyPath:"/4dgs/demo/new/no13_l.4dv",lowVRPlyPath:"/4dgs/demo/new/no13_l.4dv",lowPlyPath:"/4dgs/demo/new/no13_l.4dv",settingPath:"/4dgs/demo/new/shiku_no13_settings.json",posterPath:"/4dgs/demo/new/no13.png",previewPath:"/4dgs/demo/new/no13.webm",scale:"1,1,1",showDemo:"ysjf,4dv,yg"},jf={plyPath:"/4dgs/demo/new/shiku_no20_dance.compressed.ply",settingPath:"/4dgs/demo/new/shiku_no20_dance_settings.json",scale:"1,1,1",showDemo:""},Wf={plyPath:"/4dgs/demo/new/corgi_5s_300frames_60fps_300w_200epoch_delete.4dv",settingPath:"/4dgs/demo/new/corgi_5s_300frames_60fps_300w_200epoch.json",posterPath:"/4dgs/demo/new/corgi_5s_300frames_60fps_300w_200epoch.png",scale:"1,1,1",showDemo:"ftgs"},Vf={plyPath:"/4dgs/demo/new/hair_3s_180frames_60fps_4k_ccm_200w_200epoch_deleted.4dv",settingPath:"/4dgs/demo/new/hair_3s_180frames_60fps_4k_ccm_200w_200epoch.json",posterPath:"/4dgs/demo/new/hair_3s_180frames_60fps_4k_ccm_200w_200epoch.png",scale:"1,1,1",showDemo:"ftgs"},Kf={plyPath:"/4dgs/demo/new/salmon_10s_300frames_30fps_4k_200w_60epoch_deleted.4dv",settingPath:"/4dgs/demo/new/salmon_10s_300frames_30fps_4k_200w_60epoch.json",posterPath:"/4dgs/demo/new/salmon_10s_300frames_30fps_4k_200w_60epoch.png",scale:"1,1,1",showDemo:"ftgs"},Gf={plyPath:"/4dgs/demo/new/group_photo_m_seg_0.4dv",lowVRPlyPath:"/4dgs/demo/new/group_photo_l_seg_0.4dv",lowPlyPath:"/4dgs/demo/new/group_photo_l_seg_0.4dv",highPlyPath:"/4dgs/demo/new/group_photo_l_seg_0.4dv, /4dgs/demo/new/group_photo_l_seg_1.4dv, /4dgs/demo/new/group_photo_l_seg_2.4dv, /4dgs/demo/new/group_photo_l_seg_3.4dv",timeOption:"0,5,5,5,10,5,15,5",settingPath:"/4dgs/demo/new/ysjf_group_photo_long_settings.json",posterPath:"/4dgs/demo/new/ysjf_group_photo.png",scale:"1,1,1",showDemo:""},Zf={plyPath:"/4dgs/demo/new/nikk1_cleaned.4dv",highPlyPath:"/4dgs/demo/new/nikki1_seg_0.4dv, /4dgs/demo/new/nikki1_seg_1.4dv, /4dgs/demo/new/nikki1_seg_2.4dv, /4dgs/demo/new/nikki1_seg_3.4dv, /4dgs/demo/new/nikki1_seg_4.4dv",timeOption:"0,5,5,5,10,5,15,5,20,5",settingPath:"/4dgs/demo/new/nikki1_long_settings.json",posterPath:"/4dgs/demo/new/nikki1.png",scale:"1,1,1",showDemo:""},Xf={plyPath:"/4dgs/demo/new/nikk2_cleaned.4dv",highPlyPath:"/4dgs/demo/new/nikki2_seg_0.4dv, /4dgs/demo/new/nikki2_seg_1.4dv, /4dgs/demo/new/nikki2_seg_2.4dv",timeOption:"0,5,5,5,10,5",settingPath:"/4dgs/demo/new/nikki2_long_settings.json",posterPath:"/4dgs/demo/new/nikki2.png",scale:"1,1,1",showDemo:""},Yf={plyPath:"/4dgs/demo/new/bbbv1_blue.4dv",settingPath:"/4dgs/demo/new/bbb_settings.json",scale:"1,1,1",showDemo:""},Jf={plyPath:"/4dgs/demo/new/bbbv1_blue2.4dv",settingPath:"/4dgs/demo/new/bbb_settings.json",scale:"1,1,1",showDemo:""},ep={plyPath:"/4dgs/demo/new/bbbv1_entrance.4dv",settingPath:"/4dgs/demo/new/bbb_settings.json",scale:"1,1,1",showDemo:""},tp={plyPath:"/4dgs/demo/new/bbbv1_mirror.4dv",settingPath:"/4dgs/demo/new/bbb_settings.json",scale:"1,1,1",showDemo:""},np={plyPath:"/4dgs/demo/new/bbbv1_shiny.4dv",settingPath:"/4dgs/demo/new/bbb_settings.json",scale:"1,1,1",showDemo:""},sp={plyPath:"/4dgs/demo/diffuman4d/dnar_0172_05_v2.4dv",posterPath:"/4dgs/demo/diffuman4d/dnar_0172_05.png",settingPath:"/4dgs/demo/diffuman4d/dnar_settings.json",scale:"0.05,0.05,0.05",showDemo:"diffuman4d"},rp={plyPath:"/4dgs/demo/diffuman4d/dnar_0230_03_v2.4dv",posterPath:"/4dgs/demo/diffuman4d/dnar_0230_03.png",settingPath:"/4dgs/demo/diffuman4d/dnar_settings.json",scale:"0.05,0.05,0.05",showDemo:"diffuman4d"},ip={plyPath:"/4dgs/demo/diffuman4d/dnar_0410_05_v2.4dv",posterPath:"/4dgs/demo/diffuman4d/dnar_0410_05.png",settingPath:"/4dgs/demo/diffuman4d/dnar_settings.json",scale:"0.05,0.05,0.05",showDemo:"diffuman4d"},op={plyPath:"/4dgs/demo/diffuman4d/dnar_0623_01_v2.4dv",posterPath:"/4dgs/demo/diffuman4d/dnar_0623_01.png",settingPath:"/4dgs/demo/diffuman4d/dnar_settings.json",scale:"0.05,0.05,0.05",showDemo:"diffuman4d"},ap={plyPath:"/4dgs/demo/diffuman4d/dnar_0811_06_v2.4dv",posterPath:"/4dgs/demo/diffuman4d/dnar_0811_06.png",settingPath:"/4dgs/demo/diffuman4d/dnar_settings.json",scale:"0.05,0.05,0.05",showDemo:"diffuman4d"},cp={plyPath:"/4dgs/demo/diffuman4d/fdvai_dance_colored_v2.4dv",posterPath:"/4dgs/demo/diffuman4d/fdvai_dance_colored.png",settingPath:"/4dgs/demo/diffuman4d/fdvai_settings.json",scale:"0.05,0.05,0.05",showDemo:"diffuman4d"},dp={plyPath:"/4dgs/demo/diffuman4d/fdvai_dance_white_v2.4dv",posterPath:"/4dgs/demo/diffuman4d/fdvai_dance_white.png",settingPath:"/4dgs/demo/diffuman4d/fdvai_settings.json",scale:"0.05,0.05,0.05",showDemo:"diffuman4d"},lp={plyPath:"/4dgs/demo/diffuman4d/fdvai_yoga_dance_v2.4dv",posterPath:"/4dgs/demo/diffuman4d/fdvai_yoga_dance.png",settingPath:"/4dgs/demo/diffuman4d/fdvai_settings.json",scale:"0.05,0.05,0.05",showDemo:"diffuman4d"},up={plyPath:"/4dgs/demo/infinite_reality_demo.4dv",settingPath:"/4dgs/demo/infinite_reality_demo.json",scale:"1,1,1"},hp={plyPath:"/4dgs/demo/jay_demo_seg2.4dv,/4dgs/demo/jay_demo_seg3.4dv",timeOption:"0,5,5,5",settingPath:"/4dgs/demo/jay_demo1_settings.json",scale:"1,1,1"},fp={plyPath:"/4dgs/demo/jay_demo2.4dv",timeOption:"0,5",settingPath:"/4dgs/demo/jay_demo2_settings.json",scale:"1,1,1"},pp={plyPath:"/4dgs/demo/hz_story.4dv",timeOption:"0,5",settingPath:"/4dgs/demo/hz_story1_settings.json",scale:"1,1,1"},mp={plyPath:"/4dgs/demo/hz_story2_seg1.4dv, /4dgs/demo/hz_story2_seg2.4dv",timeOption:"0,5,5,5",settingPath:"/4dgs/demo/hz_story2_settings.json",scale:"1,1,1"},gp={demo:Pf,demo2:_f,demo_tim_30:Tf,demo_tim_50:Rf,"ysjf-sjg":{plyPath:"/4dgs/demo/new/new_ysjf-sjg_seg_0.4dv",posterPath:"/4dgs/demo/new/ysjf-sjg.webp",previewPath:"/4dgs/demo/new/ysjf-sjg.webm",settingPath:"/4dgs/demo/new/ysjf-sjg_settings.json",scale:"1,1,1",showDemo:"ysjf,4dv"},corgi:Mf,timtalk:If,"0512_dance_color":{plyPath:"/4dgs/demo/new/new_0512_dance_color_seg_13.4dv",posterPath:"/4dgs/demo/new/0512_dance_color.png",settingPath:"/4dgs/demo/new/0512_dance_color_settings.json",previewPath:"/4dgs/demo/new/0512_dance_color.webm",scale:"1,1,1",showDemo:"ysjf,4dv"},"0512_dance_white":{plyPath:"/4dgs/demo/new/new_0512_dance_white_seg_13.4dv",posterPath:"/4dgs/demo/new/0512_dance_white.png",settingPath:"/4dgs/demo/new/0512_dance_color_settings.json",previewPath:"/4dgs/demo/new/0512_dance_white.webm",scale:"1,1,1",showDemo:""},dance_white:Lf,"jm-talk":{plyPath:"/4dgs/demo/new/jm.compressed.ply",settingPath:"/4dgs/demo/new/jm_settings.json",scale:"0.6,0.6,0.6"},neemo:Bf,neemo2:Ff,neemo3:Df,"ysjf2-seq3":{plyPath:"/4dgs/demo/new/ysjf2-seq3.compressed.ply",settingPath:"/4dgs/demo/new/ysjf2-seq3_settings.json",scale:"0.6,0.6,0.6"},"ysjf2-seq13":{plyPath:"/4dgs/demo/new/ysjf2-seg13.compressed.ply",settingPath:"/4dgs/demo/new/ysjf2-seg13_settings.json",scale:"0.6,0.6,0.6"},"a2o-4-9_seq3_seg0":{plyPath:"/4dgs/demo/new/4-9_seq3_seg0.compressed.ply",settingPath:"/4dgs/demo/new/a2o_settings.json",scale:"1,1,1"},"a2o-4-8_seq0_seg1":{plyPath:"/4dgs/demo/new/4-8_seq0_seg1.compressed.ply",settingPath:"/4dgs/demo/new/a2o_settings.json",scale:"1,1,1"},"a2o-1-4_seq0_seg0":{plyPath:"/4dgs/demo/new/1-4_seq0_seg0.compressed.ply",settingPath:"/4dgs/demo/new/a2o_settings.json",scale:"1,1,1"},boss_bg:Nf,"r3-18":{plyPath:"/4dgs/demo/new/r3_18.compressed.ply",settingPath:"/4dgs/demo/new/r3_18_settings.json",scale:"1.1,1.1,1.1"},ysjf_lsw:Of,"719_mvc":{plyPath:"/4dgs/demo/new/719_mvc.compressed.ply",settingPath:"/4dgs/demo/new/719_mvc_settings.json",scale:"1.05,1.05,1.05"},boss_seg_3:Uf,jazz:Qf,dance:$f,shiku_dtwd:Hf,shiku_no10:zf,shiku_no13:qf,shiku_no20_dance:jf,"zcam-data_seg0-201":{plyPath:"/4dgs/demo/new/0519-zcam-data_subseqs_seq_seg0-201_fps50.4dv",settingPath:"/4dgs/demo/new/0519-zcam-data_subseqs_seq_seg0-201_settings.json",scale:"1,1,1",showDemo:""},"hunan_data_seg0-226":{plyPath:"/4dgs/demo/new/0519_hunan_data_subseqs_seq_seg0-226_fps25.4dv",settingPath:"/4dgs/demo/new/0519_hunan_data_subseqs_seq_seg0-226_settings.json",scale:"1,1,1",showDemo:""},"zcam-data_seg0-201_fps50":{plyPath:"/4dgs/demo/new/0519-zcam-data_subseqs_seq_seg0-201_fps50.4dv",settingPath:"/4dgs/demo/new/0519-zcam-data_subseqs_seq_seg0-201_fps50_settings.json",scale:"1,1,1",showDemo:""},"hunan_data_seg0-226_fps25":{plyPath:"/4dgs/demo/new/0519_hunan_data_subseqs_seq_seg0-226_fps25.4dv",settingPath:"/4dgs/demo/new/0519_hunan_data_subseqs_seq_seg0-226_fps25_settings.json",scale:"1,1,1",showDemo:""},corgi_5s:Wf,hair_3s:Vf,salmon_10s:Kf,ysjf_group_photo:Gf,nikk1:Zf,nikk2:Xf,bbbv1_blue:Yf,bbbv1_blue2:Jf,bbbv1_entrance:ep,bbbv1_mirror:tp,bbbv1_shiny:np,diffuman4d_dnar_0172_05:sp,diffuman4d_dnar_0230_03:rp,diffuman4d_dnar_0410_05:ip,diffuman4d_dnar_0623_01:op,diffuman4d_dnar_0811_06:ap,diffuman4d_fdvai_dance_colored:cp,diffuman4d_fdvai_dance_white:dp,diffuman4d_fdvai_yoga_dance:lp,ir_michael:up,jay_demo:hp,jay_demo2:fp,hz_story:pp,hz_story2:mp},yp="https://s1.4dv-intelligence.com",ke=(t,e)=>{var n;return typeof t=="string"?(n=t==null?void 0:t.split(","))==null?void 0:n.map(s=>Number(s)):t||e},Qe={position:[0,0,0],rotation:[0,0,0],scale:[1.1,1.1,1.1],timeOption:[0,60],audioPosition:[0,0,0]},ls={settings:{fps:-1,xrCamera:{fov:50,position:[1,0,2],target:[.3,0,.6]},camera:{fov:50,position:[1,1,2],target:[0,1,0]},animTracks:[{duration:5,frameRate:60}]},params:null,app:null,performanceLevel:It.MEDIUM,metaInfo:{contentUrl:"",timeOption:ke(Qe.timeOption),position:ke(Qe.position),rotation:ke(Qe.rotation),scale:ke(Qe.scale),audioPosition:ke(Qe.audioPosition)},guideList:[]},wp=async()=>gp,kr=t=>{if(!t)return"";const e="/";let n=[t];return t.includes(",")&&(n=t.split(",")),n=n.map(s=>(s=s.trim(),s!=null&&s.startsWith(e)&&(s=`${yp}${s}`),s)),n.join(", ")},bp=()=>{const t=new URL(location.href);let e={},n=ls;const s=async()=>{const a=new Sf,d=new U0;await a.initialize();const c=a.getMetrics();return c?d.evaluatePerformance(c):It.MEDIUM},r=a=>{let d=a||(t.searchParams.has("content")?t.searchParams.get("content"):"");if(!d){const c=t.pathname.replace(/^\/|\/$/g,"").split("/");d=c.length>0?c[0]==="viewer"?c[1]:c[0]:""}return d},i=()=>{const a={showdemo:"4dv"};return t.searchParams.has("showdemo")&&(a.showdemo=t.searchParams.get("showdemo")||"4dv"),t.searchParams.has("noui")&&(a.noui=!0),t.searchParams.has("noanim")&&(a.noanim=!0),t.searchParams.has("skybox")&&(a.skyboxUrl=t.searchParams.get("skybox")),t.searchParams.has("ministats")&&(a.ministats=!0),t.searchParams.has("cpath")&&(a.cpath=decodeURIComponent(t.searchParams.get("cpath"))),a},o=async a=>{var re,O;const{settingUrl:d,plyUrl:c,contentName:l,resetMode:u,audioUrl:h,settingJson:f,metaInfoObj:y}=a||{},x=await s(),w=r(l),_=i();let R=c;if(c&&(!f||JSON.stringify(f)==="{}"))return n={app:n.app,guideList:n.guideList,performanceLevel:x,params:{...n.params||{},..._||{}},settings:{...(n==null?void 0:n.settings)||{}},metaInfo:{...(n==null?void 0:n.metaInfo)||{},...y||{},audioUrl:h,contentUrl:R}},n;const S=await wp(),k=S[w];let M={posterUrl:"",previewUrl:"",audioUrl:"",settingUrl:d,ultraUrl:"",position:Qe.position,rotation:Qe.rotation,scale:Qe.scale,timeOption:Qe.timeOption};if(k){switch(R=k.plyPath,x){case It.LOW:R=k.lowPlyPath;break;case It.LOW_VR:R=k.lowVRPlyPath;break;case It.HIGH:case It.MEDIUM:default:R=k.plyPath}if(u)switch(u){case It.LOW:R=k.lowPlyPath;break;case It.LOW_VR:R=k.lowVRPlyPath;break;case It.HIGH:R=k.highPlyPath;break;case It.MEDIUM:default:R=k.plyPath}R||(R=k.plyPath),M=Object.assign(M,{posterUrl:k.posterPath,previewUrl:k.previewPath,audioUrl:k.audioPath,settingUrl:_.cpath||k.settingPath,ultraUrl:k.highPlyPath,position:k.position||Qe.position,rotation:k.rotation||Qe.rotation,scale:k.scale||Qe.scale,timeOption:k.timeOption||Qe.timeOption,audioPosition:k.audioPosition||Qe.audioPosition})}if(!k&&decodeURIComponent(w)&&t.searchParams.get("content")){R=decodeURIComponent(t.searchParams.get("content"));const Te=R.split(",").length;M=Object.assign(M,{settingUrl:_.cpath,position:Qe.position,rotation:Qe.rotation,scale:Qe.scale,timeOption:li({startNumber:0,spaceTime:5,number:Te}),audioPosition:Qe.audioPosition})}y&&(M=Object.assign(M,y)),Object.keys(M).forEach(q=>{typeof M[q]=="string"&&["settingUrl","posterUrl","previewUrl","ultraUrl","audioUrl"].includes(q)&&(M[q]=kr(M[q]))});const{contentUrl:$,contentName:I}=y||{};let j=k==null?void 0:k.paramsPath;R=$||R,j=kr(j);let ee={contentUrl:kr(R),contentName:I||w,timeOption:ke(M.timeOption),position:ke(M.position),rotation:ke(M.rotation),scale:ke(M.scale),previewUrl:Qt()?"":M.previewUrl,settingUrl:M.settingUrl,posterUrl:M.posterUrl,audioUrl:M.audioUrl,ultraUrl:M.ultraUrl,audioPosition:ke(M.audioPosition)};const de=(O=(re=Object.keys(S))==null?void 0:re.map(q=>{var Te;return{url:kr(S[q].posterPath),key:q,show:(Te=S[q].showDemo)==null?void 0:Te.split(",").includes(_.showdemo),hasAudio:!!S[q].audioPath}}))==null?void 0:O.filter(q=>q.show),fe=f||await kf(M.settingUrl)||n.settings;return e=Object.assign(/(^https?:\/\/|.*\.json)/.test(j)?await fetch(j).then(q=>q.json()).catch(()=>{})||{}:{},_),n={settings:fe,params:e,app:null,performanceLevel:x,metaInfo:ee,guideList:de,initSuperStatus:!0},n};return{initSSE:async a=>await o(a),getSSE:()=>n,updateSSE:a=>(n=Object.assign(n,a),n),updateSettings:a=>{const d=Object.assign(n.settings,a);return n.settings=d,n},updateMetaInfo:a=>{const d=Object.assign(n.metaInfo,a);return n.metaInfo=d,n}}};window.sseManager||(window.sseManager=bp());const Dt=window.sseManager,li=({startNumber:t=0,spaceTime:e=5,number:n=1})=>{let s=[];const r=e;for(let i=0;i<n;i++)s=s.concat([t+i*r,r]);return s},vp=t=>{var e;return typeof t=="string"?(e=t==null?void 0:t.split(","))==null?void 0:e.map(n=>Number(n)):t||[]},xp=async t=>{const{contentUrl:e,contentName:n,resetMode:s,audioUrl:r,settings:i,metaInfo:o={}}=t||{},{timeOption:a}=o;return a&&a.length>0&&(o.timeOption=vp(a)),{sseContent:e||n?await Dt.initSSE({plyUrl:e,contentName:n,resetMode:s,audioUrl:r,settingJson:i,metaInfoObj:o}):await Dt.initSSE(),getSSE:Dt.getSSE,updateSSE:Dt.updateSSE}};function Sp(t=1e3){let e=0;return()=>{const n=Date.now();return n-e<t?!1:(e=n,!0)}}const Ds=200,hc=12;class Ep extends Xl{constructor(){var n,s;super();g(this,"isShow");g(this,"noRepeatWrap");g(this,"scrollElement");g(this,"checkDom");g(this,"noRepeatPanel");g(this,"checkLeft");g(this,"checkKey");g(this,"timer");g(this,"remaining");g(this,"open",()=>{var n;this.noRepeatPanel&&(this.isShow=!0,this.show(),this.noRepeatPanel.classList.remove("hidden"),this.noRepeatPanel.classList.remove("faded-out"),this.noRepeatPanel.classList.add("faded-in"),document.getElementById("openGuideIcon").classList.remove("open"),console.log((n=this.checkDom)==null?void 0:n.offsetLeft,this.checkDom,"offsetLeft"),this.checkDom&&this.scrollElement.scrollTo({left:this.checkDom.offsetLeft}))});g(this,"close",()=>{this.noRepeatPanel&&(this.isShow=!1,this.noRepeatPanel.classList.remove("faded-in"),this.noRepeatPanel.classList.add("faded-out"),this.noRepeatPanel.classList.add("hidden"),document.getElementById("openGuideIcon").classList.add("open"))});g(this,"show",()=>{this.noRepeatWrap&&(this.noRepeatWrap.classList.remove("hidden"),this.noRepeatWrap.classList.remove("faded-out"),this.noRepeatWrap.classList.add("faded-in"))});g(this,"hidden",()=>{this.noRepeatWrap&&(this.noRepeatWrap.classList.add("hidden"),this.noRepeatWrap.classList.add("faded-out"),this.noRepeatWrap.classList.remove("faded-in"))});this.checkKey=(s=(n=window.location.pathname)==null?void 0:n.split("/"))==null?void 0:s.at(-1)}initialize(n){const s=document.getElementById("splatsList"),r=document.getElementById("volumeContainer"),i=document.getElementById("splatsListWrapper"),o=document.getElementById("noRepeatWrap"),a=document.getElementById("noRepeatPanel");document.getElementById("openGuideIcon");const d=document.getElementById("goConfirm");ra()||d.classList.remove("hidden"),this.noRepeatWrap=o,this.noRepeatPanel=a;let l=!1,u=0,h=0,f=0;this.addListenerFn(o,"touchstart",S=>{u=S.touches[0].pageX,h=S.touches[0].pageY,f=i.scrollLeft,l=!1}),this.addListenerFn(o,"touchmove",S=>{const k=S.touches[0].pageX,M=S.touches[0].pageY,$=k-u,I=M-h;!l&&Math.abs($)>Math.abs(I)&&(l=!0),l&&(i.scrollLeft=f-$,S.preventDefault())});const y=n.length-1,x=Ds*y+hc*(y-1);s.innerHTML="",r.style.bottom="70px",s.style.width=`${x}px`,this.scrollElement=i;const w=(S,k)=>{const M=Ds*(k-1)+Ds*.5-hc*(k-1);S.classList.add("checked"),this.checkDom=S,this.checkLeft=M,s.childNodes.forEach(($,I)=>{k!==I&&$.classList.remove("checked")})},_='<svg class="icon unMutedStatus" viewBox="0 0 1024 1024" fill="#dddd" xmlns="http://www.w3.org/2000/svg" p-id="2503" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M734.118332 271.7758l-46.483684 46.52257c43.48028 50.070372 69.959352 115.233488 69.959352 186.752358 0 78.772065-31.899524 150.056598-83.529415 201.648626l46.482661 46.483684c63.563688-63.447031 102.833063-151.207817 102.833063-248.131287C823.381331 415.397848 789.493523 333.817832 734.118332 271.7758z" p-id="2504"></path><path d="M830.049195 175.883823l-49.329499 49.290613c67.229171 74.0536 108.565625 172.011632 108.565625 279.874245 0 115.115807-46.678112 219.333404-122.096802 294.789956l49.252751 49.281403c88.1302-88.043219 142.569066-209.691813 142.569066-344.07136C959.009312 377.922329 909.834332 262.572184 830.049195 175.883823z" p-id="2505"></path><path d="M646.729006 359.243921l-44.534286 44.474934c21.877263 27.979238 35.018561 63.076594 35.018561 101.33085 0 45.508473-18.444071 86.706781-48.237631 116.519784l44.182268 44.240597c41.102117-41.179888 66.566068-97.977475 66.566068-160.761404C699.723987 449.539436 679.75826 398.707724 646.729006 359.243921z" p-id="2506"></path><path d="M224.830093 633.092939 498.018056 837.997726 498.018056 177.814802 224.830093 382.680702Z" p-id="2507"></path><path d="M87.252715 381.432269c-12.830213 0-23.202445 10.372232-23.202445 23.183002l0 0L64.05027 604.060719c0 12.81077 10.373255 23.183002 23.202445 23.183002l84.923158 0c0.001023 0 0.010233 0.001023 0.010233 0.001023l0-0.001023L172.186106 381.432269l0 0-0.005117 0L87.252715 381.432269z"></path></svg>';n==null||n.forEach((S,k)=>{const M=document.createElement("div"),$=this.checkKey===S.key;if(S.hasAudio){const I=document.createElement("div");I.classList.add("miniVoiceIcon"),I.innerHTML=_,M.appendChild(I)}S.url?(M.style.backgroundImage=`url(${S.url})`,M.style.backgroundSize="cover",M.style.width=`${Ds}px`):(M.innerHTML=S.key,M.style.width=`${Ds}px`),$&&w(M,k),this.addListenerFn(M,"click",async()=>{!Sp(1e3)||this.checkKey===S.key||(console.log("clicked",S),this.hidden(),this.checkKey=S.key,w(M,k),await dr({contentName:S.key}))}),s.appendChild(M),r.style.bottom="182px"});const R="";this.addListenerFn(d,"click",()=>{window.open(R)})}startCount(n=5,s){this.timer&&window.clearInterval(this.timer),this.remaining=n;const r=window.setInterval(()=>{this.remaining--,this.remaining>0?console.log(`剩余时间：${this.remaining} 秒`):(s==null||s(),console.log("倒计时结束"),clearInterval(r))},1e3);return this.timer=r,r}}const qr=new Ep;class Cp{constructor(e,n){g(this,"events");g(this,"state");g(this,"keyMap");g(this,"modifierKeys");g(this,"userKeyMap",["escape","f","r"," ","m","Meta+Shift+,","Meta+Shift+<"]);this.events=e,this.state=n,this.keyMap=new Map,this.modifierKeys=new Set(["Control","Alt","Meta","Shift"]),this.initializeKeyMap()}initializeKeyMap(){this.keyMap.set("escape",{event:"cancel"}),this.keyMap.set("f",{event:"frame"}),this.keyMap.set("r",{event:"reset"}),this.keyMap.set(" ",{event:"playPause"}),this.keyMap.set("]",{event:"framePlaybackForward"}),this.keyMap.set("】",{event:"framePlaybackForward"}),this.keyMap.set("[",{event:"framePlaybackBackward"}),this.keyMap.set("【",{event:"framePlaybackBackward"}),this.keyMap.set("-",{event:"decreaseSplatSize"}),this.keyMap.set("=",{event:"increaseSplatSize"}),this.keyMap.set("p",{event:"togglePointCloudMode"}),this.keyMap.set("b",{event:"toggleBackgroundColor"}),this.keyMap.set(";",{event:"decreasePlaybackRate"}),this.keyMap.set("；",{event:"decreasePlaybackRate"}),this.keyMap.set("‘",{event:"increasePlaybackRate"}),this.keyMap.set("'",{event:"increasePlaybackRate"}),this.keyMap.set("i",{event:"information"}),this.keyMap.set("m",{event:"slowMotion"}),this.keyMap.set("Meta+Shift+,",{event:"toggleDebugMode"}),this.keyMap.set("Meta+Shift+<",{event:"toggleDebugMode"})}handleKeyDown(e){const n=[];e.ctrlKey&&n.push("Control"),e.altKey&&n.push("Alt"),e.metaKey&&n.push("Meta"),e.shiftKey&&n.push("Shift");const s=n.length>0?`${n.join("+")}+${e.key.toLowerCase()}`:e.key.toLowerCase(),r=this.keyMap.get(s);r&&(this.state.debugModeEnabled||this.userKeyMap.includes(s))&&this.events.fire("inputEvent",r.event,e)}}let Pr=null;const rs=new Q,Ap=(t,e)=>{var d;const n=document.getElementById("cursor"),s=document.getElementById("cancelWheel"),r=document.getElementById("enterWheel"),i=(d=document.getElementsByTagName("canvas"))==null?void 0:d[0],o=ra(),a=Zl();o&&(i.style.cursor="pointer"),a&&(V(r,"click",()=>{Ft.emit("cancelNoWheel"),r.classList.add("hidden"),s.classList.remove("hidden")}),V(s,"click",()=>{Ft.emit("onNoWheel"),r.classList.remove("hidden"),s.classList.add("hidden")})),z(e,"firstFrame",()=>{if(n==null||n.classList.remove("hidden"),V(t.graphicsDevice.canvas,"pointerdown",()=>{n==null||n.classList.add("hidden")}),qr.open(),a){r==null||r.classList.remove("hidden");const c=document.getElementById("timelineContainer"),l=document.getElementById("buttonContainer");c.style.display="none",l.style.display="none"}})},kp=(t,e)=>{const n=r=>`blur(${Math.floor((100-r)*.4)}px)`,s=document.getElementById("poster");s.style.backgroundImage=`url(${t})`,s.style.display="block",s.style.filter=n(0),z(e,"progress:changed",r=>{s.style.filter=n(r)}),z(e,"firstFrame",()=>{s.style.display="none"})},Pp=(t,e,n)=>{const s=i=>`blur(${Math.floor((100-i)*.4)}px)`,r=document.getElementById("video");t&&(r.src=t),r.style.display="block",r.style.filter=s(0),z(e,"progress:changed",i=>{r.style.filter=s(i)}),z(e,"firstFrame",()=>{r.currentTime,r.style.display="none",e.fire("playAudio")}),V(r,"click",()=>{e.fire("startAssets")})},_p=t=>{qr.initialize(t)},Tp=async(t,e)=>{e.parentElement.entity.script.destroy(ql)},Rp=async(t,e,n,s,r)=>{const i=(()=>{const{position:o,target:a}=r.xrCamera??{};return new Zt().fromLookAt(new Q(o??[0,0,-2]),new Q(a??[0,0,0]))})();if(n.hasAR=t.xr.isAvailable("immersive-ar"),n.hasVR=t.xr.isAvailable("immersive-vr"),n.hasAR||n.hasVR){await t.graphicsDevice.gl.makeXRCompatible();const a=e.parentElement.entity,d=e.entity,c=new yn,l=new Q,u=new gn,h=new Q,f=new gn;a.script.create(ql);let y=null;const x={},w=($,I)=>{let j=I?`${I}
`:"";return Object.keys($).forEach(ee=>{j+=ee+":"+$[ee]+`
`}),j},_=new Fr("text3DPosition");_.addComponent("element",{type:ec,fontAsset:t.assets.find("4dr"),anchor:[.5,0,.5,0],pivot:new xr(.5,.5),fontSize:.1,text:"",color:new yn(1,1,1,1),alignment:new xr(.5,.5),width:1,height:1,wrapLines:!0,screenSpace:!0,useInput:!0}),_.setLocalPosition(0,-1,0);const R=new Fr("text3DCursor");R.addComponent("element",{type:ec,fontAsset:t.assets.find("4dr"),anchor:[.5,1,.5,1],pivot:new xr(.5,.5),fontSize:.1,text:"",color:new yn(1,1,1,1),alignment:new xr(.5,.5),width:1,height:1,wrapLines:!0,screenSpace:!0,useInput:!0}),R.setLocalPosition(0,1,0);const S=new Fr("entryBgEl");S.addChild(_),S.addChild(R),S.setLocalScale(.5,.5,.5),S.setLocalPosition(0,1,-1),S.setEulerAngles(0,250,0),z(s,"xrTextPlacePosition",$=>{S.setLocalPosition(...$)});let k={},M={};z(s,"xrTextCursor",$=>{if(!$){R.element.text="";return}const{s:I,t:j,...ee}=$;M=Object.assign(M,ee),$=Object.assign(k,$),k=$;const{s:de={},t:fe={}}=$||{};R.element.text=w(de,"---1 hand---")+w(fe,"---2 hand---")+w(M,"---message---")}),z(s,"xrTextPositionChange",$=>{_.element.text=w($)}),z(t.xr,"start",()=>{console.log("____ startXR"),t.autoRender=!0,n.cameraMode="orbit",y=t.xr.session,s.fire("xrSessionStart",y),l.copy(a.getPosition()),u.copy(a.getRotation()),h.copy(d.getPosition()),f.copy(d.getRotation()),a.setPosition(i.position.x,i.position.y,i.position.z),a.setRotation(i.rotation),t.xr.type==="immersive-ar"&&(c.copy(d.camera.clearColor),d.camera.clearColor=new yn(0,0,0,0))}),z(t.xr,"end",()=>{console.log("____ endXR"),t.autoRender=!1,k={},M={},s.fire("xrSessionEnd"),s.fire("xrTextPositionChange",x),s.fire("xrTextCursor",""),t.root.removeChild(S),y=null,a.setPosition(l),a.setRotation(u),d.setPosition(h),d.setRotation(f),t.xr.type==="immersive-ar"&&(d.camera.clearColor=c)}),z(t.xr,"update",$=>{y&&t.xr.active&&s.fire("xrFrame",{frame:$,screen3D:S})}),z(s,"startAR",()=>{console.log("____ startAR"),t.xr.start(t.root.findComponent("camera"),"immersive-ar","local-floor")}),z(s,"startVR",()=>{console.log("____ startVR"),t.xr.start(t.root.findComponent("camera"),"immersive-vr","local-floor")}),z(s,"inputEvent",$=>{$==="cancel"&&t.xr.active&&t.xr.end()})}},Mp=({app:t,state:e,events:n,params:s,metaInfo:r,musicAssetId:i,contentUrl:o,contentName:a,rateArr:d})=>{var at,ne,he,ct,U,W,Z,le,ue,X,me,xe,Be,Pe,ge,Se,qe,Je,yt,Me,Ee,an,es;const c=["ui","controlsWrap","arMode","vrMode","ultraMode","arModeMax","vrModeMax","maxIconWrapper","enterFullscreen","exitFullscreen","info","infoPanel","desktopTab","touchTab","desktopInfoPanel","touchInfoPanel","timelineContainer","handle","time","buttonContainer","play","pause","anima","volumeShow","volumeShowMax","volumeContainer","volumeHandle","volume","mutedStatus","unMutedStatus","mutedStatusMax","unMutedStatusMax","settings","settingsPanel","fly","orbit","cameraToggleHighlight","high","low","qualityToggleHighlight","reset","frame","loadingText","loadingBar","loadingFill","joystickBase","joystick","statsPanel","loadingWrap","cursor"].reduce((A,L)=>(A[L]=document.getElementById(L),A),{});(at=c.maxIconWrapper)==null||at.classList.add("hidden"),(ne=c.loadingWrap)==null||ne.classList.remove("hidden"),(he=c.controlsWrap)==null||he.classList.add("hidden"),(ct=document.getElementById("viewerInputContainer"))==null||ct.classList.add("hidden"),r.ultraUrl&&r.ultraUrl!==o&&Kl()&&((U=c.ultraMode)==null||U.classList.remove("hidden"));let l=!1;if(i){(W=c.volumeShow)==null||W.classList.remove("hidden"),(Z=c.volumeShowMax)==null||Z.classList.remove("hidden");const A=document.getElementsByTagName("canvas")[0];V(A,"pointerdown",()=>{Qt()||!l&&Te()})}else(le=c.volumeShow)==null||le.classList.add("hidden"),(ue=c.volumeShowMax)==null||ue.classList.add("hidden");(X=c.loadingBar)==null||X.classList.remove("pageLoading"),c.loadingText.textContent="0%",c.loadingFill.style.right="100%",z(n,"progress:changed",A=>{c.loadingText.textContent=`${A}%`,c.loadingFill.style.right=`${100-A}%`}),z(n,"firstFrame",()=>{var A,L,Y;(A=document.getElementById("loadingWrap"))==null||A.classList.add("hidden"),(L=document.getElementById("controlsWrap"))==null||L.classList.remove("hidden"),(Y=document.getElementById("buttonContainer"))==null||Y.classList.remove("hidden"),S(),Ft.emit(rr.LISTEN_MESSAGE,{type:"REPLY",text:"firstFrameRender"})});const u=document.documentElement,h=u.requestFullscreen&&document.exitFullscreen,f=()=>{h?u.requestFullscreen():(window.parent.postMessage("requestFullscreen","*"),e.isFullscreen=!0)},y=()=>{h?document.exitFullscreen():(window.parent.postMessage("exitFullscreen","*"),e.isFullscreen=!1)};h&&V(document,"fullscreenchange",()=>{e.isFullscreen=!!document.fullscreenElement}),V(c.enterFullscreen,"click",f),V(c.exitFullscreen,"click",y),screen!=null&&screen.orientation&&V(screen.orientation,"change",A=>{["landscape-primary","landscape-secondary"].includes(screen.orientation.type)?f():y()}),z(n,"isFullscreen:changed",A=>{c.enterFullscreen.classList[A?"add":"remove"]("hidden"),c.exitFullscreen.classList[A?"remove":"add"]("hidden")}),V(c.high,"click",()=>{e.hqMode=!0}),V(c.low,"click",()=>{e.hqMode=!1});let x=!1;V(c.ultraMode,"click",async()=>{x||(console.log("ultra click"),x=!0,await dr({contentName:a,resetMode:It.HIGH}),x=!1)});const w=()=>{c.qualityToggleHighlight.classList[e.hqMode?"add":"remove"]("right")};z(n,"hqMode:changed",A=>{w()}),w(),e.hasAR&&((me=c.arMode)==null||me.classList.remove("hidden"),V(c.arMode,"click",()=>{n.fire("startAR")}),Qt()||((xe=c.arModeMax)==null||xe.classList.remove("hidden"),V(c.arModeMax,"click",()=>{n.fire("startAR")}))),e.hasVR&&((Be=c.vrMode)==null||Be.classList.remove("hidden"),V(c.vrMode,"click",()=>{n.fire("startVR")}),Qt()||((Pe=c.vrModeMax)==null||Pe.classList.remove("hidden"),V(c.vrModeMax,"click",()=>{n.fire("startVR")})));const _=A=>{A==="desktop"?(c.desktopTab.classList.add("active"),c.touchTab.classList.remove("active"),c.desktopInfoPanel.classList.remove("hidden"),c.touchInfoPanel.classList.add("hidden")):(c.desktopTab.classList.remove("active"),c.touchTab.classList.add("active"),c.desktopInfoPanel.classList.add("hidden"),c.touchInfoPanel.classList.remove("hidden"))};V(c.desktopTab,"click",()=>{_("desktop")}),V(c.touchTab,"click",()=>{_("touch")}),V(c.info,"pointerup",()=>{_(e.inputMode),c.infoPanel.classList.toggle("hidden")}),V(c.infoPanel,"pointerdown",()=>{c.infoPanel.classList.add("hidden")}),z(n,"inputEvent",A=>{var L,Y,Ce,Tt,Tn;A==="cancel"?(Ft.emit(rr.LISTEN_MESSAGE,{type:"REPLY",text:"escCancel"}),(L=c.infoPanel)==null||L.classList.add("hidden"),(Y=c.settingsPanel)==null||Y.classList.add("hidden"),(Ce=c.volumeContainer)==null||Ce.classList.add("hidden"),e.isFullscreen&&y()):A==="interrupt"&&((Tt=c.settingsPanel)==null||Tt.classList.add("hidden"),(Tn=c.volumeContainer)==null||Tn.classList.add("hidden"))}),z(n,"controlsUiVisible:changed",A=>{var L,Y,Ce,Tt,Tn,Za,Xa,Ya,Ja;Qt()||(A?((L=c.controlsWrap)==null||L.classList.add("faded-in"),(Y=c.controlsWrap)==null||Y.classList.remove("faded-out"),(Ce=c.maxIconWrapper)==null||Ce.classList.add("faded-out"),(Tt=c.maxIconWrapper)==null||Tt.classList.remove("faded-in"),qr.show()):((Tn=c.controlsWrap)==null||Tn.classList.remove("faded-in"),(Za=c.controlsWrap)==null||Za.classList.add("faded-out"),(Xa=c.maxIconWrapper)==null||Xa.classList.remove("hidden"),(Ya=c.maxIconWrapper)==null||Ya.classList.remove("faded-out"),(Ja=c.maxIconWrapper)==null||Ja.classList.add("faded-in")))}),z(n,"statsVisible:changed",A=>{c.statsPanel.classList[A?"remove":"add"]("hidden")});const R=()=>{Pr&&clearTimeout(Pr),e.controlsUiVisible=!0,Pr=window.setTimeout(()=>{Pr=null,e.controlsUiVisible=!1},4e3)};R(),z(n,"inputEvent",R),z(n,"hasAnimationCamera:changed",()=>{var A;(A=c.anima)==null||A.classList.remove("hidden"),V(c.anima,"click",()=>{e.cameraMode="anim"})}),V(c.play,"click",()=>{e.timePaused=!1}),V(c.pause,"click",()=>{e.timePaused=!0});const S=()=>{var A,L,Y;(A=c.play)==null||A.classList.add("hidden"),(L=c.pause)==null||L.classList.remove("hidden"),n.fire("playAudio"),(Y=c.timelineContainer)==null||Y.classList.remove("hidden")},k=()=>{var A,L,Y,Ce;e.timePaused?((A=c.play)==null||A.classList.remove("hidden"),(L=c.pause)==null||L.classList.add("hidden"),n.fire("pauseAudio"),qr.open()):S(),(Ce=(Y=c.timelineContainer)==null?void 0:Y.classList)==null||Ce.remove("hidden")};z(n,"cameraMode:changed",k),z(n,"timePaused:changed",k),z(n,"inputEvent",A=>{A==="playPause"&&(e.timePaused=!e.timePaused)});const M=A=>{const[L,Y]=A.split("_"),[Ce,Tt]=L.split(",");return{rate:Number(Y),start:Number(Ce),end:Number(Tt)}},$=(A,L)=>{let Y=!1;return L==null||L.forEach(Ce=>{const{start:Tt,end:Tn}=M(Ce);A>=Tt&&A<=Tn&&(Y=!0)}),Y};z(n,"currentTime:changed",()=>{c.handle&&(c.handle.style.left=`${e.currentTime/e.duration*100}%`),c.time&&(c.time.style.left=`${e.currentTime/e.duration*100}%`,c.time.innerText=`${e.currentTime.toFixed(1)}s`),e.currentTime.toFixed(1)==="0.0"&&(!e.timePaused&&n.fire("playAudio"),e.timePaused&&n.fire("pauseAudio")),d==null||d.forEach(A=>{const{start:L,end:Y,rate:Ce}=M(A);if(e.currentTime>=L&&e.currentTime<=Y){e.playbackSpeed=Ce;return}else $(e.currentTime,d)||(e.playbackSpeed=1)})});const j=()=>{var A,L,Y,Ce;if(c.volumeHandle&&(c.volumeHandle.style.bottom=`${e.volume*100}%`),c.volume&&(c.volume.style.bottom=`${e.volume*100}%`),c.volume&&(c.volume.innerText=`${(e.volume*100).toFixed(0)}%`),(e.volume*100).toFixed(0)==="0"){e.muted=!0;return}e.muted=!1,(A=c.mutedStatus)==null||A.classList.add("hidden"),(L=c.mutedStatusMax)==null||L.classList.add("hidden"),(Y=c.unMutedStatus)==null||Y.classList.remove("hidden"),(Ce=c.unMutedStatusMax)==null||Ce.classList.remove("hidden")};z(n,"volume:changed",j),z(n,"playbackSpeed:changed",A=>{n.fire("setRate",A)}),e.volume===0||e.muted?((ge=c.mutedStatus)==null||ge.classList.remove("hidden"),(Se=c.mutedStatusMax)==null||Se.classList.remove("hidden"),(qe=c.unMutedStatus)==null||qe.classList.add("hidden"),(Je=c.unMutedStatusMax)==null||Je.classList.add("hidden")):((yt=c.mutedStatus)==null||yt.classList.add("hidden"),(Me=c.mutedStatusMax)==null||Me.classList.add("hidden"),(Ee=c.unMutedStatus)==null||Ee.classList.remove("hidden"),(an=c.unMutedStatusMax)==null||an.classList.remove("hidden")),j(),z(n,"muted:changed",A=>{var L,Y,Ce,Tt;A&&(n.fire("setVolume",0),(L=c.mutedStatus)==null||L.classList.remove("hidden"),(Y=c.mutedStatusMax)==null||Y.classList.remove("hidden"),(Ce=c.unMutedStatus)==null||Ce.classList.add("hidden"),(Tt=c.unMutedStatusMax)==null||Tt.classList.add("hidden"))});const de=A=>{const L=c.timelineContainer.getBoundingClientRect(),Y=Math.max(0,Math.min(L.width-1,A.clientX-L.left))/L.width;n.fire("setCurrentTime",e.duration*Y)},fe=A=>{const L=c.volumeContainer.getBoundingClientRect(),Y=1-Math.max(0,Math.min(L.height-1,A.clientY-L.top))/L.height;Y<=.01&&(l=!0),n.fire("setVolume",Y)};let re=!1,O=!1,q=!1;V(c.timelineContainer,"pointerdown",A=>{var L;O||(de(A),c.timelineContainer.setPointerCapture(A.pointerId),(L=c.time)==null||L.classList.remove("hidden"),re=e.timePaused,e.timePaused=!0,O=!0)}),V(c.timelineContainer,"pointermove",A=>{O&&de(A),R()}),V(c.timelineContainer,"pointerup",A=>{var L;O&&(c.timelineContainer.releasePointerCapture(A.pointerId),(L=c.time)==null||L.classList.add("hidden"),e.timePaused=re,O=!1)}),V(c.volumeContainer,"pointerdown",A=>{var L;q||(fe(A),c.volumeContainer.setPointerCapture(A.pointerId),(L=c.volume)==null||L.classList.remove("hidden"),q=!0)}),V(c.volumeContainer,"pointermove",A=>{A.preventDefault(),A.stopPropagation(),A.cancelBubble=!0,q&&fe(A),R()}),V(c.volumeContainer,"touchmove",A=>{A.preventDefault(),A.stopPropagation(),A.cancelBubble=!0,R()}),V(c.volumeContainer,"pointerup",A=>{var L;q&&(c.volumeContainer.releasePointerCapture(A.pointerId),(L=c.volume)==null||L.classList.add("hidden"),q=!1)}),V(c.mutedStatus,"click",()=>{Te()}),V(c.mutedStatusMax,"click",()=>{Te()}),V(c.unMutedStatusMax,"click",()=>{e.unMutedVolume=e.volume,l=!0,n.fire("setVolume",0)});const Te=()=>{var A,L,Y,Ce;n.fire("pauseAudio"),e.muted=!1,e.volume=1,(A=c.mutedStatus)==null||A.classList.add("hidden"),(L=c.mutedStatusMax)==null||L.classList.add("hidden"),(Y=c.unMutedStatus)==null||Y.classList.remove("hidden"),(Ce=c.unMutedStatusMax)==null||Ce.classList.remove("hidden"),!e.timePaused&&n.fire("playAudio"),e.timePaused&&n.fire("pauseAudio"),console.log("pauseAudio")};V(c.ui,"click",()=>{var A;(A=c.loadingWrap)!=null&&A.classList.contains("hidden")||Te()}),z(n,"cameraMode:changed",()=>{var A,L;e.cameraMode==="fly"?(A=c.cameraToggleHighlight)==null||A.classList.add("right"):(L=c.cameraToggleHighlight)==null||L.classList.remove("right")}),z(n,"cameraMode:changed",()=>{var A,L;e.hasAnimationCamera&&(e.cameraMode==="anim"?(A=c.anima)==null||A.classList.add("hidden"):(L=c.anima)==null||L.classList.remove("hidden"))}),V(c.settings,"click",()=>{var A;(A=c.settingsPanel)==null||A.classList.toggle("hidden")}),V(c.volumeShow,"click",()=>{var A;(A=c.volumeContainer)==null||A.classList.toggle("hidden")}),V(c.fly,"click",()=>{e.cameraMode="fly"}),V(c.orbit,"click",()=>{e.cameraMode="orbit"});const pe=A=>{n.fire("inputEvent","reset",A)};V(c.reset,"click",pe);const Ze=A=>{n.fire("inputEvent","frame",A)};V(c.frame,"click",Ze),z(n,"touchJoystickUpdate",(A,L)=>{var Y,Ce;A===null?(Y=c.joystickBase)==null||Y.classList.add("hidden"):(rs.set(L[0],L[1],0).mulScalar(1/48),rs.length()>1&&rs.normalize(),rs.mulScalar(48),(Ce=c.joystickBase)==null||Ce.classList.remove("hidden"),c.joystickBase.style.left=`${A[0]}px`,c.joystickBase.style.top=`${A[1]}px`,c.joystick.style.left=`${48+rs.x}px`,c.joystick.style.top=`${48+rs.y}px`)}),s.noui&&((es=c.ui)==null||es.classList.add("hidden")),["wheel","pointerdown","contextmenu","keydown"].forEach(A=>{const L=Y=>{n.fire("inputEvent","interrupt",Y)};V(t.graphicsDevice.canvas,A,L)});const ut=A=>{n.fire("inputEvent","interact",A)};V(t.graphicsDevice.canvas,"pointermove",ut);const Le={time:0,x:0,y:0},Re=A=>{const L=new Date().getTime();Math.max(0,L-Le.time)<300&&Math.abs(A.clientX-Le.x)<8&&Math.abs(A.clientY-Le.y)<8?(n.fire("inputEvent","dblclick",A),Le.time=0):(Le.time=L,Le.x=A.clientX,Le.y=A.clientY)};V(t.graphicsDevice.canvas,"pointerdown",Re),["pointerdown","pointermove"].forEach(A=>{V(window,A,Y=>{e.inputMode=Y.pointerType==="touch"?"touch":"desktop"})});const Fe=new Cp(n,e);V(window,"keydown",A=>Fe.handleKeyDown(A))};let Dr=null,St=null;const Ip=t=>{const e="https://frontend.4dv-intelligence.com/viewer-static/Montserrat-Black.json",n="https://frontend.4dv-intelligence.com/viewer-static/Montserrat-Black.png",s=new sr("4dr","font",{url:e}),r=new sr("4drAtlas","texture",{url:n});t.assets.add(r),t.assets.add(s),t.assets.load(r),r.ready(()=>{t.assets.load(s),s.ready(()=>{s.resource.texture=r.resource,console.log("字体资源已准备好:",s.resource)})})},Lp=async({app:t,audioUrl:e,events:n})=>{if(!e)return;Dr&&t.assets.remove(Dr);let s=new sr("sounds","audio",{url:e});return Dr=s,new Promise(r=>{s.on("load",()=>{const o=s.resource.buffer;console.log("资源加载完成:",o),r(s)}),s.preload=!0,s.on("error",i=>{n.fire("audioAssetLoadError"),console.log(i),r({})}),t.assets.add(s),t.assets.load(s),r(s)})},Bp=({app:t,cameraEntity:e,events:n,state:s,musicAssetId:r,audioPosition:i})=>{const o=new Fr;o.addComponent("sound"),i||(i=[0,0,0]),o.setPosition(i[0],i[1],i[2]),t.root.addChild(o),e.addComponent("audiolistener");const a=o.sound.addSlot(`backgroundMusic${r}`,{asset:t.assets.get(r),volume:s.volume,loop:!1,autoPlay:!1,startTime:s.currentTime});return new Promise(d=>{var c;z(n,"playAudio",()=>{St&&(St.pitch=s.playbackSpeed,St.volume=s.volume,St.startTime=s.currentTime),St=a.play(St)}),z(n,"pauseAudio",()=>{St.pause()}),z(n,"setVolume",l=>{St&&(St.volume=l,s.volume=l,s.unMutedVolume=Math.max(l!==0?l:s.unMutedVolume,.1))}),z(n,"setRate",l=>{St&&(St.pitch=l),s.playbackSpeed=l}),d((c=a.instances)==null?void 0:c[0])})},Fp=async(t,e)=>{var n;St==null||St.pause(),St=null,(n=t.sound)==null||n.removeSlot(`backgroundMusic${e.id}`)};class Dp extends S0{constructor(){super(...arguments);g(this,"functions",new Map)}function(n,s){if(this.functions.has(n))throw new Error(`error: function ${n} already exists`);this.functions.set(n,s)}invoke(n,...s){const r=this.functions.get(n);if(!r){console.log(`error: function not found '${n}'`);return}return r(...s)}}tc.skyboxPS=tc.skyboxPS.replace("mapRoughnessUv(uv, mipLevel)","uv");let pn=null,Ns=null;const Np=(t,e)=>{let n=9,s=0;e.on("progress",(r,i)=>{const a=Math.min(1,r/i)*100*(9/10);if(a>=90){if(s)return;s=window.setInterval(()=>{if(n--,n>0){let d=Number(t.progress)+1;t.progress=Math.min(d,99).toFixed(0)}else s&&clearInterval(s)},1e3);return}t.progress=Math.min(a,99).toFixed(0)}),e.on("loadAllAssetsDone",()=>{t.progress=100,s&&clearInterval(s)})},Op=({app:t,cameraEntity:e,events:n,state:s,settings:r,params:i,splatAsset:o,timeOption:a,mPosition:d,mRotation:c,mScale:l})=>{let u=-1,h=1;o.data.loadAllSeq&&(h=o.file.url.split(",").length),a&&a.length>=2*h&&(u=a[2*h-1]+a[2*h-2]),pn=new xf(t,e,n,s,r,i,u),new Z0(t,o,n,s,a);const f=t.root.findByName("splat"),[y=0,x=0,w=0]=d||[],[_=0,R=0,S=0]=c||[],[k=1,M=1,$=1]=l||[],I=()=>{f==null||f.setLocalPosition(y,x,w),f==null||f.setEulerAngles(_,R,S),f==null||f.setLocalScale(k,M,$)};I();let j=f==null?void 0:f.getLocalPosition().clone(),ee=f==null?void 0:f.getLocalScale().clone(),de=f==null?void 0:f.getLocalEulerAngles().clone(),fe=null;t.xr.input.on("squeezestart",(O,q)=>{fe=window.setTimeout(()=>{n.fire("resetModelTransform"),fe=null},3e3)}),t.xr.input.on("squeezeend",(O,q)=>{fe&&(clearTimeout(fe),fe=null)}),z(n,"startXrDrag",O=>{j=f==null?void 0:f.getLocalPosition().clone(),console.log("startXrDrag")}),z(n,"startXrTwoHandGesture",O=>{console.log("startXrTwoHandGesture"),ee=f==null?void 0:f.getLocalScale().clone(),de=f==null?void 0:f.getLocalEulerAngles().clone()});const re={rotationY:"",scale:"",position:""};z(n,"setNewRotationY",O=>{if(de||(de=f==null?void 0:f.getEulerAngles().clone()),O===0)return;const q=new gn().setFromEulerAngles(0,de.y-O,0);re.rotationY=q,n.fire("xrTextPositionChange",re),f==null||f.setRotation(q)}),z(n,"setNewScale",O=>{if(ee||(ee=f==null?void 0:f.getLocalScale().clone()),O[0]===1&&O[1]===1&&O[2]===1)return;const q=[ee.x*O[0],ee.y*O[1],ee.z*O[2]];re.scale=q.join(","),n.fire("xrTextPositionChange",re),f==null||f.setLocalScale(...q)}),z(n,"setNewPosition",O=>{if(j||(j=f==null?void 0:f.getPosition().clone()),O[0]===0&&O[1]===0&&O[2]===0)return;const q=f==null?void 0:f.getPosition();function Te(ut,Le){let Re=ut.forward.clone(),Fe=ut.right.clone(),De=ut.up.clone(),at=new Q;return at.add(Re.mulScalar(Le.z)),at.add(Fe.mulScalar(Le.x)),at.add(De.mulScalar(Le.y)),at}const ot=t.root.findByName("camera");let pe=Te(ot,new Q(O));const Ze=[q.x+pe.x,q.y+pe.y,q.z+pe.z];re.position=Ze==null?void 0:Ze.join(","),n.fire("xrTextPositionChange",re),f==null||f.setPosition(...Ze)}),z(n,"resetModelTransform",()=>{I(),n.fire("inputEvent","resetXrPosition",null)}),z(n,"startAssets",()=>{pn.initialize()})},Up=({contentUrl:t,fileName:e,app:n,timeOption:s,events:r,state:i,cameraEntity:o,settings:a,params:d,mPosition:c,mRotation:l,mScale:u})=>{var f;Ns&&(n.loader._cache={},(f=Ns.resource)==null||f.destroy(),(()=>{const x=n.root.findByName("splat");x&&n.root.removeChild(x)})()),Np(i,r);let h=new sr(e||"scene.compressed.ply","gsplat",{url:t,filename:e||"scene.compressed.ply"},{decompress:!0,loadAllSeq:Kl(),timeOption:s,events:r});return Ns&&n.assets.remove(Ns),n.assets.add(h),n.assets.load(h),Ns=h,new Promise((y,x)=>{h.on("load",async()=>{const w=await h.resource.instantiate();w.name="splat",console.log("资源加载完成:",h.name),Ft.emit(rr.LISTEN_MESSAGE,{type:"REPLY",text:"assetLoad"}),n.root.insertChild(w,0),Op({app:n,cameraEntity:o,events:r,state:i,settings:a,params:d,splatAsset:h,timeOption:s,mPosition:c,mRotation:l,mScale:u}),h.loaded?r.fire("loaded",h):h.on("load",()=>{r.fire("loaded",h)}),y(h)}),h.on("error",w=>{console.log(w),x(w)})})},dr=async t=>{var Te,ot,pe,Ze,ut,Le,Re,Fe,De,at;const{sseContent:e}=await xp(t),{contentUrl:n,contentName:s,rawName:r,audioUrl:i}=t||{};(n||s)&&pn&&W0((Te=pn==null?void 0:pn.destroy)==null?void 0:Te.call(pn));const{metaInfo:o,settings:a,guideList:d,params:c}=e,{position:l,rotation:u,scale:h,timeOption:f,posterUrl:y,previewUrl:x,audioUrl:w,contentUrl:_,audioPosition:R}=o,k=(await document.querySelector("pc-app").ready()).app;if(!(n||_))return!1;const M=n||_,$=f,I=new Dp,j=await document.querySelector('pc-entity[name="camera"]').ready(),ee=j.entity,de=K0(a),fe=new URL(location.href),re=G0(I,{readyToRender:!1,hqMode:!0,progress:0,inputMode:"desktop",cameraMode:"anim",hasAnimationCamera:!1,duration:0,currentTime:0,volume:0,muted:!0,unMutedVolume:1,timePaused:!1,hasAR:!1,hasVR:!1,isFullscreen:!1,controlsUiVisible:!0,pointCloudModeEnabled:!1,playbackRate:1,backgroundColor:"original",splatScale:1,playbackSpeed:1,statsVisible:fe.searchParams.has("statinfo"),sortTime:0,renderCount:0,debugModeEnabled:!1});Up({app:k,fileName:r,contentUrl:M,timeOption:$,events:I,state:re,cameraEntity:ee,settings:de,params:c,mPosition:l,mRotation:u,mScale:h});let O="";(n||s)&&(await Tp(k,j),await Fp(ee,Dr),ee.removeChild("sound"),document.getElementById("cursor").classList.add("hidden"),(ot=document.getElementById("ultraMode"))==null||ot.classList.add("hidden"),(pe=document.getElementById("controlsWrap"))==null||pe.classList.add("hidden"),(Ze=document.getElementById("maxIconWrapper"))==null||Ze.classList.add("hidden"),(Le=(ut=document.getElementById("enterWheel"))==null?void 0:ut.classList)==null||Le.add("hidden"),(Fe=(Re=document.getElementById("cancelWheel"))==null?void 0:Re.classList)==null||Fe.add("hidden"));const q=async(ne,he)=>{const ct=await Lp({app:k,events:I,audioUrl:ne});O=ct==null?void 0:ct.id,O&&await Bp({app:k,cameraEntity:ee,events:I,state:re,musicAssetId:O,audioPosition:he})};if(!n&&w?await q(w,R):n&&i&&await q(i,R),Ip(k),y&&kp(y,I),x&&Pp(x,I),Ap(k,I),c.skyboxUrl){const ne=new sr("skybox","texture",{url:c.skyboxUrl},{type:"rgbp",mipmaps:!1,addressu:"repeat",addressv:"clamp"});ne.on("load",()=>{k.scene.envAtlas=ne.resource}),k.assets.add(ne),k.assets.load(ne)}if(c.ministats){const ne=new E0(k);ne.position="topright"}return await Rp(k,j,re,I,de),Mp({app:k,state:re,events:I,params:c,metaInfo:o,musicAssetId:O,contentUrl:M,contentName:o.contentName,rateArr:(at=(De=de==null?void 0:de.animTracks)==null?void 0:De[0])==null?void 0:at.rateArr}),Dt.updateSSE({app:k,events:I}),!0};async function Qp(){const t="4dv.ai";self.onmessage=async i=>{const{data:o}=i;switch(o.type){case"initWorker":importScripts(o.zipUrl);break;case"extractFile":e(o.urls);break}};const e=async i=>{if(i.length===0){self.postMessage({type:"error",data:{message:"文件不存在"}});return}await n(i[0].url,i[0].fileName)},n=async(i,o)=>{const d=(await fetch(i)).body.getReader(),{value:c}=await d.read(),l=new Uint8Array(c);if(!(l[0]===80&&l[1]===75&&l[2]===3&&l[3]===4)){self.postMessage({type:"error",data:{message:"文件格式错误"}});return}try{const f=await(await fetch(i)).blob(),y=new zip.ZipReader(new zip.BlobReader(f),{password:`!@#${t}@707_`}),x=await y.getEntries(),w=x.find(O=>O.filename==="meta.json");if(!w){const O={audioUrl:{}};let q=[];const Te=x.filter(pe=>(pe.filename.endsWith(".ply")||pe.filename.endsWith(".4dv"))&&!pe.filename.includes("__MACOSX"));for(const pe of Te){const Ze=await r(pe);q.push({url:Ze,fileName:pe.filename})}if(O.plyUrlList=q,q.length===0){self.postMessage({type:"error",data:{message:"ply 文件不存在"}});return}const ot=x.find(pe=>(pe.filename.endsWith(".wav")||pe.filename.endsWith(".mp3"))&&!pe.filename.includes("__MACOSX"));if(ot){const pe=await r(ot);O.audioUrl={url:pe,fileName:ot.filename}}self.postMessage({type:"extracted",metaInfo:O,settings:{}});return}const _=await s(w);let R={};const S=x.find(O=>O.filename===_.settingPath);S&&(R=await s(S));const k=_.posterPath,M=x.find(O=>O.filename===k);if(M){const O=await r(M);_.posterPath=O}const $=_.previewPath,I=x.find(O=>O.filename===$);if(I){const O=await r(I);_.previewPath=O}const j=_.audioPath,ee=x.find(O=>O.filename===j);if(ee){const O=await r(ee);_.audioUrl={url:O,fileName:ee.filename}}const de=_.plyPath.split(",").map(O=>O.trim()),fe=x.filter(O=>de.includes(O.filename));let re=[];for(const O of fe){const q=await r(O);re.push({url:q,fileName:O.filename})}_.plyUrlList=re,self.postMessage({type:"extracted",metaInfo:_,settings:R}),await y.close()}catch(h){console.error("------- 解压失败 --------"),self.postMessage({type:"error",data:h})}},s=async i=>{const o=await i.getData(new zip.Uint8ArrayWriter),d=new TextDecoder("utf-8").decode(o);return JSON.parse(d)},r=async i=>{const o=await i.getData(new zip.Uint8ArrayWriter),a=new Blob([o],{type:"application/octet-stream"});return URL.createObjectURL(a)}}class $p{constructor(){g(this,"worker");this._initWorker()}async _initWorker(){this.worker=new Worker(URL.createObjectURL(new Blob([`(${Qp.toString()})()`],{type:"application/javascript"}))),this.worker.postMessage({type:"initWorker",zipUrl:"https://frontend.4dv-intelligence.com/viewer-static/zip.min.js"})}extractFile(e){return new Promise((n,s)=>{this.worker.postMessage({type:"extractFile",urls:e}),this.worker.onmessage=r=>{if(!this.worker)return;const{data:i}=r;switch(i.type){case"extracted":n({metaInfo:i.metaInfo,settings:i.settings});break;case"error":s(i.data);break}}})}destroy(){this.worker&&(this.worker.terminate(),this.worker=null)}}new $p;const Hp=t=>({setHttpHandler(e){t.httpHandler=e},httpHandler(){return t.httpHandler},updateHttpClientConfig(e,n){var s;(s=t.httpHandler)==null||s.updateHttpClientConfig(e,n)},httpHandlerConfigs(){return t.httpHandler.httpHandlerConfigs()}}),zp=t=>({httpHandler:t.httpHandler()});class Ge{constructor(e){this.method=e.method||"GET",this.hostname=e.hostname||"localhost",this.port=e.port,this.query=e.query||{},this.headers=e.headers||{},this.body=e.body,this.protocol=e.protocol?e.protocol.slice(-1)!==":"?`${e.protocol}:`:e.protocol:"https:",this.path=e.path?e.path.charAt(0)!=="/"?`/${e.path}`:e.path:"/",this.username=e.username,this.password=e.password,this.fragment=e.fragment}static clone(e){const n=new Ge({...e,headers:{...e.headers}});return n.query&&(n.query=qp(n.query)),n}static isInstance(e){if(!e)return!1;const n=e;return"method"in n&&"protocol"in n&&"hostname"in n&&"path"in n&&typeof n.query=="object"&&typeof n.headers=="object"}clone(){return Ge.clone(this)}}function qp(t){return Object.keys(t).reduce((e,n)=>{const s=t[n];return{...e,[n]:Array.isArray(s)?[...s]:s}},{})}class vs{constructor(e){this.statusCode=e.statusCode,this.reason=e.reason,this.headers=e.headers||{},this.body=e.body}static isInstance(e){if(!e)return!1;const n=e;return typeof n.statusCode=="number"&&typeof n.headers=="object"}}function jp(t){return e=>async n=>{var r,i;const{request:s}=n;return Ge.isInstance(s)&&s.body&&t.runtime==="node"&&((i=(r=t.requestHandler)==null?void 0:r.constructor)==null?void 0:i.name)!=="FetchHttpHandler"&&(s.headers={...s.headers,Expect:"100-continue"}),e({...n,request:s})}}const Wp={step:"build",tags:["SET_EXPECT_HEADER","EXPECT_HEADER"],name:"addExpectContinueMiddleware",override:!0},Vp=t=>({applyToStack:e=>{e.add(jp(t),Wp)}}),xs={WHEN_SUPPORTED:"WHEN_SUPPORTED",WHEN_REQUIRED:"WHEN_REQUIRED"},Kp=xs.WHEN_SUPPORTED,Pi={WHEN_SUPPORTED:"WHEN_SUPPORTED",WHEN_REQUIRED:"WHEN_REQUIRED"},Gp=xs.WHEN_SUPPORTED;var ve;(function(t){t.MD5="MD5",t.CRC32="CRC32",t.CRC32C="CRC32C",t.CRC64NVME="CRC64NVME",t.SHA1="SHA1",t.SHA256="SHA256"})(ve||(ve={}));var fc;(function(t){t.HEADER="header",t.TRAILER="trailer"})(fc||(fc={}));const Po=ve.CRC32;var pc;(function(t){t.ENV="env",t.CONFIG="shared config entry"})(pc||(pc={}));function Zp(t,e,n){return t.$source||(t.$source={}),t.$source[e]=n,t}function We(t,e,n){t.__aws_sdk_context?t.__aws_sdk_context.features||(t.__aws_sdk_context.features={}):t.__aws_sdk_context={features:{}},t.__aws_sdk_context.features[e]=n}const mc=t=>{var e,n;return vs.isInstance(t)?((e=t.headers)==null?void 0:e.date)??((n=t.headers)==null?void 0:n.Date):void 0},oa=t=>new Date(Date.now()+t),Xp=(t,e)=>Math.abs(oa(e).getTime()-t)>=3e5,gc=(t,e)=>{const n=Date.parse(t);return Xp(n,e)?n-Date.now():e},Ks=(t,e)=>{if(!e)throw new Error(`Property \`${t}\` is not resolved for AWS SDK SigV4Auth`);return e},nu=async t=>{var c,l,u;const e=Ks("context",t.context),n=Ks("config",t.config),s=(u=(l=(c=e.endpointV2)==null?void 0:c.properties)==null?void 0:l.authSchemes)==null?void 0:u[0],i=await Ks("signer",n.signer)(s),o=t==null?void 0:t.signingRegion,a=t==null?void 0:t.signingRegionSet,d=t==null?void 0:t.signingName;return{config:n,signer:i,signingRegion:o,signingRegionSet:a,signingName:d}};class su{async sign(e,n,s){var u;if(!Ge.isInstance(e))throw new Error("The request is not an instance of `HttpRequest` and cannot be signed");const r=await nu(s),{config:i,signer:o}=r;let{signingRegion:a,signingName:d}=r;const c=s.context;if(((u=c==null?void 0:c.authSchemes)==null?void 0:u.length)??!1){const[h,f]=c.authSchemes;(h==null?void 0:h.name)==="sigv4a"&&(f==null?void 0:f.name)==="sigv4"&&(a=(f==null?void 0:f.signingRegion)??a,d=(f==null?void 0:f.signingName)??d)}return await o.sign(e,{signingDate:oa(i.systemClockOffset),signingRegion:a,signingService:d})}errorHandler(e){return n=>{const s=n.ServerTime??mc(n.$response);if(s){const r=Ks("config",e.config),i=r.systemClockOffset;r.systemClockOffset=gc(s,r.systemClockOffset),r.systemClockOffset!==i&&n.$metadata&&(n.$metadata.clockSkewCorrected=!0)}throw n}}successHandler(e,n){const s=mc(e);if(s){const r=Ks("config",n.config);r.systemClockOffset=gc(s,r.systemClockOffset)}}}class Yp extends su{async sign(e,n,s){var h;if(!Ge.isInstance(e))throw new Error("The request is not an instance of `HttpRequest` and cannot be signed");const{config:r,signer:i,signingRegion:o,signingRegionSet:a,signingName:d}=await nu(s),l=(await((h=r.sigv4aSigningRegionSet)==null?void 0:h.call(r))??a??[o]).join(",");return await i.sign(e,{signingDate:oa(r.systemClockOffset),signingRegion:l,signingService:d})}}const _s=t=>t[Eo]||(t[Eo]={}),$t=t=>{if(typeof t=="function")return t;const e=Promise.resolve(t);return()=>e},Jp=(t,e)=>{if(!e||e.length===0)return t;const n=[];for(const s of e)for(const r of t)r.schemeId.split("#")[1]===s&&n.push(r);for(const s of t)n.find(({schemeId:r})=>r===s.schemeId)||n.push(s);return n};function e1(t){const e=new Map;for(const n of t)e.set(n.schemeId,n);return e}const t1=(t,e)=>(n,s)=>async r=>{var u;const i=t.httpAuthSchemeProvider(await e.httpAuthSchemeParametersProvider(t,s,r.input)),o=t.authSchemePreference?await t.authSchemePreference():[],a=Jp(i,o),d=e1(t.httpAuthSchemes),c=_s(s),l=[];for(const h of a){const f=d.get(h.schemeId);if(!f){l.push(`HttpAuthScheme \`${h.schemeId}\` was not enabled for this service.`);continue}const y=f.identityProvider(await e.identityProviderConfigProvider(t));if(!y){l.push(`HttpAuthScheme \`${h.schemeId}\` did not have an IdentityProvider configured.`);continue}const{identityProperties:x={},signingProperties:w={}}=((u=h.propertiesExtractor)==null?void 0:u.call(h,t,s))||{};h.identityProperties=Object.assign(h.identityProperties||{},x),h.signingProperties=Object.assign(h.signingProperties||{},w),c.selectedHttpAuthScheme={httpAuthOption:h,identity:await y(h.identityProperties),signer:f.signer};break}if(!c.selectedHttpAuthScheme)throw new Error(l.join(`
`));return n(r)},n1={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:"endpointV2Middleware"},s1=(t,{httpAuthSchemeParametersProvider:e,identityProviderConfigProvider:n})=>({applyToStack:s=>{s.addRelativeTo(t1(t,{httpAuthSchemeParametersProvider:e,identityProviderConfigProvider:n}),n1)}}),r1=(t,e)=>(n,s)=>async r=>{var o,a,d,c;const{response:i}=await n(r);try{const l=await e(i,t);return{response:i,output:l}}catch(l){if(Object.defineProperty(l,"$response",{value:i}),!("$metadata"in l)){const u="Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.";try{l.message+=`
  `+u}catch{!s.logger||((a=(o=s.logger)==null?void 0:o.constructor)==null?void 0:a.name)==="NoOpLogger"?console.warn(u):(c=(d=s.logger)==null?void 0:d.warn)==null||c.call(d,u)}typeof l.$responseBodyText<"u"&&l.$response&&(l.$response.body=l.$responseBodyText);try{if(vs.isInstance(i)){const{headers:h={}}=i,f=Object.entries(h);l.$metadata={httpStatusCode:i.statusCode,requestId:_i(/^x-[\w-]+-request-?id$/,f),extendedRequestId:_i(/^x-[\w-]+-id-2$/,f),cfId:_i(/^x-[\w-]+-cf-id$/,f)}}}catch{}}throw l}},_i=(t,e)=>(e.find(([n])=>n.match(t))||[void 0,void 0])[1],i1=(t,e)=>(n,s)=>async r=>{var d;const i=t,o=(d=s.endpointV2)!=null&&d.url&&i.urlParser?async()=>i.urlParser(s.endpointV2.url):i.endpoint;if(!o)throw new Error("No valid endpoint provider available.");const a=await e(r.input,{...t,endpoint:o});return n({...r,request:a})},o1={name:"deserializerMiddleware",step:"deserialize",tags:["DESERIALIZER"],override:!0},ru={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0};function zn(t,e,n){return{applyToStack:s=>{s.add(r1(t,n),o1),s.add(i1(t,e),ru)}}}const a1=t=>e=>{throw e},c1=(t,e)=>{},d1=t=>(e,n)=>async s=>{if(!Ge.isInstance(s.request))return e(s);const i=_s(n).selectedHttpAuthScheme;if(!i)throw new Error("No HttpAuthScheme was selected: unable to sign request");const{httpAuthOption:{signingProperties:o={}},identity:a,signer:d}=i,c=await e({...s,request:await d.sign(s.request,a,o)}).catch((d.errorHandler||a1)(o));return(d.successHandler||c1)(c.response,o),c},iu={step:"finalizeRequest",tags:["HTTP_SIGNING"],name:"httpSigningMiddleware",aliases:["apiKeyMiddleware","tokenMiddleware","awsAuthMiddleware"],override:!0,relation:"after",toMiddleware:"retryMiddleware"},l1=t=>({applyToStack:e=>{e.addRelativeTo(d1(),iu)}}),ps=t=>{if(typeof t=="function")return t;const e=Promise.resolve(t);return()=>e},xn={},Ts=new Array(64);for(let t=0,e=65,n=90;t+e<=n;t++){const s=String.fromCharCode(t+e);xn[s]=t,Ts[t]=s}for(let t=0,e=97,n=122;t+e<=n;t++){const s=String.fromCharCode(t+e),r=t+26;xn[s]=r,Ts[r]=s}for(let t=0;t<10;t++){xn[t.toString(10)]=t+52;const e=t.toString(10),n=t+52;xn[e]=n,Ts[n]=e}xn["+"]=62;Ts[62]="+";xn["/"]=63;Ts[63]="/";const ms=6,Gs=8,u1=63,aa=t=>{let e=t.length/4*3;t.slice(-2)==="=="?e-=2:t.slice(-1)==="="&&e--;const n=new ArrayBuffer(e),s=new DataView(n);for(let r=0;r<t.length;r+=4){let i=0,o=0;for(let c=r,l=r+3;c<=l;c++)if(t[c]!=="="){if(!(t[c]in xn))throw new TypeError(`Invalid character ${t[c]} in base64 string.`);i|=xn[t[c]]<<(l-c)*ms,o+=ms}else i>>=ms;const a=r/4*3;i>>=o%Gs;const d=Math.floor(o/Gs);for(let c=0;c<d;c++){const l=(d-c-1)*Gs;s.setUint8(a+c,(i&255<<l)>>l)}}return new Uint8Array(n)},$n=t=>new TextEncoder().encode(t),Ss=t=>typeof t=="string"?$n(t):ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(t),ca=t=>{if(typeof t=="string")return t;if(typeof t!="object"||typeof t.byteOffset!="number"||typeof t.byteLength!="number")throw new Error("@smithy/util-utf8: toUtf8 encoder function only accepts string | Uint8Array.");return new TextDecoder("utf-8").decode(t)};function ui(t){let e;typeof t=="string"?e=$n(t):e=t;const n=typeof e=="object"&&typeof e.length=="number",s=typeof e=="object"&&typeof e.byteOffset=="number"&&typeof e.byteLength=="number";if(!n&&!s)throw new Error("@smithy/util-base64: toBase64 encoder function only accepts string | Uint8Array.");let r="";for(let i=0;i<e.length;i+=3){let o=0,a=0;for(let c=i,l=Math.min(i+3,e.length);c<l;c++)o|=e[c]<<(l-c-1)*Gs,a+=Gs;const d=Math.ceil(a/ms);o<<=d*ms-a;for(let c=1;c<=d;c++){const l=(d-c)*ms;r+=Ts[(o&u1<<l)>>l]}r+="==".slice(0,4-d)}return r}function h1(t,e="utf-8"){return e==="base64"?ui(t):ca(t)}function f1(t,e){return e==="base64"?On.mutate(aa(t)):On.mutate($n(t))}class On extends Uint8Array{static fromString(e,n="utf-8"){switch(typeof e){case"string":return f1(e,n);default:throw new Error(`Unsupported conversion from ${typeof e} to Uint8ArrayBlobAdapter.`)}}static mutate(e){return Object.setPrototypeOf(e,On.prototype),e}transformToString(e="utf-8"){return h1(this,e)}}const p1=typeof ReadableStream=="function"?ReadableStream:function(){};class m1 extends p1{}const _o=t=>{var e;return typeof ReadableStream=="function"&&(((e=t==null?void 0:t.constructor)==null?void 0:e.name)===ReadableStream.name||t instanceof ReadableStream)},g1=({expectedChecksum:t,checksum:e,source:n,checksumSourceLocation:s,base64Encoder:r})=>{var d;if(!_o(n))throw new Error(`@smithy/util-stream: unsupported source type ${((d=n==null?void 0:n.constructor)==null?void 0:d.name)??n} in ChecksumStream.`);const i=r??ui;if(typeof TransformStream!="function")throw new Error("@smithy/util-stream: unable to instantiate ChecksumStream because API unavailable: ReadableStream/TransformStream.");const o=new TransformStream({start(){},async transform(c,l){e.update(c),l.enqueue(c)},async flush(c){const l=await e.digest(),u=i(l);if(t!==u){const h=new Error(`Checksum mismatch: expected "${t}" but received "${u}" in response header "${s}".`);c.error(h)}else c.terminate()}});n.pipeThrough(o);const a=o.readable;return Object.setPrototypeOf(a,m1.prototype),a};class y1{constructor(e){this.allocByteArray=e,this.byteLength=0,this.byteArrays=[]}push(e){this.byteArrays.push(e),this.byteLength+=e.byteLength}flush(){if(this.byteArrays.length===1){const s=this.byteArrays[0];return this.reset(),s}const e=this.allocByteArray(this.byteLength);let n=0;for(let s=0;s<this.byteArrays.length;++s){const r=this.byteArrays[s];e.set(r,n),n+=r.byteLength}return this.reset(),e}reset(){this.byteArrays=[],this.byteLength=0}}function w1(t,e,n){const s=t.getReader();let r=!1,i=0;const o=["",new y1(c=>new Uint8Array(c))];let a=-1;const d=async c=>{const{value:l,done:u}=await s.read(),h=l;if(u){if(a!==-1){const f=Ti(o,a);Zs(f)>0&&c.enqueue(f)}c.close()}else{const f=x1(h,!1);if(a!==f&&(a>=0&&c.enqueue(Ti(o,a)),a=f),a===-1){c.enqueue(h);return}const y=Zs(h);i+=y;const x=Zs(o[a]);if(y>=e&&x===0)c.enqueue(h);else{const w=v1(o,a,h);!r&&i>e*2&&(r=!0,n==null||n.warn(`@smithy/util-stream - stream chunk size ${y} is below threshold of ${e}, automatically buffering.`)),w>=e?c.enqueue(Ti(o,a)):await d(c)}}};return new ReadableStream({pull:d})}const b1=w1;function v1(t,e,n){switch(e){case 0:return t[0]+=n,Zs(t[0]);case 1:case 2:return t[e].push(n),Zs(t[e])}}function Ti(t,e){switch(e){case 0:const n=t[0];return t[0]="",n;case 1:case 2:return t[e].flush()}throw new Error(`@smithy/util-stream - invalid index ${e} given to flush()`)}function Zs(t){return(t==null?void 0:t.byteLength)??(t==null?void 0:t.length)??0}function x1(t,e=!0){return e&&typeof Buffer<"u"&&t instanceof Buffer?2:t instanceof Uint8Array?1:typeof t=="string"?0:-1}const S1=(t,e)=>{const{base64Encoder:n,bodyLengthChecker:s,checksumAlgorithmFn:r,checksumLocationName:i,streamHasher:o}=e,a=n!==void 0&&s!==void 0&&r!==void 0&&i!==void 0&&o!==void 0,d=a?o(r,t):void 0,c=t.getReader();return new ReadableStream({async pull(l){const{value:u,done:h}=await c.read();if(h){if(l.enqueue(`0\r
`),a){const f=n(await d);l.enqueue(`${i}:${f}\r
`),l.enqueue(`\r
`)}l.close()}else l.enqueue(`${(s(u)||0).toString(16)}\r
${u}\r
`)}})};async function E1(t,e){let n=0;const s=[],r=t.getReader();let i=!1;for(;!i;){const{done:d,value:c}=await r.read();if(c&&(s.push(c),n+=(c==null?void 0:c.byteLength)??0),n>=e)break;i=d}r.releaseLock();const o=new Uint8Array(Math.min(e,n));let a=0;for(const d of s){if(d.byteLength>o.byteLength-a){o.set(d.subarray(0,o.byteLength-a),a);break}else o.set(d,a);a+=d.length}return o}const Un=t=>encodeURIComponent(t).replace(/[!'()*]/g,C1),C1=t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`;function A1(t){const e=[];for(let n of Object.keys(t).sort()){const s=t[n];if(n=Un(n),Array.isArray(s))for(let r=0,i=s.length;r<i;r++)e.push(`${n}=${Un(s[r])}`);else{let r=n;(s||typeof s=="string")&&(r+=`=${Un(s)}`),e.push(r)}}return e.join("&")}function yc(t,e){return new Request(t,e)}function k1(t=0){return new Promise((e,n)=>{t&&setTimeout(()=>{const s=new Error(`Request did not complete within ${t} ms`);s.name="TimeoutError",n(s)},t)})}const Ri={supported:void 0};class da{static create(e){return typeof(e==null?void 0:e.handle)=="function"?e:new da(e)}constructor(e){typeof e=="function"?this.configProvider=e().then(n=>n||{}):(this.config=e??{},this.configProvider=Promise.resolve(this.config)),Ri.supported===void 0&&(Ri.supported=typeof Request<"u"&&"keepalive"in yc("https://[::1]"))}destroy(){}async handle(e,{abortSignal:n,requestTimeout:s}={}){var R;this.config||(this.config=await this.configProvider);const r=s??this.config.requestTimeout,i=this.config.keepAlive===!0,o=this.config.credentials;if(n!=null&&n.aborted){const S=new Error("Request aborted");return S.name="AbortError",Promise.reject(S)}let a=e.path;const d=A1(e.query||{});d&&(a+=`?${d}`),e.fragment&&(a+=`#${e.fragment}`);let c="";if(e.username!=null||e.password!=null){const S=e.username??"",k=e.password??"";c=`${S}:${k}@`}const{port:l,method:u}=e,h=`${e.protocol}//${c}${e.hostname}${l?`:${l}`:""}${a}`,f=u==="GET"||u==="HEAD"?void 0:e.body,y={body:f,headers:new Headers(e.headers),method:u,credentials:o};(R=this.config)!=null&&R.cache&&(y.cache=this.config.cache),f&&(y.duplex="half"),typeof AbortController<"u"&&(y.signal=n),Ri.supported&&(y.keepalive=i),typeof this.config.requestInit=="function"&&Object.assign(y,this.config.requestInit(e));let x=()=>{};const w=yc(h,y),_=[fetch(w).then(S=>{const k=S.headers,M={};for(const I of k.entries())M[I[0]]=I[1];return S.body!=null?{response:new vs({headers:M,reason:S.statusText,statusCode:S.status,body:S.body})}:S.blob().then(I=>({response:new vs({headers:M,reason:S.statusText,statusCode:S.status,body:I})}))}),k1(r)];return n&&_.push(new Promise((S,k)=>{const M=()=>{const $=new Error("Request aborted");$.name="AbortError",k($)};if(typeof n.addEventListener=="function"){const $=n;$.addEventListener("abort",M,{once:!0}),x=()=>$.removeEventListener("abort",M)}else n.onabort=M})),Promise.race(_).finally(x)}updateHttpClientConfig(e,n){this.config=void 0,this.configProvider=this.configProvider.then(s=>(s[e]=n,s))}httpHandlerConfigs(){return this.config??{}}}const ou=async t=>{var e;return typeof Blob=="function"&&t instanceof Blob||((e=t.constructor)==null?void 0:e.name)==="Blob"?Blob.prototype.arrayBuffer!==void 0?new Uint8Array(await t.arrayBuffer()):P1(t):_1(t)};async function P1(t){const e=await T1(t),n=aa(e);return new Uint8Array(n)}async function _1(t){const e=[],n=t.getReader();let s=!1,r=0;for(;!s;){const{done:a,value:d}=await n.read();d&&(e.push(d),r+=d.length),s=a}const i=new Uint8Array(r);let o=0;for(const a of e)i.set(a,o),o+=a.length;return i}function T1(t){return new Promise((e,n)=>{const s=new FileReader;s.onloadend=()=>{if(s.readyState!==2)return n(new Error("Reader aborted too early"));const r=s.result??"",i=r.indexOf(","),o=i>-1?i+1:r.length;e(r.substring(o))},s.onabort=()=>n(new Error("Read aborted")),s.onerror=()=>n(s.error),s.readAsDataURL(t)})}const au={},To={};for(let t=0;t<256;t++){let e=t.toString(16).toLowerCase();e.length===1&&(e=`0${e}`),au[t]=e,To[e]=t}function cu(t){if(t.length%2!==0)throw new Error("Hex encoded strings must have an even number length");const e=new Uint8Array(t.length/2);for(let n=0;n<t.length;n+=2){const s=t.slice(n,n+2).toLowerCase();if(s in To)e[n/2]=To[s];else throw new Error(`Cannot decode unrecognized sequence ${s} as hexadecimal`)}return e}function At(t){let e="";for(let n=0;n<t.byteLength;n++)e+=au[t[n]];return e}const wc="The stream has already been transformed.",R1=t=>{var r,i;if(!bc(t)&&!_o(t)){const o=((i=(r=t==null?void 0:t.__proto__)==null?void 0:r.constructor)==null?void 0:i.name)||t;throw new Error(`Unexpected stream implementation, expect Blob or ReadableStream, got ${o}`)}let e=!1;const n=async()=>{if(e)throw new Error(wc);return e=!0,await ou(t)},s=o=>{if(typeof o.stream!="function")throw new Error(`Cannot transform payload Blob to web stream. Please make sure the Blob.stream() is polyfilled.
If you are using React Native, this API is not yet supported, see: https://react-native.canny.io/feature-requests/p/fetch-streaming-body`);return o.stream()};return Object.assign(t,{transformToByteArray:n,transformToString:async o=>{const a=await n();if(o==="base64")return ui(a);if(o==="hex")return At(a);if(o===void 0||o==="utf8"||o==="utf-8")return ca(a);if(typeof TextDecoder=="function")return new TextDecoder(o).decode(a);throw new Error("TextDecoder is not available, please make sure polyfill is provided.")},transformToWebStream:()=>{if(e)throw new Error(wc);if(e=!0,bc(t))return s(t);if(_o(t))return t;throw new Error(`Cannot transform payload to web stream, got ${t}`)}})},bc=t=>typeof Blob=="function"&&t instanceof Blob;async function M1(t){return typeof t.stream=="function"&&(t=t.stream()),t.tee()}const lr=async(t=new Uint8Array,e)=>{if(t instanceof Uint8Array)return On.mutate(t);if(!t)return On.mutate(new Uint8Array);const n=e.streamCollector(t);return On.mutate(await n)};function jr(t){return encodeURIComponent(t).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}const ur=t=>{switch(t){case"true":return!0;case"false":return!1;default:throw new Error(`Unable to parse boolean value "${t}"`)}},I1=t=>{if(t!=null){if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return String(e)!==String(t)&&uu.warn(lu(`Expected number but observed string: ${t}`)),e}if(typeof t=="number")return t;throw new TypeError(`Expected number, got ${typeof t}: ${t}`)}},L1=Math.ceil(2**127*(2-2**-23)),vc=t=>{const e=I1(t);if(e!==void 0&&!Number.isNaN(e)&&e!==1/0&&e!==-1/0&&Math.abs(e)>L1)throw new TypeError(`Expected 32-bit float, got ${t}`);return e},Ro=t=>{if(t!=null){if(Number.isInteger(t)&&!Number.isNaN(t))return t;throw new TypeError(`Expected integer, got ${typeof t}: ${t}`)}},xc=t=>du(t,16),Sc=t=>du(t,8),du=(t,e)=>{const n=Ro(t);if(n!==void 0&&B1(n,e)!==n)throw new TypeError(`Expected ${e}-bit integer, got ${t}`);return n},B1=(t,e)=>{switch(e){case 32:return Int32Array.of(t)[0];case 16:return Int16Array.of(t)[0];case 8:return Int8Array.of(t)[0]}},on=(t,e)=>{if(t==null)throw e?new TypeError(`Expected a non-null value for ${e}`):new TypeError("Expected a non-null value");return t},la=t=>{if(t==null)return;if(typeof t=="object"&&!Array.isArray(t))return t;const e=Array.isArray(t)?"array":typeof t;throw new TypeError(`Expected object, got ${e}: ${t}`)},st=t=>{if(t!=null){if(typeof t=="string")return t;if(["boolean","number","bigint"].includes(typeof t))return uu.warn(lu(`Expected string, got ${typeof t}: ${t}`)),String(t);throw new TypeError(`Expected string, got ${typeof t}: ${t}`)}},F1=t=>vc(typeof t=="string"?hi(t):t),D1=/(-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?)|(-?Infinity)|(NaN)/g,hi=t=>{const e=t.match(D1);if(e===null||e[0].length!==t.length)throw new TypeError("Expected real number, got implicit NaN");return parseFloat(t)},N1=t=>Ro(typeof t=="string"?hi(t):t),Wr=t=>xc(typeof t=="string"?hi(t):t),O1=t=>Sc(typeof t=="string"?hi(t):t),lu=t=>String(new TypeError(t).stack||t).split(`
`).slice(0,5).filter(e=>!e.includes("stackTraceWarning")).join(`
`),uu={warn:console.warn},U1=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ua=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function ha(t){const e=t.getUTCFullYear(),n=t.getUTCMonth(),s=t.getUTCDay(),r=t.getUTCDate(),i=t.getUTCHours(),o=t.getUTCMinutes(),a=t.getUTCSeconds(),d=r<10?`0${r}`:`${r}`,c=i<10?`0${i}`:`${i}`,l=o<10?`0${o}`:`${o}`,u=a<10?`0${a}`:`${a}`;return`${U1[s]}, ${d} ${ua[n]} ${e} ${c}:${l}:${u} GMT`}const Q1=new RegExp(/^(\d{4})-(\d{2})-(\d{2})[tT](\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?(([-+]\d{2}\:\d{2})|[zZ])$/),$1=t=>{if(t==null)return;if(typeof t!="string")throw new TypeError("RFC-3339 date-times must be expressed as strings");const e=Q1.exec(t);if(!e)throw new TypeError("Invalid RFC-3339 date-time value");const[n,s,r,i,o,a,d,c,l]=e,u=Wr(ir(s)),h=bn(r,"month",1,12),f=bn(i,"day",1,31),y=Nr(u,h,f,{hours:o,minutes:a,seconds:d,fractionalMilliseconds:c});return l.toUpperCase()!="Z"&&y.setTime(y.getTime()-J1(l)),y},H1=new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d{2}) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? GMT$/),z1=new RegExp(/^(?:Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d{2})-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d{2}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? GMT$/),q1=new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( [1-9]|\d{2}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? (\d{4})$/),j1=t=>{if(t==null)return;if(typeof t!="string")throw new TypeError("RFC-7231 date-times must be expressed as strings");let e=H1.exec(t);if(e){const[n,s,r,i,o,a,d,c]=e;return Nr(Wr(ir(i)),Mi(r),bn(s,"day",1,31),{hours:o,minutes:a,seconds:d,fractionalMilliseconds:c})}if(e=z1.exec(t),e){const[n,s,r,i,o,a,d,c]=e;return K1(Nr(W1(i),Mi(r),bn(s,"day",1,31),{hours:o,minutes:a,seconds:d,fractionalMilliseconds:c}))}if(e=q1.exec(t),e){const[n,s,r,i,o,a,d,c]=e;return Nr(Wr(ir(c)),Mi(s),bn(r.trimLeft(),"day",1,31),{hours:i,minutes:o,seconds:a,fractionalMilliseconds:d})}throw new TypeError("Invalid RFC-7231 date-time value")},Nr=(t,e,n,s)=>{const r=e-1;return Z1(t,r,n),new Date(Date.UTC(t,r,n,bn(s.hours,"hour",0,23),bn(s.minutes,"minute",0,59),bn(s.seconds,"seconds",0,60),Y1(s.fractionalMilliseconds)))},W1=t=>{const e=new Date().getUTCFullYear(),n=Math.floor(e/100)*100+Wr(ir(t));return n<e?n+100:n},V1=50*365*24*60*60*1e3,K1=t=>t.getTime()-new Date().getTime()>V1?new Date(Date.UTC(t.getUTCFullYear()-100,t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds())):t,Mi=t=>{const e=ua.indexOf(t);if(e<0)throw new TypeError(`Invalid month: ${t}`);return e+1},G1=[31,28,31,30,31,30,31,31,30,31,30,31],Z1=(t,e,n)=>{let s=G1[e];if(e===1&&X1(t)&&(s=29),n>s)throw new TypeError(`Invalid day for ${ua[e]} in ${t}: ${n}`)},X1=t=>t%4===0&&(t%100!==0||t%400===0),bn=(t,e,n,s)=>{const r=O1(ir(t));if(r<n||r>s)throw new TypeError(`${e} must be between ${n} and ${s}, inclusive`);return r},Y1=t=>t==null?0:F1("0."+t)*1e3,J1=t=>{const e=t[0];let n=1;if(e=="+")n=1;else if(e=="-")n=-1;else throw new TypeError(`Offset direction, ${e}, must be "+" or "-"`);const s=Number(t.substring(1,3)),r=Number(t.substring(4,6));return n*(s*60+r)*60*1e3},ir=t=>{let e=0;for(;e<t.length-1&&t.charAt(e)==="0";)e++;return e===0?t:t.slice(e)},em=(t,e,n,s,r,i)=>{if(e!=null&&e[n]!==void 0){const o=s();if(o.length<=0)throw new Error("Empty value provided for input HTTP label: "+n+".");t=t.replace(r,i?o.split("/").map(a=>jr(a)).join("/"):jr(o))}else throw new Error("No value provided for input HTTP label: "+n+".");return t};function qn(t,e){return new tm(t,e)}class tm{constructor(e,n){this.input=e,this.context=n,this.query={},this.method="",this.headers={},this.path="",this.body=null,this.hostname="",this.resolvePathStack=[]}async build(){const{hostname:e,protocol:n="https",port:s,path:r}=await this.context.endpoint();this.path=r;for(const i of this.resolvePathStack)i(this.path);return new Ge({protocol:n,hostname:this.hostname||e,port:s,method:this.method,path:this.path,query:this.query,body:this.body,headers:this.headers})}hn(e){return this.hostname=e,this}bp(e){return this.resolvePathStack.push(n=>{this.path=`${n!=null&&n.endsWith("/")?n.slice(0,-1):n||""}`+e}),this}p(e,n,s,r){return this.resolvePathStack.push(i=>{this.path=em(i,this.input,e,n,s,r)}),this}h(e){return this.headers=e,this}q(e){return this.query=e,this}b(e){return this.body=e,this}m(e){return this.method=e,this}}function nm(t,e,n){t.__smithy_context?t.__smithy_context.features||(t.__smithy_context.features={}):t.__smithy_context={features:{}},t.__smithy_context.features[e]=n}class sm{constructor(e){this.authSchemes=new Map;for(const[n,s]of Object.entries(e))s!==void 0&&this.authSchemes.set(n,s)}getIdentityProvider(e){return this.authSchemes.get(e)}}const rm=t=>e=>hu(e)&&e.expiration.getTime()-Date.now()<t,im=3e5,om=rm(im),hu=t=>t.expiration!==void 0,am=(t,e,n)=>{if(t===void 0)return;const s=typeof t!="function"?async()=>Promise.resolve(t):t;let r,i,o,a=!1;const d=async c=>{i||(i=s(c));try{r=await i,o=!0,a=!1}finally{i=void 0}return r};return e===void 0?async c=>((!o||c!=null&&c.forceRefresh)&&(r=await d(c)),r):async c=>((!o||c!=null&&c.forceRefresh)&&(r=await d(c)),a?r:n(r)?(e(r)&&await d(c),r):(a=!0,r))},cm=(t,e,n)=>{let s,r,i,o=!1;const a=async()=>{r||(r=t());try{s=await r,i=!0,o=!1}finally{r=void 0}return s};return async d=>((!i||d!=null&&d.forceRefresh)&&(s=await a()),s)},dm=t=>(t.sigv4aSigningRegionSet=ps(t.sigv4aSigningRegionSet),t),lm="X-Amz-Algorithm",um="X-Amz-Credential",fu="X-Amz-Date",hm="X-Amz-SignedHeaders",fm="X-Amz-Expires",pu="X-Amz-Signature",mu="X-Amz-Security-Token",gu="authorization",yu=fu.toLowerCase(),pm="date",mm=[gu,yu,pm],gm=pu.toLowerCase(),Mo="x-amz-content-sha256",ym=mu.toLowerCase(),wm={authorization:!0,"cache-control":!0,connection:!0,expect:!0,from:!0,"keep-alive":!0,"max-forwards":!0,pragma:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,"x-amzn-trace-id":!0},bm=/^proxy-/,vm=/^sec-/,Ii="AWS4-HMAC-SHA256",xm="AWS4-HMAC-SHA256-PAYLOAD",Sm="UNSIGNED-PAYLOAD",Em=50,wu="aws4_request",Cm=60*60*24*7,_r={},Li=[],Bi=(t,e,n)=>`${t}/${e}/${n}/${wu}`,Am=async(t,e,n,s,r)=>{const i=await Ec(t,e.secretAccessKey,e.accessKeyId),o=`${n}:${s}:${r}:${At(i)}:${e.sessionToken}`;if(o in _r)return _r[o];for(Li.push(o);Li.length>Em;)delete _r[Li.shift()];let a=`AWS4${e.secretAccessKey}`;for(const d of[n,s,r,wu])a=await Ec(t,a,d);return _r[o]=a},Ec=(t,e,n)=>{const s=new t(e);return s.update(Ss(n)),s.digest()},Cc=({headers:t},e,n)=>{const s={};for(const r of Object.keys(t).sort()){if(t[r]==null)continue;const i=r.toLowerCase();(i in wm||e!=null&&e.has(i)||bm.test(i)||vm.test(i))&&(!n||n&&!n.has(i))||(s[i]=t[r].trim().replace(/\s+/g," "))}return s},bu=t=>typeof ArrayBuffer=="function"&&t instanceof ArrayBuffer||Object.prototype.toString.call(t)==="[object ArrayBuffer]",Fi=async({headers:t,body:e},n)=>{for(const s of Object.keys(t))if(s.toLowerCase()===Mo)return t[s];if(e==null)return"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";if(typeof e=="string"||ArrayBuffer.isView(e)||bu(e)){const s=new n;return s.update(Ss(e)),At(await s.digest())}return Sm};class km{format(e){const n=[];for(const i of Object.keys(e)){const o=$n(i);n.push(Uint8Array.from([o.byteLength]),o,this.formatHeaderValue(e[i]))}const s=new Uint8Array(n.reduce((i,o)=>i+o.byteLength,0));let r=0;for(const i of n)s.set(i,r),r+=i.byteLength;return s}formatHeaderValue(e){switch(e.type){case"boolean":return Uint8Array.from([e.value?0:1]);case"byte":return Uint8Array.from([2,e.value]);case"short":const n=new DataView(new ArrayBuffer(3));return n.setUint8(0,3),n.setInt16(1,e.value,!1),new Uint8Array(n.buffer);case"integer":const s=new DataView(new ArrayBuffer(5));return s.setUint8(0,4),s.setInt32(1,e.value,!1),new Uint8Array(s.buffer);case"long":const r=new Uint8Array(9);return r[0]=5,r.set(e.value.bytes,1),r;case"binary":const i=new DataView(new ArrayBuffer(3+e.value.byteLength));i.setUint8(0,6),i.setUint16(1,e.value.byteLength,!1);const o=new Uint8Array(i.buffer);return o.set(e.value,3),o;case"string":const a=$n(e.value),d=new DataView(new ArrayBuffer(3+a.byteLength));d.setUint8(0,7),d.setUint16(1,a.byteLength,!1);const c=new Uint8Array(d.buffer);return c.set(a,3),c;case"timestamp":const l=new Uint8Array(9);return l[0]=8,l.set(_m.fromNumber(e.value.valueOf()).bytes,1),l;case"uuid":if(!Pm.test(e.value))throw new Error(`Invalid UUID received: ${e.value}`);const u=new Uint8Array(17);return u[0]=9,u.set(cu(e.value.replace(/\-/g,"")),1),u}}}var Ac;(function(t){t[t.boolTrue=0]="boolTrue",t[t.boolFalse=1]="boolFalse",t[t.byte=2]="byte",t[t.short=3]="short",t[t.integer=4]="integer",t[t.long=5]="long",t[t.byteArray=6]="byteArray",t[t.string=7]="string",t[t.timestamp=8]="timestamp",t[t.uuid=9]="uuid"})(Ac||(Ac={}));const Pm=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/;let _m=class vu{constructor(e){if(this.bytes=e,e.byteLength!==8)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(e){if(e>9223372036854776e3||e<-9223372036854776e3)throw new Error(`${e} is too large (or, if negative, too small) to represent as an Int64`);const n=new Uint8Array(8);for(let s=7,r=Math.abs(Math.round(e));s>-1&&r>0;s--,r/=256)n[s]=r;return e<0&&kc(n),new vu(n)}valueOf(){const e=this.bytes.slice(0),n=e[0]&128;return n&&kc(e),parseInt(At(e),16)*(n?-1:1)}toString(){return String(this.valueOf())}};function kc(t){for(let e=0;e<8;e++)t[e]^=255;for(let e=7;e>-1&&(t[e]++,t[e]===0);e--);}const Tm=(t,e)=>{t=t.toLowerCase();for(const n of Object.keys(e))if(t===n.toLowerCase())return!0;return!1},Rm=(t,e={})=>{var r,i;const{headers:n,query:s={}}=Ge.clone(t);for(const o of Object.keys(n)){const a=o.toLowerCase();(a.slice(0,6)==="x-amz-"&&!((r=e.unhoistableHeaders)!=null&&r.has(a))||(i=e.hoistableHeaders)!=null&&i.has(a))&&(s[o]=n[o],delete n[o])}return{...t,headers:n,query:s}},Pc=t=>{t=Ge.clone(t);for(const e of Object.keys(t.headers))mm.indexOf(e.toLowerCase())>-1&&delete t.headers[e];return t},Mm=({query:t={}})=>{const e=[],n={};for(const s of Object.keys(t)){if(s.toLowerCase()===gm)continue;const r=Un(s);e.push(r);const i=t[s];typeof i=="string"?n[r]=`${r}=${Un(i)}`:Array.isArray(i)&&(n[r]=i.slice(0).reduce((o,a)=>o.concat([`${r}=${Un(a)}`]),[]).sort().join("&"))}return e.sort().map(s=>n[s]).filter(s=>s).join("&")},Im=t=>Lm(t).toISOString().replace(/\.\d{3}Z$/,"Z"),Lm=t=>typeof t=="number"?new Date(t*1e3):typeof t=="string"?Number(t)?new Date(Number(t)*1e3):new Date(t):t;class Bm{constructor({applyChecksum:e,credentials:n,region:s,service:r,sha256:i,uriEscapePath:o=!0}){this.service=r,this.sha256=i,this.uriEscapePath=o,this.applyChecksum=typeof e=="boolean"?e:!0,this.regionProvider=$t(s),this.credentialProvider=$t(n)}createCanonicalRequest(e,n,s){const r=Object.keys(n).sort();return`${e.method}
${this.getCanonicalPath(e)}
${Mm(e)}
${r.map(i=>`${i}:${n[i]}`).join(`
`)}

${r.join(";")}
${s}`}async createStringToSign(e,n,s,r){const i=new this.sha256;i.update(Ss(s));const o=await i.digest();return`${r}
${e}
${n}
${At(o)}`}getCanonicalPath({path:e}){if(this.uriEscapePath){const n=[];for(const i of e.split("/"))(i==null?void 0:i.length)!==0&&i!=="."&&(i===".."?n.pop():n.push(i));const s=`${e!=null&&e.startsWith("/")?"/":""}${n.join("/")}${n.length>0&&(e!=null&&e.endsWith("/"))?"/":""}`;return Un(s).replace(/%2F/g,"/")}return e}validateResolvedCredentials(e){if(typeof e!="object"||typeof e.accessKeyId!="string"||typeof e.secretAccessKey!="string")throw new Error("Resolved credential object is not valid")}formatDate(e){const n=Im(e).replace(/[\-:]/g,"");return{longDate:n,shortDate:n.slice(0,8)}}getCanonicalHeaderList(e){return Object.keys(e).sort().join(";")}}class Io extends Bm{constructor({applyChecksum:e,credentials:n,region:s,service:r,sha256:i,uriEscapePath:o=!0}){super({applyChecksum:e,credentials:n,region:s,service:r,sha256:i,uriEscapePath:o}),this.headerFormatter=new km}async presign(e,n={}){const{signingDate:s=new Date,expiresIn:r=3600,unsignableHeaders:i,unhoistableHeaders:o,signableHeaders:a,hoistableHeaders:d,signingRegion:c,signingService:l}=n,u=await this.credentialProvider();this.validateResolvedCredentials(u);const h=c??await this.regionProvider(),{longDate:f,shortDate:y}=this.formatDate(s);if(r>Cm)return Promise.reject("Signature version 4 presigned URLs must have an expiration date less than one week in the future");const x=Bi(y,h,l??this.service),w=Rm(Pc(e),{unhoistableHeaders:o,hoistableHeaders:d});u.sessionToken&&(w.query[mu]=u.sessionToken),w.query[lm]=Ii,w.query[um]=`${u.accessKeyId}/${x}`,w.query[fu]=f,w.query[fm]=r.toString(10);const _=Cc(w,i,a);return w.query[hm]=this.getCanonicalHeaderList(_),w.query[pu]=await this.getSignature(f,x,this.getSigningKey(u,h,y,l),this.createCanonicalRequest(w,_,await Fi(e,this.sha256))),w}async sign(e,n){return typeof e=="string"?this.signString(e,n):e.headers&&e.payload?this.signEvent(e,n):e.message?this.signMessage(e,n):this.signRequest(e,n)}async signEvent({headers:e,payload:n},{signingDate:s=new Date,priorSignature:r,signingRegion:i,signingService:o}){const a=i??await this.regionProvider(),{shortDate:d,longDate:c}=this.formatDate(s),l=Bi(d,a,o??this.service),u=await Fi({headers:{},body:n},this.sha256),h=new this.sha256;h.update(e);const f=At(await h.digest()),y=[xm,c,l,r,f,u].join(`
`);return this.signString(y,{signingDate:s,signingRegion:a,signingService:o})}async signMessage(e,{signingDate:n=new Date,signingRegion:s,signingService:r}){return this.signEvent({headers:this.headerFormatter.format(e.message.headers),payload:e.message.body},{signingDate:n,signingRegion:s,signingService:r,priorSignature:e.priorSignature}).then(o=>({message:e.message,signature:o}))}async signString(e,{signingDate:n=new Date,signingRegion:s,signingService:r}={}){const i=await this.credentialProvider();this.validateResolvedCredentials(i);const o=s??await this.regionProvider(),{shortDate:a}=this.formatDate(n),d=new this.sha256(await this.getSigningKey(i,o,a,r));return d.update(Ss(e)),At(await d.digest())}async signRequest(e,{signingDate:n=new Date,signableHeaders:s,unsignableHeaders:r,signingRegion:i,signingService:o}={}){const a=await this.credentialProvider();this.validateResolvedCredentials(a);const d=i??await this.regionProvider(),c=Pc(e),{longDate:l,shortDate:u}=this.formatDate(n),h=Bi(u,d,o??this.service);c.headers[yu]=l,a.sessionToken&&(c.headers[ym]=a.sessionToken);const f=await Fi(c,this.sha256);!Tm(Mo,c.headers)&&this.applyChecksum&&(c.headers[Mo]=f);const y=Cc(c,r,s),x=await this.getSignature(l,h,this.getSigningKey(a,d,u,o),this.createCanonicalRequest(c,y,f));return c.headers[gu]=`${Ii} Credential=${a.accessKeyId}/${h}, SignedHeaders=${this.getCanonicalHeaderList(y)}, Signature=${x}`,c}async getSignature(e,n,s,r){const i=await this.createStringToSign(e,n,r,Ii),o=new this.sha256(await s);return o.update(Ss(i)),At(await o.digest())}getSigningKey(e,n,s,r){return Am(this.sha256,e,s,n,r||this.service)}}const Fm=t=>{let e=t.credentials,n=!!t.credentials,s;Object.defineProperty(t,"credentials",{set(c){c&&c!==e&&c!==s&&(n=!0),e=c;const l=Dm(t,{credentials:e,credentialDefaultProvider:t.credentialDefaultProvider}),u=Nm(t,l);n&&!u.attributed?(s=async h=>u(h).then(f=>Zp(f,"CREDENTIALS_CODE","e")),s.memoized=u.memoized,s.configBound=u.configBound,s.attributed=!0):s=u},get(){return s},enumerable:!0,configurable:!0}),t.credentials=e;const{signingEscapePath:r=!0,systemClockOffset:i=t.systemClockOffset||0,sha256:o}=t;let a;return t.signer?a=ps(t.signer):t.regionInfoProvider?a=()=>ps(t.region)().then(async c=>[await t.regionInfoProvider(c,{useFipsEndpoint:await t.useFipsEndpoint(),useDualstackEndpoint:await t.useDualstackEndpoint()})||{},c]).then(([c,l])=>{const{signingRegion:u,signingService:h}=c;t.signingRegion=t.signingRegion||u||l,t.signingName=t.signingName||h||t.serviceId;const f={...t,credentials:t.credentials,region:t.signingRegion,service:t.signingName,sha256:o,uriEscapePath:r},y=t.signerConstructor||Io;return new y(f)}):a=async c=>{c=Object.assign({},{name:"sigv4",signingName:t.signingName||t.defaultSigningName,signingRegion:await ps(t.region)(),properties:{}},c);const l=c.signingRegion,u=c.signingName;t.signingRegion=t.signingRegion||l,t.signingName=t.signingName||u||t.serviceId;const h={...t,credentials:t.credentials,region:t.signingRegion,service:t.signingName,sha256:o,uriEscapePath:r},f=t.signerConstructor||Io;return new f(h)},Object.assign(t,{systemClockOffset:i,signingEscapePath:r,signer:a})};function Dm(t,{credentials:e,credentialDefaultProvider:n}){let s;return e?e!=null&&e.memoized?s=e:s=am(e,om,hu):n?s=ps(n(Object.assign({},t,{parentClientConfig:t}))):s=async()=>{throw new Error("@aws-sdk/core::resolveAwsSdkSigV4Config - `credentials` not provided and no credentialDefaultProvider was configured.")},s.memoized=!0,s}function Nm(t,e){if(e.configBound)return e;const n=async s=>e({...s,callerClientConfig:t});return n.memoized=e.memoized,n.configBound=!0,n}const _c=typeof TextEncoder=="function"?new TextEncoder:null,Om=t=>{if(typeof t=="string"){if(_c)return _c.encode(t).byteLength;let e=t.length;for(let n=e-1;n>=0;n--){const s=t.charCodeAt(n);s>127&&s<=2047?e++:s>2047&&s<=65535&&(e+=2),s>=56320&&s<=57343&&n--}return e}else{if(typeof t.byteLength=="number")return t.byteLength;if(typeof t.size=="number")return t.size}throw new Error(`Body Length computation failed for ${t}`)},Rn=(t,e)=>{const n=[];if(t&&n.push(t),e)for(const s of e)n.push(s);return n},dn=(t,e)=>`${t||"anonymous"}${e&&e.length>0?` (a.k.a. ${e.join(",")})`:""}`,Vr=()=>{let t=[],e=[],n=!1;const s=new Set,r=u=>u.sort((h,f)=>Tc[f.step]-Tc[h.step]||Rc[f.priority||"normal"]-Rc[h.priority||"normal"]),i=u=>{let h=!1;const f=y=>{const x=Rn(y.name,y.aliases);if(x.includes(u)){h=!0;for(const w of x)s.delete(w);return!1}return!0};return t=t.filter(f),e=e.filter(f),h},o=u=>{let h=!1;const f=y=>{if(y.middleware===u){h=!0;for(const x of Rn(y.name,y.aliases))s.delete(x);return!1}return!0};return t=t.filter(f),e=e.filter(f),h},a=u=>{var h;return t.forEach(f=>{u.add(f.middleware,{...f})}),e.forEach(f=>{u.addRelativeTo(f.middleware,{...f})}),(h=u.identifyOnResolve)==null||h.call(u,l.identifyOnResolve()),u},d=u=>{const h=[];return u.before.forEach(f=>{f.before.length===0&&f.after.length===0?h.push(f):h.push(...d(f))}),h.push(u),u.after.reverse().forEach(f=>{f.before.length===0&&f.after.length===0?h.push(f):h.push(...d(f))}),h},c=(u=!1)=>{const h=[],f=[],y={};return t.forEach(w=>{const _={...w,before:[],after:[]};for(const R of Rn(_.name,_.aliases))y[R]=_;h.push(_)}),e.forEach(w=>{const _={...w,before:[],after:[]};for(const R of Rn(_.name,_.aliases))y[R]=_;f.push(_)}),f.forEach(w=>{if(w.toMiddleware){const _=y[w.toMiddleware];if(_===void 0){if(u)return;throw new Error(`${w.toMiddleware} is not found when adding ${dn(w.name,w.aliases)} middleware ${w.relation} ${w.toMiddleware}`)}w.relation==="after"&&_.after.push(w),w.relation==="before"&&_.before.push(w)}}),r(h).map(d).reduce((w,_)=>(w.push(..._),w),[])},l={add:(u,h={})=>{const{name:f,override:y,aliases:x}=h,w={step:"initialize",priority:"normal",middleware:u,...h},_=Rn(f,x);if(_.length>0){if(_.some(R=>s.has(R))){if(!y)throw new Error(`Duplicate middleware name '${dn(f,x)}'`);for(const R of _){const S=t.findIndex(M=>{var $;return M.name===R||(($=M.aliases)==null?void 0:$.some(I=>I===R))});if(S===-1)continue;const k=t[S];if(k.step!==w.step||w.priority!==k.priority)throw new Error(`"${dn(k.name,k.aliases)}" middleware with ${k.priority} priority in ${k.step} step cannot be overridden by "${dn(f,x)}" middleware with ${w.priority} priority in ${w.step} step.`);t.splice(S,1)}}for(const R of _)s.add(R)}t.push(w)},addRelativeTo:(u,h)=>{const{name:f,override:y,aliases:x}=h,w={middleware:u,...h},_=Rn(f,x);if(_.length>0){if(_.some(R=>s.has(R))){if(!y)throw new Error(`Duplicate middleware name '${dn(f,x)}'`);for(const R of _){const S=e.findIndex(M=>{var $;return M.name===R||(($=M.aliases)==null?void 0:$.some(I=>I===R))});if(S===-1)continue;const k=e[S];if(k.toMiddleware!==w.toMiddleware||k.relation!==w.relation)throw new Error(`"${dn(k.name,k.aliases)}" middleware ${k.relation} "${k.toMiddleware}" middleware cannot be overridden by "${dn(f,x)}" middleware ${w.relation} "${w.toMiddleware}" middleware.`);e.splice(S,1)}}for(const R of _)s.add(R)}e.push(w)},clone:()=>a(Vr()),use:u=>{u.applyToStack(l)},remove:u=>typeof u=="string"?i(u):o(u),removeByTag:u=>{let h=!1;const f=y=>{const{tags:x,name:w,aliases:_}=y;if(x&&x.includes(u)){const R=Rn(w,_);for(const S of R)s.delete(S);return h=!0,!1}return!0};return t=t.filter(f),e=e.filter(f),h},concat:u=>{var f;const h=a(Vr());return h.use(u),h.identifyOnResolve(n||h.identifyOnResolve()||(((f=u.identifyOnResolve)==null?void 0:f.call(u))??!1)),h},applyToStack:a,identify:()=>c(!0).map(u=>{const h=u.step??u.relation+" "+u.toMiddleware;return dn(u.name,u.aliases)+" - "+h}),identifyOnResolve(u){return typeof u=="boolean"&&(n=u),n},resolve:(u,h)=>{for(const f of c().map(y=>y.middleware).reverse())u=f(u,h);return n&&console.log(l.identify()),u}};return l},Tc={initialize:5,serialize:4,build:3,finalizeRequest:2,deserialize:1},Rc={high:3,normal:2,low:1};class Um{constructor(e){this.config=e,this.middlewareStack=Vr()}send(e,n,s){const r=typeof n!="function"?n:void 0,i=typeof n=="function"?n:s,o=r===void 0&&this.config.cacheMiddleware===!0;let a;if(o){this.handlers||(this.handlers=new WeakMap);const d=this.handlers;d.has(e.constructor)?a=d.get(e.constructor):(a=e.resolveMiddleware(this.middlewareStack,this.config,r),d.set(e.constructor,a))}else delete this.handlers,a=e.resolveMiddleware(this.middlewareStack,this.config,r);if(i)a(e).then(d=>i(null,d.output),d=>i(d)).catch(()=>{});else return a(e).then(d=>d.output)}destroy(){var e,n,s;(s=(n=(e=this.config)==null?void 0:e.requestHandler)==null?void 0:n.destroy)==null||s.call(n),delete this.handlers}}class Cn{constructor(){this.middlewareStack=Vr()}static classBuilder(){return new Qm}resolveMiddlewareWithContext(e,n,s,{middlewareFn:r,clientName:i,commandName:o,inputFilterSensitiveLog:a,outputFilterSensitiveLog:d,smithyContext:c,additionalContext:l,CommandCtor:u}){for(const w of r.bind(this)(u,e,n,s))this.middlewareStack.use(w);const h=e.concat(this.middlewareStack),{logger:f}=n,y={logger:f,clientName:i,commandName:o,inputFilterSensitiveLog:a,outputFilterSensitiveLog:d,[Eo]:{commandInstance:this,...c},...l},{requestHandler:x}=n;return h.resolve(w=>x.handle(w.request,s||{}),y)}}class Qm{constructor(){this._init=()=>{},this._ep={},this._middlewareFn=()=>[],this._commandName="",this._clientName="",this._additionalContext={},this._smithyContext={},this._inputFilterSensitiveLog=e=>e,this._outputFilterSensitiveLog=e=>e,this._serializer=null,this._deserializer=null}init(e){this._init=e}ep(e){return this._ep=e,this}m(e){return this._middlewareFn=e,this}s(e,n,s={}){return this._smithyContext={service:e,operation:n,...s},this}c(e={}){return this._additionalContext=e,this}n(e,n){return this._clientName=e,this._commandName=n,this}f(e=s=>s,n=s=>s){return this._inputFilterSensitiveLog=e,this._outputFilterSensitiveLog=n,this}ser(e){return this._serializer=e,this}de(e){return this._deserializer=e,this}sc(e){return this._operationSchema=e,this._smithyContext.operationSchema=e,this}build(){const e=this;let n;return n=class extends Cn{static getEndpointParameterInstructions(){return e._ep}constructor(...[s]){super(),this.serialize=e._serializer,this.deserialize=e._deserializer,this.input=s??{},e._init(this),this.schema=e._operationSchema}resolveMiddleware(s,r,i){return this.resolveMiddlewareWithContext(s,r,i,{CommandCtor:n,middlewareFn:e._middlewareFn,clientName:e._clientName,commandName:e._commandName,inputFilterSensitiveLog:e._inputFilterSensitiveLog,outputFilterSensitiveLog:e._outputFilterSensitiveLog,smithyContext:e._smithyContext,additionalContext:e._additionalContext})}}}}const Ve="***SensitiveInformation***";class us extends Error{constructor(e){super(e.message),Object.setPrototypeOf(this,Object.getPrototypeOf(this).constructor.prototype),this.name=e.name,this.$fault=e.$fault,this.$metadata=e.$metadata}static isInstance(e){if(!e)return!1;const n=e;return us.prototype.isPrototypeOf(n)||!!n.$fault&&!!n.$metadata&&(n.$fault==="client"||n.$fault==="server")}static[Symbol.hasInstance](e){if(!e)return!1;const n=e;return this===us?us.isInstance(e):us.isInstance(e)?n.name&&this.name?this.prototype.isPrototypeOf(e)||n.name===this.name:this.prototype.isPrototypeOf(e):!1}}const Ct=(t,e={})=>{Object.entries(e).filter(([,s])=>s!==void 0).forEach(([s,r])=>{(t[s]==null||t[s]==="")&&(t[s]=r)});const n=t.message||t.Message||"UnknownError";return t.message=n,delete t.Message,t},$m=({output:t,parsedBody:e,exceptionCtor:n,errorCode:s})=>{const r=zm(t),i=r.httpStatusCode?r.httpStatusCode+"":void 0,o=new n({name:(e==null?void 0:e.code)||(e==null?void 0:e.Code)||s||i||"UnknownError",$fault:"client",$metadata:r});throw Ct(o,e)},Hm=t=>({output:e,parsedBody:n,errorCode:s})=>{$m({output:e,parsedBody:n,exceptionCtor:t,errorCode:s})},zm=t=>({httpStatusCode:t.statusCode,requestId:t.headers["x-amzn-requestid"]??t.headers["x-amzn-request-id"]??t.headers["x-amz-request-id"],extendedRequestId:t.headers["x-amz-id-2"],cfId:t.headers["x-amz-cf-id"]}),qm=t=>{switch(t){case"standard":return{retryMode:"standard",connectionTimeout:3100};case"in-region":return{retryMode:"standard",connectionTimeout:1100};case"cross-region":return{retryMode:"standard",connectionTimeout:3100};case"mobile":return{retryMode:"standard",connectionTimeout:3e4};default:return{}}},jm=t=>{const e=[];for(const n in sc){const s=sc[n];t[s]!==void 0&&e.push({algorithmId:()=>s,checksumConstructor:()=>t[s]})}return{addChecksumAlgorithm(n){e.push(n)},checksumAlgorithms(){return e}}},Wm=t=>{const e={};return t.checksumAlgorithms().forEach(n=>{e[n.algorithmId()]=n.checksumConstructor()}),e},Vm=t=>({setRetryStrategy(e){t.retryStrategy=e},retryStrategy(){return t.retryStrategy}}),Km=t=>{const e={};return e.retryStrategy=t.retryStrategy(),e},Gm=t=>Object.assign(jm(t),Vm(t)),Zm=t=>Object.assign(Wm(t),Km(t)),xu=t=>{const e="#text";for(const n in t)t.hasOwnProperty(n)&&t[n][e]!==void 0?t[n]=t[n][e]:typeof t[n]=="object"&&t[n]!==null&&(t[n]=xu(t[n]));return t},Ye=t=>t!=null;class fa{trace(){}debug(){}info(){}warn(){}error(){}}function oe(t,e,n){let s,r,i;if(typeof e>"u"&&typeof n>"u")s={},i=t;else{if(s=t,typeof e=="function")return r=e,i=n,Xm(s,r,i);i=e}for(const o of Object.keys(i)){if(!Array.isArray(i[o])){s[o]=i[o];continue}Ym(s,null,i,o)}return s}const Xm=(t,e,n)=>oe(t,Object.entries(n).reduce((s,[r,i])=>(Array.isArray(i)?s[r]=i:typeof i=="function"?s[r]=[e,i()]:s[r]=[e,i],s),{})),Ym=(t,e,n,s)=>{let[r,i]=n[s];if(typeof i=="function"){let o;const a=r===void 0&&(o=i())!=null,d=typeof r=="function"&&!!r(void 0)||typeof r!="function"&&!!r;a?t[s]=o:d&&(t[s]=i())}else{const o=r===void 0&&i!=null,a=typeof r=="function"&&!!r(i)||typeof r!="function"&&!!r;(o||a)&&(t[s]=i)}},Su=t=>t.toISOString().replace(".000Z","Z"),Jm=(t,e)=>lr(t,e).then(n=>e.utf8Encoder(n)),Eu=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",eg=Eu+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",tg="["+Eu+"]["+eg+"]*",ng=new RegExp("^"+tg+"$");function Cu(t,e){const n=[];let s=e.exec(t);for(;s;){const r=[];r.startIndex=e.lastIndex-s[0].length;const i=s.length;for(let o=0;o<i;o++)r.push(s[o]);n.push(r),s=e.exec(t)}return n}const pa=function(t){const e=ng.exec(t);return!(e===null||typeof e>"u")};function sg(t){return typeof t<"u"}const rg={allowBooleanAttributes:!1,unpairedTags:[]};function ig(t,e){e=Object.assign({},rg,e);const n=[];let s=!1,r=!1;t[0]==="\uFEFF"&&(t=t.substr(1));for(let i=0;i<t.length;i++)if(t[i]==="<"&&t[i+1]==="?"){if(i+=2,i=Ic(t,i),i.err)return i}else if(t[i]==="<"){let o=i;if(i++,t[i]==="!"){i=Lc(t,i);continue}else{let a=!1;t[i]==="/"&&(a=!0,i++);let d="";for(;i<t.length&&t[i]!==">"&&t[i]!==" "&&t[i]!=="	"&&t[i]!==`
`&&t[i]!=="\r";i++)d+=t[i];if(d=d.trim(),d[d.length-1]==="/"&&(d=d.substring(0,d.length-1),i--),!fg(d)){let u;return d.trim().length===0?u="Invalid space after '<'.":u="Tag '"+d+"' is an invalid name.",Ue("InvalidTag",u,bt(t,i))}const c=cg(t,i);if(c===!1)return Ue("InvalidAttr","Attributes for '"+d+"' have open quote.",bt(t,i));let l=c.value;if(i=c.index,l[l.length-1]==="/"){const u=i-l.length;l=l.substring(0,l.length-1);const h=Bc(l,e);if(h===!0)s=!0;else return Ue(h.err.code,h.err.msg,bt(t,u+h.err.line))}else if(a)if(c.tagClosed){if(l.trim().length>0)return Ue("InvalidTag","Closing tag '"+d+"' can't have attributes or invalid starting.",bt(t,o));if(n.length===0)return Ue("InvalidTag","Closing tag '"+d+"' has not been opened.",bt(t,o));{const u=n.pop();if(d!==u.tagName){let h=bt(t,u.tagStartPos);return Ue("InvalidTag","Expected closing tag '"+u.tagName+"' (opened in line "+h.line+", col "+h.col+") instead of closing tag '"+d+"'.",bt(t,o))}n.length==0&&(r=!0)}}else return Ue("InvalidTag","Closing tag '"+d+"' doesn't have proper closing.",bt(t,i));else{const u=Bc(l,e);if(u!==!0)return Ue(u.err.code,u.err.msg,bt(t,i-l.length+u.err.line));if(r===!0)return Ue("InvalidXml","Multiple possible root nodes found.",bt(t,i));e.unpairedTags.indexOf(d)!==-1||n.push({tagName:d,tagStartPos:o}),s=!0}for(i++;i<t.length;i++)if(t[i]==="<")if(t[i+1]==="!"){i++,i=Lc(t,i);continue}else if(t[i+1]==="?"){if(i=Ic(t,++i),i.err)return i}else break;else if(t[i]==="&"){const u=ug(t,i);if(u==-1)return Ue("InvalidChar","char '&' is not expected.",bt(t,i));i=u}else if(r===!0&&!Mc(t[i]))return Ue("InvalidXml","Extra text at the end",bt(t,i));t[i]==="<"&&i--}}else{if(Mc(t[i]))continue;return Ue("InvalidChar","char '"+t[i]+"' is not expected.",bt(t,i))}if(s){if(n.length==1)return Ue("InvalidTag","Unclosed tag '"+n[0].tagName+"'.",bt(t,n[0].tagStartPos));if(n.length>0)return Ue("InvalidXml","Invalid '"+JSON.stringify(n.map(i=>i.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return Ue("InvalidXml","Start tag expected.",1);return!0}function Mc(t){return t===" "||t==="	"||t===`
`||t==="\r"}function Ic(t,e){const n=e;for(;e<t.length;e++)if(t[e]=="?"||t[e]==" "){const s=t.substr(n,e-n);if(e>5&&s==="xml")return Ue("InvalidXml","XML declaration allowed only at the start of the document.",bt(t,e));if(t[e]=="?"&&t[e+1]==">"){e++;break}else continue}return e}function Lc(t,e){if(t.length>e+5&&t[e+1]==="-"&&t[e+2]==="-"){for(e+=3;e<t.length;e++)if(t[e]==="-"&&t[e+1]==="-"&&t[e+2]===">"){e+=2;break}}else if(t.length>e+8&&t[e+1]==="D"&&t[e+2]==="O"&&t[e+3]==="C"&&t[e+4]==="T"&&t[e+5]==="Y"&&t[e+6]==="P"&&t[e+7]==="E"){let n=1;for(e+=8;e<t.length;e++)if(t[e]==="<")n++;else if(t[e]===">"&&(n--,n===0))break}else if(t.length>e+9&&t[e+1]==="["&&t[e+2]==="C"&&t[e+3]==="D"&&t[e+4]==="A"&&t[e+5]==="T"&&t[e+6]==="A"&&t[e+7]==="["){for(e+=8;e<t.length;e++)if(t[e]==="]"&&t[e+1]==="]"&&t[e+2]===">"){e+=2;break}}return e}const og='"',ag="'";function cg(t,e){let n="",s="",r=!1;for(;e<t.length;e++){if(t[e]===og||t[e]===ag)s===""?s=t[e]:s!==t[e]||(s="");else if(t[e]===">"&&s===""){r=!0;break}n+=t[e]}return s!==""?!1:{value:n,index:e,tagClosed:r}}const dg=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function Bc(t,e){const n=Cu(t,dg),s={};for(let r=0;r<n.length;r++){if(n[r][1].length===0)return Ue("InvalidAttr","Attribute '"+n[r][2]+"' has no space in starting.",Os(n[r]));if(n[r][3]!==void 0&&n[r][4]===void 0)return Ue("InvalidAttr","Attribute '"+n[r][2]+"' is without value.",Os(n[r]));if(n[r][3]===void 0&&!e.allowBooleanAttributes)return Ue("InvalidAttr","boolean attribute '"+n[r][2]+"' is not allowed.",Os(n[r]));const i=n[r][2];if(!hg(i))return Ue("InvalidAttr","Attribute '"+i+"' is an invalid name.",Os(n[r]));if(!s.hasOwnProperty(i))s[i]=1;else return Ue("InvalidAttr","Attribute '"+i+"' is repeated.",Os(n[r]))}return!0}function lg(t,e){let n=/\d/;for(t[e]==="x"&&(e++,n=/[\da-fA-F]/);e<t.length;e++){if(t[e]===";")return e;if(!t[e].match(n))break}return-1}function ug(t,e){if(e++,t[e]===";")return-1;if(t[e]==="#")return e++,lg(t,e);let n=0;for(;e<t.length;e++,n++)if(!(t[e].match(/\w/)&&n<20)){if(t[e]===";")break;return-1}return e}function Ue(t,e,n){return{err:{code:t,msg:e,line:n.line||n,col:n.col}}}function hg(t){return pa(t)}function fg(t){return pa(t)}function bt(t,e){const n=t.substring(0,e).split(/\r?\n/);return{line:n.length,col:n[n.length-1].length+1}}function Os(t){return t.startIndex+t[1].length}const pg={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(t,e){return e},attributeValueProcessor:function(t,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(t,e,n){return t},captureMetaData:!1},mg=function(t){return Object.assign({},pg,t)};let Kr;typeof Symbol!="function"?Kr="@@xmlMetadata":Kr=Symbol("XML Node Metadata");let In=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,n){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:n})}addChild(e,n){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child}),n!==void 0&&(this.child[this.child.length-1][Kr]={startIndex:n})}static getMetaDataSymbol(){return Kr}};function gg(t,e){const n={};if(t[e+3]==="O"&&t[e+4]==="C"&&t[e+5]==="T"&&t[e+6]==="Y"&&t[e+7]==="P"&&t[e+8]==="E"){e=e+9;let s=1,r=!1,i=!1,o="";for(;e<t.length;e++)if(t[e]==="<"&&!i){if(r&&Ln(t,"!ENTITY",e)){e+=7;let a,d;[a,d,e]=yg(t,e+1),d.indexOf("&")===-1&&(n[a]={regx:RegExp(`&${a};`,"g"),val:d})}else if(r&&Ln(t,"!ELEMENT",e)){e+=8;const{index:a}=bg(t,e+1);e=a}else if(r&&Ln(t,"!ATTLIST",e))e+=8;else if(r&&Ln(t,"!NOTATION",e)){e+=9;const{index:a}=wg(t,e+1);e=a}else if(Ln(t,"!--",e))i=!0;else throw new Error("Invalid DOCTYPE");s++,o=""}else if(t[e]===">"){if(i?t[e-1]==="-"&&t[e-2]==="-"&&(i=!1,s--):s--,s===0)break}else t[e]==="["?r=!0:o+=t[e];if(s!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:n,i:e}}const wn=(t,e)=>{for(;e<t.length&&/\s/.test(t[e]);)e++;return e};function yg(t,e){e=wn(t,e);let n="";for(;e<t.length&&!/\s/.test(t[e])&&t[e]!=='"'&&t[e]!=="'";)n+=t[e],e++;if(ma(n),e=wn(t,e),t.substring(e,e+6).toUpperCase()==="SYSTEM")throw new Error("External entities are not supported");if(t[e]==="%")throw new Error("Parameter entities are not supported");let s="";return[e,s]=Or(t,e,"entity"),e--,[n,s,e]}function wg(t,e){e=wn(t,e);let n="";for(;e<t.length&&!/\s/.test(t[e]);)n+=t[e],e++;ma(n),e=wn(t,e);const s=t.substring(e,e+6).toUpperCase();if(s!=="SYSTEM"&&s!=="PUBLIC")throw new Error(`Expected SYSTEM or PUBLIC, found "${s}"`);e+=s.length,e=wn(t,e);let r=null,i=null;if(s==="PUBLIC")[e,r]=Or(t,e,"publicIdentifier"),e=wn(t,e),(t[e]==='"'||t[e]==="'")&&([e,i]=Or(t,e,"systemIdentifier"));else if(s==="SYSTEM"&&([e,i]=Or(t,e,"systemIdentifier"),!i))throw new Error("Missing mandatory system identifier for SYSTEM notation");return{notationName:n,publicIdentifier:r,systemIdentifier:i,index:--e}}function Or(t,e,n){let s="";const r=t[e];if(r!=='"'&&r!=="'")throw new Error(`Expected quoted string, found "${r}"`);for(e++;e<t.length&&t[e]!==r;)s+=t[e],e++;if(t[e]!==r)throw new Error(`Unterminated ${n} value`);return e++,[e,s]}function bg(t,e){e=wn(t,e);let n="";for(;e<t.length&&!/\s/.test(t[e]);)n+=t[e],e++;if(!ma(n))throw new Error(`Invalid element name: "${n}"`);e=wn(t,e);let s="";if(t[e]==="E"&&Ln(t,"MPTY",e))e+=4;else if(t[e]==="A"&&Ln(t,"NY",e))e+=2;else if(t[e]==="("){for(e++;e<t.length&&t[e]!==")";)s+=t[e],e++;if(t[e]!==")")throw new Error("Unterminated content model")}else throw new Error(`Invalid Element Expression, found "${t[e]}"`);return{elementName:n,contentModel:s.trim(),index:e}}function Ln(t,e,n){for(let s=0;s<e.length;s++)if(e[s]!==t[n+s+1])return!1;return!0}function ma(t){if(pa(t))return t;throw new Error(`Invalid entity name ${t}`)}const vg=/^[-+]?0x[a-fA-F0-9]+$/,xg=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,Sg={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function Eg(t,e={}){if(e=Object.assign({},Sg,e),!t||typeof t!="string")return t;let n=t.trim();if(e.skipLike!==void 0&&e.skipLike.test(n))return t;if(t==="0")return 0;if(e.hex&&vg.test(n))return Pg(n,16);if(n.search(/.+[eE].+/)!==-1)return Ag(t,n,e);{const s=xg.exec(n);if(s){const r=s[1]||"",i=s[2];let o=kg(s[3]);const a=r?t[i.length+1]===".":t[i.length]===".";if(!e.leadingZeros&&(i.length>1||i.length===1&&!a))return t;{const d=Number(n),c=String(d);if(d===0)return d;if(c.search(/[eE]/)!==-1)return e.eNotation?d:t;if(n.indexOf(".")!==-1)return c==="0"||c===o||c===`${r}${o}`?d:t;let l=i?o:n;return i?l===c||r+l===c?d:t:l===c||l===r+c?d:t}}else return t}}const Cg=/^([-+])?(0*)(\d*(\.\d*)?[eE][-\+]?\d+)$/;function Ag(t,e,n){if(!n.eNotation)return t;const s=e.match(Cg);if(s){let r=s[1]||"";const i=s[3].indexOf("e")===-1?"E":"e",o=s[2],a=r?t[o.length+1]===i:t[o.length]===i;return o.length>1&&a?t:o.length===1&&(s[3].startsWith(`.${i}`)||s[3][0]===i)?Number(e):n.leadingZeros&&!a?(e=(s[1]||"")+s[3],Number(e)):t}else return t}function kg(t){return t&&t.indexOf(".")!==-1&&(t=t.replace(/0+$/,""),t==="."?t="0":t[0]==="."?t="0"+t:t[t.length-1]==="."&&(t=t.substring(0,t.length-1))),t}function Pg(t,e){if(parseInt)return parseInt(t,e);if(Number.parseInt)return Number.parseInt(t,e);if(window&&window.parseInt)return window.parseInt(t,e);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}function _g(t){return typeof t=="function"?t:Array.isArray(t)?e=>{for(const n of t)if(typeof n=="string"&&e===n||n instanceof RegExp&&n.test(e))return!0}:()=>!1}class Tg{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(n,s)=>String.fromCodePoint(Number.parseInt(s,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(n,s)=>String.fromCodePoint(Number.parseInt(s,16))}},this.addExternalEntities=Rg,this.parseXml=Fg,this.parseTextData=Mg,this.resolveNameSpace=Ig,this.buildAttributesMap=Bg,this.isItStopNode=Ug,this.replaceEntitiesValue=Ng,this.readStopNodeData=$g,this.saveTextToParentTag=Og,this.addChild=Dg,this.ignoreAttributesFn=_g(this.options.ignoreAttributes)}}function Rg(t){const e=Object.keys(t);for(let n=0;n<e.length;n++){const s=e[n];this.lastEntities[s]={regex:new RegExp("&"+s+";","g"),val:t[s]}}}function Mg(t,e,n,s,r,i,o){if(t!==void 0&&(this.options.trimValues&&!s&&(t=t.trim()),t.length>0)){o||(t=this.replaceEntitiesValue(t));const a=this.options.tagValueProcessor(e,t,n,r,i);return a==null?t:typeof a!=typeof t||a!==t?a:this.options.trimValues?Bo(t,this.options.parseTagValue,this.options.numberParseOptions):t.trim()===t?Bo(t,this.options.parseTagValue,this.options.numberParseOptions):t}}function Ig(t){if(this.options.removeNSPrefix){const e=t.split(":"),n=t.charAt(0)==="/"?"/":"";if(e[0]==="xmlns")return"";e.length===2&&(t=n+e[1])}return t}const Lg=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function Bg(t,e,n){if(this.options.ignoreAttributes!==!0&&typeof t=="string"){const s=Cu(t,Lg),r=s.length,i={};for(let o=0;o<r;o++){const a=this.resolveNameSpace(s[o][1]);if(this.ignoreAttributesFn(a,e))continue;let d=s[o][4],c=this.options.attributeNamePrefix+a;if(a.length)if(this.options.transformAttributeName&&(c=this.options.transformAttributeName(c)),c==="__proto__"&&(c="#__proto__"),d!==void 0){this.options.trimValues&&(d=d.trim()),d=this.replaceEntitiesValue(d);const l=this.options.attributeValueProcessor(a,d,e);l==null?i[c]=d:typeof l!=typeof d||l!==d?i[c]=l:i[c]=Bo(d,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(i[c]=!0)}if(!Object.keys(i).length)return;if(this.options.attributesGroupName){const o={};return o[this.options.attributesGroupName]=i,o}return i}}const Fg=function(t){t=t.replace(/\r\n?/g,`
`);const e=new In("!xml");let n=e,s="",r="";for(let i=0;i<t.length;i++)if(t[i]==="<")if(t[i+1]==="/"){const a=Dn(t,">",i,"Closing Tag is not closed.");let d=t.substring(i+2,a).trim();if(this.options.removeNSPrefix){const u=d.indexOf(":");u!==-1&&(d=d.substr(u+1))}this.options.transformTagName&&(d=this.options.transformTagName(d)),n&&(s=this.saveTextToParentTag(s,n,r));const c=r.substring(r.lastIndexOf(".")+1);if(d&&this.options.unpairedTags.indexOf(d)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${d}>`);let l=0;c&&this.options.unpairedTags.indexOf(c)!==-1?(l=r.lastIndexOf(".",r.lastIndexOf(".")-1),this.tagsNodeStack.pop()):l=r.lastIndexOf("."),r=r.substring(0,l),n=this.tagsNodeStack.pop(),s="",i=a}else if(t[i+1]==="?"){let a=Lo(t,i,!1,"?>");if(!a)throw new Error("Pi Tag is not closed.");if(s=this.saveTextToParentTag(s,n,r),!(this.options.ignoreDeclaration&&a.tagName==="?xml"||this.options.ignorePiTags)){const d=new In(a.tagName);d.add(this.options.textNodeName,""),a.tagName!==a.tagExp&&a.attrExpPresent&&(d[":@"]=this.buildAttributesMap(a.tagExp,r,a.tagName)),this.addChild(n,d,r,i)}i=a.closeIndex+1}else if(t.substr(i+1,3)==="!--"){const a=Dn(t,"-->",i+4,"Comment is not closed.");if(this.options.commentPropName){const d=t.substring(i+4,a-2);s=this.saveTextToParentTag(s,n,r),n.add(this.options.commentPropName,[{[this.options.textNodeName]:d}])}i=a}else if(t.substr(i+1,2)==="!D"){const a=gg(t,i);this.docTypeEntities=a.entities,i=a.i}else if(t.substr(i+1,2)==="!["){const a=Dn(t,"]]>",i,"CDATA is not closed.")-2,d=t.substring(i+9,a);s=this.saveTextToParentTag(s,n,r);let c=this.parseTextData(d,n.tagname,r,!0,!1,!0,!0);c==null&&(c=""),this.options.cdataPropName?n.add(this.options.cdataPropName,[{[this.options.textNodeName]:d}]):n.add(this.options.textNodeName,c),i=a+2}else{let a=Lo(t,i,this.options.removeNSPrefix),d=a.tagName;const c=a.rawTagName;let l=a.tagExp,u=a.attrExpPresent,h=a.closeIndex;this.options.transformTagName&&(d=this.options.transformTagName(d)),n&&s&&n.tagname!=="!xml"&&(s=this.saveTextToParentTag(s,n,r,!1));const f=n;f&&this.options.unpairedTags.indexOf(f.tagname)!==-1&&(n=this.tagsNodeStack.pop(),r=r.substring(0,r.lastIndexOf("."))),d!==e.tagname&&(r+=r?"."+d:d);const y=i;if(this.isItStopNode(this.options.stopNodes,r,d)){let x="";if(l.length>0&&l.lastIndexOf("/")===l.length-1)d[d.length-1]==="/"?(d=d.substr(0,d.length-1),r=r.substr(0,r.length-1),l=d):l=l.substr(0,l.length-1),i=a.closeIndex;else if(this.options.unpairedTags.indexOf(d)!==-1)i=a.closeIndex;else{const _=this.readStopNodeData(t,c,h+1);if(!_)throw new Error(`Unexpected end of ${c}`);i=_.i,x=_.tagContent}const w=new In(d);d!==l&&u&&(w[":@"]=this.buildAttributesMap(l,r,d)),x&&(x=this.parseTextData(x,d,r,!0,u,!0,!0)),r=r.substr(0,r.lastIndexOf(".")),w.add(this.options.textNodeName,x),this.addChild(n,w,r,y)}else{if(l.length>0&&l.lastIndexOf("/")===l.length-1){d[d.length-1]==="/"?(d=d.substr(0,d.length-1),r=r.substr(0,r.length-1),l=d):l=l.substr(0,l.length-1),this.options.transformTagName&&(d=this.options.transformTagName(d));const x=new In(d);d!==l&&u&&(x[":@"]=this.buildAttributesMap(l,r,d)),this.addChild(n,x,r,y),r=r.substr(0,r.lastIndexOf("."))}else{const x=new In(d);this.tagsNodeStack.push(n),d!==l&&u&&(x[":@"]=this.buildAttributesMap(l,r,d)),this.addChild(n,x,r,y),n=x}s="",i=h}}else s+=t[i];return e.child};function Dg(t,e,n,s){this.options.captureMetaData||(s=void 0);const r=this.options.updateTag(e.tagname,n,e[":@"]);r===!1||(typeof r=="string"&&(e.tagname=r),t.addChild(e,s))}const Ng=function(t){if(this.options.processEntities){for(let e in this.docTypeEntities){const n=this.docTypeEntities[e];t=t.replace(n.regx,n.val)}for(let e in this.lastEntities){const n=this.lastEntities[e];t=t.replace(n.regex,n.val)}if(this.options.htmlEntities)for(let e in this.htmlEntities){const n=this.htmlEntities[e];t=t.replace(n.regex,n.val)}t=t.replace(this.ampEntity.regex,this.ampEntity.val)}return t};function Og(t,e,n,s){return t&&(s===void 0&&(s=e.child.length===0),t=this.parseTextData(t,e.tagname,n,!1,e[":@"]?Object.keys(e[":@"]).length!==0:!1,s),t!==void 0&&t!==""&&e.add(this.options.textNodeName,t),t=""),t}function Ug(t,e,n){const s="*."+n;for(const r in t){const i=t[r];if(s===i||e===i)return!0}return!1}function Qg(t,e,n=">"){let s,r="";for(let i=e;i<t.length;i++){let o=t[i];if(s)o===s&&(s="");else if(o==='"'||o==="'")s=o;else if(o===n[0])if(n[1]){if(t[i+1]===n[1])return{data:r,index:i}}else return{data:r,index:i};else o==="	"&&(o=" ");r+=o}}function Dn(t,e,n,s){const r=t.indexOf(e,n);if(r===-1)throw new Error(s);return r+e.length-1}function Lo(t,e,n,s=">"){const r=Qg(t,e+1,s);if(!r)return;let i=r.data;const o=r.index,a=i.search(/\s/);let d=i,c=!0;a!==-1&&(d=i.substring(0,a),i=i.substring(a+1).trimStart());const l=d;if(n){const u=d.indexOf(":");u!==-1&&(d=d.substr(u+1),c=d!==r.data.substr(u+1))}return{tagName:d,tagExp:i,closeIndex:o,attrExpPresent:c,rawTagName:l}}function $g(t,e,n){const s=n;let r=1;for(;n<t.length;n++)if(t[n]==="<")if(t[n+1]==="/"){const i=Dn(t,">",n,`${e} is not closed`);if(t.substring(n+2,i).trim()===e&&(r--,r===0))return{tagContent:t.substring(s,n),i};n=i}else if(t[n+1]==="?")n=Dn(t,"?>",n+1,"StopNode is not closed.");else if(t.substr(n+1,3)==="!--")n=Dn(t,"-->",n+3,"StopNode is not closed.");else if(t.substr(n+1,2)==="![")n=Dn(t,"]]>",n,"StopNode is not closed.")-2;else{const i=Lo(t,n,">");i&&((i&&i.tagName)===e&&i.tagExp[i.tagExp.length-1]!=="/"&&r++,n=i.closeIndex)}}function Bo(t,e,n){if(e&&typeof t=="string"){const s=t.trim();return s==="true"?!0:s==="false"?!1:Eg(t,n)}else return sg(t)?t:""}const Di=In.getMetaDataSymbol();function Hg(t,e){return Au(t,e)}function Au(t,e,n){let s;const r={};for(let i=0;i<t.length;i++){const o=t[i],a=zg(o);let d="";if(n===void 0?d=a:d=n+"."+a,a===e.textNodeName)s===void 0?s=o[a]:s+=""+o[a];else{if(a===void 0)continue;if(o[a]){let c=Au(o[a],e,d);const l=jg(c,e);o[Di]!==void 0&&(c[Di]=o[Di]),o[":@"]?qg(c,o[":@"],d,e):Object.keys(c).length===1&&c[e.textNodeName]!==void 0&&!e.alwaysCreateTextNode?c=c[e.textNodeName]:Object.keys(c).length===0&&(e.alwaysCreateTextNode?c[e.textNodeName]="":c=""),r[a]!==void 0&&r.hasOwnProperty(a)?(Array.isArray(r[a])||(r[a]=[r[a]]),r[a].push(c)):e.isArray(a,d,l)?r[a]=[c]:r[a]=c}}}return typeof s=="string"?s.length>0&&(r[e.textNodeName]=s):s!==void 0&&(r[e.textNodeName]=s),r}function zg(t){const e=Object.keys(t);for(let n=0;n<e.length;n++){const s=e[n];if(s!==":@")return s}}function qg(t,e,n,s){if(e){const r=Object.keys(e),i=r.length;for(let o=0;o<i;o++){const a=r[o];s.isArray(a,n+"."+a,!0,!0)?t[a]=[e[a]]:t[a]=e[a]}}}function jg(t,e){const{textNodeName:n}=e,s=Object.keys(t).length;return!!(s===0||s===1&&(t[n]||typeof t[n]=="boolean"||t[n]===0))}class Wg{constructor(e){this.externalEntities={},this.options=mg(e)}parse(e,n){if(typeof e!="string")if(e.toString)e=e.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(n){n===!0&&(n={});const i=ig(e,n);if(i!==!0)throw Error(`${i.err.msg}:${i.err.line}:${i.err.col}`)}const s=new Tg(this.options);s.addExternalEntities(this.externalEntities);const r=s.parseXml(e);return this.options.preserveOrder||r===void 0?r:Hg(r,this.options)}addEntity(e,n){if(n.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(e.indexOf("&")!==-1||e.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(n==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=n}static getMetaDataSymbol(){return In.getMetaDataSymbol()}}const fi=(t,e)=>Jm(t,e).then(n=>{if(n.length){const s=new Wg({attributeNamePrefix:"",htmlEntities:!0,ignoreAttributes:!1,ignoreDeclaration:!0,parseTagValue:!1,trimValues:!1,tagValueProcessor:(d,c)=>c.trim()===""&&c.includes(`
`)?"":void 0});s.addEntity("#xD","\r"),s.addEntity("#10",`
`);let r;try{r=s.parse(n,!0)}catch(d){throw d&&typeof d=="object"&&Object.defineProperty(d,"$responseBodyText",{value:n}),d}const i="#text",o=Object.keys(r)[0],a=r[o];return a[i]&&(a[o]=a[i],delete a[i]),xu(a)}return{}}),Vg=async(t,e)=>{const n=await fi(t,e);return n.Error&&(n.Error.message=n.Error.message??n.Error.Message),n},Kg=(t,e)=>{var n;if(((n=e==null?void 0:e.Error)==null?void 0:n.Code)!==void 0)return e.Error.Code;if((e==null?void 0:e.Code)!==void 0)return e.Code;if(t.statusCode==404)return"NotFound"};function Gg(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function Zg(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#x0D;").replace(/\n/g,"&#x0A;").replace(/\u0085/g,"&#x85;").replace(/\u2028/,"&#x2028;")}class Xg{constructor(e){g(this,"value");this.value=e}toString(){return Zg(""+this.value)}}class Kt{constructor(e,n=[]){g(this,"name");g(this,"children");g(this,"attributes",{});this.name=e,this.children=n}static of(e,n,s){const r=new Kt(e);return n!==void 0&&r.addChildNode(new Xg(n)),s!==void 0&&r.withName(s),r}withName(e){return this.name=e,this}addAttribute(e,n){return this.attributes[e]=n,this}addChildNode(e){return this.children.push(e),this}removeAttribute(e){return delete this.attributes[e],this}n(e){return this.name=e,this}c(e){return this.children.push(e),this}a(e,n){return n!=null&&(this.attributes[e]=n),this}cc(e,n,s=n){if(e[n]!=null){const r=Kt.of(n,e[n]).withName(s);this.c(r)}}l(e,n,s,r){e[n]!=null&&r().map(o=>{o.withName(s),this.c(o)})}lc(e,n,s,r){if(e[n]!=null){const i=r(),o=new Kt(s);i.map(a=>{o.c(a)}),this.c(o)}}toString(){const e=!!this.children.length;let n=`<${this.name}`;const s=this.attributes;for(const r of Object.keys(s)){const i=s[r];i!=null&&(n+=` ${r}="${Gg(""+i)}"`)}return n+=e?`>${this.children.map(r=>r.toString()).join("")}</${this.name}>`:"/>"}}const Fo=[ve.CRC32,ve.CRC32C,ve.CRC64NVME,ve.SHA1,ve.SHA256],Yg=[ve.SHA256,ve.SHA1,ve.CRC32,ve.CRC32C,ve.CRC64NVME],Jg=(t,{requestChecksumRequired:e,requestAlgorithmMember:n,requestChecksumCalculation:s})=>{if(!n)return s===xs.WHEN_SUPPORTED||e?Po:void 0;if(!t[n])return;const r=t[n];if(!Fo.includes(r))throw new Error(`The checksum algorithm "${r}" is not supported by the client. Select one of ${Fo}.`);return r},ga=t=>t===ve.MD5?"content-md5":`x-amz-checksum-${t.toLowerCase()}`,e2=(t,e)=>{const n=t.toLowerCase();for(const s of Object.keys(e))if(n===s.toLowerCase())return!0;return!1},t2=(t,e)=>{const n=t.toLowerCase();for(const s of Object.keys(e))if(s.toLowerCase().startsWith(n))return!0;return!1},ku=t=>t!==void 0&&typeof t!="string"&&!ArrayBuffer.isView(t)&&!bu(t),Pu=t=>new TextEncoder().encode(t);var n2=typeof Buffer<"u"&&Buffer.from?function(t){return Buffer.from(t,"utf8")}:Pu;function Sn(t){return t instanceof Uint8Array?t:typeof t=="string"?n2(t):ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(t)}function or(t){return typeof t=="string"?t.length===0:t.byteLength===0}function _u(t){return new Uint8Array([(t&4278190080)>>24,(t&16711680)>>16,(t&65280)>>8,t&255])}function Tu(t){if(!Uint32Array.from){for(var e=new Uint32Array(t.length),n=0;n<t.length;)e[n]=t[n],n+=1;return e}return Uint32Array.from(t)}var s2=function(){function t(){this.crc32c=new Fc}return t.prototype.update=function(e){or(e)||this.crc32c.update(Sn(e))},t.prototype.digest=function(){return ta(this,void 0,void 0,function(){return na(this,function(e){return[2,_u(this.crc32c.digest())]})})},t.prototype.reset=function(){this.crc32c=new Fc},t}(),Fc=function(){function t(){this.checksum=4294967295}return t.prototype.update=function(e){var n,s;try{for(var r=Wl(e),i=r.next();!i.done;i=r.next()){var o=i.value;this.checksum=this.checksum>>>8^i2[(this.checksum^o)&255]}}catch(a){n={error:a}}finally{try{i&&!i.done&&(s=r.return)&&s.call(r)}finally{if(n)throw n.error}}return this},t.prototype.digest=function(){return(this.checksum^4294967295)>>>0},t}(),r2=[0,4067132163,3778769143,324072436,3348797215,904991772,648144872,3570033899,2329499855,2024987596,1809983544,2575936315,1296289744,3207089363,2893594407,1578318884,274646895,3795141740,4049975192,51262619,3619967088,632279923,922689671,3298075524,2592579488,1760304291,2075979607,2312596564,1562183871,2943781820,3156637768,1313733451,549293790,3537243613,3246849577,871202090,3878099393,357341890,102525238,4101499445,2858735121,1477399826,1264559846,3107202533,1845379342,2677391885,2361733625,2125378298,820201905,3263744690,3520608582,598981189,4151959214,85089709,373468761,3827903834,3124367742,1213305469,1526817161,2842354314,2107672161,2412447074,2627466902,1861252501,1098587580,3004210879,2688576843,1378610760,2262928035,1955203488,1742404180,2511436119,3416409459,969524848,714683780,3639785095,205050476,4266873199,3976438427,526918040,1361435347,2739821008,2954799652,1114974503,2529119692,1691668175,2005155131,2247081528,3690758684,697762079,986182379,3366744552,476452099,3993867776,4250756596,255256311,1640403810,2477592673,2164122517,1922457750,2791048317,1412925310,1197962378,3037525897,3944729517,427051182,170179418,4165941337,746937522,3740196785,3451792453,1070968646,1905808397,2213795598,2426610938,1657317369,3053634322,1147748369,1463399397,2773627110,4215344322,153784257,444234805,3893493558,1021025245,3467647198,3722505002,797665321,2197175160,1889384571,1674398607,2443626636,1164749927,3070701412,2757221520,1446797203,137323447,4198817972,3910406976,461344835,3484808360,1037989803,781091935,3705997148,2460548119,1623424788,1939049696,2180517859,1429367560,2807687179,3020495871,1180866812,410100952,3927582683,4182430767,186734380,3756733383,763408580,1053836080,3434856499,2722870694,1344288421,1131464017,2971354706,1708204729,2545590714,2229949006,1988219213,680717673,3673779818,3383336350,1002577565,4010310262,493091189,238226049,4233660802,2987750089,1082061258,1395524158,2705686845,1972364758,2279892693,2494862625,1725896226,952904198,3399985413,3656866545,731699698,4283874585,222117402,510512622,3959836397,3280807620,837199303,582374963,3504198960,68661723,4135334616,3844915500,390545967,1230274059,3141532936,2825850620,1510247935,2395924756,2091215383,1878366691,2644384480,3553878443,565732008,854102364,3229815391,340358836,3861050807,4117890627,119113024,1493875044,2875275879,3090270611,1247431312,2660249211,1828433272,2141937292,2378227087,3811616794,291187481,34330861,4032846830,615137029,3603020806,3314634738,939183345,1776939221,2609017814,2295496738,2058945313,2926798794,1545135305,1330124605,3173225534,4084100981,17165430,307568514,3762199681,888469610,3332340585,3587147933,665062302,2042050490,2346497209,2559330125,1793573966,3190661285,1279665062,1595330642,2910671697],i2=Tu(r2),o2=function(){function t(){this.crc32=new Gr}return t.prototype.update=function(e){or(e)||this.crc32.update(Sn(e))},t.prototype.digest=function(){return ta(this,void 0,void 0,function(){return na(this,function(e){return[2,_u(this.crc32.digest())]})})},t.prototype.reset=function(){this.crc32=new Gr},t}(),Gr=function(){function t(){this.checksum=4294967295}return t.prototype.update=function(e){var n,s;try{for(var r=Wl(e),i=r.next();!i.done;i=r.next()){var o=i.value;this.checksum=this.checksum>>>8^c2[(this.checksum^o)&255]}}catch(a){n={error:a}}finally{try{i&&!i.done&&(s=r.return)&&s.call(r)}finally{if(n)throw n.error}}return this},t.prototype.digest=function(){return(this.checksum^4294967295)>>>0},t}(),a2=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],c2=Tu(a2);const d2=()=>o2,Ru=(t,e)=>{switch(t){case ve.MD5:return e.md5;case ve.CRC32:return d2();case ve.CRC32C:return s2;case ve.CRC64NVME:throw new Error(`Please check whether you have installed the "@aws-sdk/crc64-nvme-crt" package explicitly. 
You must also register the package by calling [require("@aws-sdk/crc64-nvme-crt");] or an ESM equivalent such as [import "@aws-sdk/crc64-nvme-crt";]. 
For more information please go to https://github.com/aws/aws-sdk-js-v3#functionality-requiring-aws-common-runtime-crt`);case ve.SHA1:return e.sha1;case ve.SHA256:return e.sha256;default:throw new Error(`Unsupported checksum algorithm: ${t}`)}},Mu=(t,e)=>{const n=new t;return n.update(Ss(e||"")),n.digest()},l2={name:"flexibleChecksumsMiddleware",step:"build",tags:["BODY_CHECKSUM"],override:!0},u2=(t,e)=>(n,s)=>async r=>{if(!Ge.isInstance(r.request)||t2("x-amz-checksum-",r.request.headers))return n(r);const{request:i,input:o}=r,{body:a,headers:d}=i,{base64Encoder:c,streamHasher:l}=t,{requestChecksumRequired:u,requestAlgorithmMember:h}=e,f=await t.requestChecksumCalculation(),y=h==null?void 0:h.name,x=h==null?void 0:h.httpHeader;y&&!o[y]&&(f===xs.WHEN_SUPPORTED||u)&&(o[y]=Po,x&&(d[x]=Po));const w=Jg(o,{requestChecksumRequired:u,requestAlgorithmMember:h==null?void 0:h.name,requestChecksumCalculation:f});let _=a,R=d;if(w){switch(w){case ve.CRC32:We(s,"FLEXIBLE_CHECKSUMS_REQ_CRC32","U");break;case ve.CRC32C:We(s,"FLEXIBLE_CHECKSUMS_REQ_CRC32C","V");break;case ve.CRC64NVME:We(s,"FLEXIBLE_CHECKSUMS_REQ_CRC64","W");break;case ve.SHA1:We(s,"FLEXIBLE_CHECKSUMS_REQ_SHA1","X");break;case ve.SHA256:We(s,"FLEXIBLE_CHECKSUMS_REQ_SHA256","Y");break}const k=ga(w),M=Ru(w,t);if(ku(a)){const{getAwsChunkedEncodingStream:$,bodyLengthChecker:I}=t;_=$(typeof t.requestStreamBufferSize=="number"&&t.requestStreamBufferSize>=8*1024?b1(a,t.requestStreamBufferSize,s.logger):a,{base64Encoder:c,bodyLengthChecker:I,checksumLocationName:k,checksumAlgorithmFn:M,streamHasher:l}),R={...d,"content-encoding":d["content-encoding"]?`${d["content-encoding"]},aws-chunked`:"aws-chunked","transfer-encoding":"chunked","x-amz-decoded-content-length":d["content-length"],"x-amz-content-sha256":"STREAMING-UNSIGNED-PAYLOAD-TRAILER","x-amz-trailer":k},delete R["content-length"]}else if(!e2(k,d)){const $=await Mu(M,a);R={...d,[k]:c($)}}}return await n({...r,request:{...i,headers:R,body:_}})},h2={name:"flexibleChecksumsInputMiddleware",toMiddleware:"serializerMiddleware",relation:"before",tags:["BODY_CHECKSUM"],override:!0},f2=(t,e)=>(n,s)=>async r=>{const i=r.input,{requestValidationModeMember:o}=e,a=await t.requestChecksumCalculation(),d=await t.responseChecksumValidation();switch(a){case xs.WHEN_REQUIRED:We(s,"FLEXIBLE_CHECKSUMS_REQ_WHEN_REQUIRED","a");break;case xs.WHEN_SUPPORTED:We(s,"FLEXIBLE_CHECKSUMS_REQ_WHEN_SUPPORTED","Z");break}switch(d){case Pi.WHEN_REQUIRED:We(s,"FLEXIBLE_CHECKSUMS_RES_WHEN_REQUIRED","c");break;case Pi.WHEN_SUPPORTED:We(s,"FLEXIBLE_CHECKSUMS_RES_WHEN_SUPPORTED","b");break}return o&&!i[o]&&d===Pi.WHEN_SUPPORTED&&(i[o]="ENABLED"),n(r)},Iu=(t=[])=>{const e=[];for(const n of Yg)!t.includes(n)||!Fo.includes(n)||e.push(n);return e},p2=t=>{const e=t.lastIndexOf("-");if(e!==-1){const n=t.slice(e+1);if(!n.startsWith("0")){const s=parseInt(n,10);if(!isNaN(s)&&s>=1&&s<=1e4)return!0}}return!1},m2=async(t,{checksumAlgorithmFn:e,base64Encoder:n})=>n(await Mu(e,t)),g2=async(t,{config:e,responseAlgorithms:n,logger:s})=>{const r=Iu(n),{body:i,headers:o}=t;for(const a of r){const d=ga(a),c=o[d];if(c){let l;try{l=Ru(a,e)}catch(f){if(a===ve.CRC64NVME){s==null||s.warn(`Skipping ${ve.CRC64NVME} checksum validation: ${f.message}`);continue}throw f}const{base64Encoder:u}=e;if(ku(i)){t.body=g1({expectedChecksum:c,checksumSourceLocation:d,checksum:new l,source:i,base64Encoder:u});return}const h=await m2(i,{checksumAlgorithmFn:l,base64Encoder:u});if(h===c)break;throw new Error(`Checksum mismatch: expected "${h}" but received "${c}" in response header "${d}".`)}}},y2={name:"flexibleChecksumsResponseMiddleware",toMiddleware:"deserializerMiddleware",relation:"after",tags:["BODY_CHECKSUM"],override:!0},w2=(t,e)=>(n,s)=>async r=>{if(!Ge.isInstance(r.request))return n(r);const i=r.input,o=await n(r),a=o.response,{requestValidationModeMember:d,responseAlgorithms:c}=e;if(d&&i[d]==="ENABLED"){const{clientName:l,commandName:u}=s;if(l==="S3Client"&&u==="GetObjectCommand"&&Iu(c).every(f=>{const y=ga(f),x=a.headers[y];return!x||p2(x)}))return o;await g2(a,{config:t,responseAlgorithms:c,logger:s.logger})}return o},ya=(t,e)=>({applyToStack:n=>{n.add(u2(t,e),l2),n.addRelativeTo(f2(t,e),h2),n.addRelativeTo(w2(t,e),y2)}}),b2=t=>{const{requestChecksumCalculation:e,responseChecksumValidation:n,requestStreamBufferSize:s}=t;return Object.assign(t,{requestChecksumCalculation:$t(e??Kp),responseChecksumValidation:$t(n??Gp),requestStreamBufferSize:Number(s??0)})};const v2=t=>e=>async n=>{if(!Ge.isInstance(n.request))return e(n);const{request:s}=n,{handlerProtocol:r=""}=t.requestHandler.metadata||{};if(r.indexOf("h2")>=0&&!s.headers[":authority"])delete s.headers.host,s.headers[":authority"]=s.hostname+(s.port?":"+s.port:"");else if(!s.headers.host){let i=s.hostname;s.port!=null&&(i+=`:${s.port}`),s.headers.host=i}return e(n)},x2={name:"hostHeaderMiddleware",step:"build",priority:"low",tags:["HOST"],override:!0},S2=t=>({applyToStack:e=>{e.add(v2(t),x2)}}),E2=()=>(t,e)=>async n=>{var s,r;try{const i=await t(n),{clientName:o,commandName:a,logger:d,dynamoDbDocumentClientOptions:c={}}=e,{overrideInputFilterSensitiveLog:l,overrideOutputFilterSensitiveLog:u}=c,h=l??e.inputFilterSensitiveLog,f=u??e.outputFilterSensitiveLog,{$metadata:y,...x}=i.output;return(s=d==null?void 0:d.info)==null||s.call(d,{clientName:o,commandName:a,input:h(n.input),output:f(x),metadata:y}),i}catch(i){const{clientName:o,commandName:a,logger:d,dynamoDbDocumentClientOptions:c={}}=e,{overrideInputFilterSensitiveLog:l}=c,u=l??e.inputFilterSensitiveLog;throw(r=d==null?void 0:d.error)==null||r.call(d,{clientName:o,commandName:a,input:u(n.input),error:i,metadata:i.$metadata}),i}},C2={name:"loggerMiddleware",tags:["LOGGER"],step:"initialize",override:!0},A2=t=>({applyToStack:e=>{e.add(E2(),C2)}});var Dc={};const Ni="X-Amzn-Trace-Id",k2="AWS_LAMBDA_FUNCTION_NAME",P2="_X_AMZN_TRACE_ID",_2=t=>e=>async n=>{const{request:s}=n;if(!Ge.isInstance(s)||t.runtime!=="node")return e(n);const r=Object.keys(s.headers??{}).find(d=>d.toLowerCase()===Ni.toLowerCase())??Ni;if(s.headers.hasOwnProperty(r))return e(n);const i=Dc[k2],o=Dc[P2],a=d=>typeof d=="string"&&d.length>0;return a(i)&&a(o)&&(s.headers[Ni]=o),e({...n,request:s})},T2={step:"build",tags:["RECURSION_DETECTION"],name:"recursionDetectionMiddleware",override:!0,priority:"low"},R2=t=>({applyToStack:e=>{e.add(_2(t),T2)}}),M2="content-length",I2="x-amz-decoded-content-length";function L2(){return(t,e)=>async n=>{var r;const{request:s}=n;if(Ge.isInstance(s)&&!(M2 in s.headers)&&!(I2 in s.headers)){const i="Are you using a Stream of unknown length as the Body of a PutObject request? Consider using Upload instead from @aws-sdk/lib-storage.";typeof((r=e==null?void 0:e.logger)==null?void 0:r.warn)=="function"&&!(e.logger instanceof fa)?e.logger.warn(i):console.warn(i)}return t({...n})}}const B2={step:"finalizeRequest",tags:["CHECK_CONTENT_LENGTH_HEADER"],name:"getCheckContentLengthHeaderPlugin",override:!0},F2=t=>({applyToStack:e=>{e.add(L2(),B2)}}),D2=t=>(e,n)=>async s=>{const r=await t.region(),i=t.region;let o=()=>{};n.__s3RegionRedirect&&(Object.defineProperty(t,"region",{writable:!1,value:async()=>n.__s3RegionRedirect}),o=()=>Object.defineProperty(t,"region",{writable:!0,value:i}));try{const a=await e(s);if(n.__s3RegionRedirect){o();const d=await t.region();if(r!==d)throw new Error("Region was not restored following S3 region redirect.")}return a}catch(a){throw o(),a}},N2={tags:["REGION_REDIRECT","S3"],name:"regionRedirectEndpointMiddleware",override:!0,relation:"before",toMiddleware:"endpointV2Middleware"};function O2(t){return(e,n)=>async s=>{var r,i,o;try{return await e(s)}catch(a){if(t.followRegionRedirects&&(((r=a==null?void 0:a.$metadata)==null?void 0:r.httpStatusCode)===301||((i=a==null?void 0:a.$metadata)==null?void 0:i.httpStatusCode)===400&&(a==null?void 0:a.name)==="IllegalLocationConstraintException")){try{const d=a.$response.headers["x-amz-bucket-region"];(o=n.logger)==null||o.debug(`Redirecting from ${await t.region()} to ${d}`),n.__s3RegionRedirect=d}catch(d){throw new Error("Region redirect failed: "+d)}return e(s)}throw a}}}const U2={step:"initialize",tags:["REGION_REDIRECT","S3"],name:"regionRedirectMiddleware",override:!0},Q2=t=>({applyToStack:e=>{e.add(O2(t),U2),e.addRelativeTo(D2(t),N2)}}),ci=class ci{constructor(e={}){g(this,"data");g(this,"lastPurgeTime",Date.now());this.data=e}get(e){const n=this.data[e];if(n)return n}set(e,n){return this.data[e]=n,n}delete(e){delete this.data[e]}async purgeExpired(){const e=Date.now();if(!(this.lastPurgeTime+ci.EXPIRED_CREDENTIAL_PURGE_INTERVAL_MS>e))for(const n in this.data){const s=this.data[n];if(!s.isRefreshing){const r=await s.identity;r.expiration&&r.expiration.getTime()<e&&delete this.data[n]}}}};g(ci,"EXPIRED_CREDENTIAL_PURGE_INTERVAL_MS",3e4);let Do=ci;class Oi{constructor(e,n=!1,s=Date.now()){g(this,"_identity");g(this,"isRefreshing");g(this,"accessed");this._identity=e,this.isRefreshing=n,this.accessed=s}get identity(){return this.accessed=Date.now(),this._identity}}const di=class di{constructor(e,n=new Do){g(this,"createSessionFn");g(this,"cache");this.createSessionFn=e,this.cache=n}async getS3ExpressIdentity(e,n){const s=n.Bucket,{cache:r}=this,i=r.get(s);return i?i.identity.then(o=>{var c,l;return(((c=o.expiration)==null?void 0:c.getTime())??0)<Date.now()?r.set(s,new Oi(this.getIdentity(s))).identity:((((l=o.expiration)==null?void 0:l.getTime())??0)<Date.now()+di.REFRESH_WINDOW_MS&&!i.isRefreshing&&(i.isRefreshing=!0,this.getIdentity(s).then(u=>{r.set(s,new Oi(Promise.resolve(u)))})),o)}):r.set(s,new Oi(this.getIdentity(s))).identity}async getIdentity(e){var r,i;await this.cache.purgeExpired().catch(o=>{console.warn(`Error while clearing expired entries in S3ExpressIdentityCache: 
`+o)});const n=await this.createSessionFn(e);if(!((r=n.Credentials)!=null&&r.AccessKeyId)||!((i=n.Credentials)!=null&&i.SecretAccessKey))throw new Error("s3#createSession response credential missing AccessKeyId or SecretAccessKey.");return{accessKeyId:n.Credentials.AccessKeyId,secretAccessKey:n.Credentials.SecretAccessKey,sessionToken:n.Credentials.SessionToken,expiration:n.Credentials.Expiration?new Date(n.Credentials.Expiration):void 0}}};g(di,"REFRESH_WINDOW_MS",6e4);let No=di;var Nc;(function(t){t.ENV="env",t.CONFIG="shared config entry"})(Nc||(Nc={}));const $2="Directory",H2="S3Express",z2="sigv4-s3express",Oo="X-Amz-S3session-Token",Uo=Oo.toLowerCase();class q2 extends Io{async signWithCredentials(e,n,s){const r=Oc(n);e.headers[Uo]=n.sessionToken;const i=this;return Uc(i,r),i.signRequest(e,s??{})}async presignWithCredentials(e,n,s){const r=Oc(n);return delete e.headers[Uo],e.headers[Oo]=n.sessionToken,e.query=e.query??{},e.query[Oo]=n.sessionToken,Uc(this,r),this.presign(e,s)}}function Oc(t){return{accessKeyId:t.accessKeyId,secretAccessKey:t.secretAccessKey,expiration:t.expiration}}function Uc(t,e){const n=setTimeout(()=>{throw new Error("SignatureV4S3Express credential override was created but not called.")},10),s=t.credentialProvider,r=()=>(clearTimeout(n),t.credentialProvider=s,Promise.resolve(e));t.credentialProvider=r}const j2=t=>(e,n)=>async s=>{var r,i,o,a,d;if(n.endpointV2){const c=n.endpointV2,l=((o=(i=(r=c.properties)==null?void 0:r.authSchemes)==null?void 0:i[0])==null?void 0:o.name)===z2;if((((a=c.properties)==null?void 0:a.backend)===H2||((d=c.properties)==null?void 0:d.bucketType)===$2)&&(We(n,"S3_EXPRESS_BUCKET","J"),n.isS3ExpressBucket=!0),l){const h=s.input.Bucket;if(h){const f=await t.s3ExpressIdentityProvider.getS3ExpressIdentity(await t.credentials(),{Bucket:h});n.s3ExpressIdentity=f,Ge.isInstance(s.request)&&f.sessionToken&&(s.request.headers[Uo]=f.sessionToken)}}}return e(s)},W2={name:"s3ExpressMiddleware",step:"build",tags:["S3","S3_EXPRESS"],override:!0},V2=t=>({applyToStack:e=>{e.add(j2(t),W2)}}),K2=async(t,e,n,s)=>{const r=await s.signWithCredentials(n,t,{});if(r.headers["X-Amz-Security-Token"]||r.headers["x-amz-security-token"])throw new Error("X-Amz-Security-Token must not be set for s3-express requests.");return r},G2=t=>e=>{throw e},Z2=(t,e)=>{},X2=t=>(e,n)=>async s=>{if(!Ge.isInstance(s.request))return e(s);const i=_s(n).selectedHttpAuthScheme;if(!i)throw new Error("No HttpAuthScheme was selected: unable to sign request");const{httpAuthOption:{signingProperties:o={}},identity:a,signer:d}=i;let c;n.s3ExpressIdentity?c=await K2(n.s3ExpressIdentity,o,s.request,await t.signer()):c=await d.sign(s.request,a,o);const l=await e({...s,request:c}).catch((d.errorHandler||G2)(o));return(d.successHandler||Z2)(l.response,o),l},Y2=t=>({applyToStack:e=>{e.addRelativeTo(X2(t),iu)}}),J2=(t,{session:e})=>{const[n,s]=e,{forcePathStyle:r,useAccelerateEndpoint:i,disableMultiregionAccessPoints:o,followRegionRedirects:a,s3ExpressIdentityProvider:d,bucketEndpoint:c}=t;return Object.assign(t,{forcePathStyle:r??!1,useAccelerateEndpoint:i??!1,disableMultiregionAccessPoints:o??!1,followRegionRedirects:a??!1,s3ExpressIdentityProvider:d??new No(async l=>n().send(new s({Bucket:l}))),bucketEndpoint:c??!1})},e9={CopyObjectCommand:!0,UploadPartCopyCommand:!0,CompleteMultipartUploadCommand:!0},t9=3e3,n9=t=>(e,n)=>async s=>{const r=await e(s),{response:i}=r;if(!vs.isInstance(i))return r;const{statusCode:o,body:a}=i;if(o<200||o>=300||!(typeof(a==null?void 0:a.stream)=="function"||typeof(a==null?void 0:a.pipe)=="function"||typeof(a==null?void 0:a.tee)=="function"))return r;let c=a,l=a;a&&typeof a=="object"&&!(a instanceof Uint8Array)&&([c,l]=await M1(a)),i.body=l;const u=await s9(c,{streamCollector:async f=>E1(f,t9)});typeof(c==null?void 0:c.destroy)=="function"&&c.destroy();const h=t.utf8Encoder(u.subarray(u.length-16));if(u.length===0&&e9[n.commandName]){const f=new Error("S3 aborted request");throw f.name="InternalError",f}return h&&h.endsWith("</Error>")&&(i.statusCode=400),r},s9=(t=new Uint8Array,e)=>t instanceof Uint8Array?Promise.resolve(t):e.streamCollector(t)||Promise.resolve(new Uint8Array),r9={relation:"after",toMiddleware:"deserializerMiddleware",tags:["THROW_200_EXCEPTIONS","S3"],name:"throw200ExceptionsMiddleware",override:!0},jn=t=>({applyToStack:e=>{e.addRelativeTo(n9(t),r9)}}),i9=t=>typeof t=="string"&&t.indexOf("arn:")===0&&t.split(":").length>=6;function o9(t){return(e,n)=>async s=>{var r,i,o,a;if(t.bucketEndpoint){const d=n.endpointV2;if(d){const c=s.input.Bucket;if(typeof c=="string")try{const l=new URL(c);n.endpointV2={...d,url:l}}catch(l){const u=`@aws-sdk/middleware-sdk-s3: bucketEndpoint=true was set but Bucket=${c} could not be parsed as URL.`;throw((i=(r=n.logger)==null?void 0:r.constructor)==null?void 0:i.name)==="NoOpLogger"?console.warn(u):(a=(o=n.logger)==null?void 0:o.warn)==null||a.call(o,u),l}}}return e(s)}}const a9={name:"bucketEndpointMiddleware",override:!0,relation:"after",toMiddleware:"endpointV2Middleware"};function c9({bucketEndpoint:t}){return e=>async n=>{const{input:{Bucket:s}}=n;if(!t&&typeof s=="string"&&!i9(s)&&s.indexOf("/")>=0){const r=new Error(`Bucket name shouldn't contain '/', received '${s}'`);throw r.name="InvalidBucketName",r}return e({...n})}}const d9={step:"initialize",tags:["VALIDATE_BUCKET_NAME"],name:"validateBucketNameMiddleware",override:!0},l9=t=>({applyToStack:e=>{e.add(c9(t),d9),e.addRelativeTo(o9(t),a9)}}),u9=void 0;function h9(t){return t===void 0?!0:typeof t=="string"&&t.length<=50}function f9(t){const e=ps(t.userAgentAppId??u9),{customUserAgent:n}=t;return Object.assign(t,{customUserAgent:typeof n=="string"?[[n]]:n,userAgentAppId:async()=>{var r,i;const s=await e();if(!h9(s)){const o=((i=(r=t.logger)==null?void 0:r.constructor)==null?void 0:i.name)==="NoOpLogger"||!t.logger?console:t.logger;typeof s!="string"?o==null||o.warn("userAgentAppId must be a string or undefined."):s.length>50&&(o==null||o.warn("The provided userAgentAppId exceeds the maximum length of 50 characters."))}return s}})}const Lu={isVirtualHostableS3Bucket:B0,parseArn:L0,partition:I0};Vl.aws=Lu;function p9(t){const e={};if(t=t.replace(/^\?/,""),t)for(const n of t.split("&")){let[s,r=null]=n.split("=");s=decodeURIComponent(s),r&&(r=decodeURIComponent(r)),s in e?Array.isArray(e[s])?e[s].push(r):e[s]=[e[s],r]:e[s]=r}return e}const Zr=t=>{if(typeof t=="string")return Zr(new URL(t));const{hostname:e,pathname:n,port:s,protocol:r,search:i}=t;let o;return i&&(o=p9(i)),{hostname:e,port:s?parseInt(s):void 0,protocol:r,path:n,query:o}},m9=/\d{12}\.ddb/;async function g9(t,e,n){var i,o,a,d,c,l,u;const s=n.request;if(((i=s==null?void 0:s.headers)==null?void 0:i["smithy-protocol"])==="rpc-v2-cbor"&&We(t,"PROTOCOL_RPC_V2_CBOR","M"),typeof e.retryStrategy=="function"){const h=await e.retryStrategy();typeof h.acquireInitialRetryToken=="function"?(a=(o=h.constructor)==null?void 0:o.name)!=null&&a.includes("Adaptive")?We(t,"RETRY_MODE_ADAPTIVE","F"):We(t,"RETRY_MODE_STANDARD","E"):We(t,"RETRY_MODE_LEGACY","D")}if(typeof e.accountIdEndpointMode=="function"){const h=t.endpointV2;switch(String((d=h==null?void 0:h.url)==null?void 0:d.hostname).match(m9)&&We(t,"ACCOUNT_ID_ENDPOINT","O"),await((c=e.accountIdEndpointMode)==null?void 0:c.call(e))){case"disabled":We(t,"ACCOUNT_ID_MODE_DISABLED","Q");break;case"preferred":We(t,"ACCOUNT_ID_MODE_PREFERRED","P");break;case"required":We(t,"ACCOUNT_ID_MODE_REQUIRED","R");break}}const r=(u=(l=t.__smithy_context)==null?void 0:l.selectedHttpAuthScheme)==null?void 0:u.identity;if(r!=null&&r.$source){const h=r;h.accountId&&We(t,"RESOLVED_ACCOUNT_ID","T");for(const[f,y]of Object.entries(h.$source??{}))We(t,f,y)}}const Qc="user-agent",Ui="x-amz-user-agent",$c=" ",Qi="/",y9=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w]/g,w9=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w\#]/g,Hc="-",b9=1024;function v9(t){let e="";for(const n in t){const s=t[n];if(e.length+s.length+1<=b9){e.length?e+=","+s:e+=s;continue}break}return e}const x9=t=>(e,n)=>async s=>{var f,y,x,w;const{request:r}=s;if(!Ge.isInstance(r))return e(s);const{headers:i}=r,o=((f=n==null?void 0:n.userAgent)==null?void 0:f.map(Tr))||[],a=(await t.defaultUserAgentProvider()).map(Tr);await g9(n,t,s);const d=n;a.push(`m/${v9(Object.assign({},(y=n.__smithy_context)==null?void 0:y.features,(x=d.__aws_sdk_context)==null?void 0:x.features))}`);const c=((w=t==null?void 0:t.customUserAgent)==null?void 0:w.map(Tr))||[],l=await t.userAgentAppId();l&&a.push(Tr([`app/${l}`]));const u=[].concat([...a,...o,...c]).join($c),h=[...a.filter(_=>_.startsWith("aws-sdk-")),...c].join($c);return t.runtime!=="browser"?(h&&(i[Ui]=i[Ui]?`${i[Qc]} ${h}`:h),i[Qc]=u):i[Ui]=u,e({...s,request:r})},Tr=t=>{var o;const e=t[0].split(Qi).map(a=>a.replace(y9,Hc)).join(Qi),n=(o=t[1])==null?void 0:o.replace(w9,Hc),s=e.indexOf(Qi),r=e.substring(0,s);let i=e.substring(s+1);return r==="api"&&(i=i.toLowerCase()),[r,i,n].filter(a=>a&&a.length>0).reduce((a,d,c)=>{switch(c){case 0:return d;case 1:return`${a}/${d}`;default:return`${a}#${d}`}},"")},S9={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0},E9=t=>({applyToStack:e=>{e.add(x9(t),S9)}}),C9=!1,A9=!1,Bu=t=>typeof t=="string"&&(t.startsWith("fips-")||t.endsWith("-fips")),zc=t=>Bu(t)?["fips-aws-global","aws-fips"].includes(t)?"us-east-1":t.replace(/fips-(dkr-|prod-)?|-fips/,""):t,k9=t=>{const{region:e,useFipsEndpoint:n}=t;if(!e)throw new Error("Region is missing");return Object.assign(t,{region:async()=>{if(typeof e=="string")return zc(e);const s=await e();return zc(s)},useFipsEndpoint:async()=>{const s=typeof e=="string"?e:await e();return Bu(s)?!0:typeof n!="function"?Promise.resolve(!!n):n()}})},P9=t=>Object.assign(t,{eventStreamMarshaller:t.eventStreamSerdeProvider(t)}),qc="content-length";function _9(t){return e=>async n=>{const s=n.request;if(Ge.isInstance(s)){const{body:r,headers:i}=s;if(r&&Object.keys(i).map(o=>o.toLowerCase()).indexOf(qc)===-1)try{const o=t(r);s.headers={...s.headers,[qc]:String(o)}}catch{}}return e({...n,request:s})}}const T9={step:"build",tags:["SET_CONTENT_LENGTH","CONTENT_LENGTH"],name:"contentLengthMiddleware",override:!0},R9=t=>({applyToStack:e=>{e.add(_9(t.bodyLengthChecker),T9)}}),M9=async t=>{const e=(t==null?void 0:t.Bucket)||"";if(typeof t.Bucket=="string"&&(t.Bucket=e.replace(/#/g,encodeURIComponent("#")).replace(/\?/g,encodeURIComponent("?"))),D9(e)){if(t.ForcePathStyle===!0)throw new Error("Path-style addressing cannot be used with ARN buckets")}else(!F9(e)||e.indexOf(".")!==-1&&!String(t.Endpoint).startsWith("http:")||e.toLowerCase()!==e||e.length<3)&&(t.ForcePathStyle=!0);return t.DisableMultiRegionAccessPoints&&(t.disableMultiRegionAccessPoints=!0,t.DisableMRAP=!0),t},I9=/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/,L9=/(\d+\.){3}\d+/,B9=/\.\./,F9=t=>I9.test(t)&&!L9.test(t)&&!B9.test(t),D9=t=>{const[e,n,s,,,r]=t.split(":"),i=e==="arn"&&t.split(":").length>=6,o=!!(i&&n&&s&&r);if(i&&!o)throw new Error(`Invalid ARN: ${t} was an invalid ARN.`);return o},N9=(t,e,n)=>{const s=async()=>{const r=n[t]??n[e];return typeof r=="function"?r():r};return t==="credentialScope"||e==="CredentialScope"?async()=>{const r=typeof n.credentials=="function"?await n.credentials():n.credentials;return(r==null?void 0:r.credentialScope)??(r==null?void 0:r.CredentialScope)}:t==="accountId"||e==="AccountId"?async()=>{const r=typeof n.credentials=="function"?await n.credentials():n.credentials;return(r==null?void 0:r.accountId)??(r==null?void 0:r.AccountId)}:t==="endpoint"||e==="endpoint"?async()=>{if(n.isCustomEndpoint===!1)return;const r=await s();if(r&&typeof r=="object"){if("url"in r)return r.url.href;if("hostname"in r){const{protocol:i,hostname:o,port:a,path:d}=r;return`${i}//${o}${a?":"+a:""}${d}`}}return r}:s},Fu=async t=>{},wa=t=>typeof t=="object"?"url"in t?Zr(t.url):t:Zr(t),Du=async(t,e,n,s)=>{if(!n.isCustomEndpoint){let o;n.serviceConfiguredEndpoint?o=await n.serviceConfiguredEndpoint():o=await Fu(n.serviceId),o&&(n.endpoint=()=>Promise.resolve(wa(o)),n.isCustomEndpoint=!0)}const r=await Nu(t,e,n);if(typeof n.endpointProvider!="function")throw new Error("config.endpointProvider is not set.");return n.endpointProvider(r,s)},Nu=async(t,e,n)=>{var i;const s={},r=((i=e==null?void 0:e.getEndpointParameterInstructions)==null?void 0:i.call(e))||{};for(const[o,a]of Object.entries(r))switch(a.type){case"staticContextParams":s[o]=a.value;break;case"contextParams":s[o]=t[a.name];break;case"clientContextParams":case"builtInParams":s[o]=await N9(a.name,o,n)();break;case"operationContextParams":s[o]=a.get(t);break;default:throw new Error("Unrecognized endpoint parameter instruction: "+JSON.stringify(a))}return Object.keys(r).length===0&&Object.assign(s,n),String(n.serviceId).toLowerCase()==="s3"&&await M9(s),s},O9=({config:t,instructions:e})=>(n,s)=>async r=>{var a,d,c;t.isCustomEndpoint&&nm(s,"ENDPOINT_OVERRIDE","N");const i=await Du(r.input,{getEndpointParameterInstructions(){return e}},{...t},s);s.endpointV2=i,s.authSchemes=(a=i.properties)==null?void 0:a.authSchemes;const o=(d=s.authSchemes)==null?void 0:d[0];if(o){s.signing_region=o.signingRegion,s.signing_service=o.signingName;const l=_s(s),u=(c=l==null?void 0:l.selectedHttpAuthScheme)==null?void 0:c.httpAuthOption;u&&(u.signingProperties=Object.assign(u.signingProperties||{},{signing_region:o.signingRegion,signingRegion:o.signingRegion,signing_service:o.signingName,signingName:o.signingName,signingRegionSet:o.signingRegionSet},o.properties))}return n({...r})},U9={step:"serialize",tags:["ENDPOINT_PARAMETERS","ENDPOINT_V2","ENDPOINT"],name:"endpointV2Middleware",override:!0,relation:"before",toMiddleware:ru.name},Wn=(t,e)=>({applyToStack:n=>{n.addRelativeTo(O9({config:t,instructions:e}),U9)}}),Q9=t=>{const e=t.tls??!0,{endpoint:n,useDualstackEndpoint:s,useFipsEndpoint:r}=t,i=n!=null?async()=>wa(await $t(n)()):void 0,a=Object.assign(t,{endpoint:i,tls:e,isCustomEndpoint:!!n,useDualstackEndpoint:$t(s??!1),useFipsEndpoint:$t(r??!1)});let d;return a.serviceConfiguredEndpoint=async()=>(t.serviceId&&!d&&(d=Fu(t.serviceId)),d),a};var Es;(function(t){t.STANDARD="standard",t.ADAPTIVE="adaptive"})(Es||(Es={}));const Xr=3,$9=Es.STANDARD,H9=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],z9=["TimeoutError","RequestTimeout","RequestTimeoutException"],q9=[500,502,503,504],j9=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],W9=["EHOSTUNREACH","ENETUNREACH","ENOTFOUND"],V9=t=>{var e;return(e=t.$metadata)==null?void 0:e.clockSkewCorrected},K9=t=>{const e=new Set(["Failed to fetch","NetworkError when attempting to fetch resource","The Internet connection appears to be offline","Load failed","Network request failed"]);return t&&t instanceof TypeError?e.has(t.message):!1},Ou=t=>{var e,n;return((e=t.$metadata)==null?void 0:e.httpStatusCode)===429||H9.includes(t.name)||((n=t.$retryable)==null?void 0:n.throttling)==!0},ba=(t,e=0)=>{var n;return V9(t)||z9.includes(t.name)||j9.includes((t==null?void 0:t.code)||"")||W9.includes((t==null?void 0:t.code)||"")||q9.includes(((n=t.$metadata)==null?void 0:n.httpStatusCode)||0)||K9(t)||t.cause!==void 0&&e<=10&&ba(t.cause,e+1)},G9=t=>{var e;if(((e=t.$metadata)==null?void 0:e.httpStatusCode)!==void 0){const n=t.$metadata.httpStatusCode;return 500<=n&&n<=599&&!ba(t)}return!1};class pi{constructor(e){this.currentCapacity=0,this.enabled=!1,this.lastMaxRate=0,this.measuredTxRate=0,this.requestCount=0,this.lastTimestamp=0,this.timeWindow=0,this.beta=(e==null?void 0:e.beta)??.7,this.minCapacity=(e==null?void 0:e.minCapacity)??1,this.minFillRate=(e==null?void 0:e.minFillRate)??.5,this.scaleConstant=(e==null?void 0:e.scaleConstant)??.4,this.smooth=(e==null?void 0:e.smooth)??.8;const n=this.getCurrentTimeInSeconds();this.lastThrottleTime=n,this.lastTxRateBucket=Math.floor(this.getCurrentTimeInSeconds()),this.fillRate=this.minFillRate,this.maxCapacity=this.minCapacity}getCurrentTimeInSeconds(){return Date.now()/1e3}async getSendToken(){return this.acquireTokenBucket(1)}async acquireTokenBucket(e){if(this.enabled){if(this.refillTokenBucket(),e>this.currentCapacity){const n=(e-this.currentCapacity)/this.fillRate*1e3;await new Promise(s=>pi.setTimeoutFn(s,n))}this.currentCapacity=this.currentCapacity-e}}refillTokenBucket(){const e=this.getCurrentTimeInSeconds();if(!this.lastTimestamp){this.lastTimestamp=e;return}const n=(e-this.lastTimestamp)*this.fillRate;this.currentCapacity=Math.min(this.maxCapacity,this.currentCapacity+n),this.lastTimestamp=e}updateClientSendingRate(e){let n;if(this.updateMeasuredRate(),Ou(e)){const r=this.enabled?Math.min(this.measuredTxRate,this.fillRate):this.measuredTxRate;this.lastMaxRate=r,this.calculateTimeWindow(),this.lastThrottleTime=this.getCurrentTimeInSeconds(),n=this.cubicThrottle(r),this.enableTokenBucket()}else this.calculateTimeWindow(),n=this.cubicSuccess(this.getCurrentTimeInSeconds());const s=Math.min(n,2*this.measuredTxRate);this.updateTokenBucketRate(s)}calculateTimeWindow(){this.timeWindow=this.getPrecise(Math.pow(this.lastMaxRate*(1-this.beta)/this.scaleConstant,1/3))}cubicThrottle(e){return this.getPrecise(e*this.beta)}cubicSuccess(e){return this.getPrecise(this.scaleConstant*Math.pow(e-this.lastThrottleTime-this.timeWindow,3)+this.lastMaxRate)}enableTokenBucket(){this.enabled=!0}updateTokenBucketRate(e){this.refillTokenBucket(),this.fillRate=Math.max(e,this.minFillRate),this.maxCapacity=Math.max(e,this.minCapacity),this.currentCapacity=Math.min(this.currentCapacity,this.maxCapacity)}updateMeasuredRate(){const e=this.getCurrentTimeInSeconds(),n=Math.floor(e*2)/2;if(this.requestCount++,n>this.lastTxRateBucket){const s=this.requestCount/(n-this.lastTxRateBucket);this.measuredTxRate=this.getPrecise(s*this.smooth+this.measuredTxRate*(1-this.smooth)),this.requestCount=0,this.lastTxRateBucket=n}}getPrecise(e){return parseFloat(e.toFixed(8))}}pi.setTimeoutFn=setTimeout;const Qo=100,Uu=20*1e3,Z9=500,jc=500,X9=5,Y9=10,J9=1,e4="amz-sdk-invocation-id",t4="amz-sdk-request",n4=()=>{let t=Qo;return{computeNextBackoffDelay:s=>Math.floor(Math.min(Uu,Math.random()*2**s*t)),setDelayBase:s=>{t=s}}},Wc=({retryDelay:t,retryCount:e,retryCost:n})=>({getRetryCount:()=>e,getRetryDelay:()=>Math.min(Uu,t),getRetryCost:()=>n});class Qu{constructor(e){this.maxAttempts=e,this.mode=Es.STANDARD,this.capacity=jc,this.retryBackoffStrategy=n4(),this.maxAttemptsProvider=typeof e=="function"?e:async()=>e}async acquireInitialRetryToken(e){return Wc({retryDelay:Qo,retryCount:0})}async refreshRetryTokenForRetry(e,n){const s=await this.getMaxAttempts();if(this.shouldRetry(e,n,s)){const r=n.errorType;this.retryBackoffStrategy.setDelayBase(r==="THROTTLING"?Z9:Qo);const i=this.retryBackoffStrategy.computeNextBackoffDelay(e.getRetryCount()),o=n.retryAfterHint?Math.max(n.retryAfterHint.getTime()-Date.now()||0,i):i,a=this.getCapacityCost(r);return this.capacity-=a,Wc({retryDelay:o,retryCount:e.getRetryCount()+1,retryCost:a})}throw new Error("No retry token available")}recordSuccess(e){this.capacity=Math.max(jc,this.capacity+(e.getRetryCost()??J9))}getCapacity(){return this.capacity}async getMaxAttempts(){try{return await this.maxAttemptsProvider()}catch{return console.warn(`Max attempts provider could not resolve. Using default of ${Xr}`),Xr}}shouldRetry(e,n,s){return e.getRetryCount()+1<s&&this.capacity>=this.getCapacityCost(n.errorType)&&this.isRetryableError(n.errorType)}getCapacityCost(e){return e==="TRANSIENT"?Y9:X9}isRetryableError(e){return e==="THROTTLING"||e==="TRANSIENT"}}class s4{constructor(e,n){this.maxAttemptsProvider=e,this.mode=Es.ADAPTIVE;const{rateLimiter:s}=n??{};this.rateLimiter=s??new pi,this.standardRetryStrategy=new Qu(e)}async acquireInitialRetryToken(e){return await this.rateLimiter.getSendToken(),this.standardRetryStrategy.acquireInitialRetryToken(e)}async refreshRetryTokenForRetry(e,n){return this.rateLimiter.updateClientSendingRate(n),this.standardRetryStrategy.refreshRetryTokenForRetry(e,n)}recordSuccess(e){this.rateLimiter.updateClientSendingRate({}),this.standardRetryStrategy.recordSuccess(e)}}let Rr;const r4=new Uint8Array(16);function i4(){if(!Rr&&(Rr=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Rr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Rr(r4)}const dt=[];for(let t=0;t<256;++t)dt.push((t+256).toString(16).slice(1));function o4(t,e=0){return dt[t[e+0]]+dt[t[e+1]]+dt[t[e+2]]+dt[t[e+3]]+"-"+dt[t[e+4]]+dt[t[e+5]]+"-"+dt[t[e+6]]+dt[t[e+7]]+"-"+dt[t[e+8]]+dt[t[e+9]]+"-"+dt[t[e+10]]+dt[t[e+11]]+dt[t[e+12]]+dt[t[e+13]]+dt[t[e+14]]+dt[t[e+15]]}const a4=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Vc={randomUUID:a4};function c4(t,e,n){if(Vc.randomUUID&&!t)return Vc.randomUUID();t=t||{};const s=t.random||(t.rng||i4)();return s[6]=s[6]&15|64,s[8]=s[8]&63|128,o4(s)}const d4=t=>t instanceof Error?t:t instanceof Object?Object.assign(new Error,t):typeof t=="string"?new Error(t):new Error(`AWS SDK error wrapper for ${t}`),l4=t=>{const{retryStrategy:e,retryMode:n,maxAttempts:s}=t,r=$t(s??Xr);return Object.assign(t,{maxAttempts:r,retryStrategy:async()=>e||(await $t(n)()===Es.ADAPTIVE?new s4(r):new Qu(r))})},u4=t=>(t==null?void 0:t.body)instanceof ReadableStream,h4=t=>(e,n)=>async s=>{var o;let r=await t.retryStrategy();const i=await t.maxAttempts();if(f4(r)){r=r;let a=await r.acquireInitialRetryToken(n.partition_id),d=new Error,c=0,l=0;const{request:u}=s,h=Ge.isInstance(u);for(h&&(u.headers[e4]=c4());;)try{h&&(u.headers[t4]=`attempt=${c+1}; max=${i}`);const{response:f,output:y}=await e(s);return r.recordSuccess(a),y.$metadata.attempts=c+1,y.$metadata.totalRetryDelay=l,{response:f,output:y}}catch(f){const y=p4(f);if(d=d4(f),h&&u4(u))throw(o=n.logger instanceof fa?console:n.logger)==null||o.warn("An error was encountered in a non-retryable streaming request."),d;try{a=await r.refreshRetryTokenForRetry(a,y)}catch{throw d.$metadata||(d.$metadata={}),d.$metadata.attempts=c+1,d.$metadata.totalRetryDelay=l,d}c=a.getRetryCount();const x=a.getRetryDelay();l+=x,await new Promise(w=>setTimeout(w,x))}}else return r=r,r!=null&&r.mode&&(n.userAgent=[...n.userAgent||[],["cfg/retry-mode",r.mode]]),r.retry(e,s)},f4=t=>typeof t.acquireInitialRetryToken<"u"&&typeof t.refreshRetryTokenForRetry<"u"&&typeof t.recordSuccess<"u",p4=t=>{const e={error:t,errorType:m4(t)},n=w4(t.$response);return n&&(e.retryAfterHint=n),e},m4=t=>Ou(t)?"THROTTLING":ba(t)?"TRANSIENT":G9(t)?"SERVER_ERROR":"CLIENT_ERROR",g4={name:"retryMiddleware",tags:["RETRY"],step:"finalizeRequest",priority:"high",override:!0},y4=t=>({applyToStack:e=>{e.add(h4(t),g4)}}),w4=t=>{if(!vs.isInstance(t))return;const e=Object.keys(t.headers).find(i=>i.toLowerCase()==="retry-after");if(!e)return;const n=t.headers[e],s=Number(n);return Number.isNaN(s)?new Date(n):new Date(s*1e3)};class $u{constructor(e){g(this,"sigv4aSigner");g(this,"sigv4Signer");g(this,"signerOptions");this.sigv4Signer=new q2(e),this.signerOptions=e}static sigv4aDependency(){return"none"}async sign(e,n={}){return n.signingRegion==="*"?this.getSigv4aSigner().sign(e,n):this.sigv4Signer.sign(e,n)}async signWithCredentials(e,n,s={}){if(s.signingRegion==="*")throw this.getSigv4aSigner(),new Error(`signWithCredentials with signingRegion '*' is only supported when using the CRT dependency @aws-sdk/signature-v4-crt. Please check whether you have installed the "@aws-sdk/signature-v4-crt" package explicitly. You must also register the package by calling [require("@aws-sdk/signature-v4-crt");] or an ESM equivalent such as [import "@aws-sdk/signature-v4-crt";]. For more information please go to https://github.com/aws/aws-sdk-js-v3#functionality-requiring-aws-common-runtime-crt`);return this.sigv4Signer.signWithCredentials(e,n,s)}async presign(e,n={}){if(n.signingRegion==="*")throw this.getSigv4aSigner(),new Error(`presign with signingRegion '*' is only supported when using the CRT dependency @aws-sdk/signature-v4-crt. Please check whether you have installed the "@aws-sdk/signature-v4-crt" package explicitly. You must also register the package by calling [require("@aws-sdk/signature-v4-crt");] or an ESM equivalent such as [import "@aws-sdk/signature-v4-crt";]. For more information please go to https://github.com/aws/aws-sdk-js-v3#functionality-requiring-aws-common-runtime-crt`);return this.sigv4Signer.presign(e,n)}async presignWithCredentials(e,n,s={}){if(s.signingRegion==="*")throw new Error("Method presignWithCredentials is not supported for [signingRegion=*].");return this.sigv4Signer.presignWithCredentials(e,n,s)}getSigv4aSigner(){if(!this.sigv4aSigner)throw this.signerOptions.runtime==="node"?new Error("Neither CRT nor JS SigV4a implementation is available. Please load either @aws-sdk/signature-v4-crt or @aws-sdk/signature-v4a. For more information please go to https://github.com/aws/aws-sdk-js-v3#functionality-requiring-aws-common-runtime-crt"):new Error("JS SigV4a implementation is not available or not a valid constructor. Please check whether you have installed the @aws-sdk/signature-v4a package explicitly. The CRT implementation is not available for browsers. You must also register the package by calling [require('@aws-sdk/signature-v4a');] or an ESM equivalent such as [import '@aws-sdk/signature-v4a';]. For more information please go to https://github.com/aws/aws-sdk-js-v3#using-javascript-non-crt-implementation-of-sigv4a");return this.sigv4aSigner}}const va="required",p="type",E="rules",m="conditions",b="fn",v="argv",H="ref",J="assign",F="url",D="properties",Nn="backend",gt="authSchemes",rt="disableDoubleEncoding",it="signingName",Et="signingRegion",N="headers",xa="signingRegionSet",b4=6,v4=!1,zt=!0,Pt="isSet",He="booleanEquals",B="error",Yr="aws.partition",ce="stringEquals",Ie="getAttr",$e="name",be="substring",Kc="bucketSuffix",Sa="parseURL",T="endpoint",C="tree",Jr="aws.isVirtualHostableS3Bucket",ei="{url#scheme}://{Bucket}.{url#authority}{url#path}",Gt="not",Gc="accessPointSuffix",Ur="{url#scheme}://{url#authority}{url#path}",Hu="hardwareType",zu="regionPrefix",Zc="bucketAliasSuffix",$o="outpostId",Vn="isValidHostLabel",Ea="sigv4a",ar="s3-outposts",Cs="s3",qu="{url#scheme}://{url#authority}{url#normalizedPath}{Bucket}",ju="https://{Bucket}.s3-accelerate.{partitionResult#dnsSuffix}",Xc="https://{Bucket}.s3.{partitionResult#dnsSuffix}",Wu="aws.parseArn",Vu="bucketArn",Ku="arnType",ti="",Ca="s3-object-lambda",Gu="accesspoint",Aa="accessPointName",Yc="{url#scheme}://{accessPointName}-{bucketArn#accountId}.{url#authority}{url#path}",Jc="mrapPartition",ed="outpostType",td="arnPrefix",Zu="{url#scheme}://{url#authority}{url#normalizedPath}{uri_encoded_bucket}",nd="https://s3.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",sd="https://s3.{partitionResult#dnsSuffix}",is={[va]:!1,[p]:"String"},os={[va]:!0,default:!1,[p]:"Boolean"},Us={[va]:!1,[p]:"Boolean"},Lt={[b]:He,[v]:[{[H]:"Accelerate"},!0]},Ae={[b]:He,[v]:[{[H]:"UseFIPS"},!0]},we={[b]:He,[v]:[{[H]:"UseDualStack"},!0]},Oe={[b]:Pt,[v]:[{[H]:"Endpoint"}]},Xu={[b]:Yr,[v]:[{[H]:"Region"}],[J]:"partitionResult"},rd={[b]:ce,[v]:[{[b]:Ie,[v]:[{[H]:"partitionResult"},$e]},"aws-cn"]},Xs={[b]:Pt,[v]:[{[H]:"Bucket"}]},ae={[H]:"Bucket"},id={[m]:[we],[B]:"S3Express does not support Dual-stack.",[p]:B},od={[m]:[Lt],[B]:"S3Express does not support S3 Accelerate.",[p]:B},ad={[m]:[Oe,{[b]:Sa,[v]:[{[H]:"Endpoint"}],[J]:"url"}],[E]:[{[m]:[{[b]:Pt,[v]:[{[H]:"DisableS3ExpressSessionAuth"}]},{[b]:He,[v]:[{[H]:"DisableS3ExpressSessionAuth"},!0]}],[E]:[{[m]:[{[b]:He,[v]:[{[b]:Ie,[v]:[{[H]:"url"},"isIp"]},!0]}],[E]:[{[m]:[{[b]:"uriEncode",[v]:[ae],[J]:"uri_encoded_bucket"}],[E]:[{[T]:{[F]:"{url#scheme}://{url#authority}/{uri_encoded_bucket}{url#path}",[D]:{[Nn]:"S3Express",[gt]:[{[rt]:!0,[$e]:"sigv4",[it]:"s3express",[Et]:"{Region}"}]},[N]:{}},[p]:T}],[p]:C}],[p]:C},{[m]:[{[b]:Jr,[v]:[ae,!1]}],[E]:[{[T]:{[F]:ei,[D]:{[Nn]:"S3Express",[gt]:[{[rt]:!0,[$e]:"sigv4",[it]:"s3express",[Et]:"{Region}"}]},[N]:{}},[p]:T}],[p]:C},{[B]:"S3Express bucket name is not a valid virtual hostable name.",[p]:B}],[p]:C},{[m]:[{[b]:He,[v]:[{[b]:Ie,[v]:[{[H]:"url"},"isIp"]},!0]}],[E]:[{[m]:[{[b]:"uriEncode",[v]:[ae],[J]:"uri_encoded_bucket"}],[E]:[{[T]:{[F]:"{url#scheme}://{url#authority}/{uri_encoded_bucket}{url#path}",[D]:{[Nn]:"S3Express",[gt]:[{[rt]:!0,[$e]:"sigv4-s3express",[it]:"s3express",[Et]:"{Region}"}]},[N]:{}},[p]:T}],[p]:C}],[p]:C},{[m]:[{[b]:Jr,[v]:[ae,!1]}],[E]:[{[T]:{[F]:ei,[D]:{[Nn]:"S3Express",[gt]:[{[rt]:!0,[$e]:"sigv4-s3express",[it]:"s3express",[Et]:"{Region}"}]},[N]:{}},[p]:T}],[p]:C},{[B]:"S3Express bucket name is not a valid virtual hostable name.",[p]:B}],[p]:C},vt={[b]:Sa,[v]:[{[H]:"Endpoint"}],[J]:"url"},$i={[b]:He,[v]:[{[b]:Ie,[v]:[{[H]:"url"},"isIp"]},!0]},Yu={[H]:"url"},Ju={[b]:"uriEncode",[v]:[ae],[J]:"uri_encoded_bucket"},Bn={[Nn]:"S3Express",[gt]:[{[rt]:!0,[$e]:"sigv4",[it]:"s3express",[Et]:"{Region}"}]},K={},eh={[b]:Jr,[v]:[ae,!1]},cd={[B]:"S3Express bucket name is not a valid virtual hostable name.",[p]:B},dd={[b]:Pt,[v]:[{[H]:"UseS3ExpressControlEndpoint"}]},ld={[b]:He,[v]:[{[H]:"UseS3ExpressControlEndpoint"},!0]},G={[b]:Gt,[v]:[Oe]},Mr={[B]:"Unrecognized S3Express bucket name format.",[p]:B},ud={[b]:Gt,[v]:[Xs]},hd={[H]:Hu},fd={[m]:[G],[B]:"Expected a endpoint to be specified but no endpoint was found",[p]:B},Ir={[gt]:[{[rt]:!0,[$e]:Ea,[it]:ar,[xa]:["*"]},{[rt]:!0,[$e]:"sigv4",[it]:ar,[Et]:"{Region}"}]},Hi={[b]:He,[v]:[{[H]:"ForcePathStyle"},!1]},x4={[H]:"ForcePathStyle"},je={[b]:He,[v]:[{[H]:"Accelerate"},!1]},Xe={[b]:ce,[v]:[{[H]:"Region"},"aws-global"]},et={[gt]:[{[rt]:!0,[$e]:"sigv4",[it]:Cs,[Et]:"us-east-1"}]},ie={[b]:Gt,[v]:[Xe]},tt={[b]:He,[v]:[{[H]:"UseGlobalEndpoint"},!0]},pd={[F]:"https://{Bucket}.s3-fips.dualstack.{Region}.{partitionResult#dnsSuffix}",[D]:{[gt]:[{[rt]:!0,[$e]:"sigv4",[it]:Cs,[Et]:"{Region}"}]},[N]:{}},Ke={[gt]:[{[rt]:!0,[$e]:"sigv4",[it]:Cs,[Et]:"{Region}"}]},nt={[b]:He,[v]:[{[H]:"UseGlobalEndpoint"},!1]},se={[b]:He,[v]:[{[H]:"UseDualStack"},!1]},md={[F]:"https://{Bucket}.s3-fips.{Region}.{partitionResult#dnsSuffix}",[D]:Ke,[N]:{}},te={[b]:He,[v]:[{[H]:"UseFIPS"},!1]},gd={[F]:"https://{Bucket}.s3-accelerate.dualstack.{partitionResult#dnsSuffix}",[D]:Ke,[N]:{}},yd={[F]:"https://{Bucket}.s3.dualstack.{Region}.{partitionResult#dnsSuffix}",[D]:Ke,[N]:{}},zi={[b]:He,[v]:[{[b]:Ie,[v]:[Yu,"isIp"]},!1]},qi={[F]:qu,[D]:Ke,[N]:{}},Ho={[F]:ei,[D]:Ke,[N]:{}},wd={[T]:Ho,[p]:T},ji={[F]:ju,[D]:Ke,[N]:{}},bd={[F]:"https://{Bucket}.s3.{Region}.{partitionResult#dnsSuffix}",[D]:Ke,[N]:{}},Lr={[B]:"Invalid region: region was not a valid DNS name.",[p]:B},kt={[H]:Vu},th={[H]:Ku},Wi={[b]:Ie,[v]:[kt,"service"]},ka={[H]:Aa},vd={[m]:[we],[B]:"S3 Object Lambda does not support Dual-stack",[p]:B},xd={[m]:[Lt],[B]:"S3 Object Lambda does not support S3 Accelerate",[p]:B},Sd={[m]:[{[b]:Pt,[v]:[{[H]:"DisableAccessPoints"}]},{[b]:He,[v]:[{[H]:"DisableAccessPoints"},!0]}],[B]:"Access points are not supported for this operation",[p]:B},Vi={[m]:[{[b]:Pt,[v]:[{[H]:"UseArnRegion"}]},{[b]:He,[v]:[{[H]:"UseArnRegion"},!1]},{[b]:Gt,[v]:[{[b]:ce,[v]:[{[b]:Ie,[v]:[kt,"region"]},"{Region}"]}]}],[B]:"Invalid configuration: region from ARN `{bucketArn#region}` does not match client region `{Region}` and UseArnRegion is `false`",[p]:B},nh={[b]:Ie,[v]:[{[H]:"bucketPartition"},$e]},sh={[b]:Ie,[v]:[kt,"accountId"]},Ki={[gt]:[{[rt]:!0,[$e]:"sigv4",[it]:Ca,[Et]:"{bucketArn#region}"}]},Ed={[B]:"Invalid ARN: The access point name may only contain a-z, A-Z, 0-9 and `-`. Found: `{accessPointName}`",[p]:B},Gi={[B]:"Invalid ARN: The account id may only contain a-z, A-Z, 0-9 and `-`. Found: `{bucketArn#accountId}`",[p]:B},Zi={[B]:"Invalid region in ARN: `{bucketArn#region}` (invalid DNS name)",[p]:B},Xi={[B]:"Client was configured for partition `{partitionResult#name}` but ARN (`{Bucket}`) has `{bucketPartition#name}`",[p]:B},Cd={[B]:"Invalid ARN: The ARN may only contain a single resource component after `accesspoint`.",[p]:B},Ad={[B]:"Invalid ARN: Expected a resource of the format `accesspoint:<accesspoint name>` but no name was provided",[p]:B},Qs={[gt]:[{[rt]:!0,[$e]:"sigv4",[it]:Cs,[Et]:"{bucketArn#region}"}]},kd={[gt]:[{[rt]:!0,[$e]:Ea,[it]:ar,[xa]:["*"]},{[rt]:!0,[$e]:"sigv4",[it]:ar,[Et]:"{bucketArn#region}"}]},Pd={[b]:Wu,[v]:[ae]},_d={[F]:"https://s3-fips.dualstack.{Region}.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",[D]:Ke,[N]:{}},Td={[F]:"https://s3-fips.{Region}.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",[D]:Ke,[N]:{}},Rd={[F]:"https://s3.dualstack.{Region}.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",[D]:Ke,[N]:{}},Yi={[F]:Zu,[D]:Ke,[N]:{}},Md={[F]:"https://s3.{Region}.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",[D]:Ke,[N]:{}},Id={[H]:"UseObjectLambdaEndpoint"},Ji={[gt]:[{[rt]:!0,[$e]:"sigv4",[it]:Ca,[Et]:"{Region}"}]},Ld={[F]:"https://s3-fips.dualstack.{Region}.{partitionResult#dnsSuffix}",[D]:Ke,[N]:{}},Bd={[F]:"https://s3-fips.{Region}.{partitionResult#dnsSuffix}",[D]:Ke,[N]:{}},Fd={[F]:"https://s3.dualstack.{Region}.{partitionResult#dnsSuffix}",[D]:Ke,[N]:{}},eo={[F]:Ur,[D]:Ke,[N]:{}},Dd={[F]:"https://s3.{Region}.{partitionResult#dnsSuffix}",[D]:Ke,[N]:{}},to=[{[H]:"Region"}],S4=[{[H]:"Endpoint"}],E4=[ae],Nd=[we],no=[Lt],as=[Oe,vt],Od=[{[b]:Pt,[v]:[{[H]:"DisableS3ExpressSessionAuth"}]},{[b]:He,[v]:[{[H]:"DisableS3ExpressSessionAuth"},!0]}],C4=[Ju],Ud=[eh],Mt=[Xu],cs=[Ae],Qd=[{[b]:be,[v]:[ae,6,14,!0],[J]:"s3expressAvailabilityZoneId"},{[b]:be,[v]:[ae,14,16,!0],[J]:"s3expressAvailabilityZoneDelim"},{[b]:ce,[v]:[{[H]:"s3expressAvailabilityZoneDelim"},"--"]}],qt=[{[m]:[Ae],[T]:{[F]:"https://{Bucket}.s3express-fips-{s3expressAvailabilityZoneId}.{Region}.{partitionResult#dnsSuffix}",[D]:Bn,[N]:{}},[p]:T},{[T]:{[F]:"https://{Bucket}.s3express-{s3expressAvailabilityZoneId}.{Region}.{partitionResult#dnsSuffix}",[D]:Bn,[N]:{}},[p]:T}],$d=[{[b]:be,[v]:[ae,6,15,!0],[J]:"s3expressAvailabilityZoneId"},{[b]:be,[v]:[ae,15,17,!0],[J]:"s3expressAvailabilityZoneDelim"},{[b]:ce,[v]:[{[H]:"s3expressAvailabilityZoneDelim"},"--"]}],Hd=[{[b]:be,[v]:[ae,6,19,!0],[J]:"s3expressAvailabilityZoneId"},{[b]:be,[v]:[ae,19,21,!0],[J]:"s3expressAvailabilityZoneDelim"},{[b]:ce,[v]:[{[H]:"s3expressAvailabilityZoneDelim"},"--"]}],zd=[{[b]:be,[v]:[ae,6,20,!0],[J]:"s3expressAvailabilityZoneId"},{[b]:be,[v]:[ae,20,22,!0],[J]:"s3expressAvailabilityZoneDelim"},{[b]:ce,[v]:[{[H]:"s3expressAvailabilityZoneDelim"},"--"]}],qd=[{[b]:be,[v]:[ae,6,26,!0],[J]:"s3expressAvailabilityZoneId"},{[b]:be,[v]:[ae,26,28,!0],[J]:"s3expressAvailabilityZoneDelim"},{[b]:ce,[v]:[{[H]:"s3expressAvailabilityZoneDelim"},"--"]}],jt=[{[m]:[Ae],[T]:{[F]:"https://{Bucket}.s3express-fips-{s3expressAvailabilityZoneId}.{Region}.{partitionResult#dnsSuffix}",[D]:{[Nn]:"S3Express",[gt]:[{[rt]:!0,[$e]:"sigv4-s3express",[it]:"s3express",[Et]:"{Region}"}]},[N]:{}},[p]:T},{[T]:{[F]:"https://{Bucket}.s3express-{s3expressAvailabilityZoneId}.{Region}.{partitionResult#dnsSuffix}",[D]:{[Nn]:"S3Express",[gt]:[{[rt]:!0,[$e]:"sigv4-s3express",[it]:"s3express",[Et]:"{Region}"}]},[N]:{}},[p]:T}],jd=[ae,0,7,!0],Wd=[{[b]:be,[v]:[ae,7,15,!0],[J]:"s3expressAvailabilityZoneId"},{[b]:be,[v]:[ae,15,17,!0],[J]:"s3expressAvailabilityZoneDelim"},{[b]:ce,[v]:[{[H]:"s3expressAvailabilityZoneDelim"},"--"]}],Vd=[{[b]:be,[v]:[ae,7,16,!0],[J]:"s3expressAvailabilityZoneId"},{[b]:be,[v]:[ae,16,18,!0],[J]:"s3expressAvailabilityZoneDelim"},{[b]:ce,[v]:[{[H]:"s3expressAvailabilityZoneDelim"},"--"]}],Kd=[{[b]:be,[v]:[ae,7,20,!0],[J]:"s3expressAvailabilityZoneId"},{[b]:be,[v]:[ae,20,22,!0],[J]:"s3expressAvailabilityZoneDelim"},{[b]:ce,[v]:[{[H]:"s3expressAvailabilityZoneDelim"},"--"]}],Gd=[{[b]:be,[v]:[ae,7,21,!0],[J]:"s3expressAvailabilityZoneId"},{[b]:be,[v]:[ae,21,23,!0],[J]:"s3expressAvailabilityZoneDelim"},{[b]:ce,[v]:[{[H]:"s3expressAvailabilityZoneDelim"},"--"]}],Zd=[{[b]:be,[v]:[ae,7,27,!0],[J]:"s3expressAvailabilityZoneId"},{[b]:be,[v]:[ae,27,29,!0],[J]:"s3expressAvailabilityZoneDelim"},{[b]:ce,[v]:[{[H]:"s3expressAvailabilityZoneDelim"},"--"]}],A4=[Xs],Xd=[{[b]:Vn,[v]:[{[H]:$o},!1]}],Yd=[{[b]:ce,[v]:[{[H]:zu},"beta"]}],k4=["*"],Jd=[{[b]:Vn,[v]:[{[H]:"Region"},!1]}],ln=[{[b]:ce,[v]:[{[H]:"Region"},"us-east-1"]}],so=[{[b]:ce,[v]:[th,Gu]}],el=[{[b]:Ie,[v]:[kt,"resourceId[1]"],[J]:Aa},{[b]:Gt,[v]:[{[b]:ce,[v]:[ka,ti]}]}],P4=[kt,"resourceId[1]"],ro=[{[b]:Gt,[v]:[{[b]:ce,[v]:[{[b]:Ie,[v]:[kt,"region"]},ti]}]}],tl=[{[b]:Gt,[v]:[{[b]:Pt,[v]:[{[b]:Ie,[v]:[kt,"resourceId[2]"]}]}]}],_4=[kt,"resourceId[2]"],io=[{[b]:Yr,[v]:[{[b]:Ie,[v]:[kt,"region"]}],[J]:"bucketPartition"}],nl=[{[b]:ce,[v]:[nh,{[b]:Ie,[v]:[{[H]:"partitionResult"},$e]}]}],oo=[{[b]:Vn,[v]:[{[b]:Ie,[v]:[kt,"region"]},!0]}],ao=[{[b]:Vn,[v]:[sh,!1]}],sl=[{[b]:Vn,[v]:[ka,!1]}],rl=[{[b]:Vn,[v]:[{[H]:"Region"},!0]}],T4={parameters:{Bucket:is,Region:is,UseFIPS:os,UseDualStack:os,Endpoint:is,ForcePathStyle:os,Accelerate:os,UseGlobalEndpoint:os,UseObjectLambdaEndpoint:Us,Key:is,Prefix:is,CopySource:is,DisableAccessPoints:Us,DisableMultiRegionAccessPoints:os,UseArnRegion:Us,UseS3ExpressControlEndpoint:Us,DisableS3ExpressSessionAuth:Us},[E]:[{[m]:[{[b]:Pt,[v]:to}],[E]:[{[m]:[Lt,Ae],error:"Accelerate cannot be used with FIPS",[p]:B},{[m]:[we,Oe],error:"Cannot set dual-stack in combination with a custom endpoint.",[p]:B},{[m]:[Oe,Ae],error:"A custom endpoint cannot be combined with FIPS",[p]:B},{[m]:[Oe,Lt],error:"A custom endpoint cannot be combined with S3 Accelerate",[p]:B},{[m]:[Ae,Xu,rd],error:"Partition does not support FIPS",[p]:B},{[m]:[Xs,{[b]:be,[v]:[ae,0,b4,zt],[J]:Kc},{[b]:ce,[v]:[{[H]:Kc},"--x-s3"]}],[E]:[id,od,ad,{[m]:[dd,ld],[E]:[{[m]:Mt,[E]:[{[m]:[Ju,G],[E]:[{[m]:cs,endpoint:{[F]:"https://s3express-control-fips.{Region}.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",[D]:Bn,[N]:K},[p]:T},{endpoint:{[F]:"https://s3express-control.{Region}.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",[D]:Bn,[N]:K},[p]:T}],[p]:C}],[p]:C}],[p]:C},{[m]:Ud,[E]:[{[m]:Mt,[E]:[{[m]:Od,[E]:[{[m]:Qd,[E]:qt,[p]:C},{[m]:$d,[E]:qt,[p]:C},{[m]:Hd,[E]:qt,[p]:C},{[m]:zd,[E]:qt,[p]:C},{[m]:qd,[E]:qt,[p]:C},Mr],[p]:C},{[m]:Qd,[E]:jt,[p]:C},{[m]:$d,[E]:jt,[p]:C},{[m]:Hd,[E]:jt,[p]:C},{[m]:zd,[E]:jt,[p]:C},{[m]:qd,[E]:jt,[p]:C},Mr],[p]:C}],[p]:C},cd],[p]:C},{[m]:[Xs,{[b]:be,[v]:jd,[J]:Gc},{[b]:ce,[v]:[{[H]:Gc},"--xa-s3"]}],[E]:[id,od,ad,{[m]:Ud,[E]:[{[m]:Mt,[E]:[{[m]:Od,[E]:[{[m]:Wd,[E]:qt,[p]:C},{[m]:Vd,[E]:qt,[p]:C},{[m]:Kd,[E]:qt,[p]:C},{[m]:Gd,[E]:qt,[p]:C},{[m]:Zd,[E]:qt,[p]:C},Mr],[p]:C},{[m]:Wd,[E]:jt,[p]:C},{[m]:Vd,[E]:jt,[p]:C},{[m]:Kd,[E]:jt,[p]:C},{[m]:Gd,[E]:jt,[p]:C},{[m]:Zd,[E]:jt,[p]:C},Mr],[p]:C}],[p]:C},cd],[p]:C},{[m]:[ud,dd,ld],[E]:[{[m]:Mt,[E]:[{[m]:as,endpoint:{[F]:Ur,[D]:Bn,[N]:K},[p]:T},{[m]:cs,endpoint:{[F]:"https://s3express-control-fips.{Region}.{partitionResult#dnsSuffix}",[D]:Bn,[N]:K},[p]:T},{endpoint:{[F]:"https://s3express-control.{Region}.{partitionResult#dnsSuffix}",[D]:Bn,[N]:K},[p]:T}],[p]:C}],[p]:C},{[m]:[Xs,{[b]:be,[v]:[ae,49,50,zt],[J]:Hu},{[b]:be,[v]:[ae,8,12,zt],[J]:zu},{[b]:be,[v]:jd,[J]:Zc},{[b]:be,[v]:[ae,32,49,zt],[J]:$o},{[b]:Yr,[v]:to,[J]:"regionPartition"},{[b]:ce,[v]:[{[H]:Zc},"--op-s3"]}],[E]:[{[m]:Xd,[E]:[{[m]:[{[b]:ce,[v]:[hd,"e"]}],[E]:[{[m]:Yd,[E]:[fd,{[m]:as,endpoint:{[F]:"https://{Bucket}.ec2.{url#authority}",[D]:Ir,[N]:K},[p]:T}],[p]:C},{endpoint:{[F]:"https://{Bucket}.ec2.s3-outposts.{Region}.{regionPartition#dnsSuffix}",[D]:Ir,[N]:K},[p]:T}],[p]:C},{[m]:[{[b]:ce,[v]:[hd,"o"]}],[E]:[{[m]:Yd,[E]:[fd,{[m]:as,endpoint:{[F]:"https://{Bucket}.op-{outpostId}.{url#authority}",[D]:Ir,[N]:K},[p]:T}],[p]:C},{endpoint:{[F]:"https://{Bucket}.op-{outpostId}.s3-outposts.{Region}.{regionPartition#dnsSuffix}",[D]:Ir,[N]:K},[p]:T}],[p]:C},{error:'Unrecognized hardware type: "Expected hardware type o or e but got {hardwareType}"',[p]:B}],[p]:C},{error:"Invalid ARN: The outpost Id must only contain a-z, A-Z, 0-9 and `-`.",[p]:B}],[p]:C},{[m]:A4,[E]:[{[m]:[Oe,{[b]:Gt,[v]:[{[b]:Pt,[v]:[{[b]:Sa,[v]:S4}]}]}],error:"Custom endpoint `{Endpoint}` was not a valid URI",[p]:B},{[m]:[Hi,eh],[E]:[{[m]:Mt,[E]:[{[m]:Jd,[E]:[{[m]:[Lt,rd],error:"S3 Accelerate cannot be used in this region",[p]:B},{[m]:[we,Ae,je,G,Xe],endpoint:{[F]:"https://{Bucket}.s3-fips.dualstack.us-east-1.{partitionResult#dnsSuffix}",[D]:et,[N]:K},[p]:T},{[m]:[we,Ae,je,G,ie,tt],[E]:[{endpoint:pd,[p]:T}],[p]:C},{[m]:[we,Ae,je,G,ie,nt],endpoint:pd,[p]:T},{[m]:[se,Ae,je,G,Xe],endpoint:{[F]:"https://{Bucket}.s3-fips.us-east-1.{partitionResult#dnsSuffix}",[D]:et,[N]:K},[p]:T},{[m]:[se,Ae,je,G,ie,tt],[E]:[{endpoint:md,[p]:T}],[p]:C},{[m]:[se,Ae,je,G,ie,nt],endpoint:md,[p]:T},{[m]:[we,te,Lt,G,Xe],endpoint:{[F]:"https://{Bucket}.s3-accelerate.dualstack.us-east-1.{partitionResult#dnsSuffix}",[D]:et,[N]:K},[p]:T},{[m]:[we,te,Lt,G,ie,tt],[E]:[{endpoint:gd,[p]:T}],[p]:C},{[m]:[we,te,Lt,G,ie,nt],endpoint:gd,[p]:T},{[m]:[we,te,je,G,Xe],endpoint:{[F]:"https://{Bucket}.s3.dualstack.us-east-1.{partitionResult#dnsSuffix}",[D]:et,[N]:K},[p]:T},{[m]:[we,te,je,G,ie,tt],[E]:[{endpoint:yd,[p]:T}],[p]:C},{[m]:[we,te,je,G,ie,nt],endpoint:yd,[p]:T},{[m]:[se,te,je,Oe,vt,$i,Xe],endpoint:{[F]:qu,[D]:et,[N]:K},[p]:T},{[m]:[se,te,je,Oe,vt,zi,Xe],endpoint:{[F]:ei,[D]:et,[N]:K},[p]:T},{[m]:[se,te,je,Oe,vt,$i,ie,tt],[E]:[{[m]:ln,endpoint:qi,[p]:T},{endpoint:qi,[p]:T}],[p]:C},{[m]:[se,te,je,Oe,vt,zi,ie,tt],[E]:[{[m]:ln,endpoint:Ho,[p]:T},wd],[p]:C},{[m]:[se,te,je,Oe,vt,$i,ie,nt],endpoint:qi,[p]:T},{[m]:[se,te,je,Oe,vt,zi,ie,nt],endpoint:Ho,[p]:T},{[m]:[se,te,Lt,G,Xe],endpoint:{[F]:ju,[D]:et,[N]:K},[p]:T},{[m]:[se,te,Lt,G,ie,tt],[E]:[{[m]:ln,endpoint:ji,[p]:T},{endpoint:ji,[p]:T}],[p]:C},{[m]:[se,te,Lt,G,ie,nt],endpoint:ji,[p]:T},{[m]:[se,te,je,G,Xe],endpoint:{[F]:Xc,[D]:et,[N]:K},[p]:T},{[m]:[se,te,je,G,ie,tt],[E]:[{[m]:ln,endpoint:{[F]:Xc,[D]:Ke,[N]:K},[p]:T},{endpoint:bd,[p]:T}],[p]:C},{[m]:[se,te,je,G,ie,nt],endpoint:bd,[p]:T}],[p]:C},Lr],[p]:C}],[p]:C},{[m]:[Oe,vt,{[b]:ce,[v]:[{[b]:Ie,[v]:[Yu,"scheme"]},"http"]},{[b]:Jr,[v]:[ae,zt]},Hi,te,se,je],[E]:[{[m]:Mt,[E]:[{[m]:Jd,[E]:[wd],[p]:C},Lr],[p]:C}],[p]:C},{[m]:[Hi,{[b]:Wu,[v]:E4,[J]:Vu}],[E]:[{[m]:[{[b]:Ie,[v]:[kt,"resourceId[0]"],[J]:Ku},{[b]:Gt,[v]:[{[b]:ce,[v]:[th,ti]}]}],[E]:[{[m]:[{[b]:ce,[v]:[Wi,Ca]}],[E]:[{[m]:so,[E]:[{[m]:el,[E]:[vd,xd,{[m]:ro,[E]:[Sd,{[m]:tl,[E]:[Vi,{[m]:io,[E]:[{[m]:Mt,[E]:[{[m]:nl,[E]:[{[m]:oo,[E]:[{[m]:[{[b]:ce,[v]:[sh,ti]}],error:"Invalid ARN: Missing account id",[p]:B},{[m]:ao,[E]:[{[m]:sl,[E]:[{[m]:as,endpoint:{[F]:Yc,[D]:Ki,[N]:K},[p]:T},{[m]:cs,endpoint:{[F]:"https://{accessPointName}-{bucketArn#accountId}.s3-object-lambda-fips.{bucketArn#region}.{bucketPartition#dnsSuffix}",[D]:Ki,[N]:K},[p]:T},{endpoint:{[F]:"https://{accessPointName}-{bucketArn#accountId}.s3-object-lambda.{bucketArn#region}.{bucketPartition#dnsSuffix}",[D]:Ki,[N]:K},[p]:T}],[p]:C},Ed],[p]:C},Gi],[p]:C},Zi],[p]:C},Xi],[p]:C}],[p]:C}],[p]:C},Cd],[p]:C},{error:"Invalid ARN: bucket ARN is missing a region",[p]:B}],[p]:C},Ad],[p]:C},{error:"Invalid ARN: Object Lambda ARNs only support `accesspoint` arn types, but found: `{arnType}`",[p]:B}],[p]:C},{[m]:so,[E]:[{[m]:el,[E]:[{[m]:ro,[E]:[{[m]:so,[E]:[{[m]:ro,[E]:[Sd,{[m]:tl,[E]:[Vi,{[m]:io,[E]:[{[m]:Mt,[E]:[{[m]:[{[b]:ce,[v]:[nh,"{partitionResult#name}"]}],[E]:[{[m]:oo,[E]:[{[m]:[{[b]:ce,[v]:[Wi,Cs]}],[E]:[{[m]:ao,[E]:[{[m]:sl,[E]:[{[m]:no,error:"Access Points do not support S3 Accelerate",[p]:B},{[m]:[Ae,we],endpoint:{[F]:"https://{accessPointName}-{bucketArn#accountId}.s3-accesspoint-fips.dualstack.{bucketArn#region}.{bucketPartition#dnsSuffix}",[D]:Qs,[N]:K},[p]:T},{[m]:[Ae,se],endpoint:{[F]:"https://{accessPointName}-{bucketArn#accountId}.s3-accesspoint-fips.{bucketArn#region}.{bucketPartition#dnsSuffix}",[D]:Qs,[N]:K},[p]:T},{[m]:[te,we],endpoint:{[F]:"https://{accessPointName}-{bucketArn#accountId}.s3-accesspoint.dualstack.{bucketArn#region}.{bucketPartition#dnsSuffix}",[D]:Qs,[N]:K},[p]:T},{[m]:[te,se,Oe,vt],endpoint:{[F]:Yc,[D]:Qs,[N]:K},[p]:T},{[m]:[te,se],endpoint:{[F]:"https://{accessPointName}-{bucketArn#accountId}.s3-accesspoint.{bucketArn#region}.{bucketPartition#dnsSuffix}",[D]:Qs,[N]:K},[p]:T}],[p]:C},Ed],[p]:C},Gi],[p]:C},{error:"Invalid ARN: The ARN was not for the S3 service, found: {bucketArn#service}",[p]:B}],[p]:C},Zi],[p]:C},Xi],[p]:C}],[p]:C}],[p]:C},Cd],[p]:C}],[p]:C}],[p]:C},{[m]:[{[b]:Vn,[v]:[ka,zt]}],[E]:[{[m]:Nd,error:"S3 MRAP does not support dual-stack",[p]:B},{[m]:cs,error:"S3 MRAP does not support FIPS",[p]:B},{[m]:no,error:"S3 MRAP does not support S3 Accelerate",[p]:B},{[m]:[{[b]:He,[v]:[{[H]:"DisableMultiRegionAccessPoints"},zt]}],error:"Invalid configuration: Multi-Region Access Point ARNs are disabled.",[p]:B},{[m]:[{[b]:Yr,[v]:to,[J]:Jc}],[E]:[{[m]:[{[b]:ce,[v]:[{[b]:Ie,[v]:[{[H]:Jc},$e]},{[b]:Ie,[v]:[kt,"partition"]}]}],[E]:[{endpoint:{[F]:"https://{accessPointName}.accesspoint.s3-global.{mrapPartition#dnsSuffix}",[D]:{[gt]:[{[rt]:zt,name:Ea,[it]:Cs,[xa]:k4}]},[N]:K},[p]:T}],[p]:C},{error:"Client was configured for partition `{mrapPartition#name}` but bucket referred to partition `{bucketArn#partition}`",[p]:B}],[p]:C}],[p]:C},{error:"Invalid Access Point Name",[p]:B}],[p]:C},Ad],[p]:C},{[m]:[{[b]:ce,[v]:[Wi,ar]}],[E]:[{[m]:Nd,error:"S3 Outposts does not support Dual-stack",[p]:B},{[m]:cs,error:"S3 Outposts does not support FIPS",[p]:B},{[m]:no,error:"S3 Outposts does not support S3 Accelerate",[p]:B},{[m]:[{[b]:Pt,[v]:[{[b]:Ie,[v]:[kt,"resourceId[4]"]}]}],error:"Invalid Arn: Outpost Access Point ARN contains sub resources",[p]:B},{[m]:[{[b]:Ie,[v]:P4,[J]:$o}],[E]:[{[m]:Xd,[E]:[Vi,{[m]:io,[E]:[{[m]:Mt,[E]:[{[m]:nl,[E]:[{[m]:oo,[E]:[{[m]:ao,[E]:[{[m]:[{[b]:Ie,[v]:_4,[J]:ed}],[E]:[{[m]:[{[b]:Ie,[v]:[kt,"resourceId[3]"],[J]:Aa}],[E]:[{[m]:[{[b]:ce,[v]:[{[H]:ed},Gu]}],[E]:[{[m]:as,endpoint:{[F]:"https://{accessPointName}-{bucketArn#accountId}.{outpostId}.{url#authority}",[D]:kd,[N]:K},[p]:T},{endpoint:{[F]:"https://{accessPointName}-{bucketArn#accountId}.{outpostId}.s3-outposts.{bucketArn#region}.{bucketPartition#dnsSuffix}",[D]:kd,[N]:K},[p]:T}],[p]:C},{error:"Expected an outpost type `accesspoint`, found {outpostType}",[p]:B}],[p]:C},{error:"Invalid ARN: expected an access point name",[p]:B}],[p]:C},{error:"Invalid ARN: Expected a 4-component resource",[p]:B}],[p]:C},Gi],[p]:C},Zi],[p]:C},Xi],[p]:C}],[p]:C}],[p]:C},{error:"Invalid ARN: The outpost Id may only contain a-z, A-Z, 0-9 and `-`. Found: `{outpostId}`",[p]:B}],[p]:C},{error:"Invalid ARN: The Outpost Id was not set",[p]:B}],[p]:C},{error:"Invalid ARN: Unrecognized format: {Bucket} (type: {arnType})",[p]:B}],[p]:C},{error:"Invalid ARN: No ARN type specified",[p]:B}],[p]:C},{[m]:[{[b]:be,[v]:[ae,0,4,v4],[J]:td},{[b]:ce,[v]:[{[H]:td},"arn:"]},{[b]:Gt,[v]:[{[b]:Pt,[v]:[Pd]}]}],error:"Invalid ARN: `{Bucket}` was not a valid ARN",[p]:B},{[m]:[{[b]:He,[v]:[x4,zt]},Pd],error:"Path-style addressing cannot be used with ARN buckets",[p]:B},{[m]:C4,[E]:[{[m]:Mt,[E]:[{[m]:[je],[E]:[{[m]:[we,G,Ae,Xe],endpoint:{[F]:"https://s3-fips.dualstack.us-east-1.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",[D]:et,[N]:K},[p]:T},{[m]:[we,G,Ae,ie,tt],[E]:[{endpoint:_d,[p]:T}],[p]:C},{[m]:[we,G,Ae,ie,nt],endpoint:_d,[p]:T},{[m]:[se,G,Ae,Xe],endpoint:{[F]:"https://s3-fips.us-east-1.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",[D]:et,[N]:K},[p]:T},{[m]:[se,G,Ae,ie,tt],[E]:[{endpoint:Td,[p]:T}],[p]:C},{[m]:[se,G,Ae,ie,nt],endpoint:Td,[p]:T},{[m]:[we,G,te,Xe],endpoint:{[F]:"https://s3.dualstack.us-east-1.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",[D]:et,[N]:K},[p]:T},{[m]:[we,G,te,ie,tt],[E]:[{endpoint:Rd,[p]:T}],[p]:C},{[m]:[we,G,te,ie,nt],endpoint:Rd,[p]:T},{[m]:[se,Oe,vt,te,Xe],endpoint:{[F]:Zu,[D]:et,[N]:K},[p]:T},{[m]:[se,Oe,vt,te,ie,tt],[E]:[{[m]:ln,endpoint:Yi,[p]:T},{endpoint:Yi,[p]:T}],[p]:C},{[m]:[se,Oe,vt,te,ie,nt],endpoint:Yi,[p]:T},{[m]:[se,G,te,Xe],endpoint:{[F]:nd,[D]:et,[N]:K},[p]:T},{[m]:[se,G,te,ie,tt],[E]:[{[m]:ln,endpoint:{[F]:nd,[D]:Ke,[N]:K},[p]:T},{endpoint:Md,[p]:T}],[p]:C},{[m]:[se,G,te,ie,nt],endpoint:Md,[p]:T}],[p]:C},{error:"Path-style addressing cannot be used with S3 Accelerate",[p]:B}],[p]:C}],[p]:C}],[p]:C},{[m]:[{[b]:Pt,[v]:[Id]},{[b]:He,[v]:[Id,zt]}],[E]:[{[m]:Mt,[E]:[{[m]:rl,[E]:[vd,xd,{[m]:as,endpoint:{[F]:Ur,[D]:Ji,[N]:K},[p]:T},{[m]:cs,endpoint:{[F]:"https://s3-object-lambda-fips.{Region}.{partitionResult#dnsSuffix}",[D]:Ji,[N]:K},[p]:T},{endpoint:{[F]:"https://s3-object-lambda.{Region}.{partitionResult#dnsSuffix}",[D]:Ji,[N]:K},[p]:T}],[p]:C},Lr],[p]:C}],[p]:C},{[m]:[ud],[E]:[{[m]:Mt,[E]:[{[m]:rl,[E]:[{[m]:[Ae,we,G,Xe],endpoint:{[F]:"https://s3-fips.dualstack.us-east-1.{partitionResult#dnsSuffix}",[D]:et,[N]:K},[p]:T},{[m]:[Ae,we,G,ie,tt],[E]:[{endpoint:Ld,[p]:T}],[p]:C},{[m]:[Ae,we,G,ie,nt],endpoint:Ld,[p]:T},{[m]:[Ae,se,G,Xe],endpoint:{[F]:"https://s3-fips.us-east-1.{partitionResult#dnsSuffix}",[D]:et,[N]:K},[p]:T},{[m]:[Ae,se,G,ie,tt],[E]:[{endpoint:Bd,[p]:T}],[p]:C},{[m]:[Ae,se,G,ie,nt],endpoint:Bd,[p]:T},{[m]:[te,we,G,Xe],endpoint:{[F]:"https://s3.dualstack.us-east-1.{partitionResult#dnsSuffix}",[D]:et,[N]:K},[p]:T},{[m]:[te,we,G,ie,tt],[E]:[{endpoint:Fd,[p]:T}],[p]:C},{[m]:[te,we,G,ie,nt],endpoint:Fd,[p]:T},{[m]:[te,se,Oe,vt,Xe],endpoint:{[F]:Ur,[D]:et,[N]:K},[p]:T},{[m]:[te,se,Oe,vt,ie,tt],[E]:[{[m]:ln,endpoint:eo,[p]:T},{endpoint:eo,[p]:T}],[p]:C},{[m]:[te,se,Oe,vt,ie,nt],endpoint:eo,[p]:T},{[m]:[te,se,G,Xe],endpoint:{[F]:sd,[D]:et,[N]:K},[p]:T},{[m]:[te,se,G,ie,tt],[E]:[{[m]:ln,endpoint:{[F]:sd,[D]:Ke,[N]:K},[p]:T},{endpoint:Dd,[p]:T}],[p]:C},{[m]:[te,se,G,ie,nt],endpoint:Dd,[p]:T}],[p]:C},Lr],[p]:C}],[p]:C}],[p]:C},{error:"A region must be set when sending requests to S3.",[p]:B}]},R4=T4,M4=new F0({size:50,params:["Accelerate","Bucket","DisableAccessPoints","DisableMultiRegionAccessPoints","DisableS3ExpressSessionAuth","Endpoint","ForcePathStyle","Region","UseArnRegion","UseDualStack","UseFIPS","UseGlobalEndpoint","UseObjectLambdaEndpoint","UseS3ExpressControlEndpoint"]}),rh=(t,e={})=>M4.get(t,()=>D0(R4,{endpointParams:t,logger:e.logger}));Vl.aws=Lu;const I4=t=>async(e,n,s)=>{var a,d,c;if(!s)throw new Error("Could not find `input` for `defaultEndpointRuleSetHttpAuthSchemeParametersProvider`");const r=await t(e,n,s),i=(c=(d=(a=_s(n))==null?void 0:a.commandInstance)==null?void 0:d.constructor)==null?void 0:c.getEndpointParameterInstructions;if(!i)throw new Error(`getEndpointParameterInstructions() is not defined on \`${n.commandName}\``);const o=await Nu(s,{getEndpointParameterInstructions:i},e);return Object.assign(r,o)},L4=async(t,e,n)=>({operation:_s(e).operation,region:await $t(t.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()}),B4=I4(L4);function ih(t){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"s3",region:t.region},propertiesExtractor:(e,n)=>({signingProperties:{config:e,context:n}})}}function oh(t){return{schemeId:"aws.auth#sigv4a",signingProperties:{name:"s3",region:t.region},propertiesExtractor:(e,n)=>({signingProperties:{config:e,context:n}})}}const F4=(t,e,n)=>r=>{var d;const o=(d=t(r).properties)==null?void 0:d.authSchemes;if(!o)return e(r);const a=[];for(const c of o){const{name:l,properties:u={},...h}=c,f=l.toLowerCase();l!==f&&console.warn(`HttpAuthScheme has been normalized with lowercasing: \`${l}\` to \`${f}\``);let y;if(f==="sigv4a"){y="aws.auth#sigv4a";const _=o.find(R=>{const S=R.name.toLowerCase();return S!=="sigv4a"&&S.startsWith("sigv4")});if($u.sigv4aDependency()==="none"&&_)continue}else if(f.startsWith("sigv4"))y="aws.auth#sigv4";else throw new Error(`Unknown HttpAuthScheme found in \`@smithy.rules#endpointRuleSet\`: \`${f}\``);const x=n[y];if(!x)throw new Error(`Could not find HttpAuthOption create function for \`${y}\``);const w=x(r);w.schemeId=y,w.signingProperties={...w.signingProperties||{},...h,...u},a.push(w)}return a},D4=t=>{const e=[];switch(t.operation){default:e.push(ih(t)),e.push(oh(t))}return e},N4=F4(rh,D4,{"aws.auth#sigv4":ih,"aws.auth#sigv4a":oh}),O4=t=>{const e=Fm(t),n=dm(e);return Object.assign(n,{authSchemePreference:$t(t.authSchemePreference??[])})},U4=t=>Object.assign(t,{useFipsEndpoint:t.useFipsEndpoint??!1,useDualstackEndpoint:t.useDualstackEndpoint??!1,forcePathStyle:t.forcePathStyle??!1,useAccelerateEndpoint:t.useAccelerateEndpoint??!1,useGlobalEndpoint:t.useGlobalEndpoint??!1,disableMultiregionAccessPoints:t.disableMultiregionAccessPoints??!1,defaultSigningName:"s3"}),Kn={ForcePathStyle:{type:"clientContextParams",name:"forcePathStyle"},UseArnRegion:{type:"clientContextParams",name:"useArnRegion"},DisableMultiRegionAccessPoints:{type:"clientContextParams",name:"disableMultiregionAccessPoints"},Accelerate:{type:"clientContextParams",name:"useAccelerateEndpoint"},DisableS3ExpressSessionAuth:{type:"clientContextParams",name:"disableS3ExpressSessionAuth"},UseGlobalEndpoint:{type:"builtInParams",name:"useGlobalEndpoint"},UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}};class lt extends us{constructor(e){super(e),Object.setPrototypeOf(this,lt.prototype)}}class Pa extends lt{constructor(n){super({name:"NoSuchUpload",$fault:"client",...n});g(this,"name","NoSuchUpload");g(this,"$fault","client");Object.setPrototypeOf(this,Pa.prototype)}}const ah={CRC32:"CRC32",CRC32C:"CRC32C",CRC64NVME:"CRC64NVME",SHA1:"SHA1",SHA256:"SHA256"};class _a extends lt{constructor(n){super({name:"ObjectNotInActiveTierError",$fault:"client",...n});g(this,"name","ObjectNotInActiveTierError");g(this,"$fault","client");Object.setPrototypeOf(this,_a.prototype)}}class Ta extends lt{constructor(n){super({name:"BucketAlreadyExists",$fault:"client",...n});g(this,"name","BucketAlreadyExists");g(this,"$fault","client");Object.setPrototypeOf(this,Ta.prototype)}}class Ra extends lt{constructor(n){super({name:"BucketAlreadyOwnedByYou",$fault:"client",...n});g(this,"name","BucketAlreadyOwnedByYou");g(this,"$fault","client");Object.setPrototypeOf(this,Ra.prototype)}}class Ma extends lt{constructor(n){super({name:"NoSuchBucket",$fault:"client",...n});g(this,"name","NoSuchBucket");g(this,"$fault","client");Object.setPrototypeOf(this,Ma.prototype)}}var il;(function(t){t.visit=(e,n)=>e.Prefix!==void 0?n.Prefix(e.Prefix):e.Tag!==void 0?n.Tag(e.Tag):e.And!==void 0?n.And(e.And):n._(e.$unknown[0],e.$unknown[1])})(il||(il={}));var ol;(function(t){t.visit=(e,n)=>e.Prefix!==void 0?n.Prefix(e.Prefix):e.Tag!==void 0?n.Tag(e.Tag):e.AccessPointArn!==void 0?n.AccessPointArn(e.AccessPointArn):e.And!==void 0?n.And(e.And):n._(e.$unknown[0],e.$unknown[1])})(ol||(ol={}));class Ia extends lt{constructor(n){super({name:"InvalidObjectState",$fault:"client",...n});g(this,"name","InvalidObjectState");g(this,"$fault","client");g(this,"StorageClass");g(this,"AccessTier");Object.setPrototypeOf(this,Ia.prototype),this.StorageClass=n.StorageClass,this.AccessTier=n.AccessTier}}class La extends lt{constructor(n){super({name:"NoSuchKey",$fault:"client",...n});g(this,"name","NoSuchKey");g(this,"$fault","client");Object.setPrototypeOf(this,La.prototype)}}class Ba extends lt{constructor(n){super({name:"NotFound",$fault:"client",...n});g(this,"name","NotFound");g(this,"$fault","client");Object.setPrototypeOf(this,Ba.prototype)}}const Q4=t=>({...t,...t.SSEKMSKeyId&&{SSEKMSKeyId:Ve}}),$4=t=>({...t,...t.SSECustomerKey&&{SSECustomerKey:Ve}}),H4=t=>({...t,...t.SSEKMSKeyId&&{SSEKMSKeyId:Ve},...t.SSEKMSEncryptionContext&&{SSEKMSEncryptionContext:Ve}}),z4=t=>({...t,...t.SSECustomerKey&&{SSECustomerKey:Ve},...t.SSEKMSKeyId&&{SSEKMSKeyId:Ve},...t.SSEKMSEncryptionContext&&{SSEKMSEncryptionContext:Ve}}),q4=t=>({...t,...t.SecretAccessKey&&{SecretAccessKey:Ve},...t.SessionToken&&{SessionToken:Ve}}),j4=t=>({...t,...t.SSEKMSKeyId&&{SSEKMSKeyId:Ve},...t.SSEKMSEncryptionContext&&{SSEKMSEncryptionContext:Ve},...t.Credentials&&{Credentials:q4(t.Credentials)}}),W4=t=>({...t,...t.SSEKMSKeyId&&{SSEKMSKeyId:Ve},...t.SSEKMSEncryptionContext&&{SSEKMSEncryptionContext:Ve}});class Fa extends lt{constructor(n){super({name:"EncryptionTypeMismatch",$fault:"client",...n});g(this,"name","EncryptionTypeMismatch");g(this,"$fault","client");Object.setPrototypeOf(this,Fa.prototype)}}class Da extends lt{constructor(n){super({name:"InvalidRequest",$fault:"client",...n});g(this,"name","InvalidRequest");g(this,"$fault","client");Object.setPrototypeOf(this,Da.prototype)}}class Na extends lt{constructor(n){super({name:"InvalidWriteOffset",$fault:"client",...n});g(this,"name","InvalidWriteOffset");g(this,"$fault","client");Object.setPrototypeOf(this,Na.prototype)}}class Oa extends lt{constructor(n){super({name:"TooManyParts",$fault:"client",...n});g(this,"name","TooManyParts");g(this,"$fault","client");Object.setPrototypeOf(this,Oa.prototype)}}class Ua extends lt{constructor(n){super({name:"IdempotencyParameterMismatch",$fault:"client",...n});g(this,"name","IdempotencyParameterMismatch");g(this,"$fault","client");Object.setPrototypeOf(this,Ua.prototype)}}class Qa extends lt{constructor(n){super({name:"ObjectAlreadyInActiveTierError",$fault:"client",...n});g(this,"name","ObjectAlreadyInActiveTierError");g(this,"$fault","client");Object.setPrototypeOf(this,Qa.prototype)}}var al;(function(t){t.visit=(e,n)=>e.Records!==void 0?n.Records(e.Records):e.Stats!==void 0?n.Stats(e.Stats):e.Progress!==void 0?n.Progress(e.Progress):e.Cont!==void 0?n.Cont(e.Cont):e.End!==void 0?n.End(e.End):n._(e.$unknown[0],e.$unknown[1])})(al||(al={}));const V4=t=>({...t,...t.SSEKMSKeyId&&{SSEKMSKeyId:Ve},...t.SSEKMSEncryptionContext&&{SSEKMSEncryptionContext:Ve}}),K4=t=>({...t,...t.SSECustomerKey&&{SSECustomerKey:Ve},...t.SSEKMSKeyId&&{SSEKMSKeyId:Ve},...t.SSEKMSEncryptionContext&&{SSEKMSEncryptionContext:Ve}}),G4=t=>({...t,...t.SSEKMSKeyId&&{SSEKMSKeyId:Ve}}),Z4=t=>({...t,...t.SSECustomerKey&&{SSECustomerKey:Ve}}),X4=async(t,e)=>{const n=qn(t,e),s=oe({},Ye,{[Bs]:t[Ms],[Ls]:t[Rs],[Xy]:[()=>Ye(t[cl]),()=>ha(t[cl]).toString()]});n.bp("/{Key+}"),n.p("Bucket",()=>t.Bucket,"{Bucket}",!1),n.p("Key",()=>t.Key,"{Key+}",!0);const r=oe({[Va]:[,"AbortMultipartUpload"],[qa]:[,on(t[ws],"UploadId")]});return n.m("DELETE").h(s).q(r).b(void 0),n.build()},Y4=async(t,e)=>{const n=qn(t,e),s=oe({},Ye,{"content-type":"application/xml",[pr]:t[Jt],[mr]:t[en],[gr]:t[tn],[yr]:t[nn],[wr]:t[sn],[yi]:t[Qn],[Yy]:[()=>Ye(t[dl]),()=>t[dl].toString()],[Bs]:t[Ms],[Ls]:t[Rs],[Ih]:t[wh],[Lh]:t[bh],[Yn]:t[Zn],[wi]:t[mi],[Jn]:t[Xn]});n.bp("/{Key+}"),n.p("Bucket",()=>t.Bucket,"{Bucket}",!1),n.p("Key",()=>t.Key,"{Key+}",!0);const r=oe({[qa]:[,on(t[ws],"UploadId")]});let i,o;return t.MultipartUpload!==void 0&&(o=ky(t.MultipartUpload),o=o.n("CompleteMultipartUpload"),i=Bh,o.a("xmlns","http://s3.amazonaws.com/doc/2006-03-01/"),i+=o.toString()),n.m("POST").h(s).q(r).b(i),n.build()},J4=async(t,e)=>{const n=qn(t,e),s=oe({},Ye,{...t.Metadata!==void 0&&Object.keys(t.Metadata).reduce((o,a)=>(o[`x-amz-meta-${a.toLowerCase()}`]=t.Metadata[a],o),{}),[Fh]:t[ch],[Ch]:t[dh],[Ah]:t[lh],[kh]:t[uh],[Ph]:t[hh],[Th]:t[fh],[Rh]:[()=>Ye(t[si]),()=>ha(t[si]).toString()],[Oh]:t[ph],[Uh]:t[mh],[Qh]:t[gh],[$h]:t[yh],[Pn]:t[An],[jh]:t[Js],[Vh]:t[Eh],[Yn]:t[Zn],[wi]:t[mi],[Jn]:t[Xn],[_n]:t[kn],[Fs]:t[Is],[_t]:[()=>Ye(t[Ht]),()=>t[Ht].toString()],[Bs]:t[Ms],[Wh]:t[Ha],[zh]:t[xh],[qh]:[()=>Ye(t[ri]),()=>Su(t[ri]).toString()],[Hh]:t[vh],[Ls]:t[Rs],[Dh]:t[hr],[yi]:t[Qn]});n.bp("/{Key+}"),n.p("Bucket",()=>t.Bucket,"{Bucket}",!1),n.p("Key",()=>t.Key,"{Key+}",!0);const r=oe({[Vy]:[,""]});return n.m("POST").h(s).q(r).b(void 0),n.build()},ey=async(t,e)=>{const n=qn(t,e),s=oe({},Ye,{[Zy]:t[Uy],[Pn]:t[An],[_n]:t[kn],[Fs]:t[Is],[_t]:[()=>Ye(t[Ht]),()=>t[Ht].toString()]});n.bp("/"),n.p("Bucket",()=>t.Bucket,"{Bucket}",!1);const r=oe({[jy]:[,""]});return n.m("GET").h(s).q(r).b(void 0),n.build()},ty=async(t,e)=>{const n=qn(t,e),s=oe({},Ye,{...t.Metadata!==void 0&&Object.keys(t.Metadata).reduce((a,d)=>(a[`x-amz-meta-${d.toLowerCase()}`]=t.Metadata[d],a),{}),[Th]:t[fh]||"application/octet-stream",[Fh]:t[ch],[Ch]:t[dh],[Ah]:t[lh],[kh]:t[uh],[Ph]:t[hh],[_h]:[()=>Ye(t[ni]),()=>t[ni].toString()],[za]:t[$a],[ja]:t[hr],[pr]:t[Jt],[mr]:t[en],[gr]:t[tn],[yr]:t[nn],[wr]:t[sn],[Rh]:[()=>Ye(t[si]),()=>ha(t[si]).toString()],[Ih]:t[wh],[Lh]:t[bh],[Oh]:t[ph],[Uh]:t[mh],[Qh]:t[gh],[$h]:t[yh],[Jy]:[()=>Ye(t[ll]),()=>t[ll].toString()],[Pn]:t[An],[jh]:t[Js],[Vh]:t[Eh],[Yn]:t[Zn],[wi]:t[mi],[Jn]:t[Xn],[_n]:t[kn],[Fs]:t[Is],[_t]:[()=>Ye(t[Ht]),()=>t[Ht].toString()],[Bs]:t[Ms],[Wh]:t[Ha],[zh]:t[xh],[qh]:[()=>Ye(t[ri]),()=>Su(t[ri]).toString()],[Hh]:t[vh],[Ls]:t[Rs]});n.bp("/{Key+}"),n.p("Bucket",()=>t.Bucket,"{Bucket}",!1),n.p("Key",()=>t.Key,"{Key+}",!0);const r=oe({[Va]:[,"PutObject"]});let i,o;return t.Body!==void 0&&(o=t.Body,i=o),n.m("PUT").h(s).q(r).b(i),n.build()},ny=async(t,e)=>{const n=qn(t,e),s=oe({},Ye,{"content-type":"application/xml",[za]:t[$a],[ja]:t[hr],[Ls]:t[Rs],[Bs]:t[Ms]});n.bp("/{Key+}"),n.p("Bucket",()=>t.Bucket,"{Bucket}",!1),n.p("Key",()=>t.Key,"{Key+}",!0);const r=oe({[Wy]:[,""],[Ky]:[,t[gi]]});let i,o;return t.Tagging!==void 0&&(o=Ry(t.Tagging),i=Bh,o.a("xmlns","http://s3.amazonaws.com/doc/2006-03-01/"),i+=o.toString()),n.m("PUT").h(s).q(r).b(i),n.build()},sy=async(t,e)=>{const n=qn(t,e),s=oe({},Ye,{"content-type":"application/octet-stream",[_h]:[()=>Ye(t[ni]),()=>t[ni].toString()],[za]:t[$a],[ja]:t[hr],[pr]:t[Jt],[mr]:t[en],[gr]:t[tn],[yr]:t[nn],[wr]:t[sn],[Yn]:t[Zn],[wi]:t[mi],[Jn]:t[Xn],[Bs]:t[Ms],[Ls]:t[Rs]});n.bp("/{Key+}"),n.p("Bucket",()=>t.Bucket,"{Bucket}",!1),n.p("Key",()=>t.Key,"{Key+}",!0);const r=oe({[Va]:[,"UploadPart"],[qy]:[on(t.PartNumber,"PartNumber")!=null,()=>t[zs].toString()],[qa]:[,on(t[ws],"UploadId")]});let i,o;return t.Body!==void 0&&(o=t.Body,i=o),n.m("PUT").h(s).q(r).b(i),n.build()},ry=async(t,e)=>{if(t.statusCode!==204&&t.statusCode>=300)return Gn(t,e);const n=oe({$metadata:ze(t),[fr]:[,t.headers[br]]});return await lr(t.body,e),n},iy=async(t,e)=>{if(t.statusCode!==200&&t.statusCode>=300)return Gn(t,e);const n=oe({$metadata:ze(t),[Ys]:[,t.headers[Nh]],[An]:[,t.headers[Pn]],[gi]:[,t.headers[Wa]],[kn]:[,t.headers[_n]],[Ht]:[()=>t.headers[_t]!==void 0,()=>ur(t.headers[_t])],[fr]:[,t.headers[br]]}),s=on(la(await fi(t.body,e)),"body");return s[gs]!=null&&(n[gs]=st(s[gs])),s[Jt]!=null&&(n[Jt]=st(s[Jt])),s[en]!=null&&(n[en]=st(s[en])),s[tn]!=null&&(n[tn]=st(s[tn])),s[nn]!=null&&(n[nn]=st(s[nn])),s[sn]!=null&&(n[sn]=st(s[sn])),s[Qn]!=null&&(n[Qn]=st(s[Qn])),s[ys]!=null&&(n[ys]=st(s[ys])),s[rn]!=null&&(n[rn]=st(s[rn])),s[ho]!=null&&(n[ho]=st(s[ho])),n},oy=async(t,e)=>{if(t.statusCode!==200&&t.statusCode>=300)return Gn(t,e);const n=oe({$metadata:ze(t),[Ly]:[()=>t.headers[ul]!==void 0,()=>on(j1(t.headers[ul]))],[By]:[,t.headers[Gy]],[An]:[,t.headers[Pn]],[Zn]:[,t.headers[Yn]],[Xn]:[,t.headers[Jn]],[kn]:[,t.headers[_n]],[Is]:[,t.headers[Fs]],[Ht]:[()=>t.headers[_t]!==void 0,()=>ur(t.headers[_t])],[fr]:[,t.headers[br]],[hr]:[,t.headers[Dh]],[Qn]:[,t.headers[yi]]}),s=on(la(await fi(t.body,e)),"body");return s[gs]!=null&&(n[gs]=st(s[gs])),s[rn]!=null&&(n[rn]=st(s[rn])),s[ws]!=null&&(n[ws]=st(s[ws])),n},ay=async(t,e)=>{if(t.statusCode!==200&&t.statusCode>=300)return Gn(t,e);const n=oe({$metadata:ze(t),[An]:[,t.headers[Pn]],[kn]:[,t.headers[_n]],[Is]:[,t.headers[Fs]],[Ht]:[()=>t.headers[_t]!==void 0,()=>ur(t.headers[_t])]}),s=on(la(await fi(t.body,e)),"body");return s[uo]!=null&&(n[uo]=Iy(s[uo])),n},cy=async(t,e)=>{if(t.statusCode!==200&&t.statusCode>=300)return Gn(t,e);const n=oe({$metadata:ze(t),[Ys]:[,t.headers[Nh]],[ys]:[,t.headers[Mh]],[Jt]:[,t.headers[pr]],[en]:[,t.headers[mr]],[tn]:[,t.headers[gr]],[nn]:[,t.headers[yr]],[sn]:[,t.headers[wr]],[Qn]:[,t.headers[yi]],[An]:[,t.headers[Pn]],[gi]:[,t.headers[Wa]],[Zn]:[,t.headers[Yn]],[Xn]:[,t.headers[Jn]],[kn]:[,t.headers[_n]],[Is]:[,t.headers[Fs]],[Ht]:[()=>t.headers[_t]!==void 0,()=>ur(t.headers[_t])],[Qy]:[()=>t.headers[hl]!==void 0,()=>N1(t.headers[hl])],[fr]:[,t.headers[br]]});return await lr(t.body,e),n},dy=async(t,e)=>{if(t.statusCode!==200&&t.statusCode>=300)return Gn(t,e);const n=oe({$metadata:ze(t),[gi]:[,t.headers[Wa]]});return await lr(t.body,e),n},ly=async(t,e)=>{if(t.statusCode!==200&&t.statusCode>=300)return Gn(t,e);const n=oe({$metadata:ze(t),[An]:[,t.headers[Pn]],[ys]:[,t.headers[Mh]],[Jt]:[,t.headers[pr]],[en]:[,t.headers[mr]],[tn]:[,t.headers[gr]],[nn]:[,t.headers[yr]],[sn]:[,t.headers[wr]],[Zn]:[,t.headers[Yn]],[Xn]:[,t.headers[Jn]],[kn]:[,t.headers[_n]],[Ht]:[()=>t.headers[_t]!==void 0,()=>ur(t.headers[_t])],[fr]:[,t.headers[br]]});return await lr(t.body,e),n},Gn=async(t,e)=>{const n={...t,body:await Vg(t.body,e)},s=Kg(t,n.body);switch(s){case"NoSuchUpload":case"com.amazonaws.s3#NoSuchUpload":throw await xy(n);case"ObjectNotInActiveTierError":case"com.amazonaws.s3#ObjectNotInActiveTierError":throw await Cy(n);case"BucketAlreadyExists":case"com.amazonaws.s3#BucketAlreadyExists":throw await hy(n);case"BucketAlreadyOwnedByYou":case"com.amazonaws.s3#BucketAlreadyOwnedByYou":throw await fy(n);case"NoSuchBucket":case"com.amazonaws.s3#NoSuchBucket":throw await by(n);case"InvalidObjectState":case"com.amazonaws.s3#InvalidObjectState":throw await gy(n);case"NoSuchKey":case"com.amazonaws.s3#NoSuchKey":throw await vy(n);case"NotFound":case"com.amazonaws.s3#NotFound":throw await Sy(n);case"EncryptionTypeMismatch":case"com.amazonaws.s3#EncryptionTypeMismatch":throw await py(n);case"InvalidRequest":case"com.amazonaws.s3#InvalidRequest":throw await yy(n);case"InvalidWriteOffset":case"com.amazonaws.s3#InvalidWriteOffset":throw await wy(n);case"TooManyParts":case"com.amazonaws.s3#TooManyParts":throw await Ay(n);case"IdempotencyParameterMismatch":case"com.amazonaws.s3#IdempotencyParameterMismatch":throw await my(n);case"ObjectAlreadyInActiveTierError":case"com.amazonaws.s3#ObjectAlreadyInActiveTierError":throw await Ey(n);default:const r=n.body;return uy({output:t,parsedBody:r,errorCode:s})}},uy=Hm(lt),hy=async(t,e)=>{const n=oe({});t.body;const s=new Ta({$metadata:ze(t),...n});return Ct(s,t.body)},fy=async(t,e)=>{const n=oe({});t.body;const s=new Ra({$metadata:ze(t),...n});return Ct(s,t.body)},py=async(t,e)=>{const n=oe({});t.body;const s=new Fa({$metadata:ze(t),...n});return Ct(s,t.body)},my=async(t,e)=>{const n=oe({});t.body;const s=new Ua({$metadata:ze(t),...n});return Ct(s,t.body)},gy=async(t,e)=>{const n=oe({}),s=t.body;s[lo]!=null&&(n[lo]=st(s[lo])),s[Js]!=null&&(n[Js]=st(s[Js]));const r=new Ia({$metadata:ze(t),...n});return Ct(r,t.body)},yy=async(t,e)=>{const n=oe({});t.body;const s=new Da({$metadata:ze(t),...n});return Ct(s,t.body)},wy=async(t,e)=>{const n=oe({});t.body;const s=new Na({$metadata:ze(t),...n});return Ct(s,t.body)},by=async(t,e)=>{const n=oe({});t.body;const s=new Ma({$metadata:ze(t),...n});return Ct(s,t.body)},vy=async(t,e)=>{const n=oe({});t.body;const s=new La({$metadata:ze(t),...n});return Ct(s,t.body)},xy=async(t,e)=>{const n=oe({});t.body;const s=new Pa({$metadata:ze(t),...n});return Ct(s,t.body)},Sy=async(t,e)=>{const n=oe({});t.body;const s=new Ba({$metadata:ze(t),...n});return Ct(s,t.body)},Ey=async(t,e)=>{const n=oe({});t.body;const s=new Qa({$metadata:ze(t),...n});return Ct(s,t.body)},Cy=async(t,e)=>{const n=oe({});t.body;const s=new _a({$metadata:ze(t),...n});return Ct(s,t.body)},Ay=async(t,e)=>{const n=oe({});t.body;const s=new Oa({$metadata:ze(t),...n});return Ct(s,t.body)},ky=(t,e)=>{const n=new Kt(Fy);return n.l(t,"Parts","Part",()=>_y(t[Oy])),n},Py=(t,e)=>{const n=new Kt(Dy);return n.cc(t,ys),n.cc(t,Jt),n.cc(t,en),n.cc(t,tn),n.cc(t,nn),n.cc(t,sn),t[zs]!=null&&n.c(Kt.of(zs,String(t[zs])).n(zs)),n},_y=(t,e)=>t.filter(n=>n!=null).map(n=>Py(n).n(zy)),Ty=(t,e)=>{const n=new Kt(Sh);return t[rn]!=null&&n.c(Kt.of(Ny,t[rn]).n(rn)),n.cc(t,Hy),n},Ry=(t,e)=>{const n=new Kt(Ha);return n.lc(t,"TagSet","TagSet",()=>My(t[$y])),n},My=(t,e)=>t.filter(n=>n!=null).map(n=>Ty(n).n(Sh)),Iy=(t,e)=>{const n={};return t[co]!=null&&(n[co]=st(t[co])),t[fo]!=null&&(n[fo]=st(t[fo])),t[po]!=null&&(n[po]=st(t[po])),t[Ys]!=null&&(n[Ys]=on($1(t[Ys]))),n},ze=t=>({httpStatusCode:t.statusCode,requestId:t.headers["x-amzn-requestid"]??t.headers["x-amzn-request-id"]??t.headers["x-amz-request-id"],extendedRequestId:t.headers["x-amz-id-2"],cfId:t.headers["x-amz-cf-id"]}),ch="ACL",Ly="AbortDate",co="AccessKeyId",By="AbortRuleId",lo="AccessTier",gs="Bucket",Ht="BucketKeyEnabled",uo="Credentials",hr="ChecksumAlgorithm",dh="CacheControl",Jt="ChecksumCRC32",en="ChecksumCRC32C",tn="ChecksumCRC64NVME",lh="ContentDisposition",uh="ContentEncoding",hh="ContentLanguage",ni="ContentLength",$a="ContentMD5",Fy="CompletedMultipartUpload",Dy="CompletedPart",nn="ChecksumSHA1",sn="ChecksumSHA256",Qn="ChecksumType",fh="ContentType",si="Expires",Rs="ExpectedBucketOwner",ys="ETag",Ys="Expiration",ph="GrantFullControl",mh="GrantRead",gh="GrantReadACP",yh="GrantWriteACP",wh="IfMatch",cl="IfMatchInitiatedTime",bh="IfNoneMatch",rn="Key",ho="Location",dl="MpuObjectSize",Ny="ObjectKey",vh="ObjectLockLegalHoldStatus",xh="ObjectLockMode",ri="ObjectLockRetainUntilDate",zs="PartNumber",Oy="Parts",fr="RequestCharged",Ms="RequestPayer",fo="SecretAccessKey",Js="StorageClass",Uy="SessionMode",An="ServerSideEncryption",Zn="SSECustomerAlgorithm",mi="SSECustomerKey",Xn="SSECustomerKeyMD5",Is="SSEKMSEncryptionContext",kn="SSEKMSKeyId",po="SessionToken",Qy="Size",Ha="Tagging",$y="TagSet",Sh="Tag",ws="UploadId",gi="VersionId",Hy="Value",ll="WriteOffsetBytes",Eh="WebsiteRedirectLocation",Ch="cache-control",Ah="content-disposition",kh="content-encoding",Ph="content-language",_h="content-length",za="content-md5",Th="content-type",Rh="expires",Mh="etag",Ih="if-match",Lh="if-none-match",zy="member",qy="partNumber",jy="session",Wy="tagging",Vy="uploads",qa="uploadId",Ky="versionId",Bh='<?xml version="1.0" encoding="UTF-8"?>',Fh="x-amz-acl",ul="x-amz-abort-date",Gy="x-amz-abort-rule-id",Dh="x-amz-checksum-algorithm",pr="x-amz-checksum-crc32",mr="x-amz-checksum-crc32c",gr="x-amz-checksum-crc64nvme",yr="x-amz-checksum-sha1",wr="x-amz-checksum-sha256",Zy="x-amz-create-session-mode",yi="x-amz-checksum-type",Nh="x-amz-expiration",Ls="x-amz-expected-bucket-owner",Oh="x-amz-grant-full-control",Uh="x-amz-grant-read",Qh="x-amz-grant-read-acp",$h="x-amz-grant-write-acp",Xy="x-amz-if-match-initiated-time",Yy="x-amz-mp-object-size",Hh="x-amz-object-lock-legal-hold",zh="x-amz-object-lock-mode",qh="x-amz-object-lock-retain-until-date",hl="x-amz-object-size",br="x-amz-request-charged",Bs="x-amz-request-payer",jh="x-amz-storage-class",ja="x-amz-sdk-checksum-algorithm",Pn="x-amz-server-side-encryption",_n="x-amz-server-side-encryption-aws-kms-key-id",_t="x-amz-server-side-encryption-bucket-key-enabled",Fs="x-amz-server-side-encryption-context",Yn="x-amz-server-side-encryption-customer-algorithm",wi="x-amz-server-side-encryption-customer-key",Jn="x-amz-server-side-encryption-customer-key-md5",Wh="x-amz-tagging",Wa="x-amz-version-id",Jy="x-amz-write-offset-bytes",Vh="x-amz-website-redirect-location",Va="x-id";class e3 extends Cn.classBuilder().ep({...Kn,DisableS3ExpressSessionAuth:{type:"staticContextParams",value:!0},Bucket:{type:"contextParams",name:"Bucket"}}).m(function(e,n,s,r){return[zn(s,this.serialize,this.deserialize),Wn(s,e.getEndpointParameterInstructions()),jn(s)]}).s("AmazonS3","CreateSession",{}).n("S3Client","CreateSessionCommand").f(W4,j4).ser(ey).de(ay).build(){}const t3="3.855.0",n3={version:t3};function fl(t){return typeof t=="string"?t.length===0:t.byteLength===0}var Kh={name:"SHA-1"},pl={name:"HMAC",hash:Kh},s3=new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]);const r3={};function vn(){return typeof window<"u"?window:typeof self<"u"?self:r3}var i3=function(){function t(e){this.toHash=new Uint8Array(0),e!==void 0&&(this.key=new Promise(function(n,s){vn().crypto.subtle.importKey("raw",ml(e),pl,!1,["sign"]).then(n,s)}),this.key.catch(function(){}))}return t.prototype.update=function(e){if(!fl(e)){var n=ml(e),s=new Uint8Array(this.toHash.byteLength+n.byteLength);s.set(this.toHash,0),s.set(n,this.toHash.byteLength),this.toHash=s}},t.prototype.digest=function(){var e=this;return this.key?this.key.then(function(n){return vn().crypto.subtle.sign(pl,n,e.toHash).then(function(s){return new Uint8Array(s)})}):fl(this.toHash)?Promise.resolve(s3):Promise.resolve().then(function(){return vn().crypto.subtle.digest(Kh,e.toHash)}).then(function(n){return Promise.resolve(new Uint8Array(n))})},t.prototype.reset=function(){this.toHash=new Uint8Array(0)},t}();function ml(t){return typeof t=="string"?Pu(t):ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(t)}var o3=["decrypt","digest","encrypt","exportKey","generateKey","importKey","sign","verify"];function Gh(t){if(a3(t)&&typeof t.crypto.subtle=="object"){var e=t.crypto.subtle;return c3(e)}return!1}function a3(t){if(typeof t=="object"&&typeof t.crypto=="object"){var e=t.crypto.getRandomValues;return typeof e=="function"}return!1}function c3(t){return t&&o3.every(function(e){return typeof t[e]=="function"})}var d3=function(){function t(e){if(Gh(vn()))this.hash=new i3(e);else throw new Error("SHA1 not supported")}return t.prototype.update=function(e,n){this.hash.update(Sn(e))},t.prototype.digest=function(){return this.hash.digest()},t.prototype.reset=function(){this.hash.reset()},t}(),Zh={name:"SHA-256"},gl={name:"HMAC",hash:Zh},l3=new Uint8Array([227,176,196,66,152,252,28,20,154,251,244,200,153,111,185,36,39,174,65,228,100,155,147,76,164,149,153,27,120,82,184,85]),u3=function(){function t(e){this.toHash=new Uint8Array(0),this.secret=e,this.reset()}return t.prototype.update=function(e){if(!or(e)){var n=Sn(e),s=new Uint8Array(this.toHash.byteLength+n.byteLength);s.set(this.toHash,0),s.set(n,this.toHash.byteLength),this.toHash=s}},t.prototype.digest=function(){var e=this;return this.key?this.key.then(function(n){return vn().crypto.subtle.sign(gl,n,e.toHash).then(function(s){return new Uint8Array(s)})}):or(this.toHash)?Promise.resolve(l3):Promise.resolve().then(function(){return vn().crypto.subtle.digest(Zh,e.toHash)}).then(function(n){return Promise.resolve(new Uint8Array(n))})},t.prototype.reset=function(){var e=this;this.toHash=new Uint8Array(0),this.secret&&this.secret!==void 0&&(this.key=new Promise(function(n,s){vn().crypto.subtle.importKey("raw",Sn(e.secret),gl,!1,["sign"]).then(n,s)}),this.key.catch(function(){}))},t}(),Bt=64,h3=32,f3=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),p3=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],m3=Math.pow(2,53)-1,Qr=function(){function t(){this.state=Int32Array.from(p3),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return t.prototype.update=function(e){if(this.finished)throw new Error("Attempted to update an already finished hash.");var n=0,s=e.byteLength;if(this.bytesHashed+=s,this.bytesHashed*8>m3)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;s>0;)this.buffer[this.bufferLength++]=e[n++],s--,this.bufferLength===Bt&&(this.hashBuffer(),this.bufferLength=0)},t.prototype.digest=function(){if(!this.finished){var e=this.bytesHashed*8,n=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),s=this.bufferLength;if(n.setUint8(this.bufferLength++,128),s%Bt>=Bt-8){for(var r=this.bufferLength;r<Bt;r++)n.setUint8(r,0);this.hashBuffer(),this.bufferLength=0}for(var r=this.bufferLength;r<Bt-8;r++)n.setUint8(r,0);n.setUint32(Bt-8,Math.floor(e/4294967296),!0),n.setUint32(Bt-4,e),this.hashBuffer(),this.finished=!0}for(var i=new Uint8Array(h3),r=0;r<8;r++)i[r*4]=this.state[r]>>>24&255,i[r*4+1]=this.state[r]>>>16&255,i[r*4+2]=this.state[r]>>>8&255,i[r*4+3]=this.state[r]>>>0&255;return i},t.prototype.hashBuffer=function(){for(var e=this,n=e.buffer,s=e.state,r=s[0],i=s[1],o=s[2],a=s[3],d=s[4],c=s[5],l=s[6],u=s[7],h=0;h<Bt;h++){if(h<16)this.temp[h]=(n[h*4]&255)<<24|(n[h*4+1]&255)<<16|(n[h*4+2]&255)<<8|n[h*4+3]&255;else{var f=this.temp[h-2],y=(f>>>17|f<<15)^(f>>>19|f<<13)^f>>>10;f=this.temp[h-15];var x=(f>>>7|f<<25)^(f>>>18|f<<14)^f>>>3;this.temp[h]=(y+this.temp[h-7]|0)+(x+this.temp[h-16]|0)}var w=(((d>>>6|d<<26)^(d>>>11|d<<21)^(d>>>25|d<<7))+(d&c^~d&l)|0)+(u+(f3[h]+this.temp[h]|0)|0)|0,_=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&o^i&o)|0;u=l,l=c,c=d,d=a+w|0,a=o,o=i,i=r,r=w+_|0}s[0]+=r,s[1]+=i,s[2]+=o,s[3]+=a,s[4]+=d,s[5]+=c,s[6]+=l,s[7]+=u},t}(),g3=function(){function t(e){this.secret=e,this.hash=new Qr,this.reset()}return t.prototype.update=function(e){if(!(or(e)||this.error))try{this.hash.update(Sn(e))}catch(n){this.error=n}},t.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},t.prototype.digest=function(){return ta(this,void 0,void 0,function(){return na(this,function(e){return[2,this.digestSync()]})})},t.prototype.reset=function(){if(this.hash=new Qr,this.secret){this.outer=new Qr;var e=y3(this.secret),n=new Uint8Array(Bt);n.set(e);for(var s=0;s<Bt;s++)e[s]^=54,n[s]^=92;this.hash.update(e),this.outer.update(n);for(var s=0;s<e.byteLength;s++)e[s]=0}},t}();function y3(t){var e=Sn(t);if(e.byteLength>Bt){var n=new Qr;n.update(e),e=n.digest()}var s=new Uint8Array(Bt);return s.set(e),s}var w3=function(){function t(e){Gh(vn())?this.hash=new u3(e):this.hash=new g3(e)}return t.prototype.update=function(e,n){this.hash.update(Sn(e))},t.prototype.digest=function(){return this.hash.digest()},t.prototype.reset=function(){this.hash.reset()},t}();const b3={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},Xh={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},Ne={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},xt={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},hn={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"};class P{static getFirstMatch(e,n){const s=n.match(e);return s&&s.length>0&&s[1]||""}static getSecondMatch(e,n){const s=n.match(e);return s&&s.length>1&&s[2]||""}static matchAndReturnConst(e,n,s){if(e.test(n))return s}static getWindowsVersionName(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}static getMacOSVersionName(e){const n=e.split(".").splice(0,2).map(s=>parseInt(s,10)||0);if(n.push(0),n[0]===10)switch(n[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}}static getAndroidVersionName(e){const n=e.split(".").splice(0,2).map(s=>parseInt(s,10)||0);if(n.push(0),!(n[0]===1&&n[1]<5)){if(n[0]===1&&n[1]<6)return"Cupcake";if(n[0]===1&&n[1]>=6)return"Donut";if(n[0]===2&&n[1]<2)return"Eclair";if(n[0]===2&&n[1]===2)return"Froyo";if(n[0]===2&&n[1]>2)return"Gingerbread";if(n[0]===3)return"Honeycomb";if(n[0]===4&&n[1]<1)return"Ice Cream Sandwich";if(n[0]===4&&n[1]<4)return"Jelly Bean";if(n[0]===4&&n[1]>=4)return"KitKat";if(n[0]===5)return"Lollipop";if(n[0]===6)return"Marshmallow";if(n[0]===7)return"Nougat";if(n[0]===8)return"Oreo";if(n[0]===9)return"Pie"}}static getVersionPrecision(e){return e.split(".").length}static compareVersions(e,n,s=!1){const r=P.getVersionPrecision(e),i=P.getVersionPrecision(n);let o=Math.max(r,i),a=0;const d=P.map([e,n],c=>{const l=o-P.getVersionPrecision(c),u=c+new Array(l+1).join(".0");return P.map(u.split("."),h=>new Array(20-h.length).join("0")+h).reverse()});for(s&&(a=o-Math.min(r,i)),o-=1;o>=a;){if(d[0][o]>d[1][o])return 1;if(d[0][o]===d[1][o]){if(o===a)return 0;o-=1}else if(d[0][o]<d[1][o])return-1}}static map(e,n){const s=[];let r;if(Array.prototype.map)return Array.prototype.map.call(e,n);for(r=0;r<e.length;r+=1)s.push(n(e[r]));return s}static find(e,n){let s,r;if(Array.prototype.find)return Array.prototype.find.call(e,n);for(s=0,r=e.length;s<r;s+=1){const i=e[s];if(n(i,s))return i}}static assign(e,...n){const s=e;let r,i;if(Object.assign)return Object.assign(e,...n);for(r=0,i=n.length;r<i;r+=1){const o=n[r];typeof o=="object"&&o!==null&&Object.keys(o).forEach(d=>{s[d]=o[d]})}return e}static getBrowserAlias(e){return b3[e]}static getBrowserTypeByAlias(e){return Xh[e]||""}}const ye=/version\/(\d+(\.?_?\d+)+)/i,v3=[{test:[/googlebot/i],describe(t){const e={name:"Googlebot"},n=P.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,t)||P.getFirstMatch(ye,t);return n&&(e.version=n),e}},{test:[/opera/i],describe(t){const e={name:"Opera"},n=P.getFirstMatch(ye,t)||P.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/opr\/|opios/i],describe(t){const e={name:"Opera"},n=P.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,t)||P.getFirstMatch(ye,t);return n&&(e.version=n),e}},{test:[/SamsungBrowser/i],describe(t){const e={name:"Samsung Internet for Android"},n=P.getFirstMatch(ye,t)||P.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/Whale/i],describe(t){const e={name:"NAVER Whale Browser"},n=P.getFirstMatch(ye,t)||P.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/MZBrowser/i],describe(t){const e={name:"MZ Browser"},n=P.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,t)||P.getFirstMatch(ye,t);return n&&(e.version=n),e}},{test:[/focus/i],describe(t){const e={name:"Focus"},n=P.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,t)||P.getFirstMatch(ye,t);return n&&(e.version=n),e}},{test:[/swing/i],describe(t){const e={name:"Swing"},n=P.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,t)||P.getFirstMatch(ye,t);return n&&(e.version=n),e}},{test:[/coast/i],describe(t){const e={name:"Opera Coast"},n=P.getFirstMatch(ye,t)||P.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(t){const e={name:"Opera Touch"},n=P.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,t)||P.getFirstMatch(ye,t);return n&&(e.version=n),e}},{test:[/yabrowser/i],describe(t){const e={name:"Yandex Browser"},n=P.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,t)||P.getFirstMatch(ye,t);return n&&(e.version=n),e}},{test:[/ucbrowser/i],describe(t){const e={name:"UC Browser"},n=P.getFirstMatch(ye,t)||P.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/Maxthon|mxios/i],describe(t){const e={name:"Maxthon"},n=P.getFirstMatch(ye,t)||P.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/epiphany/i],describe(t){const e={name:"Epiphany"},n=P.getFirstMatch(ye,t)||P.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/puffin/i],describe(t){const e={name:"Puffin"},n=P.getFirstMatch(ye,t)||P.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/sleipnir/i],describe(t){const e={name:"Sleipnir"},n=P.getFirstMatch(ye,t)||P.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/k-meleon/i],describe(t){const e={name:"K-Meleon"},n=P.getFirstMatch(ye,t)||P.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/micromessenger/i],describe(t){const e={name:"WeChat"},n=P.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,t)||P.getFirstMatch(ye,t);return n&&(e.version=n),e}},{test:[/qqbrowser/i],describe(t){const e={name:/qqbrowserlite/i.test(t)?"QQ Browser Lite":"QQ Browser"},n=P.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,t)||P.getFirstMatch(ye,t);return n&&(e.version=n),e}},{test:[/msie|trident/i],describe(t){const e={name:"Internet Explorer"},n=P.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/\sedg\//i],describe(t){const e={name:"Microsoft Edge"},n=P.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/edg([ea]|ios)/i],describe(t){const e={name:"Microsoft Edge"},n=P.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/vivaldi/i],describe(t){const e={name:"Vivaldi"},n=P.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/seamonkey/i],describe(t){const e={name:"SeaMonkey"},n=P.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/sailfish/i],describe(t){const e={name:"Sailfish"},n=P.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,t);return n&&(e.version=n),e}},{test:[/silk/i],describe(t){const e={name:"Amazon Silk"},n=P.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/phantom/i],describe(t){const e={name:"PhantomJS"},n=P.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/slimerjs/i],describe(t){const e={name:"SlimerJS"},n=P.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(t){const e={name:"BlackBerry"},n=P.getFirstMatch(ye,t)||P.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/(web|hpw)[o0]s/i],describe(t){const e={name:"WebOS Browser"},n=P.getFirstMatch(ye,t)||P.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/bada/i],describe(t){const e={name:"Bada"},n=P.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/tizen/i],describe(t){const e={name:"Tizen"},n=P.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,t)||P.getFirstMatch(ye,t);return n&&(e.version=n),e}},{test:[/qupzilla/i],describe(t){const e={name:"QupZilla"},n=P.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,t)||P.getFirstMatch(ye,t);return n&&(e.version=n),e}},{test:[/firefox|iceweasel|fxios/i],describe(t){const e={name:"Firefox"},n=P.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/electron/i],describe(t){const e={name:"Electron"},n=P.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/MiuiBrowser/i],describe(t){const e={name:"Miui"},n=P.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/chromium/i],describe(t){const e={name:"Chromium"},n=P.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,t)||P.getFirstMatch(ye,t);return n&&(e.version=n),e}},{test:[/chrome|crios|crmo/i],describe(t){const e={name:"Chrome"},n=P.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/GSA/i],describe(t){const e={name:"Google Search"},n=P.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test(t){const e=!t.test(/like android/i),n=t.test(/android/i);return e&&n},describe(t){const e={name:"Android Browser"},n=P.getFirstMatch(ye,t);return n&&(e.version=n),e}},{test:[/playstation 4/i],describe(t){const e={name:"PlayStation 4"},n=P.getFirstMatch(ye,t);return n&&(e.version=n),e}},{test:[/safari|applewebkit/i],describe(t){const e={name:"Safari"},n=P.getFirstMatch(ye,t);return n&&(e.version=n),e}},{test:[/.*/i],describe(t){const e=/^(.*)\/(.*) /,n=/^(.*)\/(.*)[ \t]\((.*)/,r=t.search("\\(")!==-1?n:e;return{name:P.getFirstMatch(r,t),version:P.getSecondMatch(r,t)}}}],x3=[{test:[/Roku\/DVP/],describe(t){const e=P.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,t);return{name:xt.Roku,version:e}}},{test:[/windows phone/i],describe(t){const e=P.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,t);return{name:xt.WindowsPhone,version:e}}},{test:[/windows /i],describe(t){const e=P.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,t),n=P.getWindowsVersionName(e);return{name:xt.Windows,version:e,versionName:n}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(t){const e={name:xt.iOS},n=P.getSecondMatch(/(Version\/)(\d[\d.]+)/,t);return n&&(e.version=n),e}},{test:[/macintosh/i],describe(t){const e=P.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,t).replace(/[_\s]/g,"."),n=P.getMacOSVersionName(e),s={name:xt.MacOS,version:e};return n&&(s.versionName=n),s}},{test:[/(ipod|iphone|ipad)/i],describe(t){const e=P.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,t).replace(/[_\s]/g,".");return{name:xt.iOS,version:e}}},{test(t){const e=!t.test(/like android/i),n=t.test(/android/i);return e&&n},describe(t){const e=P.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,t),n=P.getAndroidVersionName(e),s={name:xt.Android,version:e};return n&&(s.versionName=n),s}},{test:[/(web|hpw)[o0]s/i],describe(t){const e=P.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,t),n={name:xt.WebOS};return e&&e.length&&(n.version=e),n}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(t){const e=P.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,t)||P.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,t)||P.getFirstMatch(/\bbb(\d+)/i,t);return{name:xt.BlackBerry,version:e}}},{test:[/bada/i],describe(t){const e=P.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,t);return{name:xt.Bada,version:e}}},{test:[/tizen/i],describe(t){const e=P.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,t);return{name:xt.Tizen,version:e}}},{test:[/linux/i],describe(){return{name:xt.Linux}}},{test:[/CrOS/],describe(){return{name:xt.ChromeOS}}},{test:[/PlayStation 4/],describe(t){const e=P.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,t);return{name:xt.PlayStation4,version:e}}}],S3=[{test:[/googlebot/i],describe(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe(t){const e=P.getFirstMatch(/(can-l01)/i,t)&&"Nova",n={type:Ne.mobile,vendor:"Huawei"};return e&&(n.model=e),n}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe(){return{type:Ne.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe(){return{type:Ne.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(){return{type:Ne.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe(){return{type:Ne.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe(){return{type:Ne.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe(){return{type:Ne.tablet}}},{test(t){const e=t.test(/ipod|iphone/i),n=t.test(/like (ipod|iphone)/i);return e&&!n},describe(t){const e=P.getFirstMatch(/(ipod|iphone)/i,t);return{type:Ne.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe(){return{type:Ne.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe(){return{type:Ne.mobile}}},{test(t){return t.getBrowserName(!0)==="blackberry"},describe(){return{type:Ne.mobile,vendor:"BlackBerry"}}},{test(t){return t.getBrowserName(!0)==="bada"},describe(){return{type:Ne.mobile}}},{test(t){return t.getBrowserName()==="windows phone"},describe(){return{type:Ne.mobile,vendor:"Microsoft"}}},{test(t){const e=Number(String(t.getOSVersion()).split(".")[0]);return t.getOSName(!0)==="android"&&e>=3},describe(){return{type:Ne.tablet}}},{test(t){return t.getOSName(!0)==="android"},describe(){return{type:Ne.mobile}}},{test(t){return t.getOSName(!0)==="macos"},describe(){return{type:Ne.desktop,vendor:"Apple"}}},{test(t){return t.getOSName(!0)==="windows"},describe(){return{type:Ne.desktop}}},{test(t){return t.getOSName(!0)==="linux"},describe(){return{type:Ne.desktop}}},{test(t){return t.getOSName(!0)==="playstation 4"},describe(){return{type:Ne.tv}}},{test(t){return t.getOSName(!0)==="roku"},describe(){return{type:Ne.tv}}}],E3=[{test(t){return t.getBrowserName(!0)==="microsoft edge"},describe(t){if(/\sedg\//i.test(t))return{name:hn.Blink};const n=P.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,t);return{name:hn.EdgeHTML,version:n}}},{test:[/trident/i],describe(t){const e={name:hn.Trident},n=P.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test(t){return t.test(/presto/i)},describe(t){const e={name:hn.Presto},n=P.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test(t){const e=t.test(/gecko/i),n=t.test(/like gecko/i);return e&&!n},describe(t){const e={name:hn.Gecko},n=P.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/(apple)?webkit\/537\.36/i],describe(){return{name:hn.Blink}}},{test:[/(apple)?webkit/i],describe(t){const e={name:hn.WebKit},n=P.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}}];class yl{constructor(e,n=!1){if(e==null||e==="")throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},n!==!0&&this.parse()}getUA(){return this._ua}test(e){return e.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const e=P.find(v3,n=>{if(typeof n.test=="function")return n.test(this);if(n.test instanceof Array)return n.test.some(s=>this.test(s));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const e=P.find(x3,n=>{if(typeof n.test=="function")return n.test(this);if(n.test instanceof Array)return n.test.some(s=>this.test(s));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os}getOSName(e){const{name:n}=this.getOS();return e?String(n).toLowerCase()||"":n||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(e=!1){const{type:n}=this.getPlatform();return e?String(n).toLowerCase()||"":n||""}parsePlatform(){this.parsedResult.platform={};const e=P.find(S3,n=>{if(typeof n.test=="function")return n.test(this);if(n.test instanceof Array)return n.test.some(s=>this.test(s));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const e=P.find(E3,n=>{if(typeof n.test=="function")return n.test(this);if(n.test instanceof Array)return n.test.some(s=>this.test(s));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return P.assign({},this.parsedResult)}satisfies(e){const n={};let s=0;const r={};let i=0;if(Object.keys(e).forEach(a=>{const d=e[a];typeof d=="string"?(r[a]=d,i+=1):typeof d=="object"&&(n[a]=d,s+=1)}),s>0){const a=Object.keys(n),d=P.find(a,l=>this.isOS(l));if(d){const l=this.satisfies(n[d]);if(l!==void 0)return l}const c=P.find(a,l=>this.isPlatform(l));if(c){const l=this.satisfies(n[c]);if(l!==void 0)return l}}if(i>0){const a=Object.keys(r),d=P.find(a,c=>this.isBrowser(c,!0));if(d!==void 0)return this.compareVersion(r[d])}}isBrowser(e,n=!1){const s=this.getBrowserName().toLowerCase();let r=e.toLowerCase();const i=P.getBrowserTypeByAlias(r);return n&&i&&(r=i.toLowerCase()),r===s}compareVersion(e){let n=[0],s=e,r=!1;const i=this.getBrowserVersion();if(typeof i=="string")return e[0]===">"||e[0]==="<"?(s=e.substr(1),e[1]==="="?(r=!0,s=e.substr(2)):n=[],e[0]===">"?n.push(1):n.push(-1)):e[0]==="="?s=e.substr(1):e[0]==="~"&&(r=!0,s=e.substr(1)),n.indexOf(P.compareVersions(i,s,r))>-1}isOS(e){return this.getOSName(!0)===String(e).toLowerCase()}isPlatform(e){return this.getPlatformType(!0)===String(e).toLowerCase()}isEngine(e){return this.getEngineName(!0)===String(e).toLowerCase()}is(e,n=!1){return this.isBrowser(e,n)||this.isOS(e)||this.isPlatform(e)}some(e=[]){return e.some(n=>this.is(n))}}/*!
 * Bowser - a browser detector
 * https://github.com/lancedikson/bowser
 * MIT License | (c) Dustin Diaz 2012-2015
 * MIT License | (c) Denis Demchenko 2015-2019
 */class Yh{static getParser(e,n=!1){if(typeof e!="string")throw new Error("UserAgent should be a string");return new yl(e,n)}static parse(e){return new yl(e).getResult()}static get BROWSER_MAP(){return Xh}static get ENGINE_MAP(){return hn}static get OS_MAP(){return xt}static get PLATFORMS_MAP(){return Ne}}const C3=({serviceId:t,clientVersion:e})=>async n=>{var o,a,d,c,l,u;const s=typeof window<"u"&&((o=window==null?void 0:window.navigator)!=null&&o.userAgent)?Yh.parse(window.navigator.userAgent):void 0,r=[["aws-sdk-js",e],["ua","2.1"],[`os/${((a=s==null?void 0:s.os)==null?void 0:a.name)||"other"}`,(d=s==null?void 0:s.os)==null?void 0:d.version],["lang/js"],["md/browser",`${((c=s==null?void 0:s.browser)==null?void 0:c.name)??"unknown"}_${((l=s==null?void 0:s.browser)==null?void 0:l.version)??"unknown"}`]];t&&r.push([`api/${t}`,e]);const i=await((u=n==null?void 0:n.userAgentAppId)==null?void 0:u.call(n));return i&&r.push([`app/${i}`]),r};class er{constructor(e){if(this.bytes=e,e.byteLength!==8)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(e){if(e>9223372036854776e3||e<-9223372036854776e3)throw new Error(`${e} is too large (or, if negative, too small) to represent as an Int64`);const n=new Uint8Array(8);for(let s=7,r=Math.abs(Math.round(e));s>-1&&r>0;s--,r/=256)n[s]=r;return e<0&&wl(n),new er(n)}valueOf(){const e=this.bytes.slice(0),n=e[0]&128;return n&&wl(e),parseInt(At(e),16)*(n?-1:1)}toString(){return String(this.valueOf())}}function wl(t){for(let e=0;e<8;e++)t[e]^=255;for(let e=7;e>-1&&(t[e]++,t[e]===0);e--);}class A3{constructor(e,n){this.toUtf8=e,this.fromUtf8=n}format(e){const n=[];for(const i of Object.keys(e)){const o=this.fromUtf8(i);n.push(Uint8Array.from([o.byteLength]),o,this.formatHeaderValue(e[i]))}const s=new Uint8Array(n.reduce((i,o)=>i+o.byteLength,0));let r=0;for(const i of n)s.set(i,r),r+=i.byteLength;return s}formatHeaderValue(e){switch(e.type){case"boolean":return Uint8Array.from([e.value?0:1]);case"byte":return Uint8Array.from([2,e.value]);case"short":const n=new DataView(new ArrayBuffer(3));return n.setUint8(0,3),n.setInt16(1,e.value,!1),new Uint8Array(n.buffer);case"integer":const s=new DataView(new ArrayBuffer(5));return s.setUint8(0,4),s.setInt32(1,e.value,!1),new Uint8Array(s.buffer);case"long":const r=new Uint8Array(9);return r[0]=5,r.set(e.value.bytes,1),r;case"binary":const i=new DataView(new ArrayBuffer(3+e.value.byteLength));i.setUint8(0,6),i.setUint16(1,e.value.byteLength,!1);const o=new Uint8Array(i.buffer);return o.set(e.value,3),o;case"string":const a=this.fromUtf8(e.value),d=new DataView(new ArrayBuffer(3+a.byteLength));d.setUint8(0,7),d.setUint16(1,a.byteLength,!1);const c=new Uint8Array(d.buffer);return c.set(a,3),c;case"timestamp":const l=new Uint8Array(9);return l[0]=8,l.set(er.fromNumber(e.value.valueOf()).bytes,1),l;case"uuid":if(!B3.test(e.value))throw new Error(`Invalid UUID received: ${e.value}`);const u=new Uint8Array(17);return u[0]=9,u.set(cu(e.value.replace(/\-/g,"")),1),u}}parse(e){const n={};let s=0;for(;s<e.byteLength;){const r=e.getUint8(s++),i=this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+s,r));switch(s+=r,e.getUint8(s++)){case 0:n[i]={type:vl,value:!0};break;case 1:n[i]={type:vl,value:!1};break;case 2:n[i]={type:k3,value:e.getInt8(s++)};break;case 3:n[i]={type:P3,value:e.getInt16(s,!1)},s+=2;break;case 4:n[i]={type:_3,value:e.getInt32(s,!1)},s+=4;break;case 5:n[i]={type:T3,value:new er(new Uint8Array(e.buffer,e.byteOffset+s,8))},s+=8;break;case 6:const o=e.getUint16(s,!1);s+=2,n[i]={type:R3,value:new Uint8Array(e.buffer,e.byteOffset+s,o)},s+=o;break;case 7:const a=e.getUint16(s,!1);s+=2,n[i]={type:M3,value:this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+s,a))},s+=a;break;case 8:n[i]={type:I3,value:new Date(new er(new Uint8Array(e.buffer,e.byteOffset+s,8)).valueOf())},s+=8;break;case 9:const d=new Uint8Array(e.buffer,e.byteOffset+s,16);s+=16,n[i]={type:L3,value:`${At(d.subarray(0,4))}-${At(d.subarray(4,6))}-${At(d.subarray(6,8))}-${At(d.subarray(8,10))}-${At(d.subarray(10))}`};break;default:throw new Error("Unrecognized header type tag")}}return n}}var bl;(function(t){t[t.boolTrue=0]="boolTrue",t[t.boolFalse=1]="boolFalse",t[t.byte=2]="byte",t[t.short=3]="short",t[t.integer=4]="integer",t[t.long=5]="long",t[t.byteArray=6]="byteArray",t[t.string=7]="string",t[t.timestamp=8]="timestamp",t[t.uuid=9]="uuid"})(bl||(bl={}));const vl="boolean",k3="byte",P3="short",_3="integer",T3="long",R3="binary",M3="string",I3="timestamp",L3="uuid",B3=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/,Jh=4,fn=Jh*2,Mn=4,F3=fn+Mn*2;function D3({byteLength:t,byteOffset:e,buffer:n}){if(t<F3)throw new Error("Provided message too short to accommodate event stream message overhead");const s=new DataView(n,e,t),r=s.getUint32(0,!1);if(t!==r)throw new Error("Reported message length does not match received message length");const i=s.getUint32(Jh,!1),o=s.getUint32(fn,!1),a=s.getUint32(t-Mn,!1),d=new Gr().update(new Uint8Array(n,e,fn));if(o!==d.digest())throw new Error(`The prelude checksum specified in the message (${o}) does not match the calculated CRC32 checksum (${d.digest()})`);if(d.update(new Uint8Array(n,e+fn,t-(fn+Mn))),a!==d.digest())throw new Error(`The message checksum (${d.digest()}) did not match the expected value of ${a}`);return{headers:new DataView(n,e+fn+Mn,i),body:new Uint8Array(n,e+fn+Mn+i,r-i-(fn+Mn+Mn))}}class N3{constructor(e,n){this.headerMarshaller=new A3(e,n),this.messageBuffer=[],this.isEndOfStream=!1}feed(e){this.messageBuffer.push(this.decode(e))}endOfStream(){this.isEndOfStream=!0}getMessage(){const e=this.messageBuffer.pop(),n=this.isEndOfStream;return{getMessage(){return e},isEndOfStream(){return n}}}getAvailableMessages(){const e=this.messageBuffer;this.messageBuffer=[];const n=this.isEndOfStream;return{getMessages(){return e},isEndOfStream(){return n}}}encode({headers:e,body:n}){const s=this.headerMarshaller.format(e),r=s.byteLength+n.byteLength+16,i=new Uint8Array(r),o=new DataView(i.buffer,i.byteOffset,i.byteLength),a=new Gr;return o.setUint32(0,r,!1),o.setUint32(4,s.byteLength,!1),o.setUint32(8,a.update(i.subarray(0,8)).digest(),!1),i.set(s,12),i.set(n,s.byteLength+12),o.setUint32(r-4,a.update(i.subarray(8,r-4)).digest(),!1),i}decode(e){const{headers:n,body:s}=D3(e);return{headers:this.headerMarshaller.parse(n),body:s}}formatHeaders(e){return this.headerMarshaller.format(e)}}class O3{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.inputStream)yield this.options.decoder.decode(e)}}class U3{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.messageStream)yield this.options.encoder.encode(e);this.options.includeEndFrame&&(yield new Uint8Array(0))}}class Q3{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.messageStream){const n=await this.options.deserializer(e);n!==void 0&&(yield n)}}}class $3{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.inputStream)yield this.options.serializer(e)}}function H3(t){let e=0,n=0,s=null,r=null;const i=a=>{if(typeof a!="number")throw new Error("Attempted to allocate an event message where size was not a number: "+a);e=a,n=4,s=new Uint8Array(a),new DataView(s.buffer).setUint32(0,a,!1)},o=async function*(){const a=t[Symbol.asyncIterator]();for(;;){const{value:d,done:c}=await a.next();if(c){if(e)if(e===n)yield s;else throw new Error("Truncated event message received.");else return;return}const l=d.length;let u=0;for(;u<l;){if(!s){const f=l-u;r||(r=new Uint8Array(4));const y=Math.min(4-n,f);if(r.set(d.slice(u,u+y),n),n+=y,u+=y,n<4)break;i(new DataView(r.buffer).getUint32(0,!1)),r=null}const h=Math.min(e-n,l-u);s.set(d.slice(u,u+h),n),n+=h,u+=h,e&&e===n&&(yield s,s=null,e=0,n=0)}}};return{[Symbol.asyncIterator]:o}}function z3(t,e){return async function(n){const{value:s}=n.headers[":message-type"];if(s==="error"){const r=new Error(n.headers[":error-message"].value||"UnknownError");throw r.name=n.headers[":error-code"].value,r}else if(s==="exception"){const r=n.headers[":exception-type"].value,i={[r]:n},o=await t(i);if(o.$unknown){const a=new Error(e(n.body));throw a.name=r,a}throw o[r]}else if(s==="event"){const r={[n.headers[":event-type"].value]:n},i=await t(r);return i.$unknown?void 0:i}else throw Error(`Unrecognizable event type: ${n.headers[":event-type"].value}`)}}let q3=class{constructor({utf8Encoder:e,utf8Decoder:n}){this.eventStreamCodec=new N3(e,n),this.utfEncoder=e}deserialize(e,n){const s=H3(e);return new Q3({messageStream:new O3({inputStream:s,decoder:this.eventStreamCodec}),deserializer:z3(n,this.utfEncoder)})}serialize(e,n){return new U3({messageStream:new $3({inputStream:e,serializer:n}),encoder:this.eventStreamCodec,includeEndFrame:!0})}};const j3=t=>({[Symbol.asyncIterator]:async function*(){const e=t.getReader();try{for(;;){const{done:n,value:s}=await e.read();if(n)return;yield s}}finally{e.releaseLock()}}}),W3=t=>{const e=t[Symbol.asyncIterator]();return new ReadableStream({async pull(n){const{done:s,value:r}=await e.next();if(s)return n.close();n.enqueue(r)}})};class V3{constructor({utf8Encoder:e,utf8Decoder:n}){this.universalMarshaller=new q3({utf8Decoder:n,utf8Encoder:e})}deserialize(e,n){const s=K3(e)?j3(e):e;return this.universalMarshaller.deserialize(s,n)}serialize(e,n){const s=this.universalMarshaller.serialize(e,n);return typeof ReadableStream=="function"?W3(s):s}}const K3=t=>typeof ReadableStream=="function"&&t instanceof ReadableStream,G3=t=>new V3(t);async function Z3(t,e,n=1024*1024){const s=t.size;let r=0;for(;r<s;){const i=t.slice(r,Math.min(s,r+n));e(new Uint8Array(await i.arrayBuffer())),r+=i.size}}const X3=async function(e,n){const s=new e;return await Z3(n,r=>{s.update(r)}),s.digest()},Y3=t=>()=>Promise.reject(t),un=64,J3=16,ew=[1732584193,4023233417,2562383102,271733878];class tw{constructor(){this.reset()}update(e){if(nw(e))return;if(this.finished)throw new Error("Attempted to update an already finished hash.");const n=sw(e);let s=0,{byteLength:r}=n;for(this.bytesHashed+=r;r>0;)this.buffer.setUint8(this.bufferLength++,n[s++]),r--,this.bufferLength===un&&(this.hashBuffer(),this.bufferLength=0)}async digest(){if(!this.finished){const{buffer:n,bufferLength:s,bytesHashed:r}=this,i=r*8;if(n.setUint8(this.bufferLength++,128),s%un>=un-8){for(let o=this.bufferLength;o<un;o++)n.setUint8(o,0);this.hashBuffer(),this.bufferLength=0}for(let o=this.bufferLength;o<un-8;o++)n.setUint8(o,0);n.setUint32(un-8,i>>>0,!0),n.setUint32(un-4,Math.floor(i/4294967296),!0),this.hashBuffer(),this.finished=!0}const e=new DataView(new ArrayBuffer(J3));for(let n=0;n<4;n++)e.setUint32(n*4,this.state[n],!0);return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}hashBuffer(){const{buffer:e,state:n}=this;let s=n[0],r=n[1],i=n[2],o=n[3];s=ht(s,r,i,o,e.getUint32(0,!0),7,3614090360),o=ht(o,s,r,i,e.getUint32(4,!0),12,3905402710),i=ht(i,o,s,r,e.getUint32(8,!0),17,606105819),r=ht(r,i,o,s,e.getUint32(12,!0),22,3250441966),s=ht(s,r,i,o,e.getUint32(16,!0),7,4118548399),o=ht(o,s,r,i,e.getUint32(20,!0),12,1200080426),i=ht(i,o,s,r,e.getUint32(24,!0),17,2821735955),r=ht(r,i,o,s,e.getUint32(28,!0),22,4249261313),s=ht(s,r,i,o,e.getUint32(32,!0),7,1770035416),o=ht(o,s,r,i,e.getUint32(36,!0),12,2336552879),i=ht(i,o,s,r,e.getUint32(40,!0),17,4294925233),r=ht(r,i,o,s,e.getUint32(44,!0),22,2304563134),s=ht(s,r,i,o,e.getUint32(48,!0),7,1804603682),o=ht(o,s,r,i,e.getUint32(52,!0),12,4254626195),i=ht(i,o,s,r,e.getUint32(56,!0),17,2792965006),r=ht(r,i,o,s,e.getUint32(60,!0),22,1236535329),s=ft(s,r,i,o,e.getUint32(4,!0),5,4129170786),o=ft(o,s,r,i,e.getUint32(24,!0),9,3225465664),i=ft(i,o,s,r,e.getUint32(44,!0),14,643717713),r=ft(r,i,o,s,e.getUint32(0,!0),20,3921069994),s=ft(s,r,i,o,e.getUint32(20,!0),5,3593408605),o=ft(o,s,r,i,e.getUint32(40,!0),9,38016083),i=ft(i,o,s,r,e.getUint32(60,!0),14,3634488961),r=ft(r,i,o,s,e.getUint32(16,!0),20,3889429448),s=ft(s,r,i,o,e.getUint32(36,!0),5,568446438),o=ft(o,s,r,i,e.getUint32(56,!0),9,3275163606),i=ft(i,o,s,r,e.getUint32(12,!0),14,4107603335),r=ft(r,i,o,s,e.getUint32(32,!0),20,1163531501),s=ft(s,r,i,o,e.getUint32(52,!0),5,2850285829),o=ft(o,s,r,i,e.getUint32(8,!0),9,4243563512),i=ft(i,o,s,r,e.getUint32(28,!0),14,1735328473),r=ft(r,i,o,s,e.getUint32(48,!0),20,2368359562),s=pt(s,r,i,o,e.getUint32(20,!0),4,4294588738),o=pt(o,s,r,i,e.getUint32(32,!0),11,2272392833),i=pt(i,o,s,r,e.getUint32(44,!0),16,1839030562),r=pt(r,i,o,s,e.getUint32(56,!0),23,4259657740),s=pt(s,r,i,o,e.getUint32(4,!0),4,2763975236),o=pt(o,s,r,i,e.getUint32(16,!0),11,1272893353),i=pt(i,o,s,r,e.getUint32(28,!0),16,4139469664),r=pt(r,i,o,s,e.getUint32(40,!0),23,3200236656),s=pt(s,r,i,o,e.getUint32(52,!0),4,681279174),o=pt(o,s,r,i,e.getUint32(0,!0),11,3936430074),i=pt(i,o,s,r,e.getUint32(12,!0),16,3572445317),r=pt(r,i,o,s,e.getUint32(24,!0),23,76029189),s=pt(s,r,i,o,e.getUint32(36,!0),4,3654602809),o=pt(o,s,r,i,e.getUint32(48,!0),11,3873151461),i=pt(i,o,s,r,e.getUint32(60,!0),16,530742520),r=pt(r,i,o,s,e.getUint32(8,!0),23,3299628645),s=mt(s,r,i,o,e.getUint32(0,!0),6,4096336452),o=mt(o,s,r,i,e.getUint32(28,!0),10,1126891415),i=mt(i,o,s,r,e.getUint32(56,!0),15,2878612391),r=mt(r,i,o,s,e.getUint32(20,!0),21,4237533241),s=mt(s,r,i,o,e.getUint32(48,!0),6,1700485571),o=mt(o,s,r,i,e.getUint32(12,!0),10,2399980690),i=mt(i,o,s,r,e.getUint32(40,!0),15,4293915773),r=mt(r,i,o,s,e.getUint32(4,!0),21,2240044497),s=mt(s,r,i,o,e.getUint32(32,!0),6,1873313359),o=mt(o,s,r,i,e.getUint32(60,!0),10,4264355552),i=mt(i,o,s,r,e.getUint32(24,!0),15,2734768916),r=mt(r,i,o,s,e.getUint32(52,!0),21,1309151649),s=mt(s,r,i,o,e.getUint32(16,!0),6,4149444226),o=mt(o,s,r,i,e.getUint32(44,!0),10,3174756917),i=mt(i,o,s,r,e.getUint32(8,!0),15,718787259),r=mt(r,i,o,s,e.getUint32(36,!0),21,3951481745),n[0]=s+n[0]&4294967295,n[1]=r+n[1]&4294967295,n[2]=i+n[2]&4294967295,n[3]=o+n[3]&4294967295}reset(){this.state=Uint32Array.from(ew),this.buffer=new DataView(new ArrayBuffer(un)),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}}function bi(t,e,n,s,r,i){return e=(e+t&4294967295)+(s+i&4294967295)&4294967295,(e<<r|e>>>32-r)+n&4294967295}function ht(t,e,n,s,r,i,o){return bi(e&n|~e&s,t,e,r,i,o)}function ft(t,e,n,s,r,i,o){return bi(e&s|n&~s,t,e,r,i,o)}function pt(t,e,n,s,r,i,o){return bi(e^n^s,t,e,r,i,o)}function mt(t,e,n,s,r,i,o){return bi(n^(e|~s),t,e,r,i,o)}function nw(t){return typeof t=="string"?t.length===0:t.byteLength===0}function sw(t){return typeof t=="string"?$n(t):ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(t)}const rw=t=>({apiVersion:"2006-03-01",base64Decoder:(t==null?void 0:t.base64Decoder)??aa,base64Encoder:(t==null?void 0:t.base64Encoder)??ui,disableHostPrefix:(t==null?void 0:t.disableHostPrefix)??!1,endpointProvider:(t==null?void 0:t.endpointProvider)??rh,extensions:(t==null?void 0:t.extensions)??[],getAwsChunkedEncodingStream:(t==null?void 0:t.getAwsChunkedEncodingStream)??S1,httpAuthSchemeProvider:(t==null?void 0:t.httpAuthSchemeProvider)??N4,httpAuthSchemes:(t==null?void 0:t.httpAuthSchemes)??[{schemeId:"aws.auth#sigv4",identityProvider:e=>e.getIdentityProvider("aws.auth#sigv4"),signer:new su},{schemeId:"aws.auth#sigv4a",identityProvider:e=>e.getIdentityProvider("aws.auth#sigv4a"),signer:new Yp}],logger:(t==null?void 0:t.logger)??new fa,sdkStreamMixin:(t==null?void 0:t.sdkStreamMixin)??R1,serviceId:(t==null?void 0:t.serviceId)??"S3",signerConstructor:(t==null?void 0:t.signerConstructor)??$u,signingEscapePath:(t==null?void 0:t.signingEscapePath)??!1,urlParser:(t==null?void 0:t.urlParser)??Zr,useArnRegion:(t==null?void 0:t.useArnRegion)??void 0,utf8Decoder:(t==null?void 0:t.utf8Decoder)??$n,utf8Encoder:(t==null?void 0:t.utf8Encoder)??ca}),iw=["in-region","cross-region","mobile","standard","legacy"],ow=({defaultsMode:t}={})=>cm(async()=>{const e=typeof t=="function"?await t():t;switch(e==null?void 0:e.toLowerCase()){case"auto":return Promise.resolve(aw()?"mobile":"standard");case"mobile":case"in-region":case"cross-region":case"standard":case"legacy":return Promise.resolve(e==null?void 0:e.toLocaleLowerCase());case void 0:return Promise.resolve("legacy");default:throw new Error(`Invalid parameter for "defaultsMode", expect ${iw.join(", ")}, got ${e}`)}}),aw=()=>{var n,s;const t=typeof window<"u"&&((n=window==null?void 0:window.navigator)!=null&&n.userAgent)?Yh.parse(window.navigator.userAgent):void 0,e=(s=t==null?void 0:t.platform)==null?void 0:s.type;return e==="tablet"||e==="mobile"},cw=t=>{const e=ow(t),n=()=>e().then(qm),s=rw(t);return{...s,...t,runtime:"browser",defaultsMode:e,bodyLengthChecker:(t==null?void 0:t.bodyLengthChecker)??Om,credentialDefaultProvider:(t==null?void 0:t.credentialDefaultProvider)??(r=>()=>Promise.reject(new Error("Credential is missing"))),defaultUserAgentProvider:(t==null?void 0:t.defaultUserAgentProvider)??C3({serviceId:s.serviceId,clientVersion:n3.version}),eventStreamSerdeProvider:(t==null?void 0:t.eventStreamSerdeProvider)??G3,maxAttempts:(t==null?void 0:t.maxAttempts)??Xr,md5:(t==null?void 0:t.md5)??tw,region:(t==null?void 0:t.region)??Y3("Region is missing"),requestHandler:da.create((t==null?void 0:t.requestHandler)??n),retryMode:(t==null?void 0:t.retryMode)??(async()=>(await n()).retryMode||$9),sha1:(t==null?void 0:t.sha1)??d3,sha256:(t==null?void 0:t.sha256)??w3,streamCollector:(t==null?void 0:t.streamCollector)??ou,streamHasher:(t==null?void 0:t.streamHasher)??X3,useDualstackEndpoint:(t==null?void 0:t.useDualstackEndpoint)??(()=>Promise.resolve(C9)),useFipsEndpoint:(t==null?void 0:t.useFipsEndpoint)??(()=>Promise.resolve(A9))}},dw=t=>({setRegion(e){t.region=e},region(){return t.region}}),lw=t=>({region:t.region()}),uw=t=>{const e=t.httpAuthSchemes;let n=t.httpAuthSchemeProvider,s=t.credentials;return{setHttpAuthScheme(r){const i=e.findIndex(o=>o.schemeId===r.schemeId);i===-1?e.push(r):e.splice(i,1,r)},httpAuthSchemes(){return e},setHttpAuthSchemeProvider(r){n=r},httpAuthSchemeProvider(){return n},setCredentials(r){s=r},credentials(){return s}}},hw=t=>({httpAuthSchemes:t.httpAuthSchemes(),httpAuthSchemeProvider:t.httpAuthSchemeProvider(),credentials:t.credentials()}),fw=(t,e)=>{const n=Object.assign(dw(t),Gm(t),Hp(t),uw(t));return e.forEach(s=>s.configure(n)),Object.assign(t,lw(n),Zm(n),zp(n),hw(n))};class pw extends Um{constructor(...[n]){const s=cw(n||{});super(s);g(this,"config");this.initConfig=s;const r=U4(s),i=f9(r),o=b2(i),a=l4(o),d=k9(a),c=d,l=Q9(c),u=P9(l),h=O4(u),f=J2(h,{session:[()=>this,e3]}),y=fw(f,(n==null?void 0:n.extensions)||[]);this.config=y,this.middlewareStack.use(E9(this.config)),this.middlewareStack.use(y4(this.config)),this.middlewareStack.use(R9(this.config)),this.middlewareStack.use(S2(this.config)),this.middlewareStack.use(A2(this.config)),this.middlewareStack.use(R2(this.config)),this.middlewareStack.use(s1(this.config,{httpAuthSchemeParametersProvider:B4,identityProviderConfigProvider:async x=>new sm({"aws.auth#sigv4":x.credentials,"aws.auth#sigv4a":x.credentials})})),this.middlewareStack.use(l1(this.config)),this.middlewareStack.use(l9(this.config)),this.middlewareStack.use(Vp(this.config)),this.middlewareStack.use(Q2(this.config)),this.middlewareStack.use(V2(this.config)),this.middlewareStack.use(Y2(this.config))}destroy(){super.destroy()}}class mw extends Cn.classBuilder().ep({...Kn,Bucket:{type:"contextParams",name:"Bucket"},Key:{type:"contextParams",name:"Key"}}).m(function(e,n,s,r){return[zn(s,this.serialize,this.deserialize),Wn(s,e.getEndpointParameterInstructions()),jn(s)]}).s("AmazonS3","AbortMultipartUpload",{}).n("S3Client","AbortMultipartUploadCommand").f(void 0,void 0).ser(X4).de(ry).build(){}function gw(t){return e=>async n=>{const s={...n.input},r=[{target:"SSECustomerKey",hash:"SSECustomerKeyMD5"},{target:"CopySourceSSECustomerKey",hash:"CopySourceSSECustomerKeyMD5"}];for(const i of r){const o=s[i.target];if(o){let a;typeof o=="string"?ww(o,t)?a=t.base64Decoder(o):(a=t.utf8Decoder(o),s[i.target]=t.base64Encoder(a)):(a=ArrayBuffer.isView(o)?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):new Uint8Array(o),s[i.target]=t.base64Encoder(a));const d=new t.md5;d.update(a),s[i.hash]=t.base64Encoder(await d.digest())}}return e({...n,input:s})}}const yw={name:"ssecMiddleware",step:"initialize",tags:["SSE"],override:!0},vi=t=>({applyToStack:e=>{e.add(gw(t),yw)}});function ww(t,e){if(!/^(?:[A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t))return!1;try{return e.base64Decoder(t).length===32}catch{return!1}}class bw extends Cn.classBuilder().ep({...Kn,Bucket:{type:"contextParams",name:"Bucket"},Key:{type:"contextParams",name:"Key"}}).m(function(e,n,s,r){return[zn(s,this.serialize,this.deserialize),Wn(s,e.getEndpointParameterInstructions()),jn(s),vi(s)]}).s("AmazonS3","CompleteMultipartUpload",{}).n("S3Client","CompleteMultipartUploadCommand").f($4,Q4).ser(Y4).de(iy).build(){}class vw extends Cn.classBuilder().ep({...Kn,Bucket:{type:"contextParams",name:"Bucket"},Key:{type:"contextParams",name:"Key"}}).m(function(e,n,s,r){return[zn(s,this.serialize,this.deserialize),Wn(s,e.getEndpointParameterInstructions()),jn(s),vi(s)]}).s("AmazonS3","CreateMultipartUpload",{}).n("S3Client","CreateMultipartUploadCommand").f(z4,H4).ser(J4).de(oy).build(){}class xl extends Cn.classBuilder().ep({...Kn,Bucket:{type:"contextParams",name:"Bucket"},Key:{type:"contextParams",name:"Key"}}).m(function(e,n,s,r){return[zn(s,this.serialize,this.deserialize),Wn(s,e.getEndpointParameterInstructions()),ya(s,{requestAlgorithmMember:{httpHeader:"x-amz-sdk-checksum-algorithm",name:"ChecksumAlgorithm"},requestChecksumRequired:!1}),F2(),jn(s),vi(s)]}).s("AmazonS3","PutObject",{}).n("S3Client","PutObjectCommand").f(K4,V4).ser(ty).de(cy).build(){}class xw extends Cn.classBuilder().ep({...Kn,Bucket:{type:"contextParams",name:"Bucket"}}).m(function(e,n,s,r){return[zn(s,this.serialize,this.deserialize),Wn(s,e.getEndpointParameterInstructions()),ya(s,{requestAlgorithmMember:{httpHeader:"x-amz-sdk-checksum-algorithm",name:"ChecksumAlgorithm"},requestChecksumRequired:!0}),jn(s)]}).s("AmazonS3","PutObjectTagging",{}).n("S3Client","PutObjectTaggingCommand").f(void 0,void 0).ser(ny).de(dy).build(){}class Sw extends Cn.classBuilder().ep({...Kn,Bucket:{type:"contextParams",name:"Bucket"},Key:{type:"contextParams",name:"Key"}}).m(function(e,n,s,r){return[zn(s,this.serialize,this.deserialize),Wn(s,e.getEndpointParameterInstructions()),ya(s,{requestAlgorithmMember:{httpHeader:"x-amz-sdk-checksum-algorithm",name:"ChecksumAlgorithm"},requestChecksumRequired:!1}),jn(s),vi(s)]}).s("AmazonS3","UploadPart",{}).n("S3Client","UploadPartCommand").f(Z4,G4).ser(sy).de(ly).build(){}class Ew{constructor(){this.onabort=null,this._aborted=!1,Object.defineProperty(this,"_aborted",{value:!1,writable:!0})}get aborted(){return this._aborted}abort(){this._aborted=!0,this.onabort&&(this.onabort(this),this.onabort=null)}}let Cw=class{constructor(){this.signal=new Ew}abort(){this.signal.abort()}};var mo=jl(),En=A0();const Aw={lstatSync:()=>{}},kw={...Aw,runtime:"browser"},go=t=>{if(t==null)return 0;if(typeof t=="string")return En.Buffer.byteLength(t);if(typeof t.byteLength=="number")return t.byteLength;if(typeof t.length=="number")return t.length;if(typeof t.size=="number")return t.size;if(typeof t.path=="string")try{return kw.lstatSync(t.path).size}catch{return}};var yo,Sl;function Pw(){if(Sl)return yo;Sl=1,yo=n;var t=jl().EventEmitter,e=w0();e(n,t),n.Readable=k0(),n.Writable=P0(),n.Duplex=b0(),n.Transform=_0(),n.PassThrough=T0(),n.finished=R0(),n.pipeline=M0(),n.Stream=n;function n(){t.call(this)}return n.prototype.pipe=function(s,r){var i=this;function o(f){s.writable&&s.write(f)===!1&&i.pause&&i.pause()}i.on("data",o);function a(){i.readable&&i.resume&&i.resume()}s.on("drain",a),!s._isStdio&&(!r||r.end!==!1)&&(i.on("end",c),i.on("close",l));var d=!1;function c(){d||(d=!0,s.end())}function l(){d||(d=!0,typeof s.destroy=="function"&&s.destroy())}function u(f){if(h(),t.listenerCount(this,"error")===0)throw f}i.on("error",u),s.on("error",u);function h(){i.removeListener("data",o),s.removeListener("drain",a),i.removeListener("end",c),i.removeListener("close",l),i.removeListener("error",u),s.removeListener("error",u),i.removeListener("end",h),i.removeListener("close",h),s.removeListener("close",h)}return i.on("end",h),i.on("close",h),s.on("close",h),s.emit("pipe",i),s},yo}var _w=Pw();async function*wo(t,e,n){let s=1;const r={chunks:[],length:0};for await(const i of n(t))for(r.chunks.push(i),r.length+=i.byteLength;r.length>e;){const o=r.chunks.length>1?En.Buffer.concat(r.chunks):r.chunks[0];yield{partNumber:s,data:o.subarray(0,e)},r.chunks=[o.subarray(e)],r.length=r.chunks[0].byteLength,s+=1}yield{partNumber:s,data:r.chunks.length!==1?En.Buffer.concat(r.chunks):r.chunks[0],lastPart:!0}}async function*El(t,e){let n=1,s=0,r=e;for(;r<t.byteLength;)yield{partNumber:n,data:t.subarray(s,r)},n+=1,s=r,r=s+e;yield{partNumber:n,data:t.subarray(s),lastPart:!0}}async function*Tw(t){for await(const e of t)En.Buffer.isBuffer(e)||e instanceof Uint8Array?yield e:yield En.Buffer.from(e)}async function*Cl(t){const e=t.getReader();try{for(;;){const{done:n,value:s}=await e.read();if(n)return;En.Buffer.isBuffer(s)||s instanceof Uint8Array?yield s:yield En.Buffer.from(s)}}catch(n){throw n}finally{e.releaseLock()}}const Rw=(t,e)=>{if(t instanceof Uint8Array)return El(t,e);if(t instanceof _w.Readable)return wo(t,e,Tw);if(t instanceof String||typeof t=="string")return El(En.Buffer.from(t),e);if(typeof t.stream=="function")return wo(t.stream(),e,Cl);if(t instanceof ReadableStream)return wo(t,e,Cl);throw new Error("Body Data is unsupported format, expected data to be one of: string | Uint8Array | Buffer | Readable | ReadableStream | Blob;.")},fs=class fs extends mo.EventEmitter{constructor(n){super();g(this,"MAX_PARTS",1e4);g(this,"queueSize",4);g(this,"partSize",fs.MIN_PART_SIZE);g(this,"leavePartsOnError",!1);g(this,"tags",[]);g(this,"client");g(this,"params");g(this,"totalBytes");g(this,"bytesUploadedSoFar");g(this,"abortController");g(this,"concurrentUploaders",[]);g(this,"createMultiPartPromise");g(this,"abortMultipartUploadCommand",null);g(this,"uploadedParts",[]);g(this,"uploadEnqueuedPartsCount",0);g(this,"uploadId");g(this,"uploadEvent");g(this,"isMultiPart",!0);g(this,"singleUploadResult");g(this,"sent",!1);this.queueSize=n.queueSize||this.queueSize,this.partSize=n.partSize||this.partSize,this.leavePartsOnError=n.leavePartsOnError||this.leavePartsOnError,this.tags=n.tags||this.tags,this.client=n.client,this.params=n.params,this.__validateInput(),this.totalBytes=go(this.params.Body),this.bytesUploadedSoFar=0,this.abortController=n.abortController??new Cw}async abort(){this.abortController.abort()}async done(){if(this.sent)throw new Error("@aws-sdk/lib-storage: this instance of Upload has already executed .done(). Create a new instance.");return this.sent=!0,await Promise.race([this.__doMultipartUpload(),this.__abortTimeout(this.abortController.signal)])}on(n,s){return this.uploadEvent=n,super.on(n,s)}async __uploadUsingPut(n){var x;this.isMultiPart=!1;const s={...this.params,Body:n.data},r=this.client.config,i=r.requestHandler,o=i instanceof mo.EventEmitter?i:null,a=w=>{this.bytesUploadedSoFar=w.loaded,this.totalBytes=w.total,this.__notifyProgress({loaded:this.bytesUploadedSoFar,total:this.totalBytes,part:n.partNumber,Key:this.params.Key,Bucket:this.params.Bucket})};o!==null&&o.on("xhr.upload.progress",a);const d=await Promise.all([this.client.send(new xl(s)),(x=r==null?void 0:r.endpoint)==null?void 0:x.call(r)]),c=d[0];let l=d[1];if(l||(l=wa(await Du(s,xl,{...r}))),!l)throw new Error('Could not resolve endpoint from S3 "client.config.endpoint()" nor EndpointsV2.');o!==null&&o.off("xhr.upload.progress",a);const u=this.params.Key.split("/").map(w=>jr(w)).join("/"),h=jr(this.params.Bucket),f=(()=>{const w=l.hostname.startsWith(`${h}.`),_=this.client.config.forcePathStyle,R=l.port?`:${l.port}`:"";return _?`${l.protocol}//${l.hostname}${R}/${h}/${u}`:w?`${l.protocol}//${l.hostname}${R}/${u}`:`${l.protocol}//${h}.${l.hostname}${R}/${u}`})();this.singleUploadResult={...c,Bucket:this.params.Bucket,Key:this.params.Key,Location:f};const y=go(n.data);this.__notifyProgress({loaded:y,total:y,part:1,Key:this.params.Key,Bucket:this.params.Bucket})}async __createMultipartUpload(){const n=await this.client.config.requestChecksumCalculation();if(!this.createMultiPartPromise){const s={...this.params,Body:void 0};n==="WHEN_SUPPORTED"&&(s.ChecksumAlgorithm=this.params.ChecksumAlgorithm||ah.CRC32),this.createMultiPartPromise=this.client.send(new vw(s)).then(r=>(this.abortMultipartUploadCommand=new mw({Bucket:this.params.Bucket,Key:this.params.Key,UploadId:r.UploadId}),r))}return this.createMultiPartPromise}async __doConcurrentUpload(n){for await(const s of n){if(this.uploadEnqueuedPartsCount>this.MAX_PARTS)throw new Error(`Exceeded ${this.MAX_PARTS} parts in multipart upload to Bucket: ${this.params.Bucket} Key: ${this.params.Key}.`);if(this.abortController.signal.aborted)return;if(s.partNumber===1&&s.lastPart)return await this.__uploadUsingPut(s);if(!this.uploadId){const{UploadId:l}=await this.__createMultipartUpload();if(this.uploadId=l,this.abortController.signal.aborted)return}const r=go(s.data)||0,i=this.client.config.requestHandler,o=i instanceof mo.EventEmitter?i:null;let a=0;const d=(l,u)=>{(Number(u.query.partNumber)||-1)===s.partNumber&&(l.total&&r&&(this.bytesUploadedSoFar+=l.loaded-a,a=l.loaded),this.__notifyProgress({loaded:this.bytesUploadedSoFar,total:this.totalBytes,part:s.partNumber,Key:this.params.Key,Bucket:this.params.Bucket}))};o!==null&&o.on("xhr.upload.progress",d),this.uploadEnqueuedPartsCount+=1;const c=await this.client.send(new Sw({...this.params,ContentLength:void 0,UploadId:this.uploadId,Body:s.data,PartNumber:s.partNumber}));if(o!==null&&o.off("xhr.upload.progress",d),this.abortController.signal.aborted)return;if(!c.ETag)throw new Error(`Part ${s.partNumber} is missing ETag in UploadPart response. Missing Bucket CORS configuration for ETag header?`);this.uploadedParts.push({PartNumber:s.partNumber,ETag:c.ETag,...c.ChecksumCRC32&&{ChecksumCRC32:c.ChecksumCRC32},...c.ChecksumCRC32C&&{ChecksumCRC32C:c.ChecksumCRC32C},...c.ChecksumSHA1&&{ChecksumSHA1:c.ChecksumSHA1},...c.ChecksumSHA256&&{ChecksumSHA256:c.ChecksumSHA256}}),o===null&&(this.bytesUploadedSoFar+=r),this.__notifyProgress({loaded:this.bytesUploadedSoFar,total:this.totalBytes,part:s.partNumber,Key:this.params.Key,Bucket:this.params.Bucket})}}async __doMultipartUpload(){const n=Rw(this.params.Body,this.partSize),s=[];for(let i=0;i<this.queueSize;i++){const o=this.__doConcurrentUpload(n).catch(a=>{s.push(a)});this.concurrentUploaders.push(o)}if(await Promise.all(this.concurrentUploaders),s.length>=1)throw await this.markUploadAsAborted(),s[0];if(this.abortController.signal.aborted)throw await this.markUploadAsAborted(),Object.assign(new Error("Upload aborted."),{name:"AbortError"});let r;if(this.isMultiPart){this.uploadedParts.sort((o,a)=>o.PartNumber-a.PartNumber);const i={...this.params,Body:void 0,UploadId:this.uploadId,MultipartUpload:{Parts:this.uploadedParts}};r=await this.client.send(new bw(i)),typeof(r==null?void 0:r.Location)=="string"&&r.Location.includes("%2F")&&(r.Location=r.Location.replace(/%2F/g,"/"))}else r=this.singleUploadResult;return this.abortMultipartUploadCommand=null,this.tags.length&&await this.client.send(new xw({...this.params,Tagging:{TagSet:this.tags}})),r}async markUploadAsAborted(){this.uploadId&&!this.leavePartsOnError&&this.abortMultipartUploadCommand!==null&&(await this.client.send(this.abortMultipartUploadCommand),this.abortMultipartUploadCommand=null)}__notifyProgress(n){this.uploadEvent&&this.emit(this.uploadEvent,n)}async __abortTimeout(n){return new Promise((s,r)=>{n.onabort=()=>{const i=new Error("Upload aborted.");i.name="AbortError",r(i)}})}__validateInput(){if(!this.params)throw new Error("InputError: Upload requires params to be passed to upload.");if(!this.client)throw new Error("InputError: Upload requires a AWS client to do uploads with.");if(this.partSize<fs.MIN_PART_SIZE)throw new Error(`EntityTooSmall: Your proposed upload partsize [${this.partSize}] is smaller than the minimum allowed size [${fs.MIN_PART_SIZE}] (5MB)`);if(this.queueSize<1)throw new Error("Queue size: Must have at least one uploading queue.")}};g(fs,"MIN_PART_SIZE",1024*1024*5);let zo=fs;async function Mw(){const e=await fetch("http://127.0.0.1:11000/api/v1/auth/get_sts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTc1NDI5NTI1OSwianRpIjoiMGM2N2NhMmMtYzdhMC00MGVhLWFkOTgtM2JjNTA1MzljY2E2IiwidHlwZSI6ImFjY2VzcyIsInN1YiI6IjFkNWMyZGFhLTliZGMtNDdhOC1hMDk1LTFhOWQ5YWJhZWQzMyIsIm5iZiI6MTc1NDI5NTI1OSwiY3NyZiI6IjUyYzYyMTIwLTU3YWItNDBmYi1iNzI0LTE0YmU4ODliY2ZlZCIsImV4cCI6MTc1NDkwMDA1OX0.SOTZd_ovjgU8pXe9cYm8OjL_eN83HRMukM9eQ59hNHo"},body:JSON.stringify({type:"viewer_content"})}),{data:n}=await e.json();return n}const Iw=async({accessKeyId:t,secretAccessKey:e,sessionToken:n,region:s,bucketName:r,s3Path:i,fileName:o,buffer:a,contentType:d})=>{if(!t){console.log("accessKeyId is missing");return}const c=new pw({credentials:{accessKeyId:t,secretAccessKey:e,sessionToken:n},region:s}),l=`${i}/${o}`;try{const u=new zo({client:c,params:{Bucket:r,Key:l,Body:a,ContentType:d,ChecksumAlgorithm:ah.CRC32}});return u.on("httpUploadProgress",({loaded:h,total:f})=>{console.log({current:h,total:f})}),await u.done(),{url:l}}catch(u){if(u instanceof Error&&u.name==="AbortError")console.log(`Multipart upload was aborted. ${u.message}`);else throw u}},Lw=async({fileName:t,buffer:e,contentType:n="octet/stream"})=>{const s=await Mw();let r=[];return s.forEach(o=>{o&&(r=r.concat([Iw({accessKeyId:o.accessKeyId,secretAccessKey:o.secretAccessKey,sessionToken:o.sessionToken,region:o.regionName,s3Path:"gs-test/test/wyldemo3/upload",bucketName:o.bucketName,fileName:t,buffer:e,contentType:n})]))}),(await Promise.all(r))[0]};function Al(t){t.preventDefault(),t.stopPropagation()}const Bw=async t=>{var u,h;const{plyUrls:e,audioUrl:n}=t,s=(u=e.map(f=>f.url))==null?void 0:u.join(", "),r=e.length,i=5;let o=ke((h=t.metaInfo)==null?void 0:h.timeOption);(!o||o.length<=0)&&(o=li({startNumber:0,spaceTime:i,number:r}),t.metaInfo.timeOption=o);const{position:a,rotation:d,scale:c}=t.metaInfo;let l={contentUrl:s,audioUrl:(n==null?void 0:n.url)||"",rawName:t.rawName,settings:t.settings,metaInfo:{...t.metaInfo||{},timeOption:o,position:ke(a),rotation:ke(d),scale:ke(c)}};await dr(l)},e0=async t=>{const[e]=t,n=e.name,{url:s}=await Lw({buffer:e,fileName:n})||{},r=document.getElementById("input-error");return r.textContent=s,s};function Fw(t){if(!document.getElementById("loadingWrap").className.includes("hidden"))return;const s=t.dataTransfer.files;e0(s)}const Dw=()=>{const t=document.getElementById("dropArea")||document.getElementsByTagName("body")[0],e=document.getElementById("fileInput"),n=document.getElementById("dragInput");["dragenter","dragover","dragleave","drop"].forEach(s=>{t.addEventListener(s,Al,!1),document.body.addEventListener(s,Al,!1)}),t.addEventListener("drop",Fw,!1),n.addEventListener("click",()=>e.click()),e.addEventListener("change",s=>{e0(s.target.files)})};class Nw{constructor(e){g(this,"clearIdList");this.clearIdList=[],this.initialize(e)}_addListenerFn(e,n,s){e.addEventListener(n,s),this.clearIdList.push({fn:s,eventName:n,el:e})}initialize(e){const n=document.getElementById("input-fov"),s=document.getElementById("input-position"),r=document.getElementById("input-target"),i=document.getElementById("input-xr-position"),o=document.getElementById("input-xr-target"),a=document.getElementById("input-m-position"),d=document.getElementById("input-m-rotation"),c=document.getElementById("input-m-scale"),l=document.getElementById("input-duration"),u=document.getElementById("input-fps"),h=document.getElementById("input-reset"),f=document.getElementById("input-view"),y=document.getElementById("input-error"),x=document.getElementById("input-dynamic-sorting"),w=document.getElementById("input-temporal-sorting"),_=Dt.getSSE(),{settings:R={},metaInfo:S={}}=_||{},{position:k=S.position,rotation:M=S.rotation,scale:$=S.scale}=S,{camera:I,animTracks:j,xrCamera:ee,fps:de,...fe}=R,[re,...O]=j||[],{fov:q,position:Te,target:ot}=I||{},{position:pe,target:Ze}=ee||{},ut=(ne,he)=>{ne&&typeof he=="number"&&(he||he===0)&&(ne.value=he),ne&&he===void 0&&(ne.value=void 0)},Le=(ne,he)=>{ne&&typeof he=="boolean"&&(ne.checked=he)},Re=(ne,he)=>{let ct={};return Object.keys(ne).forEach(U=>{ct[U]=ne[U]||he[U]}),ct},Fe=ne=>{const{fov:he,duration:ct,position:U,target:W,xrTarget:Z,xrPosition:le,mPosition:ue,mRotation:X,mScale:me,fps:xe,dynamicSorting:Be,temporalSorting:Pe}=ne;[{el:n,val:he},{el:l,val:ct},{el:u,val:xe}].forEach(({el:ge,val:Se})=>{ut(ge,Se)}),[{el:x,val:Be},{el:w,val:Pe}].forEach(({el:ge,val:Se})=>{Le(ge,Se)}),s.value=U.join(","),r.value=W.join(","),i.value=le.join(","),o.value=Z.join(","),a.value=ue.join(","),d.value=X.join(","),c.value=me.join(",")},De={fov:q,duration:re==null?void 0:re.duration,position:Te,target:ot,xrTarget:Ze,xrPosition:pe,mPosition:k,mRotation:M,mScale:$,fps:de};Fe(De);const at=async ne=>{var L;if(f.classList.contains("text-button-disabled"))return;y.textContent="";const{fov:he,duration:ct,position:U,target:W,xrTarget:Z,xrPosition:le,mPosition:ue,mRotation:X,mScale:me,fps:xe,dynamicSorting:Be,temporalSorting:Pe}=ne;let ge=ke(U,Te),Se=ke(W,ot),qe=ke(le,pe),Je=ke(Z,Ze),yt=ke(ue,k),Me=ke(X,M),Ee=ke(me,$);if(he<=0){y.textContent="Please enter Fov.";return}if(ge.length>0&&ge.length<3){y.textContent="Camera Position must contain 3 elements.";return}if(Se.length>0&&Se.length<3){y.textContent="Camera Target must contain 3 elements.";return}if(qe.length>0&&qe.length<3){y.textContent="XR Position must contain 3 elements.";return}if(Je.length>0&&Je.length<3){y.textContent="XR Target must contain 3 elements.";return}if(yt.length>0&&yt.length<3){y.textContent="Position must contain 3 elements.";return}if(Me.length>0&&Me.length<3){y.textContent="Rotation must contain 3 elements.";return}if(Ee.length>0&&Ee.length<3){y.textContent="Scale must contain 3 elements.";return}if(ct<=0){y.textContent="Please enter duration.";return}let an={...fe||{},fps:Number(xe||-1),dynamicSorting:Be,temporalSorting:Pe,camera:{...I||{},fov:Number(he||q),position:ge,target:Se},xrCamera:{fov:Number(he||q),position:qe,target:Je},animTracks:[{...re||{},duration:Number(ct||(re==null?void 0:re.duration)||0),frameRate:Number((re==null?void 0:re.frameRate)||30)},...O]},es={...S||{},...window.viewerConfig.metaInfo,position:yt,rotation:Me,scale:Ee,timeOption:ke(((L=window.viewerConfig.metaInfo)==null?void 0:L.timeOption)||"")};const A={settings:an,metaInfo:es};return Dt.updateMetaInfo(A.metaInfo),Dt.updateSettings(A.settings),A};Ft.on("updateDefaultDuration",ne=>{ne&&(l.value=ne)}),this._addListenerFn(f,"pointerdown",async()=>{const ne={fov:n.value,duration:l.value,fps:u.value,dynamicSorting:x.checked,temporalSorting:w.checked,position:s.value,target:r.value,xrTarget:o.value,xrPosition:i.value,mPosition:a.value,mRotation:d.value,mScale:c.value},he=await at(ne);await e(he)}),this._addListenerFn(h,"pointerdown",()=>{Fe(De),at(De)}),Ft.on("updateDefaultPageInput",ne=>{const he=Re(ne,De);Fe(he),at(he)})}destroy(){this.clearIdList.forEach(e=>{const{fn:n,eventName:s,el:r}=e;r.removeEventListener(s,n)}),this.clearIdList=[]}}const kl=async()=>{document.getElementById("loadingWrap").classList.add("hidden"),document.getElementById("viewerInputContainer").classList.remove("hidden");const t=document.getElementById("input-error"),e=async n=>{const s=window.viewerConfig;if(!s||!s.plyUrls||s.plyUrls.length<=0){t.textContent="Please choose or drag a file to view.";return}const r=li({startNumber:0,spaceTime:5,number:s.plyUrls.length});s.metaInfo={...n.metaInfo||{},timeOption:s.metaInfo.timeOption||r},s.settings=n.settings,await Bw(s)};new Nw(e)},Ow=async()=>{const t=window.parent.location.origin,e=ra();!e&&Ei.initialize();const n=new URL(location.href);if(window.addEventListener("message",s=>{Ft.on(rr.LISTEN_MESSAGE,r=>{var i;(i=s.source)==null||i.postMessage(r,t)}),Qt()&&s.data&&s.data.type==="titleShow"&&(s.data.value?(document.getElementById("cancelWheel").classList.add("hidden"),Ft.emit("onNoWheel")):(document.getElementById("enterWheel").classList.add("hidden"),Ft.emit("cancelNoWheel")))},!1),Zl()){const s=function(i){i.ctrlKey||(i.stopImmediatePropagation(),window.parent.postMessage({type:"iframeWheel",deltaY:i.deltaY},"*"))},r=()=>{var d,c;const i=document.getElementById("timelineContainer"),o=document.getElementById("buttonContainer");i.style.display="none",o.style.display="none",document.getElementById("cancelWheel").classList.add("hidden"),window.addEventListener("wheel",s,{capture:!0,passive:!1});const a=(d=document.getElementsByTagName("canvas"))==null?void 0:d[0];a==null||a.addEventListener("pointerdown",function(){window.parent.postMessage({type:"iframeClick"},"*")}),(c=document.getElementById("enterWheel"))==null||c.addEventListener("pointerdown",function(){window.parent.postMessage({type:"iframeClick"},"*")}),Qt()&&a&&(a.style.touchAction="pan-y",["pointermove"].forEach(l=>{window.addEventListener(l,s,{capture:!0,passive:!1})}))};r(),Ft.on("cancelNoWheel",()=>{var d;document.getElementById("cancelWheel").classList.remove("hidden");const i=document.getElementById("timelineContainer"),o=document.getElementById("buttonContainer");i.style.display="block",o.style.display="flex",window.removeEventListener("wheel",s,{capture:!0,passive:!1});const a=(d=document.getElementsByTagName("canvas"))==null?void 0:d[0];Qt()&&a&&(a.style.touchAction="none",["pointermove"].forEach(c=>{window.removeEventListener(c,s,{capture:!0,passive:!1})}))}),Ft.on("onNoWheel",r)}if(document.getElementById("volumeContainer")&&(document.getElementById("volumeContainer").style.bottom="70px"),n.searchParams.has("content")||n.pathname){if(n.searchParams.has("statinfo")&&document.getElementById("statsPanel")&&document.getElementById("statsPanel").classList.remove("hidden"),await dr()){const{guideList:r}=await Dt.getSSE();(r==null?void 0:r.length)>0&&_p(r)}else await kl();e||Ei.startCount(5);return}await kl(),!e&&Ei.startCount(5)};function Uw(t){const{root:e,noContainer:n}=t||{},s=document.createElement("div");s.id="ui",s.innerHTML=`
    ${n?"":`
    <div id="maxIconWrapper" class="hidden">
        <div id="volumeShowMax" class="maxIcon hidden">
            <svg id="unMutedStatusMax" class="icon hidden unMutedStatus" viewBox="0 0 1024 1024" fill="currentColor" xmlns="http://www.w3.org/2000/svg" p-id="2503" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M734.118332 271.7758l-46.483684 46.52257c43.48028 50.070372 69.959352 115.233488 69.959352 186.752358 0 78.772065-31.899524 150.056598-83.529415 201.648626l46.482661 46.483684c63.563688-63.447031 102.833063-151.207817 102.833063-248.131287C823.381331 415.397848 789.493523 333.817832 734.118332 271.7758z" p-id="2504"></path><path d="M830.049195 175.883823l-49.329499 49.290613c67.229171 74.0536 108.565625 172.011632 108.565625 279.874245 0 115.115807-46.678112 219.333404-122.096802 294.789956l49.252751 49.281403c88.1302-88.043219 142.569066-209.691813 142.569066-344.07136C959.009312 377.922329 909.834332 262.572184 830.049195 175.883823z" p-id="2505"></path><path d="M646.729006 359.243921l-44.534286 44.474934c21.877263 27.979238 35.018561 63.076594 35.018561 101.33085 0 45.508473-18.444071 86.706781-48.237631 116.519784l44.182268 44.240597c41.102117-41.179888 66.566068-97.977475 66.566068-160.761404C699.723987 449.539436 679.75826 398.707724 646.729006 359.243921z" p-id="2506"></path><path d="M224.830093 633.092939 498.018056 837.997726 498.018056 177.814802 224.830093 382.680702Z" p-id="2507"></path><path d="M87.252715 381.432269c-12.830213 0-23.202445 10.372232-23.202445 23.183002l0 0L64.05027 604.060719c0 12.81077 10.373255 23.183002 23.202445 23.183002l84.923158 0c0.001023 0 0.010233 0.001023 0.010233 0.001023l0-0.001023L172.186106 381.432269l0 0-0.005117 0L87.252715 381.432269z" p-id="2508"></path></svg>
            <svg id="mutedStatusMax" class="icon mutedStatus" viewBox="0 0 1024 1024" fill="currentColor" xmlns="http://www.w3.org/2000/svg" p-id="1522" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M518.568091 166.067246 231.87351 381.098671 231.87351 643.904169 518.568091 858.944803Z" p-id="1523"></path><path d="M654.891919 704.501292 770.425236 588.959789 885.928876 704.501292 960.552457 629.817336 845.058027 514.322905 960.59339 398.779356 885.969808 324.217173 770.438539 439.702394 654.871453 324.135308 580.308247 398.779356 695.799608 514.309602 580.205916 629.857245Z" p-id="1524"></path><path d="M87.465562 637.779681l89.140203 0L176.605765 379.750977l-89.140203 0c-13.45443 0-24.337291 10.902304-24.337291 24.337291l0 0.039909 0 209.274304 0 0.039909C63.128271 626.877377 74.010109 637.779681 87.465562 637.779681z" p-id="1525"></path></svg>
        </div>
        <div id="arModeMax" class="maxIcon hidden">
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M440-181 240-296q-19-11-29.5-29T200-365v-230q0-22 10.5-40t29.5-29l200-115q19-11 40-11t40 11l200 115q19 11 29.5 29t10.5 40v230q0 22-10.5 40T720-296L520-181q-19 11-40 11t-40-11Zm0-92v-184l-160-93v185l160 92Zm80 0 160-92v-185l-160 93v184ZM80-680v-120q0-33 23.5-56.5T160-880h120v80H160v120H80ZM280-80H160q-33 0-56.5-23.5T80-160v-120h80v120h120v80Zm400 0v-80h120v-120h80v120q0 33-23.5 56.5T800-80H680Zm120-600v-120H680v-80h120q33 0 56.5 23.5T880-800v120h-80ZM480-526l158-93-158-91-158 91 158 93Zm0 45Zm0-45Zm40 69Zm-80 0Z"/></svg>
        </div>
        <div id="vrModeMax" class="maxIcon hidden">
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M300-240q-66 0-113-47t-47-113v-163q0-51 32-89.5t82-47.5q57-11 113-15.5t113-4.5q57 0 113.5 4.5T706-700q50 10 82 48t32 89v163q0 66-47 113t-113 47h-40q-13 0-26-1.5t-25-6.5l-64-22q-12-5-25-5t-25 5l-64 22q-12 5-25 6.5t-26 1.5h-40Zm0-80h40q7 0 13.5-1t12.5-3q29-9 56.5-19t57.5-10q30 0 58 9.5t56 19.5q6 2 12.5 3t13.5 1h40q33 0 56.5-23.5T740-400v-163q0-22-14-38t-35-21q-52-11-104.5-14.5T480-640q-54 0-106 4t-105 14q-21 4-35 20.5T220-563v163q0 33 23.5 56.5T300-320ZM40-400v-160h60v160H40Zm820 0v-160h60v160h-60Zm-380-80Z"/></svg>
        </div>
    </div>
    `}
    <div id="viewerInputContainer" class="inputContainer hidden ${e?"":"fdv-item-center"}">
        <div class="panel">
            <div class="viewer-header">4D VIDEO PLAYER</div>
            <div id="dragInput" class="drag-input">
                <input type="file" multiple accept="" id="fileInput" style="display: none;">
                <span id="drag-file">Drag & drop .4dv file, or click to open file</span>
            </div>
            <label for="input-fov" class="text-input-position">
                <span class="text-input-label">Fov:</span>
                <span title="Fov" class="text-input">
                    <input name="inputFov" aria-label="inputFov" id="input-fov" type="number" placeholder="Fov" />
                </span>
            </label>
            <label for="input-position" class="text-input-position">
                <span class="text-input-label">Camera position:</span>
                <span class="text-input">
                  <input aria-label="inputPosition" id="input-position" type="text" placeholder="Camera position" />
                </span>
            </label>
            <label for="input-target" class="text-input-position">
                <span class="text-input-label">Camera target:</span>
                <span class="text-input">
                  <input aria-label="inputTarget" id="input-target" type="text" placeholder="Camera target" />
                </span>
            </label>

            <label for="input-xr-position" class="text-input-position">
                <span class="text-input-label">XR Camera position:</span>
                <span class="text-input">
                  <input aria-label="inputXRPosition" id="input-xr-position" type="text" placeholder="XR Camera position" />
                </span>
            </label>
            <label for="input-xr-target" class="text-input-position">
                <span class="text-input-label">XR Camera target:</span>
                <span class="text-input">
                  <input aria-label="inputXRTarget" id="input-xr-target" type="text" placeholder="XR Camera target" />
                </span>
            </label>
            <label for="input-m-position" class="text-input-position">
                <span class="text-input-label">position:</span>
                <span class="text-input">
                  <input aria-label="inputMPosition" id="input-m-position" type="text" placeholder="position" />
                </span>
            </label>
            <label for="input-m-rotation" class="text-input-position">
                <span class="text-input-label">rotation:</span>
                <span class="text-input">
                  <input aria-label="inputMRotation" id="input-m-rotation" type="text" placeholder="rotation" />
                </span>
            </label>
            <label for="input-m-scale" class="text-input-position">
                <span class="text-input-label">scale:</span>
                <span class="text-input">
                  <input aria-label="inputMScale" id="input-m-scale" type="text" placeholder="scale" />
                </span>
            </label>
            <label for="input-duration" class="text-input-position">
                <span class="text-input-label">Duration:</span>
                <span class="text-input">
                    <input aria-label="inputDuration" id="input-duration" type="number" placeholder="Duration" />
                </span>
            </label>
            <label for="input-fps" class="text-input-position">
                <span class="text-input-label">FPS:</span>
                <span class="text-input">
                    <input aria-label="inputFPS" id="input-fps" type="number" placeholder="FPS(-1 not limit)" />
                </span>
            </label>
          
            <label for="input-fps" class="text-input-position">
                <span class="text-input-label">Dynamic Sorting:</span>
                <input class="text-input-checkbox" aria-label="inputDynamicSorting" id="input-dynamic-sorting" type="checkbox"
                    checked />
            </label>
            <label for="input-fps" class="text-input-position">
                <span class="text-input-label ">Temporal Sorting:</span>
                <input class="text-input-checkbox" aria-label="inputTemporalSorting" id="input-temporal-sorting" type="checkbox"
                    checked />
            </label>
            <div class="panel-footer">
                <span id="input-error" class="error-tips"></span>
                <button class="text-button" id="input-view">View</button>
                <button class="text-button" id="input-reset">Reset</button>
            </div>
        </div>
    </div>
    <div id="poster"></div>
    <video
        id="video"
        autoPlay
        muted
        loop=""
        class="w-full h-full m-auto object-cover"
    ></video>
    <svg id="cancelWheel" class="hidden" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="107.84228515625" height="15.02001953125" viewBox="0 0 107.84228515625 15.02001953125" fill="none">
        <g >
            <path     fill="#FCFCFC"  d="M5.51997 15.02Q3.87997 15.02 2.62997 14.38Q1.37997 13.74 0.689975 12.57Q-2.47359e-05 11.4 -2.47359e-05 9.86L-2.47359e-05 5.81999Q-2.47359e-05 4.29999 0.689975 3.13999Q1.37997 1.97999 2.62997 1.33999Q3.87997 0.69999 5.51997 0.69999Q7.15997 0.69999 8.40997 1.29999Q9.65997 1.89999 10.35 2.98999Q11.04 4.07999 11.04 5.51999Q11.04 5.69999 10.74 5.73999L7.57997 5.93999L7.51997 5.93999Q7.27997 5.93999 7.27997 5.71999Q7.27997 4.89999 6.79997 4.40999Q6.31997 3.91999 5.51997 3.91999Q4.71997 3.91999 4.23997 4.40999Q3.75997 4.89999 3.75997 5.71999L3.75997 10.02Q3.75997 10.82 4.23997 11.31Q4.71997 11.8 5.51997 11.8Q6.31997 11.8 6.79997 11.31Q7.27997 10.82 7.27997 10.02Q7.27997 9.9 7.35997 9.84Q7.43997 9.78 7.57997 9.8L10.74 9.96Q11.04 9.98 11.04 10.16Q11.04 11.6 10.35 12.7Q9.65997 13.8 8.40997 14.41Q7.15997 15.02 5.51997 15.02ZM12.54 14.86Q12.4 14.86 12.32 14.78Q12.24 14.7 12.24 14.56L12.24 1.15999Q12.24 1.01999 12.32 0.93999Q12.4 0.859991 12.54 0.859991L15.7 0.859991Q15.84 0.859991 15.92 0.93999Q16 1.01999 16 1.15999L16 14.56Q16 14.7 15.92 14.78Q15.84 14.86 15.7 14.86L12.54 14.86ZM19.22 3.75999Q18.4 3.75999 17.87 3.22999Q17.34 2.69999 17.34 1.87999Q17.34 1.03999 17.87 0.519989Q18.4 -1.14441e-05 19.22 -1.14441e-05Q20.04 -1.14441e-05 20.57 0.519989Q21.1 1.03999 21.1 1.87999Q21.1 2.67999 20.57 3.21999Q20.04 3.75999 19.22 3.75999ZM17.62 14.86Q17.48 14.86 17.4 14.78Q17.32 14.7 17.32 14.56L17.32 4.75999Q17.32 4.61999 17.4 4.53999Q17.48 4.45999 17.62 4.45999L20.78 4.45999Q20.92 4.45999 21 4.53999Q21.08 4.61999 21.08 4.75999L21.08 14.56Q21.08 14.7 21 14.78Q20.92 14.86 20.78 14.86L17.62 14.86ZM27.38 15.02Q25.68 15.02 24.42 14.19Q23.16 13.36 22.58 11.88Q22.18 10.86 22.18 9.6Q22.18 8.35999 22.58 7.33999Q23.14 5.91999 24.42 5.10999Q25.7 4.29999 27.38 4.29999Q29.08 4.29999 30.39 5.14999Q31.7 5.99999 32.16 7.27999Q32.3 7.64 32.34 8.04L32.34 8.09999Q32.34 8.3 32.08 8.35999L28.98 8.85999L28.92 8.85999Q28.66 8.85999 28.64 8.59999L28.56 8.31999Q28.46 7.98 28.13 7.75Q27.8 7.51999 27.36 7.51999Q26.56 7.51999 26.22 8.24Q25.98 8.74 25.98 9.62Q25.98 10.44 26.2 11Q26.54 11.8 27.36 11.8Q28.24 11.8 28.56 10.88L28.58 10.8Q28.64 10.46 28.92 10.52L32.04 11.04Q32.3 11.1 32.3 11.32Q32.3 11.56 32.16 11.98Q31.64 13.44 30.35 14.23Q29.06 15.02 27.38 15.02ZM33.68 14.86Q33.54 14.86 33.46 14.78Q33.38 14.7 33.38 14.56L33.38 1.15999Q33.38 1.01999 33.46 0.93999Q33.54 0.859991 33.68 0.859991L36.84 0.859991Q36.98 0.859991 37.06 0.93999Q37.14 1.01999 37.14 1.15999L37.14 6.89999Q37.14 6.95999 37.18 6.97999Q37.22 6.99999 37.26 6.93999L38.96 4.63999Q39.08 4.45999 39.32 4.45999L42.92 4.45999Q43.04 4.45999 43.11 4.50999Q43.18 4.55999 43.18 4.63999Q43.18 4.71999 43.12 4.81999L40.54 8.3Q40.5 8.35999 40.54 8.43999L43.4799 14.5L43.52 14.66Q43.52 14.86 43.26 14.86L39.96 14.86Q39.7 14.86 39.6 14.62L37.98 10.78Q37.96 10.74 37.91 10.73Q37.86 10.72 37.84 10.76L37.18 11.88Q37.14 11.96 37.14 12L37.14 14.56Q37.14 14.7 37.06 14.78Q36.98 14.86 36.84 14.86L33.68 14.86ZM56.2311 7.15999Q56.2311 7.29999 56.1511 7.37999Q56.0711 7.45999 55.9311 7.45999L54.2711 7.45999Q54.1711 7.45999 54.1711 7.55999L54.1711 10.7Q54.1711 11.7 54.8911 11.7L55.6311 11.7Q55.7711 11.7 55.8511 11.78Q55.9311 11.86 55.9311 12L55.9311 14.56Q55.9311 14.84 55.6311 14.88Q54.8511 14.94 54.1311 14.94Q52.3111 14.94 51.4511 14.38Q50.5911 13.82 50.5711 12.26L50.5711 7.55999Q50.5711 7.45999 50.4711 7.45999L49.3911 7.45999Q49.2511 7.45999 49.1711 7.37999Q49.0911 7.29999 49.0911 7.15999L49.0911 4.75999Q49.0911 4.61999 49.1711 4.53999Q49.2511 4.45999 49.3911 4.45999L50.4711 4.45999Q50.5711 4.45999 50.5711 4.35999L50.5711 1.95999Q50.5711 1.81999 50.6511 1.73999Q50.7311 1.65999 50.8711 1.65999L53.8711 1.65999Q54.0111 1.65999 54.0911 1.73999Q54.1711 1.81999 54.1711 1.95999L54.1711 4.35999Q54.1711 4.45999 54.2711 4.45999L55.9311 4.45999Q56.0711 4.45999 56.1511 4.53999Q56.2311 4.61999 56.2311 4.75999L56.2311 7.15999ZM62.1711 15.02Q60.2711 15.02 58.9611 14Q57.6511 12.98 57.2311 11.24Q57.0311 10.52 57.0311 9.64Q57.0311 8.66 57.2711 7.85999Q57.7511 6.19999 59.0411 5.24999Q60.3311 4.29999 62.1911 4.29999Q64.0511 4.29999 65.3211 5.24999Q66.5911 6.19999 67.0711 7.81999Q67.3111 8.66 67.3111 9.6Q67.3111 10.36 67.1511 11.12Q66.7311 12.92 65.4211 13.97Q64.1111 15.02 62.1711 15.02ZM62.1711 11.8Q62.6911 11.8 63.0111 11.45Q63.3311 11.1 63.4511 10.52Q63.5311 10.14 63.5311 9.62Q63.5311 9.16 63.4311 8.7Q63.1311 7.51999 62.1711 7.51999Q61.1711 7.51999 60.9111 8.7Q60.8111 9.04 60.8111 9.62Q60.8111 10.14 60.8911 10.52Q61.1911 11.8 62.1711 11.8ZM83.3423 8.92Q83.4023 9.36 83.4023 9.82Q83.4023 10.14 83.3823 10.32Q83.3823 10.6 83.0823 10.6L77.0823 10.6Q77.0023 10.6 77.0023 10.68Q77.0023 10.86 77.1623 11.1Q77.3623 11.44 77.8723 11.67Q78.3823 11.9 79.0223 11.9Q79.5623 11.9 80.0223 11.74Q80.4823 11.58 80.8023 11.28Q80.9023 11.2 81.0023 11.2Q81.1423 11.2 81.2223 11.32L82.7423 13.26Q82.8223 13.36 82.8223 13.48Q82.8223 13.6 82.7223 13.68Q82.0223 14.36 80.9823 14.69Q79.9423 15.02 78.7423 15.02Q76.8823 15.02 75.5623 14.24Q74.2423 13.46 73.6423 12.02Q73.2023 10.98 73.2023 9.78Q73.2023 8.51999 73.5623 7.54Q74.1023 6.01999 75.3423 5.15999Q76.5823 4.29999 78.2623 4.29999Q79.5423 4.29999 80.6323 4.89999Q81.7223 5.49999 82.4323 6.54999Q83.1423 7.59999 83.3423 8.92ZM78.2423 7.51999Q77.4223 7.51999 77.1023 8.31999L77.0223 8.54Q77.0023 8.59999 77.0423 8.63Q77.0823 8.66 77.1223 8.66L79.4023 8.66Q79.4823 8.66 79.4823 8.58Q79.4823 8.5 79.4223 8.31999Q79.3223 7.93999 79.0123 7.73Q78.7023 7.51999 78.2423 7.51999ZM84.3623 14.86Q84.2423 14.86 84.1723 14.81Q84.1023 14.76 84.1023 14.68Q84.1023 14.58 84.1623 14.5L87.2823 9.72Q87.3223 9.66 87.2823 9.6L84.1623 4.81999Q84.1023 4.71999 84.1023 4.63999Q84.1023 4.55999 84.1723 4.50999Q84.2423 4.45999 84.3623 4.45999L87.7223 4.45999Q87.9623 4.45999 88.0823 4.65999L89.3423 6.67999Q89.4023 6.79999 89.4623 6.67999L90.7223 4.65999Q90.8423 4.45999 91.0823 4.45999L94.6823 4.45999Q94.8023 4.45999 94.8723 4.50999Q94.9423 4.55999 94.9423 4.63999Q94.9423 4.71999 94.8823 4.81999L91.7623 9.6Q91.7423 9.66 91.7623 9.72L94.8823 14.5Q94.9423 14.58 94.9423 14.68Q94.9423 14.76 94.8723 14.81Q94.8023 14.86 94.6823 14.86L91.3223 14.86Q91.0823 14.86 90.9623 14.66L89.7023 12.64Q89.6423 12.52 89.5823 12.64L88.3223 14.66Q88.2023 14.86 87.9623 14.86L84.3623 14.86ZM97.8623 3.75999Q97.0423 3.75999 96.5123 3.22999Q95.9823 2.69999 95.9823 1.87999Q95.9823 1.03999 96.5123 0.519989Q97.0423 -1.14441e-05 97.8623 -1.14441e-05Q98.6823 -1.14441e-05 99.2123 0.519989Q99.7423 1.03999 99.7423 1.87999Q99.7423 2.67999 99.2123 3.21999Q98.6823 3.75999 97.8623 3.75999ZM96.2623 14.86Q96.1223 14.86 96.0423 14.78Q95.9623 14.7 95.9623 14.56L95.9623 4.75999Q95.9623 4.61999 96.0423 4.53999Q96.1223 4.45999 96.2623 4.45999L99.4223 4.45999Q99.5623 4.45999 99.6423 4.53999Q99.7223 4.61999 99.7223 4.75999L99.7223 14.56Q99.7223 14.7 99.6423 14.78Q99.5623 14.86 99.4223 14.86L96.2623 14.86ZM107.842 7.15999Q107.842 7.29999 107.762 7.37999Q107.682 7.45999 107.542 7.45999L105.882 7.45999Q105.782 7.45999 105.782 7.55999L105.782 10.7Q105.782 11.7 106.502 11.7L107.242 11.7Q107.382 11.7 107.462 11.78Q107.542 11.86 107.542 12L107.542 14.56Q107.542 14.84 107.242 14.88Q106.462 14.94 105.742 14.94Q103.922 14.94 103.062 14.38Q102.202 13.82 102.182 12.26L102.182 7.55999Q102.182 7.45999 102.082 7.45999L101.002 7.45999Q100.862 7.45999 100.782 7.37999Q100.702 7.29999 100.702 7.15999L100.702 4.75999Q100.702 4.61999 100.782 4.53999Q100.862 4.45999 101.002 4.45999L102.082 4.45999Q102.182 4.45999 102.182 4.35999L102.182 1.95999Q102.182 1.81999 102.262 1.73999Q102.342 1.65999 102.482 1.65999L105.482 1.65999Q105.622 1.65999 105.702 1.73999Q105.782 1.81999 105.782 1.95999L105.782 4.35999Q105.782 4.45999 105.882 4.45999L107.542 4.45999Q107.682 4.45999 107.762 4.53999Q107.842 4.61999 107.842 4.75999L107.842 7.15999Z">
            </path>
        </g>
    </svg>
    <svg width="80px" id="cursor" class="cursor hidden" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 342 175" fill="none">
        <path d="M229.191 64.1944C226.717 64.1944 225.303 64.5882 223.097 65.2785C219.888 59.0657 213.083 54.7002 204.652 54.7002C200.223 54.7002 196.359 55.9155 192.984 57.9573C189.217 53.5334 183.739 50.6312 176.876 50.6312C172.322 50.6312 165.254 55.5606 165.254 57.7142L162.427 15.9891C162.427 6.29062 154.544 0 143.172 0C131.801 0 125.394 7.83653 125.394 17.535L129.196 100.052L121.529 92.1959C114.387 84.6511 100.696 81.0293 91.8496 87.1255C83.0033 93.2168 87.0047 106.804 94.1468 114.354L134.252 163.464C136.805 166.162 145.766 175 167.494 175L201.552 175C250.799 175 247.949 124.388 247.949 124.388L247.949 97.208L247.949 81.8363C247.949 72.1282 240.562 64.1944 229.191 64.1944Z"   fill="#FFFFFF" >
        </path>
        <g opacity="0.6">
            <path d="M342 53.4605L293.55 14.3896L293.55 34.015L247.95 34.015L247.95 77.7674L293.55 77.7674L293.55 92.5314L342 53.4605Z"   fill="#FFFFFF" >
            </path>
        </g>
        <g opacity="0.6">
            <path d="M0 53.4605L48.4498 92.5314L48.4498 77.7674L99.7497 77.7674L99.7497 34.015L48.4498 34.015L48.4498 14.3896L0 53.4605Z"   fill="#FFFFFF" >
            </path>
        </g>
    </svg>
    <svg id="enterWheel" class="hidden" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="144.8424072265625" height="15.02001953125" viewBox="0 0 144.8424072265625 15.02001953125" fill="none">
        <g >
            <path     fill="#FCFCFC"  d="M5.51998 15.02Q3.87998 15.02 2.62998 14.38Q1.37998 13.74 0.689976 12.57Q-2.38419e-05 11.4 -2.38419e-05 9.86L-2.38419e-05 5.81999Q-2.38419e-05 4.29999 0.689976 3.13999Q1.37998 1.97999 2.62998 1.33999Q3.87998 0.69999 5.51998 0.69999Q7.15998 0.69999 8.40998 1.29999Q9.65998 1.89999 10.35 2.98999Q11.04 4.07999 11.04 5.51999Q11.04 5.69999 10.74 5.73999L7.57998 5.93999L7.51998 5.93999Q7.27998 5.93999 7.27998 5.71999Q7.27998 4.89999 6.79998 4.40999Q6.31998 3.91999 5.51998 3.91999Q4.71998 3.91999 4.23998 4.40999Q3.75998 4.89999 3.75998 5.71999L3.75998 10.02Q3.75998 10.82 4.23998 11.31Q4.71998 11.8 5.51998 11.8Q6.31998 11.8 6.79998 11.31Q7.27998 10.82 7.27998 10.02Q7.27998 9.9 7.35998 9.84Q7.43998 9.78 7.57998 9.8L10.74 9.96Q11.04 9.98 11.04 10.16Q11.04 11.6 10.35 12.7Q9.65998 13.8 8.40998 14.41Q7.15998 15.02 5.51998 15.02ZM12.54 14.86Q12.4 14.86 12.32 14.78Q12.24 14.7 12.24 14.56L12.24 1.15999Q12.24 1.01999 12.32 0.93999Q12.4 0.859991 12.54 0.859991L15.7 0.859991Q15.84 0.859991 15.92 0.93999Q16 1.01999 16 1.15999L16 14.56Q16 14.7 15.92 14.78Q15.84 14.86 15.7 14.86L12.54 14.86ZM19.22 3.75999Q18.4 3.75999 17.87 3.22999Q17.34 2.69999 17.34 1.87999Q17.34 1.03999 17.87 0.519989Q18.4 -1.14441e-05 19.22 -1.14441e-05Q20.04 -1.14441e-05 20.57 0.519989Q21.1 1.03999 21.1 1.87999Q21.1 2.67999 20.57 3.21999Q20.04 3.75999 19.22 3.75999ZM17.62 14.86Q17.48 14.86 17.4 14.78Q17.32 14.7 17.32 14.56L17.32 4.75999Q17.32 4.61999 17.4 4.53999Q17.48 4.45999 17.62 4.45999L20.78 4.45999Q20.92 4.45999 21 4.53999Q21.08 4.61999 21.08 4.75999L21.08 14.56Q21.08 14.7 21 14.78Q20.92 14.86 20.78 14.86L17.62 14.86ZM27.38 15.02Q25.68 15.02 24.42 14.19Q23.16 13.36 22.58 11.88Q22.18 10.86 22.18 9.6Q22.18 8.35999 22.58 7.33999Q23.14 5.91999 24.42 5.10999Q25.7 4.29999 27.38 4.29999Q29.08 4.29999 30.39 5.14999Q31.7 5.99999 32.16 7.27999Q32.3 7.64 32.34 8.04L32.34 8.09999Q32.34 8.3 32.08 8.35999L28.98 8.85999L28.92 8.85999Q28.66 8.85999 28.64 8.59999L28.56 8.31999Q28.46 7.98 28.13 7.75Q27.8 7.51999 27.36 7.51999Q26.56 7.51999 26.22 8.24Q25.98 8.74 25.98 9.62Q25.98 10.44 26.2 11Q26.54 11.8 27.36 11.8Q28.24 11.8 28.56 10.88L28.58 10.8Q28.64 10.46 28.92 10.52L32.04 11.04Q32.3 11.1 32.3 11.32Q32.3 11.56 32.16 11.98Q31.64 13.44 30.35 14.23Q29.06 15.02 27.38 15.02ZM33.68 14.86Q33.54 14.86 33.46 14.78Q33.38 14.7 33.38 14.56L33.38 1.15999Q33.38 1.01999 33.46 0.93999Q33.54 0.859991 33.68 0.859991L36.84 0.859991Q36.98 0.859991 37.06 0.93999Q37.14 1.01999 37.14 1.15999L37.14 6.89999Q37.14 6.95999 37.18 6.97999Q37.22 6.99999 37.26 6.93999L38.96 4.63999Q39.08 4.45999 39.32 4.45999L42.92 4.45999Q43.04 4.45999 43.11 4.50999Q43.18 4.55999 43.18 4.63999Q43.18 4.71999 43.12 4.81999L40.54 8.3Q40.5 8.35999 40.54 8.43999L43.48 14.5L43.52 14.66Q43.52 14.86 43.26 14.86L39.96 14.86Q39.7 14.86 39.6 14.62L37.98 10.78Q37.96 10.74 37.91 10.73Q37.86 10.72 37.84 10.76L37.18 11.88Q37.14 11.96 37.14 12L37.14 14.56Q37.14 14.7 37.06 14.78Q36.98 14.86 36.84 14.86L33.68 14.86ZM56.2312 7.15999Q56.2312 7.29999 56.1512 7.37999Q56.0712 7.45999 55.9312 7.45999L54.2712 7.45999Q54.1712 7.45999 54.1712 7.55999L54.1712 10.7Q54.1712 11.7 54.8912 11.7L55.6312 11.7Q55.7712 11.7 55.8512 11.78Q55.9312 11.86 55.9312 12L55.9312 14.56Q55.9312 14.84 55.6312 14.88Q54.8512 14.94 54.1312 14.94Q52.3112 14.94 51.4512 14.38Q50.5912 13.82 50.5712 12.26L50.5712 7.55999Q50.5712 7.45999 50.4712 7.45999L49.3912 7.45999Q49.2512 7.45999 49.1712 7.37999Q49.0912 7.29999 49.0912 7.15999L49.0912 4.75999Q49.0912 4.61999 49.1712 4.53999Q49.2512 4.45999 49.3912 4.45999L50.4712 4.45999Q50.5712 4.45999 50.5712 4.35999L50.5712 1.95999Q50.5712 1.81999 50.6512 1.73999Q50.7312 1.65999 50.8712 1.65999L53.8712 1.65999Q54.0112 1.65999 54.0912 1.73999Q54.1712 1.81999 54.1712 1.95999L54.1712 4.35999Q54.1712 4.45999 54.2712 4.45999L55.9312 4.45999Q56.0712 4.45999 56.1512 4.53999Q56.2312 4.61999 56.2312 4.75999L56.2312 7.15999ZM62.1712 15.02Q60.2712 15.02 58.9612 14Q57.6512 12.98 57.2312 11.24Q57.0312 10.52 57.0312 9.64Q57.0312 8.66 57.2712 7.85999Q57.7512 6.19999 59.0412 5.24999Q60.3312 4.29999 62.1912 4.29999Q64.0512 4.29999 65.3212 5.24999Q66.5912 6.19999 67.0712 7.81999Q67.3112 8.66 67.3112 9.6Q67.3112 10.36 67.1512 11.12Q66.7312 12.92 65.4212 13.97Q64.1112 15.02 62.1712 15.02ZM62.1712 11.8Q62.6912 11.8 63.0112 11.45Q63.3312 11.1 63.4512 10.52Q63.5312 10.14 63.5312 9.62Q63.5312 9.16 63.4312 8.7Q63.1312 7.51999 62.1712 7.51999Q61.1712 7.51999 60.9112 8.7Q60.8112 9.04 60.8112 9.62Q60.8112 10.14 60.8912 10.52Q61.1912 11.8 62.1712 11.8ZM75.2623 3.75999Q74.4423 3.75999 73.9123 3.22999Q73.3823 2.69999 73.3823 1.87999Q73.3823 1.03999 73.9123 0.519989Q74.4423 -1.14441e-05 75.2623 -1.14441e-05Q76.0823 -1.14441e-05 76.6124 0.519989Q77.1423 1.03999 77.1423 1.87999Q77.1423 2.67999 76.6124 3.21999Q76.0823 3.75999 75.2623 3.75999ZM73.6623 14.86Q73.5223 14.86 73.4423 14.78Q73.3623 14.7 73.3623 14.56L73.3623 4.75999Q73.3623 4.61999 73.4423 4.53999Q73.5223 4.45999 73.6623 4.45999L76.8223 4.45999Q76.9623 4.45999 77.0423 4.53999Q77.1223 4.61999 77.1223 4.75999L77.1223 14.56Q77.1223 14.7 77.0423 14.78Q76.9623 14.86 76.8223 14.86L73.6623 14.86ZM84.6824 4.29999Q85.6824 4.29999 86.4823 4.73999Q87.2823 5.17999 87.7523 6.02999Q88.2224 6.87999 88.2224 8.04L88.2224 14.56Q88.2224 14.7 88.1423 14.78Q88.0623 14.86 87.9223 14.86L84.7624 14.86Q84.6223 14.86 84.5424 14.78Q84.4623 14.7 84.4623 14.56L84.4623 8.85999Q84.4623 8.25999 84.1524 7.88999Q83.8423 7.51999 83.3423 7.51999Q82.8223 7.51999 82.5124 7.88999Q82.2023 8.25999 82.2023 8.85999L82.2023 14.56Q82.2023 14.7 82.1223 14.78Q82.0424 14.86 81.9024 14.86L78.7423 14.86Q78.6023 14.86 78.5223 14.78Q78.4424 14.7 78.4424 14.56L78.4424 4.75999Q78.4424 4.61999 78.5223 4.53999Q78.6023 4.45999 78.7423 4.45999L81.9024 4.45999Q82.0424 4.45999 82.1223 4.53999Q82.2023 4.61999 82.2023 4.75999L82.2023 5.47999Q82.2023 5.55999 82.2423 5.57999Q82.2823 5.59999 82.3023 5.53999Q83.0623 4.29999 84.6824 4.29999ZM96.2824 7.15999Q96.2824 7.29999 96.2024 7.37999Q96.1224 7.45999 95.9824 7.45999L94.3223 7.45999Q94.2224 7.45999 94.2224 7.55999L94.2224 10.7Q94.2224 11.7 94.9424 11.7L95.6824 11.7Q95.8224 11.7 95.9024 11.78Q95.9824 11.86 95.9824 12L95.9824 14.56Q95.9824 14.84 95.6824 14.88Q94.9024 14.94 94.1824 14.94Q92.3624 14.94 91.5023 14.38Q90.6423 13.82 90.6224 12.26L90.6224 7.55999Q90.6224 7.45999 90.5223 7.45999L89.4424 7.45999Q89.3024 7.45999 89.2224 7.37999Q89.1423 7.29999 89.1423 7.15999L89.1423 4.75999Q89.1423 4.61999 89.2224 4.53999Q89.3024 4.45999 89.4424 4.45999L90.5223 4.45999Q90.6224 4.45999 90.6224 4.35999L90.6224 1.95999Q90.6224 1.81999 90.7023 1.73999Q90.7823 1.65999 90.9223 1.65999L93.9223 1.65999Q94.0623 1.65999 94.1423 1.73999Q94.2224 1.81999 94.2224 1.95999L94.2224 4.35999Q94.2224 4.45999 94.3223 4.45999L95.9824 4.45999Q96.1224 4.45999 96.2024 4.53999Q96.2824 4.61999 96.2824 4.75999L96.2824 7.15999ZM107.282 8.92Q107.342 9.36 107.342 9.82Q107.342 10.14 107.322 10.32Q107.322 10.6 107.022 10.6L101.022 10.6Q100.942 10.6 100.942 10.68Q100.942 10.86 101.102 11.1Q101.302 11.44 101.812 11.67Q102.322 11.9 102.962 11.9Q103.502 11.9 103.962 11.74Q104.422 11.58 104.742 11.28Q104.842 11.2 104.942 11.2Q105.082 11.2 105.162 11.32L106.682 13.26Q106.762 13.36 106.762 13.48Q106.762 13.6 106.662 13.68Q105.962 14.36 104.922 14.69Q103.882 15.02 102.682 15.02Q100.822 15.02 99.5024 14.24Q98.1824 13.46 97.5824 12.02Q97.1424 10.98 97.1424 9.78Q97.1424 8.51999 97.5024 7.54Q98.0424 6.01999 99.2824 5.15999Q100.522 4.29999 102.202 4.29999Q103.482 4.29999 104.572 4.89999Q105.662 5.49999 106.372 6.54999Q107.082 7.59999 107.282 8.92ZM102.182 7.51999Q101.362 7.51999 101.042 8.31999L100.962 8.54Q100.942 8.59999 100.982 8.63Q101.022 8.66 101.062 8.66L103.342 8.66Q103.422 8.66 103.422 8.58Q103.422 8.5 103.362 8.31999Q103.262 7.93999 102.952 7.73Q102.642 7.51999 102.182 7.51999ZM114.182 4.31999Q114.862 4.31999 115.262 4.57999Q115.442 4.67999 115.402 4.95999L114.922 8.04Q114.902 8.2 114.812 8.24Q114.722 8.27999 114.562 8.24Q114.202 8.16 113.922 8.16Q113.622 8.16 113.362 8.22Q112.842 8.31999 112.472 8.64999Q112.102 8.98 112.102 9.54L112.102 14.56Q112.102 14.7 112.022 14.78Q111.942 14.86 111.802 14.86L108.642 14.86Q108.502 14.86 108.422 14.78Q108.342 14.7 108.342 14.56L108.342 4.75999Q108.342 4.61999 108.422 4.53999Q108.502 4.45999 108.642 4.45999L111.802 4.45999Q111.942 4.45999 112.022 4.53999Q112.102 4.61999 112.102 4.75999L112.102 5.23999Q112.102 5.29999 112.142 5.31999Q112.182 5.33999 112.202 5.29999Q112.962 4.31999 114.182 4.31999ZM120.782 4.29999Q122.142 4.29999 123.282 4.75999Q124.422 5.21999 125.082 6.01999Q125.742 6.81999 125.742 7.75999L125.742 14.56Q125.742 14.7 125.662 14.78Q125.582 14.86 125.442 14.86L122.282 14.86Q122.142 14.86 122.062 14.78Q121.982 14.7 121.982 14.56L121.982 13.86Q121.982 13.78 121.952 13.77Q121.922 13.76 121.882 13.82Q121.542 14.44 120.942 14.73Q120.342 15.02 119.362 15.02Q117.722 15.02 116.782 14.27Q115.842 13.52 115.842 12.08Q115.842 10.56 116.912 9.74Q117.982 8.92 120.022 8.92L121.882 8.92Q121.982 8.92 121.982 8.81999L121.982 8.46Q121.982 8.04 121.672 7.77999Q121.362 7.51999 120.842 7.51999Q120.482 7.51999 120.202 7.64Q119.922 7.75999 119.802 7.96Q119.722 8.09999 119.652 8.14999Q119.582 8.2 119.462 8.17999L116.242 7.77999Q115.962 7.74 115.962 7.54Q116.042 6.63999 116.682 5.89999Q117.322 5.15999 118.392 4.72999Q119.462 4.29999 120.782 4.29999ZM120.522 12.42Q121.162 12.42 121.572 12.08Q121.982 11.74 121.982 11.16L121.982 10.9Q121.982 10.8 121.882 10.8L120.882 10.8Q119.622 10.8 119.622 11.62Q119.622 11.98 119.852 12.2Q120.082 12.42 120.522 12.42ZM132.042 15.02Q130.342 15.02 129.082 14.19Q127.822 13.36 127.242 11.88Q126.842 10.86 126.842 9.6Q126.842 8.35999 127.242 7.33999Q127.802 5.91999 129.082 5.10999Q130.362 4.29999 132.042 4.29999Q133.742 4.29999 135.052 5.14999Q136.362 5.99999 136.822 7.27999Q136.962 7.64 137.002 8.04L137.002 8.09999Q137.002 8.3 136.742 8.35999L133.642 8.85999L133.582 8.85999Q133.322 8.85999 133.302 8.59999L133.222 8.31999Q133.122 7.98 132.792 7.75Q132.462 7.51999 132.022 7.51999Q131.222 7.51999 130.882 8.24Q130.642 8.74 130.642 9.62Q130.642 10.44 130.862 11Q131.202 11.8 132.022 11.8Q132.902 11.8 133.222 10.88L133.242 10.8Q133.302 10.46 133.582 10.52L136.702 11.04Q136.962 11.1 136.962 11.32Q136.962 11.56 136.822 11.98Q136.302 13.44 135.012 14.23Q133.722 15.02 132.042 15.02ZM144.842 7.15999Q144.842 7.29999 144.762 7.37999Q144.682 7.45999 144.542 7.45999L142.882 7.45999Q142.782 7.45999 142.782 7.55999L142.782 10.7Q142.782 11.7 143.502 11.7L144.242 11.7Q144.382 11.7 144.462 11.78Q144.542 11.86 144.542 12L144.542 14.56Q144.542 14.84 144.242 14.88Q143.462 14.94 142.742 14.94Q140.922 14.94 140.062 14.38Q139.202 13.82 139.182 12.26L139.182 7.55999Q139.182 7.45999 139.082 7.45999L138.002 7.45999Q137.862 7.45999 137.782 7.37999Q137.702 7.29999 137.702 7.15999L137.702 4.75999Q137.702 4.61999 137.782 4.53999Q137.862 4.45999 138.002 4.45999L139.082 4.45999Q139.182 4.45999 139.182 4.35999L139.182 1.95999Q139.182 1.81999 139.262 1.73999Q139.342 1.65999 139.482 1.65999L142.482 1.65999Q142.622 1.65999 142.702 1.73999Q142.782 1.81999 142.782 1.95999L142.782 4.35999Q142.782 4.45999 142.882 4.45999L144.542 4.45999Q144.682 4.45999 144.762 4.53999Q144.842 4.61999 144.842 4.75999L144.842 7.15999Z">
            </path>
        </g>
    </svg>
    <div class="hidden" id="tips">
        <!--        mobile tip -->
        <div id="mobileTip" class="hidden">
            For the best viewing experience, open on a modern PC or laptop.
        </div>
        <!--  questTip       PC VR-->
        <div id="questTip" class="hidden">
            This demo supports modern headsets like Meta Quest 3(S) / PICO 4 Ultra or newer. For the best model resolution and overall experience, please open this page with Chrome on a PC with RTX4070 or higher in PCVR mode.
        </div>
        <!--        all tip-->
        <div id="allTip" class="hidden">
            This demo also supports viewing in a VR headset (Apple Vision Pro / Meta Quest 3(S) / PICO 4 Ultra or PCVR).
        </div>
        <div class="text-button" id="tipsConfirm">Got It</div>
    </div>
    <!-- Loading Indicator -->
    <div id="loadingWrap">
        <div id="loadingText"></div>
        <div id="loadingBar" class="pageLoading">
            <div id="loadingFill"></div>
        </div>
    </div>

    <div class="hidden" id="nextTip">
        <svg class="icon" viewBox="0 0 1024 1024" fill="#fff" xmlns="http://www.w3.org/2000/svg" ><path d="M117.248 588.8c0 8.512 6.848 15.36 15.36 15.36H576.32l-75.712 191.68a15.36 15.36 0 0 0 23.68 17.792L900.8 524.16a15.36 15.36 0 0 0 0-24.32L524.288 210.368a15.36 15.36 0 0 0-23.68 17.792l75.712 191.68H132.608a15.36 15.36 0 0 0-15.36 15.36v153.6z" fill="#fff"></path></svg>
    </div>
    
    ${n?"":`
    <div id="controlsWrap" class="faded-in">

        <!-- Timeline Panel -->
        <div id="timelineContainer" class="hidden">
            <div id="line"></div>
            <div id="handle"></div>
            <div id="time" class="hidden">0:00</div>
        </div>

        <!-- Buttons Panel -->
        <div id="buttonContainer" class="hidden">
            <button id="play" class="button hidden">
                <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="4 4 16 16" fill="currentColor"><path d="M15 12.3301L9 16.6603L9 8L15 12.3301Z"/></svg>
            </button>
            <button id="pause" class="button hidden">
                <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 20 20" fill="currentColor"><path d="M5 16V4h3v12H5zm7-12h3v12h-3V4z"/></svg>
            </button>
            <div id="volumeShow" class="button">
                <svg id="unMutedStatus" class="icon hidden unMutedStatus" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2503" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24"><path d="M734.118332 271.7758l-46.483684 46.52257c43.48028 50.070372 69.959352 115.233488 69.959352 186.752358 0 78.772065-31.899524 150.056598-83.529415 201.648626l46.482661 46.483684c63.563688-63.447031 102.833063-151.207817 102.833063-248.131287C823.381331 415.397848 789.493523 333.817832 734.118332 271.7758z" p-id="2504"></path><path d="M830.049195 175.883823l-49.329499 49.290613c67.229171 74.0536 108.565625 172.011632 108.565625 279.874245 0 115.115807-46.678112 219.333404-122.096802 294.789956l49.252751 49.281403c88.1302-88.043219 142.569066-209.691813 142.569066-344.07136C959.009312 377.922329 909.834332 262.572184 830.049195 175.883823z" p-id="2505"></path><path d="M646.729006 359.243921l-44.534286 44.474934c21.877263 27.979238 35.018561 63.076594 35.018561 101.33085 0 45.508473-18.444071 86.706781-48.237631 116.519784l44.182268 44.240597c41.102117-41.179888 66.566068-97.977475 66.566068-160.761404C699.723987 449.539436 679.75826 398.707724 646.729006 359.243921z" p-id="2506"></path><path d="M224.830093 633.092939 498.018056 837.997726 498.018056 177.814802 224.830093 382.680702Z" p-id="2507"></path><path d="M87.252715 381.432269c-12.830213 0-23.202445 10.372232-23.202445 23.183002l0 0L64.05027 604.060719c0 12.81077 10.373255 23.183002 23.202445 23.183002l84.923158 0c0.001023 0 0.010233 0.001023 0.010233 0.001023l0-0.001023L172.186106 381.432269l0 0-0.005117 0L87.252715 381.432269z" p-id="2508"></path></svg>
                <svg id="mutedStatus" class="icon mutedStatus" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1522" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24"><path d="M518.568091 166.067246 231.87351 381.098671 231.87351 643.904169 518.568091 858.944803Z" p-id="1523"></path><path d="M654.891919 704.501292 770.425236 588.959789 885.928876 704.501292 960.552457 629.817336 845.058027 514.322905 960.59339 398.779356 885.969808 324.217173 770.438539 439.702394 654.871453 324.135308 580.308247 398.779356 695.799608 514.309602 580.205916 629.857245Z" p-id="1524"></path><path d="M87.465562 637.779681l89.140203 0L176.605765 379.750977l-89.140203 0c-13.45443 0-24.337291 10.902304-24.337291 24.337291l0 0.039909 0 209.274304 0 0.039909C63.128271 626.877377 74.010109 637.779681 87.465562 637.779681z" p-id="1525"></path></svg>
                <div id="volumeContainer" class="hidden">
                    <div id="volumeLine"></div>
                    <div id="volumeHandle"></div>
                    <div id="volume" class="hidden">0:00</div>
                </div>
            </div>
            <button id="anima" class="button hidden">
                <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" viewBox="0 0 22 22"
                     fill="currentColor">
                    <g id="svg_6"
                       transform="matrix(0.04913316008465144,0,0,0.04913316008465144,884.7638116738909,585.8773680675253) "
                       stroke="null">
                        <path fill="currentColor"
                              d="m-17957.50662,-11826.07446c25,0 50,0 75,0c0,10 0,20 0,30c-15,0 -30,0 -45,0c0,15 0,30 0,45c-10,0 -20,0 -30,0c0,-25 0,-50 0,-75z"
                              id="svg_7" stroke="null" />
                    </g>
                    <g id="svg_8"
                       transform="matrix(0.04913316008465144,0,0,0.04913316008465144,884.7638116738909,585.8773680675253) "
                       stroke="null">
                        <path fill="currentColor"
                              d="m-17640.50662,-11826.07446c25,0 50,0 75,0c0,25 0,50 0,75c-10,0 -20,0 -30,0c0,-15 0,-30 0,-45c-15,0 -30,0 -45,0c0,-10 0,-20 0,-30z"
                              id="svg_9" stroke="null" />
                    </g>
                    <g id="svg_10"
                       transform="matrix(0.04913316008465144,0,0,0.04913316008465144,884.7638116738909,585.8773680675253) "
                       stroke="null">
                        <path fill="currentColor"
                              d="m-17829.50662,-11771.07446c13.667,0 27.333,0 41,0c0,30.667 0,61.333 0,92c5.667,0 11.333,0 17,0c0,10 0,20 0,30c-5.667,0 -11.333,0 -17,0c0.218,13.689 -0.115,27.355 -1,41c-10.249,0.319 -20.416,-0.014 -30.5,-1c0.462,-13.251 0.628,-26.584 0.5,-40c-26.342,0.333 -52.675,0 -79,-1c23.277,-40.225 46.277,-80.559 69,-121zm9,47c-7.929,15.022 -16.263,29.855 -25,44.5c8.66,0.5 17.327,0.666 26,0.5c0.329,-15.176 -0.004,-30.176 -1,-45z"
                              opacity="0.974" id="svg_11" stroke="null" />
                    </g>
                    <g id="svg_12"
                       transform="matrix(0.04913316008465144,0,0,0.04913316008465144,884.7638116738909,585.8773680675253) "
                       stroke="null">
                        <path fill="currentColor"
                              d="m-17742.50662,-11771.07446c21.669,-0.167 43.336,0 65,0.5c30.31,6.979 48.477,25.812 54.5,56.5c6.451,29.741 1.118,57.074 -16,82c-10.501,12.165 -23.668,19.665 -39.5,22.5c-20.991,0.931 -41.991,1.431 -63,1.5c-0.862,-54.328 -1.195,-108.662 -1,-163zm31,31c0.705,33.662 1.038,67.329 1,101c38.795,4.704 58.461,-12.463 59,-51.5c-1.096,-39.254 -21.096,-55.754 -60,-49.5z"
                              opacity="0.963" id="svg_13" stroke="null" />
                    </g>
                    <g id="svg_14"
                       transform="matrix(0.04913316008465144,0,0,0.04913316008465144,884.7638116738909,585.8773680675253) "
                       stroke="null">
                        <path fill="currentColor"
                              d="m-17957.50662,-11629.07446c10,0 20,0 30,0c0,15 0,30 0,45c15,0 30,0 45,0c0,10 0,20 0,30c-25,0 -50,0 -75,0c0,-25 0,-50 0,-75z"
                              id="svg_15" stroke="null" />
                    </g>
                    <g id="svg_16"
                       transform="matrix(0.04913316008465144,0,0,0.04913316008465144,884.7638116738909,585.8773680675253) "
                       stroke="null">
                        <path fill="currentColor"
                              d="m-17595.50662,-11629.07446c10,0 20,0 30,0c0,25 0,50 0,75c-25,0 -50,0 -75,0c0,-10 0,-20 0,-30c15,0 30,0 45,0c0,-15 0,-30 0,-45z"
                              id="svg_17" stroke="null" />
                    </g>
                </svg>
            </button>
            <div class="spacer"></div>
            <button id="ultraMode" class="button hidden">
                <span class="font-bold">ultra</span>
            </button>
            <button id="arMode" class="button hidden">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M440-181 240-296q-19-11-29.5-29T200-365v-230q0-22 10.5-40t29.5-29l200-115q19-11 40-11t40 11l200 115q19 11 29.5 29t10.5 40v230q0 22-10.5 40T720-296L520-181q-19 11-40 11t-40-11Zm0-92v-184l-160-93v185l160 92Zm80 0 160-92v-185l-160 93v184ZM80-680v-120q0-33 23.5-56.5T160-880h120v80H160v120H80ZM280-80H160q-33 0-56.5-23.5T80-160v-120h80v120h120v80Zm400 0v-80h120v-120h80v120q0 33-23.5 56.5T800-80H680Zm120-600v-120H680v-80h120q33 0 56.5 23.5T880-800v120h-80ZM480-526l158-93-158-91-158 91 158 93Zm0 45Zm0-45Zm40 69Zm-80 0Z"/></svg>
            </button>
            <button id="vrMode" class="button hidden">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M300-240q-66 0-113-47t-47-113v-163q0-51 32-89.5t82-47.5q57-11 113-15.5t113-4.5q57 0 113.5 4.5T706-700q50 10 82 48t32 89v163q0 66-47 113t-113 47h-40q-13 0-26-1.5t-25-6.5l-64-22q-12-5-25-5t-25 5l-64 22q-12 5-25 6.5t-26 1.5h-40Zm0-80h40q7 0 13.5-1t12.5-3q29-9 56.5-19t57.5-10q30 0 58 9.5t56 19.5q6 2 12.5 3t13.5 1h40q33 0 56.5-23.5T740-400v-163q0-22-14-38t-35-21q-52-11-104.5-14.5T480-640q-54 0-106 4t-105 14q-21 4-35 20.5T220-563v163q0 33 23.5 56.5T300-320ZM40-400v-160h60v160H40Zm820 0v-160h60v160h-60Zm-380-80Z"/></svg>
            </button>
            <button id="info" class="button">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M440-280h80v-240h-80v240Zm40-320q17 0 28.5-11.5T520-640q0-17-11.5-28.5T480-680q-17 0-28.5 11.5T440-640q0 17 11.5 28.5T480-600Zm0 520q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg>
            </button>
            <button id="settings" class="button">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M160-160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h480q33 0 56.5 23.5T720-720v180l160-160v440L720-420v180q0 33-23.5 56.5T640-160H160Zm0-80h480v-480H160v480Zm0 0v-480 480Z"/></svg>
            </button>
            <button id="enterFullscreen" class="button">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M120-120v-200h80v120h120v80H120Zm520 0v-80h120v-120h80v200H640ZM120-640v-200h200v80H200v120h-80Zm640 0v-120H640v-80h200v200h-80Z"/></svg>
            </button>
            <button id="exitFullscreen" class="button hidden">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M240-120v-120H120v-80h200v200h-80Zm400 0v-200h200v80H720v120h-80ZM120-640v-80h120v-120h80v200H120Zm520 0v-200h80v120h120v80H640Z"/></svg>
            </button>
        </div>

        <div id="noRepeatWrap">
            <div id="noRepeatPanel">
                <div id="splatsListWrapper">
                    <div id="splatsList"></div>
                </div>
                <div class="btnWrapper hidden">
                    <div class="text-button hidden" id="replay">Re Play</div>
                    <div class="text-button hidden" id="goConfirm">Get Started</div>
                </div>
            </div>
            <svg id="openGuideIcon" viewBox="0 0 1740 1024" xmlns="http://www.w3.org/2000/svg"><path d="M1638.4 0h-102.4v102.4h-102.4v102.4h-102.4v102.4h-102.4v102.4h-102.4v102.4h-102.4v102.4H921.6v102.4H819.2V614.4H716.8V512H614.4V409.6H512V307.2H409.6V204.8H307.2V102.4H204.8V0H0v204.8h102.4v102.4h102.4v102.4h102.4v102.4h102.4v102.4h102.4v102.4h102.4v102.4h102.4v102.4h102.4v102.4h102.4V921.6h102.4V819.2h102.4V716.8h102.4V614.4h102.4V512h102.4V409.6h102.4V307.2h102.4V204.8h102.4V0h-102.4z" fill="#fff"></path></svg>
            <!--        <svg id="openGuideIcon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M512.02916267 263.17888107c-15.117744-0.19780267-30.3215456 5.34965227-41.8416 16.6397952L75.7197568 666.30117867c-22.66634133 22.2167904-22.8076288 58.08579093 0.05522987 80.46698773 22.68303893 22.24119467 59.4601312 22.2463328 82.10977494 0.04495573L512.0548512 399.80244587l0-0.06293654L866.19796907 746.724496c22.64964373 22.20137707 59.426736 22.19624 82.10977387-0.04495467 22.86285867-22.38248213 22.7215712-58.2514816 0.05523093-80.46827306l-394.4665216-386.4825024c-11.52647787-11.29656426-26.7405536-16.8440192-41.8672896-16.63979414l0 0.08990934z" fill="#fff"></path></svg>-->
        </div>
    </div>
    `}

    <!-- Settings Panel -->
    <div id="settingsPanel" class="hidden">
        <div>Camera Mode</div>
        <div id="cameraToggle" class="toggleWrap">
            <div id="cameraToggleHighlight" class="toggleHighlight"></div>
            <button id="orbit" class="left">Orbit</button>
            <button id="fly" class="right">Fly</button>
        </div>
        <div>Render Quality</div>
        <div id="qualityToggle" class="toggleWrap">
            <div id="qualityToggleHighlight" class="toggleHighlight"></div>
            <button id="low" class="left">Low</button>
            <button id="high" class="right">High</button>
        </div>
        <div>View</div>
        <div class="settingsRow">
            <button id="frame" class="button">Frame</button>
            <button id="reset" class="button">Reset</button>
        </div>
    </div>

    <!-- Info Panel -->
    <div id="infoPanel" class="hidden">
        <div id="infoPanelContent" onpointerdown="event.stopPropagation()">
            <div id="header">Controls</div>
            <div id="tabs">
                <div id="desktopTab" class="tab active">Desktop</div>
                <div id="touchTab" class="tab">Touch</div>
            </div>
            <div id="infoPanels">
                <div id="desktopInfoPanel">
                    <div class="control-spacer"></div>
                    <h1>Orbit Mode</h1>
                    <div class="control-item">
                        <span class="control-action">Orbit</span>
                        <span class="control-key">Left Mouse</span>
                    </div>
                    <div class="control-item">
                        <span class="control-action">Pan</span>
                        <span class="control-key">Right Mouse</span>
                    </div>
                    <div class="control-item">
                        <span class="control-action">Zoom</span>
                        <span class="control-key">Mouse Wheel</span>
                    </div>
                    <div class="control-item">
                        <span class="control-action">Set Focus</span>
                        <span class="control-key">Double Click</span>
                    </div>
                    <div class="control-spacer"></div>
                    <h1>Fly Mode</h1>
                    <div class="control-item">
                        <span class="control-action">Look Around</span>
                        <span class="control-key">Left Mouse</span>
                    </div>
                    <div class="control-item">
                        <span class="control-action">Fly</span>
                        <span class="control-key">W,S,A,D</span>
                    </div>
                    <div class="control-spacer"></div>
                    <div class="control-item">
                        <span class="control-action">Frame Scene</span>
                        <span class="control-key">F</span>
                    </div>
                    <div class="control-item">
                        <span class="control-action">Reset Camera</span>
                        <span class="control-key">R</span>
                    </div>
                    <div class="control-spacer"></div>
                    <h1>Effects</h1>
                    <div class="control-item">
                        <span class="control-action">Slow Motion</span>
                        <span class="control-key">m</span>
                    </div>
                </div>
                <div id="touchInfoPanel" class="hidden">
                    <div class="control-spacer"></div>
                    <h1>Orbit Mode</h1>
                    <div class="control-item">
                        <span class="control-action">Orbit</span>
                        <span class="control-key">One Finger Drag</span>
                    </div>
                    <div class="control-item">
                        <span class="control-action">Pan</span>
                        <span class="control-key">Two Finger Drag</span>
                    </div>
                    <div class="control-item">
                        <span class="control-action">Zoom</span>
                        <span class="control-key">Pinch</span>
                    </div>
                    <div class="control-item">
                        <span class="control-action">Set Focus</span>
                        <span class="control-key">Double Tap</span>
                    </div>
                    <div class="control-spacer"></div>
                    <h1>Fly Mode</h1>
                    <div class="control-item">
                        <span class="control-action">Look Around</span>
                        <span class="control-key">Touch on Right</span>
                    </div>
                    <div class="control-item">
                        <span class="control-action">Fly</span>
                        <span class="control-key">Touch on Left</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Touch Joystick -->
    <div id="joystickBase" class="hidden">
        <div id="joystick"></div>
    </div>

    <!-- Stats Panel -->
    <div id="statsPanel" class="hidden">
        <div id="statsPanelContent"></div>
    </div>

  `;const r=e||document.body;r&&r.classList.add("fdv-relative"),r.appendChild(s)}function Qw(t){const e=document.createElement("div");e.style.height="100%",e.innerHTML=`<pc-app antialias="false" depth="false" high-resolution="true" stencil="false">
    <pc-scene>
        <!-- Camera (with XR support) -->
        <pc-entity name="camera root">
            <pc-entity name="camera">
                <pc-camera near-clip="0.01" far-clip="100" horizontal-fov="true" tonemap="none"></pc-camera>
            </pc-entity>
            <!-- XR controllers will be added here -->
            <pc-scripts>
            </pc-scripts>
        </pc-entity>
        <!-- Light (for XR controllers) -->
        <pc-entity name="light" rotation="35 45 0">
            <pc-light color="white" intensity="1.5"></pc-light>
        </pc-entity>
    </pc-scene>
    </pc-app>`,(t||document.body).appendChild(e)}const $w=`* {
    margin: 0;
    padding: 0;
}

canvas {
    touch-action: none;
}

.hidden {
    display: none !important;
}

#ui {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

#ui * {
    pointer-events: auto;
    user-select: none;
}

#infoPanel {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.3);
}

#infoPanel>#infoPanelContent {
    position: absolute;
    top: 40px;
    left: 50%;
    transform: translate(-50%, 0);
    min-height: 280px;
    min-width: 320px;
    padding: 8px;
    border-radius: 24px;
    color: black;
    background-color: #eeed;
    display: flex;
    flex-direction: column;
}

#infoPanel>#infoPanelContent>#header {
    font-size: 24px;
    font-weight: bold;
    padding-bottom: 16px;
    color: #444;
    display: none;
}

#infoPanel>#infoPanelContent>#tabs {
    display: flex;
    gap: 16px;
    background-color: #666;
    padding: 8px;
    border-radius: 22px;
}

#infoPanel>#infoPanelContent>#tabs>.tab {
    padding: 8px;
    border-radius: 16px;
    cursor: pointer;
    flex-grow: 1;
    text-align: center;
    font-weight: bold;
    font-size: 14px;
    color: #222;
    transition: background-color 250ms ease;
}

#infoPanel>#infoPanelContent>#tabs>.tab:hover {
    background-color: #eee;
}

#infoPanel>#infoPanelContent>#tabs>.tab.active {
    background-color: #eee;
}

#infoPanel>#infoPanelContent>#infoPanels {
    padding: 16px;
}

#infoPanel>#infoPanelContent .control-item {
    display: flex;
    justify-content: space-between;
    gap: 32px;
    line-height: 1.5;
}

#infoPanel>#infoPanelContent>#infoPanels h1 {
    font-size: 14px;
    font-weight: bold;
    padding: 0 0 6px 0;
}

#infoPanel>#infoPanelContent .control-item>.control-action {
    text-align: left;
    color: #333;
}

#infoPanel>#infoPanelContent .control-item>.control-key {
    text-align: right;
    color: #666;
}

#infoPanel>#infoPanelContent .control-spacer {
    border-bottom: 1px dashed #666;
    margin: 10px 0;
}

/* loadingWrap */

#loadingWrap {
    position: absolute;
    bottom: 120px;
    left: 50%;
    transform: translate(-50%, 0);
    width: 380px;

    display: flex;
    flex-direction: column;

    padding: 16px;
}

#loadingWrap>#loadingText {
    font-size: 18px;
    color: white;
    text-align: center;
    text-shadow: 0 0 4px rgba(0, 0, 0, 0.5);
}

@keyframes progress-background {
    from {
        background-position: 0 0
    }

    to {
        background-position: 24px 0
    }
}

#loadingWrap>#loadingBar {
    position: relative;
    width: 100%;
    height: 4px;
    margin-top: 8px;
    border-radius: 4px;
    overflow: hidden;
    border: 1px #ccc solid;
}
.pageLoading {
    background: #2F2F2F;
    background: linear-gradient(135deg, #737373 0%, #737373 25%, #2F2F2F 26%, #2F2F2F 50%, #737373 51%, #737373 75%, #2F2F2F 76%, #2F2F2F 100%);
    background-position: 0 0;
    background-size: 24px 24px;
    background-repeat: repeat;
    animation: progress-background 1000ms linear infinite;
}

#loadingWrap>#loadingBar>#loadingFill {
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    background-color: #ccc;
    right: 100%;
    transition: all 0.3s ease-in-out;
    border-radius: 4px;
}

/* controlsWrap */

#controlsWrap {
    position: absolute;
    left: max(16px, env(safe-area-inset-left));
    right: max(16px, env(safe-area-inset-right));
    bottom: max(16px, env(safe-area-inset-bottom));

    display: flex;
    flex-direction: column;
}

#controlsWrap.faded-in {
    visibility: visible;
    opacity: 1;
    transition: opacity 0.5s ease-out;
}

.faded-out {
    visibility: hidden;
    opacity: 0;
    transition: visibility 0s 0.5s, opacity 0.5s ease-out;
}

#controlsWrap>#timelineContainer {
    height: 30px;
    cursor: pointer;
}

#controlsWrap>#timelineContainer>#line {
    width: 100%;
    height: 50%;
    border-bottom: 1px solid #8888;
}

#controlsWrap>#timelineContainer>#handle {
    position: absolute;
    top: 15.5px;
    width: 10px;
    height: 10px;
    transform: translate(-50%, -50%);
    border: 1px solid black;
    border-radius: 50%;
    background-color: #fff8;
}

#controlsWrap>#timelineContainer>#time {
    position: absolute;
    top: 0;
    padding: 2px 4px;
    transform: translate(-50%, -100%);
    font-size: 12px;
    color: white;
    background-color: rgba(0, 0, 0, 0.5);
    border-radius: 4px;
}

#volumeShow {
    display: flex;
    align-items: center;
    justify-content: center;
    box-sizing: border-box;
}

#volumeShow>#volumeContainer {
    position: absolute;
    bottom: 70px;
    transform: translateX(50%);
    height: 300px;
    width: 30px;
    cursor: pointer;
    z-index: 2;
    touch-action: none;
}

#volumeShow>#volumeContainer::after {
    content: '';
    position: absolute;
    width: 30px;
    left: -15px;
    height: 100%;
    top: -12px;
    padding: 12px 0 12px 0;
    background: rgba(221, 221, 221, 0.87);
    z-index: -1;
    border-radius: 6px;
    backdrop-filter: blur(10px);
}

#volumeShow>#volumeContainer>#volumeLine {
    width: 50%;
    height: 100%;
    border-left: 1px solid #8888;
}

#volumeShow>#volumeContainer>#volumeHandle {
    position: absolute;
    bottom: 0;
    width: 10px;
    height: 10px;
    transform: translateX(-50%);
    border: 1px solid black;
    border-radius: 50%;
    background-color: #fff8;
}

#volumeShow>#volumeContainer>#volume {
    position: absolute;
    bottom: 0;
    padding: 2px 4px;
    transform: translate(-50%, -100%);
    font-size: 12px;
    color: white;
    background-color: rgba(0, 0, 0, 0.5);
    border-radius: 4px;
}

#controlsWrap>#buttonContainer {
    display: flex;
    gap: 8px;
}

/* spacer */

.spacer {
    flex-grow: 1;
}

/* settingsPanel */

#settingsPanel {
    position: absolute;
    right: max(16px, env(safe-area-inset-right));
    bottom: calc(max(16px, env(safe-area-inset-bottom)) + 70px);
    padding: 10px;
    color: #eee;
    background-color: rgba(0, 0, 0, 0.3);
    border-radius: 8px;

    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 4px;

    font-size: 14px;
}

#settingsPanel>.settingsRow {
    display: flex;
    gap: 4px;
    width: 100%;

}

#settingsPanel>.settingsRow>.button {
    padding: 10px 0px;
    flex-grow: 1;
}

/* toggleWrap */

.toggleWrap {
    position: relative;
    background-color: #dddd;
    border: 1px solid #888;
    border-radius: 8px;
    height: 40px;
    width: 120px;
}

.toggleWrap>.toggleHighlight {
    position: absolute;
    left: 0;
    width: 50%;
    height: 100%;
    background-color: #eee;
    border-radius: 8px;
    transition: left 0.1s ease-out;
}

.toggleWrap>.toggleHighlight.right {
    left: 60px;
}

.toggleWrap>button {
    position: absolute;
    width: 60px;
    height: 100%;
    border: 0;
    border-radius: 8px;

    cursor: pointer;
    font-size: 14px;
    letter-spacing: -0.25px;

    color: #222;
    background-color: transparent;

    appearance: none;
}

.toggleWrap>button:hover {
    color: black;
}

.toggleWrap>button.left {
    left: 0;
}

.toggleWrap>button.right {
    right: 0;
}

/* button */
.button {
    width: 32px;
    height: 32px;
    padding: 0;
    margin: 0;
    color: #222;
    background-color: #dddd;
    border: 1px solid #888;
    border-radius: 6px;
    cursor: pointer;

    /* font-weight: bold; */
    font-size: 14px;
    letter-spacing: -0.25px;
}

.button:hover {
    background-color: #eee;
}

.button>svg {
    display: block;
    margin: auto;
}

#poster {
    display: none;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
}

#video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    pointer-events: none;
}
button {
    color: #222;
}

button:active {
    outline: none;
}

#joystickBase {
    position: absolute;
    width: 96px;
    height: 96px;
    transform: translate(-50%, -50%);
    border-radius: 50%;
    touch-action: none;

    background: radial-gradient(circle at center, #0000 50%, #000f 100%);
    background-color: #0002;
}

#joystickBase>#joystick {
    position: absolute;
    width: 48px;
    height: 48px;
    transform: translate(-50%, -50%);
    border-radius: 50%;
    touch-action: none;

    background-color: #fff8;
}

/* Stats Panel */
#statsPanel {
    position: absolute;
    top: 50px;
    right: 10px;
    bottom: auto;
    width: 280px;
    z-index: 100;
    background-color: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    overflow: auto;
    max-height: 80vh;
    padding: 4px;
    color: white;
    transition: opacity 0.3s ease;
    backdrop-filter: blur(5px);
}

#statsPanelContent {
    width: 100%;
    height: 100%;
}

/* PCUI 覆盖样式 */
.pcui-panel {
    background-color: transparent !important;
    border: none !important;
}

.pcui-panel-header {
    background-color: rgba(40, 40, 40, 0.6) !important;
    color: white !important;
}

.pcui-container {
    background-color: transparent !important;
}

.pcui-infobox {
    margin-bottom: 4px !important;
    background-color: rgba(40, 40, 40, 0.6) !important;
    border-radius: 2px !important;
}

.pcui-infobox-label {
    color: #cccccc !important;
    font-weight: bold !important;
    padding: 2px 4px !important;
    font-size: 12px !important;
}

.pcui-infobox-value {
    color: white !important;
    white-space: pre-line !important;
    padding: 4px !important;
    font-size: 10px !important;
    user-select: text !important;
    -webkit-user-select: text !important;
}

.pcui-button {
    margin-top: 10px !important;
    background-color: #4d4d4d !important;
    color: white !important;
    border: none !important;
}

.pcui-button:hover {
    background-color: #666666 !important;
}

#viewerInputContainer {
    width: 100%;
    height: 100%;
    overflow: scroll;
    box-sizing: border-box;
    display: flex;
    align-items: self-start;
    justify-content: center;
    background: linear-gradient(145deg, black, transparent);

.viewer-header {
        color: white;
        font-size: 12px;
        font-weight: bold;
        letter-spacing: 0.4px;
        margin-bottom: 12px;
    }

    .panel {
        width: 70vw;
        max-width: 550px;
        background: rgba(40, 40, 40, 0.3);
        padding: 12px;
        border-radius: 16px;
        backdrop-filter: blur(12px);
    }
    .drag-input {
        padding: 0 13px;
        height: 145px;
        background-color: rgba(40, 40, 40, 0.2509803922);
        border: 1px dashed #FFFFFF;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        border-radius: 12px;
        color: white;
        font-size: 12px;
        font-weight: 400;
        letter-spacing: 0.4px;
        word-break: break-all;
        cursor: pointer;
    }
    .drag-input:hover {
        border-color: cyan;
        color: cyan;
    }
    .text-input {
        flex: 1;
        min-height: 32px;
        border-radius: 4px;
        border: 1px solid transparent;
        color: white;
        font-size: 12px;
        font-weight: 400;
        letter-spacing: 0.4px;
        height: 24px;
        background-color: #484848;
        vertical-align: top;
        transition: color 100ms, background-color 100ms, box-shadow 100ms;

        input {
            padding: 0 18px;
            height: 100%;
            width: calc(100% - 32px);
            line-height: 1;
            color: inherit;
            background: transparent;
            border: none;
            outline: none;
            box-shadow: none;
        }
    }

    .text-input-checkbox {
        width: 16px;
        height: 16px;
    }

    .text-input:hover {
        border-color: cyan;
        /*color: cyan;*/
    }
    .text-input-position {
        margin-top: 8px;

        display: flex;
        gap: 8px;
        .text-input-inline {
            flex: 1;
            min-height: 32px;
            border-radius: 4px;
            border: 1px solid transparent;
            color: white;
            font-size: 12px;
            font-weight: 400;
            letter-spacing: 0.4px;
            height: 24px;
            background-color: #282828;
            vertical-align: top;
            transition: color 100ms, background-color 100ms, box-shadow 100ms;

            input {
                padding: 0 12px;
                height: 100%;
                width: calc(100% - 32px);
                line-height: 1;
                color: inherit;
                background: transparent;
                border: none;
                outline: none;
                box-shadow: none;
            }
        }
    }
    .panel-footer {
        margin-top: 12px;
        display: flex;
        justify-content: flex-end;
        gap: 12px;
    }
}
.fdv-item-center {
      align-items: center !important;
  }
.text-input-label {
    font-size: 14px;
    display: flex;
    align-items: center;
    color: white;
    width: 132px;
}
.error-tips {
    color: #ff0000;
    display: flex;
    align-items: center;
}

.text-button {
    user-select: none;
    display: inline-block;
    box-sizing: border-box;
    padding: 0 8px;
    margin: 6px;
    height: 28px;
    line-height: 28px;
    max-height: 100%;
    vertical-align: middle;
    text-align: center;
    white-space: nowrap;
    cursor: pointer;
    transition: color 100ms, opacity 100ms, box-shadow 100ms;
    overflow: hidden;
    text-overflow: ellipsis;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 400;
    letter-spacing: 0.4px;
    min-height: 38px;
    min-width: 80px;
    background-color: white;
    color: black;
    border: none;
}
.text-button:hover {
    background-color: #282828;
    color: cyan;
    opacity: 0.8;
    box-shadow: 0 0 2px 1px cyan;
}

.text-button-disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.text-button-disabled:hover {
    background-color: white;
    color: black;
    opacity: 0.5;
    cursor: not-allowed;
}
#tips {
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    min-height: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(12px);
    transition: all 300ms linear;
}

#tips>#tipsConfirm {
    min-height: 20px;
}

#noRepeatWrap {
    /*position: absolute;*/
    /*bottom: 0;*/
    /*left: 0;*/
    /*right: 0;*/
    /*background: rgba(0, 0, 0, 0.3);*/
    /*backdrop-filter: blur(12px);*/
    transition: all 300ms linear;

    padding: 8px 0 0;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2;

    color: white;
}
#noRepeatWrap>#noRepeatPanel>.btnWrapper {
    margin-top: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
}
#noRepeatWrap>#noRepeatPanel>#splatsListWrapper {
    width: calc(100vw - 32px);
    overflow-x: auto;
    white-space: nowrap;
    -webkit-overflow-scrolling: touch;
}

#splatsList {
    display: flex;
    gap: 12px;
    margin: 6px auto 0;
    align-items: center;
    justify-content: center;
}

#splatsList>div {
    position: relative;
    aspect-ratio: 16 / 9;
    display: inline-flex;
    cursor: pointer;
    align-items: center;
    justify-content: center;
    background-color: rgba(40, 40, 40, 0.3);
    overflow: hidden;
    border-radius: 8px;
}
.checked {
    border: 1px solid rgba(255,255,255,1);
}
#noRepeatWrap>#noRepeatPanel>.btnWrapper>.text-button {
    min-height: 20px;
}

@keyframes shake {
    0% {
        transform: translate(-50%, -50%);
    }
    25% {
        transform: translate(-150%, -50%);
    }
    75% {
        transform: translate(50%, -50%);
    }
    100% {
        transform: translate(-50%, -50%);
    }
}
@keyframes fade-up {
    0% {
        opacity: 0;
        transform: translateY(2rem);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
    }
}
.cursor {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);

    animation: shake 5s linear 0s both;
    animation-iteration-count: infinite;
    animation-delay: 0s;
    pointer-events: none;
    transition: all 300ms linear;
}
#nextTip {
    width: 50px;
    height: 50px;
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
}
#openGuideIcon {
    width: 24px;
    position: absolute;
    bottom: 0;
    cursor: pointer;
    transform: rotate(180deg);
    opacity: 0;
}
#openGuideIcon.open {
    transform: rotate(0deg);
    opacity: 1;
    padding-bottom: 6px;
}

#cancelWheel, #enterWheel  {
    position: absolute;
    bottom: 200px;
    left: 50%;
    transform: translateX(-50%);
    cursor: pointer;
    opacity: 0.6;
    width: 150px;
}

#allTip, #questTip, #mobileTip {
    color: #FCFAFA;
    padding: 12px 0 12px 0;
    max-width: 70vw;
    font-size: 12px;
    text-align: center;
}
.font-bold {
    font-weight: bold;
}

* {
    user-select: none;
    -webkit-user-select: none;
    -webkit-tap-highlight-color: transparent; /* 移除点击高亮 */
    -webkit-touch-callout: none; /* 禁用长按菜单 */
    user-select: none; /* 禁止文本选择 */
}

::selection {
    background: transparent;
}

#maxIconWrapper {
    position: absolute;
    bottom: 16px;
    right: 16px;
    display: flex;
    gap: 6px;
}
.maxIcon, .miniVoiceIcon {
    width: 28px;
    height: 28px;
    padding: 6px;
    color: #fff;
    background-color: rgba(0,0,0,0.3);
    backdrop-filter: blur(12px);
    border-radius: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}
.miniVoiceIcon {
    position: absolute;
    top: 6px;
    left: 6px;
    width: 14px;
    height: 14px;
    padding: 3px;
}
.maxIcon>svg, .miniVoiceIcon>svg {
    cursor: pointer;
    width: 100%;
    height: 100%;
}

/* 移动设备适配 */
@media (max-height: 768px), (max-width: 768px) {
    #statsPanel {
        width: 90%;
        left: 5%;
        right: 5%;
        max-height: 70vh;
    }
    #viewerInputContainer {
        align-items: start;
        padding: 24px 0 0;
        .panel {
            width: 100vw;
            min-height: 100%;
            max-width: 768px;
            border-radius: 0;
        }
    }
    .text-input {
        min-height: 32px;
        font-size: 14px;
    }
}

.fdv-relative {
    position: relative;
  }

canvas {
    width: 100% !important;
    height: 100% !important;
}
`,qo=new Set,Hw=(t,e="")=>{if(typeof document>"u"||e&&qo.has(e))return;const n=document.createElement("style");n.type="text/css",e&&(n.id=e,qo.add(e)),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t)),document.head.appendChild(n)},zw=async()=>{if(qo.has("__global_styles"))return;Hw($w,"__global_styles")};var Fn,ds,_e={isResourceTiming:!1,isElementTiming:!1,maxTime:3e4,reportOptions:{}},As=globalThis,qw=As.console,Ut=As.navigator,qs=As.performance,jo=function(){return Ut.deviceMemory},Wo=function(){return Ut.hardwareConcurrency},Pl=function(){return qs&&!!qs.getEntriesByType&&!!qs.now&&!!qs.mark},t0="4g",n0=!1,s0={value:0},Vo={value:{beacon:0,css:0,fetch:0,img:0,other:0,script:0,total:0,xmlhttprequest:0}},Ko={value:0},jw={value:0},_l={},tr={isHidden:!1,didChange:!1},Ww=function(){tr.isHidden=!1,document.hidden&&(tr.isHidden=document.hidden,tr.didChange=!0)},Go=function(t,e){try{var n=new PerformanceObserver(function(s){e(s.getEntries())});return n.observe({type:t,buffered:!0}),n}catch(s){qw.warn("Perfume.js:",s)}return null},r0=function(){return!!(Wo()&&Wo()<=4)||!!(jo()&&jo()<=4)},Vw=function(t,e){switch(t){case"slow-2g":case"2g":case"3g":return!0;default:return r0()||e}},Ka=function(t){return parseFloat(t.toFixed(4))},$s=function(t){return typeof t!="number"?null:Ka(t/Math.pow(1024,2))},i0=function(t,e,n,s,r){var i,o=function(){_e.analyticsTracker&&(tr.isHidden&&!["CLS","INP"].includes(t)||_e.analyticsTracker({attribution:s,metricName:t,data:e,navigatorInformation:Ut?{deviceMemory:jo()||0,hardwareConcurrency:Wo()||0,serviceWorkerStatus:"serviceWorker"in Ut?Ut.serviceWorker.controller?"controlled":"supported":"unsupported",isLowEndDevice:r0(),isLowEndExperience:Vw(t0,n0)}:{},rating:n,navigationType:r}))};["CLS","INP"].includes(t)?o():(i=o,"requestIdleCallback"in As?As.requestIdleCallback(i,{timeout:3e3}):i())},Kw=function(t){t.forEach(function(e){if(!(e.name!=="self"||e.startTime<s0.value)){var n=e.duration-50;n>0&&(Ko.value+=n,jw.value+=n)}})};(function(t){t.instant="instant",t.quick="quick",t.moderate="moderate",t.slow="slow",t.unavoidable="unavoidable"})(Fn||(Fn={}));var mn,nr,o0,ii,Zo;(ds={})[Fn.instant]={vitalsThresholds:[100,200],maxOutlierThreshold:1e4},ds[Fn.quick]={vitalsThresholds:[200,500],maxOutlierThreshold:1e4},ds[Fn.moderate]={vitalsThresholds:[500,1e3],maxOutlierThreshold:1e4},ds[Fn.slow]={vitalsThresholds:[1e3,2e3],maxOutlierThreshold:1e4},ds[Fn.unavoidable]={vitalsThresholds:[2e3,5e3],maxOutlierThreshold:2e4};var bo={RT:[100,200],TBT:[200,600],NTBT:[200,600]},a0=function(t,e){return bo[t]?e<=bo[t][0]?"good":e<=bo[t][1]?"needsImprovement":"poor":null},cr=function(t,e,n){Object.keys(e).forEach(function(s){typeof e[s]=="number"&&(e[s]=Ka(e[s]))}),i0(t,e,null,{})},Xt=function(t){var e=t.attribution,n=t.name,s=t.rating,r=t.value,i=t.navigationType;n==="FCP"&&(s0.value=r),["FCP","LCP"].includes(n)&&!_l[0]&&(_l[0]=Go("longtask",Kw)),n==="FID"&&setTimeout(function(){tr.didChange||(Xt({attribution:e,name:"TBT",rating:a0("TBT",Ko.value),value:Ko.value,navigationType:i}),cr("dataConsumption",Vo.value))},1e4);var o=Ka(r);o<=_e.maxTime&&o>=0&&i0(n,o,s,e,i)},ks=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},js=function(t){if(document.readyState==="loading")return"loading";var e=ks();if(e){if(t<e.domInteractive)return"loading";if(e.domContentLoadedEventStart===0||t<e.domContentLoadedEventStart)return"dom-interactive";if(e.domComplete===0||t<e.domComplete)return"dom-content-loaded"}return"complete"},Gw=function(t){var e=t.nodeName;return t.nodeType===1?e.toLowerCase():e.toUpperCase().replace(/^#/,"")},$r=function(t,e){var n="";try{for(;t&&t.nodeType!==9;){var s=t,r=s.id?"#"+s.id:Gw(s)+(s.classList&&s.classList.value&&s.classList.value.trim()&&s.classList.value.trim().length?"."+s.classList.value.trim().replace(/\s+/g,"."):"");if(n.length+r.length>(e||100)-1)return n||r;if(n=n?r+">"+n:r,s.id)break;t=s.parentNode}}catch{}return n},c0=-1,d0=function(){return c0},Hn=function(t){addEventListener("pageshow",function(e){e.persisted&&(c0=e.timeStamp,t(e))},!0)},xi=function(){var t=ks();return t&&t.activationStart||0},Nt=function(t,e){var n=ks(),s="navigate";return d0()>=0?s="back-forward-cache":n&&(document.prerendering||xi()>0?s="prerender":document.wasDiscarded?s="restore":n.type&&(s=n.type.replace(/_/g,"-"))),{name:t,value:e===void 0?-1:e,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:s}},Ps=function(t,e,n){try{if(PerformanceObserver.supportedEntryTypes.includes(t)){var s=new PerformanceObserver(function(r){Promise.resolve().then(function(){e(r.getEntries())})});return s.observe(Object.assign({type:t,buffered:!0},n||{})),s}}catch{}},Ot=function(t,e,n,s){var r,i;return function(o){e.value>=0&&(o||s)&&((i=e.value-(r||0))||r===void 0)&&(r=e.value,e.delta=i,e.rating=function(a,d){return a>d[1]?"poor":a>d[0]?"needs-improvement":"good"}(e.value,n),t(e))}},Xo=function(t){requestAnimationFrame(function(){return requestAnimationFrame(function(){return t()})})},oi=function(t){var e=function(n){n.type!=="pagehide"&&document.visibilityState!=="hidden"||t(n)};addEventListener("visibilitychange",e,!0),addEventListener("pagehide",e,!0)},Yo=function(t){var e=!1;return function(n){e||(t(n),e=!0)}},hs=-1,Tl=function(){return document.visibilityState!=="hidden"||document.prerendering?1/0:0},ai=function(t){document.visibilityState==="hidden"&&hs>-1&&(hs=t.type==="visibilitychange"?t.timeStamp:0,Zw())},Rl=function(){addEventListener("visibilitychange",ai,!0),addEventListener("prerenderingchange",ai,!0)},Zw=function(){removeEventListener("visibilitychange",ai,!0),removeEventListener("prerenderingchange",ai,!0)},Ga=function(){return hs<0&&(hs=Tl(),Rl(),Hn(function(){setTimeout(function(){hs=Tl(),Rl()},0)})),{get firstHiddenTime(){return hs}}},vr=function(t){document.prerendering?addEventListener("prerenderingchange",function(){return t()},!0):t()},Ml=[1800,3e3],Il=function(t,e){e=e||{},vr(function(){var n,s=Ga(),r=Nt("FCP"),i=Ps("paint",function(o){o.forEach(function(a){a.name==="first-contentful-paint"&&(i.disconnect(),a.startTime<s.firstHiddenTime&&(r.value=Math.max(a.startTime-xi(),0),r.entries.push(a),n(!0)))})});i&&(n=Ot(t,r,Ml,e.reportAllChanges),Hn(function(o){r=Nt("FCP"),n=Ot(t,r,Ml,e.reportAllChanges),Xo(function(){r.value=performance.now()-o.timeStamp,n(!0)})}))})},Ll=[.1,.25],Ws={passive:!0,capture:!0},Xw=new Date,Bl=function(t,e){mn||(mn=e,nr=t,o0=new Date,u0(removeEventListener),l0())},l0=function(){if(nr>=0&&nr<o0-Xw){var t={entryType:"first-input",name:mn.type,target:mn.target,cancelable:mn.cancelable,startTime:mn.timeStamp,processingStart:mn.timeStamp+nr};ii.forEach(function(e){e(t)}),ii=[]}},Yw=function(t){if(t.cancelable){var e=(t.timeStamp>1e12?new Date:performance.now())-t.timeStamp;t.type=="pointerdown"?function(n,s){var r=function(){Bl(n,s),o()},i=function(){o()},o=function(){removeEventListener("pointerup",r,Ws),removeEventListener("pointercancel",i,Ws)};addEventListener("pointerup",r,Ws),addEventListener("pointercancel",i,Ws)}(e,t):Bl(e,t)}},u0=function(t){["mousedown","keydown","touchstart","pointerdown"].forEach(function(e){return t(e,Yw,Ws)})},Fl=[100,300],Jw=function(t,e){e=e||{},vr(function(){var n,s=Ga(),r=Nt("FID"),i=function(d){d.startTime<s.firstHiddenTime&&(r.value=d.processingStart-d.startTime,r.entries.push(d),n(!0))},o=function(d){d.forEach(i)},a=Ps("first-input",o);n=Ot(t,r,Fl,e.reportAllChanges),a&&oi(Yo(function(){o(a.takeRecords()),a.disconnect()})),a&&Hn(function(){var d;r=Nt("FID"),n=Ot(t,r,Fl,e.reportAllChanges),ii=[],nr=-1,mn=null,u0(addEventListener),d=i,ii.push(d),l0()})})},h0=0,vo=1/0,Br=0,e5=function(t){t.forEach(function(e){e.interactionId&&(vo=Math.min(vo,e.interactionId),Br=Math.max(Br,e.interactionId),h0=Br?(Br-vo)/7+1:0)})},f0=function(){return Zo?h0:performance.interactionCount||0},t5=function(){"interactionCount"in performance||Zo||(Zo=Ps("event",e5,{type:"event",buffered:!0,durationThreshold:0}))},Dl=[200,500],p0=0,Nl=function(){return f0()-p0},Wt=[],xo={},Ol=function(t){var e=Wt[Wt.length-1],n=xo[t.interactionId];if(n||Wt.length<10||t.duration>e.latency){if(n)n.entries.push(t),n.latency=Math.max(n.latency,t.duration);else{var s={id:t.interactionId,latency:t.duration,entries:[t]};xo[s.id]=s,Wt.push(s)}Wt.sort(function(r,i){return i.latency-r.latency}),Wt.splice(10).forEach(function(r){delete xo[r.id]})}},n5=function(t,e){(function(n,s){s=s||{},vr(function(){var r;t5();var i,o=Nt("INP"),a=function(c){c.forEach(function(h){h.interactionId&&Ol(h),h.entryType==="first-input"&&!Wt.some(function(f){return f.entries.some(function(y){return h.duration===y.duration&&h.startTime===y.startTime})})&&Ol(h)});var l,u=(l=Math.min(Wt.length-1,Math.floor(Nl()/50)),Wt[l]);u&&u.latency!==o.value&&(o.value=u.latency,o.entries=u.entries,i())},d=Ps("event",a,{durationThreshold:(r=s.durationThreshold)!==null&&r!==void 0?r:40});i=Ot(n,o,Dl,s.reportAllChanges),d&&("PerformanceEventTiming"in window&&"interactionId"in PerformanceEventTiming.prototype&&d.observe({type:"first-input",buffered:!0}),oi(function(){a(d.takeRecords()),o.value<0&&Nl()>0&&(o.value=0,o.entries=[]),i(!0)}),Hn(function(){Wt=[],p0=f0(),o=Nt("INP"),i=Ot(n,o,Dl,s.reportAllChanges)}))})})(function(n){(function(s){if(s.entries.length){var r=s.entries.sort(function(o,a){return a.duration-o.duration||a.processingEnd-a.processingStart-(o.processingEnd-o.processingStart)})[0],i=s.entries.find(function(o){return o.target});s.attribution={eventTarget:$r(i&&i.target),eventType:r.name,eventTime:r.startTime,eventEntry:r,loadState:js(r.startTime)}}else s.attribution={}})(n),t(n)},e)},Ul=[2500,4e3],So={},Ql=[800,1800],s5=function t(e){document.prerendering?vr(function(){return t(e)}):document.readyState!=="complete"?addEventListener("load",function(){return t(e)},!0):setTimeout(e,0)},r5=function(t,e){e=e||{};var n=Nt("TTFB"),s=Ot(t,n,Ql,e.reportAllChanges);s5(function(){var r=ks();if(r){var i=r.responseStart;if(i<=0||i>performance.now())return;n.value=Math.max(i-xi(),0),n.entries=[r],s(!0),Hn(function(){n=Nt("TTFB",0),(s=Ot(t,n,Ql,e.reportAllChanges))(!0)})}})},i5=function(t){t.forEach(function(e){e.identifier&&Xt({attribution:{identifier:e.identifier},name:"ET",rating:null,value:e.startTime})})},o5=function(t){t.forEach(function(e){if(_e.isResourceTiming&&cr("resourceTiming",e),e.decodedBodySize&&e.initiatorType){var n=e.decodedBodySize/1e3;Vo.value[e.initiatorType]+=n,Vo.value.total+=n}})},a5=function(){(function(t,e){r5(function(n){(function(s){if(s.entries.length){var r=s.entries[0],i=r.activationStart||0,o=Math.max(r.domainLookupStart-i,0),a=Math.max(r.connectStart-i,0),d=Math.max(r.requestStart-i,0);s.attribution={waitingTime:o,dnsTime:a-o,connectionTime:d-a,requestTime:s.value-d,navigationEntry:r}}else s.attribution={waitingTime:0,dnsTime:0,connectionTime:0,requestTime:0}})(n),t(n)},e)})(function(t){t.value>0&&Xt(t)},_e.reportOptions.ttfb),function(t,e){(function(n,s){s=s||{},Il(Yo(function(){var r,i=Nt("CLS",0),o=0,a=[],d=function(l){l.forEach(function(u){if(!u.hadRecentInput){var h=a[0],f=a[a.length-1];o&&u.startTime-f.startTime<1e3&&u.startTime-h.startTime<5e3?(o+=u.value,a.push(u)):(o=u.value,a=[u])}}),o>i.value&&(i.value=o,i.entries=a,r())},c=Ps("layout-shift",d);c&&(r=Ot(n,i,Ll,s.reportAllChanges),oi(function(){d(c.takeRecords()),r(!0)}),Hn(function(){o=0,i=Nt("CLS",0),r=Ot(n,i,Ll,s.reportAllChanges),Xo(function(){return r()})}),setTimeout(r,0))}))})(function(n){(function(s){if(s.entries.length){var r=s.entries.reduce(function(a,d){return a&&a.value>d.value?a:d});if(r&&r.sources&&r.sources.length){var i=(o=r.sources).find(function(a){return a.node&&a.node.nodeType===1})||o[0];if(i)return void(s.attribution={largestShiftTarget:$r(i.node),largestShiftTime:r.startTime,largestShiftValue:r.value,largestShiftSource:i,largestShiftEntry:r,loadState:js(r.startTime)})}}var o;s.attribution={}})(n),t(n)},e)}(function(t){return Xt(t)},_e.reportOptions.cls),function(t,e){Il(function(n){(function(s){if(s.entries.length){var r=ks(),i=s.entries[s.entries.length-1];if(r){var o=r.activationStart||0,a=Math.max(0,r.responseStart-o);return void(s.attribution={timeToFirstByte:a,firstByteToFCP:s.value-a,loadState:js(s.entries[0].startTime),navigationEntry:r,fcpEntry:i})}}s.attribution={timeToFirstByte:0,firstByteToFCP:s.value,loadState:js(d0())}})(n),t(n)},e)}(function(t){return Xt(t)},_e.reportOptions.fcp),function(t,e){Jw(function(n){(function(s){var r=s.entries[0];s.attribution={eventTarget:$r(r.target),eventType:r.name,eventTime:r.startTime,eventEntry:r,loadState:js(r.startTime)}})(n),t(n)},e)}(function(t){return Xt(t)},_e.reportOptions.fid),function(t,e){(function(n,s){s=s||{},vr(function(){var r,i=Ga(),o=Nt("LCP"),a=function(l){var u=l[l.length-1];u&&u.startTime<i.firstHiddenTime&&(o.value=Math.max(u.startTime-xi(),0),o.entries=[u],r())},d=Ps("largest-contentful-paint",a);if(d){r=Ot(n,o,Ul,s.reportAllChanges);var c=Yo(function(){So[o.id]||(a(d.takeRecords()),d.disconnect(),So[o.id]=!0,r(!0))});["keydown","click"].forEach(function(l){addEventListener(l,function(){return setTimeout(c,0)},!0)}),oi(c),Hn(function(l){o=Nt("LCP"),r=Ot(n,o,Ul,s.reportAllChanges),Xo(function(){o.value=performance.now()-l.timeStamp,So[o.id]=!0,r(!0)})})}})})(function(n){(function(s){if(s.entries.length){var r=ks();if(r){var i=r.activationStart||0,o=s.entries[s.entries.length-1],a=o.url&&performance.getEntriesByType("resource").filter(function(f){return f.name===o.url})[0],d=Math.max(0,r.responseStart-i),c=Math.max(d,a?(a.requestStart||a.startTime)-i:0),l=Math.max(c,a?a.responseEnd-i:0),u=Math.max(l,o?o.startTime-i:0),h={element:$r(o.element),timeToFirstByte:d,resourceLoadDelay:c-d,resourceLoadTime:l-c,elementRenderDelay:u-l,navigationEntry:r,lcpEntry:o};return o.url&&(h.url=o.url),a&&(h.lcpResourceEntry=a),void(s.attribution=h)}}s.attribution={timeToFirstByte:0,resourceLoadDelay:0,resourceLoadTime:0,elementRenderDelay:s.value}})(n),t(n)},e)}(function(t){return Xt(t)},_e.reportOptions.lcp),n5(function(t){return Xt(t)},_e.reportOptions.inp),_e.isResourceTiming&&Go("resource",o5),_e.isElementTiming&&Go("element",i5)},c5=function(t){var e="usageDetails"in t?t.usageDetails:{};cr("storageEstimate",{quota:$s(t.quota),usage:$s(t.usage),caches:$s(e.caches),indexedDB:$s(e.indexedDB),serviceWorker:$s(e.serviceWorkerRegistrations)})},Vt={finalMarkToStepsMap:{},startMarkToStepsMap:{},active:{},navigationSteps:{}},d5=function(){Vt.startMarkToStepsMap={},Vt.finalMarkToStepsMap={},Vt.active={},Vt.navigationSteps={}},l5=function(t){if(t===void 0&&(t={}),_e.analyticsTracker=t.analyticsTracker,_e.isResourceTiming=!!t.resourceTiming,_e.isElementTiming=!!t.elementTiming,_e.maxTime=t.maxMeasureTime||_e.maxTime,_e.reportOptions=t.reportOptions||_e.reportOptions,_e.steps=t.steps,_e.onMarkStep=t.onMarkStep,Pl()){"PerformanceObserver"in As&&a5(),document.hidden!==void 0&&document.addEventListener("visibilitychange",Ww);var e=function(){if(!Pl())return{};var n=qs.getEntriesByType("navigation")[0];if(!n)return{};var s=n.responseStart,r=n.responseEnd;return{fetchTime:r-n.fetchStart,workerTime:n.workerStart>0?r-n.workerStart:0,totalTime:r-n.requestStart,downloadTime:r-s,timeToFirstByte:s-n.requestStart,headerSize:n.transferSize-n.encodedBodySize||0,dnsLookupTime:n.domainLookupEnd-n.domainLookupStart,redirectTime:n.redirectEnd-n.redirectStart}}();cr("navigationTiming",e),e.redirectTime&&Xt({attribution:{},name:"RT",rating:a0("RT",e.redirectTime),value:e.redirectTime}),cr("networkInformation",function(){if("connection"in Ut){var n=Ut.connection;return typeof n!="object"?{}:(t0=n.effectiveType,n0=!!n.saveData,{downlink:n.downlink,effectiveType:n.effectiveType,rtt:n.rtt,saveData:!!n.saveData})}return{}}()),Ut&&Ut.storage&&typeof Ut.storage.estimate=="function"&&Ut.storage.estimate().then(c5),_e.steps&&_e.steps&&(d5(),Object.entries(_e.steps).forEach(function(n){var s,r,i=n[0],o=n[1].marks,a=o[0],d=o[1],c=(r=Vt.startMarkToStepsMap[a])!==null&&r!==void 0?r:{};if(c[i]=!0,Vt.startMarkToStepsMap[a]=c,Vt.finalMarkToStepsMap[d]){var l=Vt.finalMarkToStepsMap[d][a]||[];l.push(i),Vt.finalMarkToStepsMap[d][a]=l}else Vt.finalMarkToStepsMap[d]=((s={})[a]=[i],s)}))}};const u5=()=>l5({analyticsTracker:t=>{const{attribution:e,metricName:n,data:s,navigatorInformation:r,rating:i,navigationType:o}=t;switch(n){case"navigationTiming":break;case"networkInformation":break;case"storageEstimate":console.log("storageEstimate",s);break;case"TTFB":console.log("timeToFirstByte",{duration:s});break;case"RT":console.log("redirectTime",{duration:s});break;case"FCP":console.log("firstContentfulPaint",{duration:s});break;case"FID":console.log("firstInputDelay",{duration:s});break;case"LCP":console.log("largestContentfulPaint",{duration:s});break;case"CLS":console.log("cumulativeLayoutShift",{value:s});break;case"INP":console.log("interactionToNextPaint",{value:s});break;case"TBT":console.log("totalBlockingTime",{duration:s});break;case"elPageTitle":console.log("elementTimingPageTitle",{duration:s});break;case"userJourneyStep":break;default:console.log(n,{duration:s});break}}});let $l=0;const h5=t=>{var r,i,o,a,d,c,l;const e=typeof t.contentUrl=="string"?1:(r=t.contentUrl)==null?void 0:r.length,n={contentUrl:t.contentUrl,audioUrl:t.audioUrl,timeOption:li({startNumber:0,spaceTime:5,number:e}),position:ke(Qe.position),rotation:ke(Qe.rotation),scale:ke(Qe.scale)},s={...ls.settings||{},animTracks:[{...((o=(i=ls.settings)==null?void 0:i.animTracks)==null?void 0:o[0])||{},duration:t.duration||e*5||5,frameRate:((c=(d=(a=ls.settings)==null?void 0:a.animTracks)==null?void 0:d[0])==null?void 0:c.frameRate)||60},...((l=ls.settings)==null?void 0:l.animTracks)||[]]};return{showGuideList:!1,contentUrl:t.contentUrl,audioUrl:t.audioUrl,rawName:t.rawName,settings:Object.assign({},s,t.settings),metaInfo:Object.assign({},n,t.metaInfo)}},Jo=async()=>{var e;const t=document.querySelector("pc-app");return t?(e=await(t==null?void 0:t.ready()))==null?void 0:e.app:null},f5=()=>{const{initSuperStatus:t}=Dt.getSSE();if(!t)return Promise.reject("SUPER4D: should init Super4D-Viewer, please check initSuper4D function")},Hl=async t=>{if(f5(),!t)return Promise.reject("SUPER4D: no render info");const e=h5(t);return await dr(e),await Jo()},zl=async t=>{const{position:e,fov:n,target:s}=t,{events:r}=Dt.getSSE(),i=r.invoke("getOrbitCameraActive",{position:e,fov:n,target:s});return i||(window.super_camera_setting=(window.super_camera_setting??[]).concat([t])),i},p5=async t=>{const e=await Jo();if(e||$l>0)return e?{app:e,renderSuper4DSplat:Hl,setCameraSetting:zl}:null;const{root:n,noContainer:s=!1}={};return Qw(n),Uw({root:n,noContainer:s}),$l=1,await zw(),Dw(),u5(),Dt.updateSSE({initSuperStatus:!0}),await Jo()?{app:e,renderSuper4DSplat:Hl,setCameraSetting:zl}:null};document.addEventListener("DOMContentLoaded",async()=>{await p5(),await Ow()});
